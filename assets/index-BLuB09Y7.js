function go(l,s){for(var o=0;o<s.length;o++){const c=s[o];if(typeof c!="string"&&!Array.isArray(c)){for(const d in c)if(d!=="default"&&!(d in l)){const f=Object.getOwnPropertyDescriptor(c,d);f&&Object.defineProperty(l,d,f.get?f:{enumerable:!0,get:()=>c[d]})}}}return Object.freeze(Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const f of d)if(f.type==="childList")for(const p of f.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&c(p)}).observe(document,{childList:!0,subtree:!0});function o(d){const f={};return d.integrity&&(f.integrity=d.integrity),d.referrerPolicy&&(f.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?f.credentials="include":d.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function c(d){if(d.ep)return;d.ep=!0;const f=o(d);fetch(d.href,f)}})();class gc{constructor(){this.routes={},this.currentRoute=null,this.currentComponent=null,window.addEventListener("hashchange",()=>this.handleRoute()),window.addEventListener("load",()=>this.handleRoute())}register(s,o){this.routes[s]=o}navigate(s,o={}){const c=o?`#${s}?${new URLSearchParams(o).toString()}`:`#${s}`;window.location.hash=c}handleRoute(){const s=window.location.hash.slice(1)||"onboarding",[o,c]=s.split("?"),d=new URLSearchParams(c),f={};d.forEach((w,b)=>{f[b]=w});let p=this.routes[o];if(!p){for(const[w,b]of Object.entries(this.routes))if(w.includes(":")){const m=new RegExp("^"+w.replace(/:[^/]+/g,"([^/]+)")+"$"),A=o.match(m);if(A){p=b;const _=w.match(/:[^/]+/g);_&&_.forEach((O,D)=>{f[O.slice(1)]=A[D+1]});break}}}p?this.renderComponent(p,f):console.error("Route not found:",o)}renderComponent(s,o){const c=document.getElementById("app");this.currentComponent&&this.currentComponent.cleanup&&this.currentComponent.cleanup(),c.innerHTML="",this.currentComponent=new s(c,o),this.currentRoute=window.location.hash.slice(1)}back(){window.history.back()}}const un=new gc,xi=(l,s)=>s.some(o=>l instanceof o);let hs,fs;function pc(){return hs||(hs=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function xc(){return fs||(fs=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const mi=new WeakMap,Gr=new WeakMap,yr=new WeakMap;function mc(l){const s=new Promise((o,c)=>{const d=()=>{l.removeEventListener("success",f),l.removeEventListener("error",p)},f=()=>{o(dn(l.result)),d()},p=()=>{c(l.error),d()};l.addEventListener("success",f),l.addEventListener("error",p)});return yr.set(s,l),s}function wc(l){if(mi.has(l))return;const s=new Promise((o,c)=>{const d=()=>{l.removeEventListener("complete",f),l.removeEventListener("error",p),l.removeEventListener("abort",p)},f=()=>{o(),d()},p=()=>{c(l.error||new DOMException("AbortError","AbortError")),d()};l.addEventListener("complete",f),l.addEventListener("error",p),l.addEventListener("abort",p)});mi.set(l,s)}let wi={get(l,s,o){if(l instanceof IDBTransaction){if(s==="done")return mi.get(l);if(s==="store")return o.objectStoreNames[1]?void 0:o.objectStore(o.objectStoreNames[0])}return dn(l[s])},set(l,s,o){return l[s]=o,!0},has(l,s){return l instanceof IDBTransaction&&(s==="done"||s==="store")?!0:s in l}};function po(l){wi=l(wi)}function Cc(l){return xc().includes(l)?function(...s){return l.apply(Ci(this),s),dn(this.request)}:function(...s){return dn(l.apply(Ci(this),s))}}function yc(l){return typeof l=="function"?Cc(l):(l instanceof IDBTransaction&&wc(l),xi(l,pc())?new Proxy(l,wi):l)}function dn(l){if(l instanceof IDBRequest)return mc(l);if(Gr.has(l))return Gr.get(l);const s=yc(l);return s!==l&&(Gr.set(l,s),yr.set(s,l)),s}const Ci=l=>yr.get(l);function bc(l,s,{blocked:o,upgrade:c,blocking:d,terminated:f}={}){const p=indexedDB.open(l,s),w=dn(p);return c&&p.addEventListener("upgradeneeded",b=>{c(dn(p.result),b.oldVersion,b.newVersion,dn(p.transaction),b)}),o&&p.addEventListener("blocked",b=>o(b.oldVersion,b.newVersion,b)),w.then(b=>{f&&b.addEventListener("close",()=>f()),d&&b.addEventListener("versionchange",m=>d(m.oldVersion,m.newVersion,m))}).catch(()=>{}),w}const Ec=["get","getKey","getAll","getAllKeys","count"],Ac=["put","add","delete","clear"],jr=new Map;function gs(l,s){if(!(l instanceof IDBDatabase&&!(s in l)&&typeof s=="string"))return;if(jr.get(s))return jr.get(s);const o=s.replace(/FromIndex$/,""),c=s!==o,d=Ac.includes(o);if(!(o in(c?IDBIndex:IDBObjectStore).prototype)||!(d||Ec.includes(o)))return;const f=async function(p,...w){const b=this.transaction(p,d?"readwrite":"readonly");let m=b.store;return c&&(m=m.index(w.shift())),(await Promise.all([m[o](...w),d&&b.done]))[0]};return jr.set(s,f),f}po(l=>({...l,get:(s,o,c)=>gs(s,o)||l.get(s,o,c),has:(s,o)=>!!gs(s,o)||l.has(s,o)}));const Ic=["continue","continuePrimaryKey","advance"],ps={},yi=new WeakMap,xo=new WeakMap,Sc={get(l,s){if(!Ic.includes(s))return l[s];let o=ps[s];return o||(o=ps[s]=function(...c){yi.set(this,xo.get(this)[s](...c))}),o}};async function*_c(...l){let s=this;if(s instanceof IDBCursor||(s=await s.openCursor(...l)),!s)return;s=s;const o=new Proxy(s,Sc);for(xo.set(o,s),yr.set(o,Ci(s));s;)yield o,s=await(yi.get(o)||s.continue()),yi.delete(o)}function xs(l,s){return s===Symbol.asyncIterator&&xi(l,[IDBIndex,IDBObjectStore,IDBCursor])||s==="iterate"&&xi(l,[IDBIndex,IDBObjectStore])}po(l=>({...l,get(s,o,c){return xs(s,o)?_c:l.get(s,o,c)},has(s,o){return xs(s,o)||l.has(s,o)}}));const Tc="chamber-db",vc=1;let or=null;async function We(){return or||(or=await bc(Tc,vc,{upgrade(l){if(l.objectStoreNames.contains("identity")||l.createObjectStore("identity",{keyPath:"id"}),!l.objectStoreNames.contains("contacts")){const s=l.createObjectStore("contacts",{keyPath:"publicId"});s.createIndex("addedAt","addedAt"),s.createIndex("lastMessageTime","lastMessageTime")}if(!l.objectStoreNames.contains("messages")){const s=l.createObjectStore("messages",{keyPath:"id",autoIncrement:!0});s.createIndex("contactId","contactId"),s.createIndex("timestamp","timestamp")}l.objectStoreNames.contains("images")||l.createObjectStore("images",{keyPath:"id",autoIncrement:!0}).createIndex("messageId","messageId"),l.objectStoreNames.contains("keys")||l.createObjectStore("keys",{keyPath:"contactId"}),l.objectStoreNames.contains("offline_queue")||l.createObjectStore("offline_queue",{keyPath:"id",autoIncrement:!0}).createIndex("contactId","contactId")}}),or)}async function Mi(l,s,o=null,c=null){await(await We()).put("identity",{id:"user",publicId:l,privateKey:s,recoveryCodes:o,displayName:c,createdAt:Date.now()})}async function ki(l){const s=await We(),o=await s.get("identity","user");o&&(o.displayName=l,await s.put("identity",o))}async function Nn(){return await(await We()).get("identity","user")}async function mo(){const s=await(await We()).get("identity","user");return s?s.recoveryCodes:null}async function bi(l,s=null){const o=await We();if(await o.get("contacts",l))throw new Error("Contact already exists");await o.put("contacts",{publicId:l,name:s||`User ${l.substring(0,8)}`,addedAt:Date.now(),lastMessage:null,lastMessageTime:0,unreadCount:0})}async function wo(){return(await(await We()).getAllFromIndex("contacts","lastMessageTime")).reverse()}async function Ei(l){return await(await We()).get("contacts",l)}async function Co(l,s,o){const c=await We(),d=await c.get("contacts",l);d&&(d.lastMessage=s,d.lastMessageTime=o,await c.put("contacts",d))}async function yo(l,s){const o=await We(),c=await o.get("contacts",l);c&&(c.name=s,await o.put("contacts",c))}async function Xn(l,s,o="text",c=!0,d=null,f=null,p=null){const w=await We(),b=Date.now(),m={contactId:l,content:s,type:o,sent:c,encrypted:d,iv:f,imageId:p,timestamp:b},A=await w.add("messages",m);return await Co(l,o==="text"?s:"ðŸ“· Image",b),A}async function bo(l){return(await(await We()).getAllFromIndex("messages","contactId",l)).sort((c,d)=>c.timestamp-d.timestamp)}async function Eo(l){const s=await We(),o=await s.getAllFromIndex("messages","contactId",l);for(const c of o)await s.delete("messages",c.id),c.imageId&&await s.delete("images",c.imageId)}async function Bi(l,s,o="image"){return await(await We()).add("images",{blob:l,iv:Array.from(s),type:o,createdAt:Date.now()})}async function Ao(l){return await(await We()).get("images",l)}const Io=Bi;async function So(l,s){await(await We()).add("offline_queue",{contactId:l,messageData:s,timestamp:Date.now()})}async function _o(l){return await(await We()).getAllFromIndex("offline_queue","contactId",l)}async function To(l){await(await We()).delete("offline_queue",l)}async function Pi(){const l=await We();await l.clear("identity"),await l.clear("contacts"),await l.clear("messages"),await l.clear("images"),await l.clear("keys")}async function vo(){const l=await We();return{identity:await l.getAll("identity"),contacts:await l.getAll("contacts"),messages:await l.getAll("messages"),images:await l.getAll("images"),keys:await l.getAll("keys"),exportedAt:Date.now()}}async function Ro(l){const s=await We();await Pi();for(const o of l.identity||[])await s.put("identity",o);for(const o of l.contacts||[])await s.put("contacts",o);for(const o of l.messages||[])await s.put("messages",o);for(const o of l.images||[])await s.put("images",o);for(const o of l.keys||[])await s.put("keys",o)}const Rc=Object.freeze(Object.defineProperty({__proto__:null,addContact:bi,clearAllData:Pi,clearMessages:Eo,exportData:vo,getAttachment:Ao,getContact:Ei,getContacts:wo,getIdentity:Nn,getMessages:bo,getQueuedMessages:_o,getRecoveryCodes:mo,importData:Ro,queueMessage:So,removeQueuedMessage:To,saveAttachment:Bi,saveIdentity:Mi,saveImage:Io,saveMessage:Xn,updateContactLastMessage:Co,updateContactName:yo,updateIdentityName:ki},Symbol.toStringTag,{value:"Module"}));async function No(){const l=[];for(let o=0;o<12;o++){const c=crypto.getRandomValues(new Uint8Array(4)),d=Array.from(c).map(f=>f.toString(16).padStart(2,"0")).join("");l.push(d)}return{publicId:await Li(l),codes:l}}async function Li(l){const o=[...l].sort().join(""),d=new TextEncoder().encode(o),f=await crypto.subtle.digest("SHA-256",d);return Array.from(new Uint8Array(f)).map(b=>b.toString(16).padStart(2,"0")).join("")}async function Oo(l){const s=[];for(const o of l){const d=new TextEncoder().encode(o),f=await crypto.subtle.digest("SHA-256",d),p=Array.from(new Uint8Array(f));s.push(p.map(w=>w.toString(16).padStart(2,"0")).join(""))}return s}async function Do(l){return Li(l)}async function Mo(l,s){const o=[l,s].sort().join(""),d=new TextEncoder().encode(o),f=await crypto.subtle.digest("SHA-256",d);return await crypto.subtle.importKey("raw",f,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function ko(l,s){const o=crypto.getRandomValues(new Uint8Array(12)),d=new TextEncoder().encode(l),f=await crypto.subtle.encrypt({name:"AES-GCM",iv:o},s,d),p=Array.from(new Uint8Array(f)),w=btoa(String.fromCharCode(...p)),b=Array.from(o),m=btoa(String.fromCharCode(...b));return{encrypted:w,iv:m}}async function Bo(l,s,o){const c=atob(l),d=new Uint8Array(c.length);for(let m=0;m<c.length;m++)d[m]=c.charCodeAt(m);const f=atob(s),p=new Uint8Array(f.length);for(let m=0;m<f.length;m++)p[m]=f.charCodeAt(m);const w=await crypto.subtle.decrypt({name:"AES-GCM",iv:p},o,d);return new TextDecoder().decode(w)}async function Po(l,s){const o=crypto.getRandomValues(new Uint8Array(12));return{encrypted:await crypto.subtle.encrypt({name:"AES-GCM",iv:o},s,l),iv:o}}async function Lo(l,s,o){return await crypto.subtle.decrypt({name:"AES-GCM",iv:s},o,l)}async function Nc(l){throw new Error("generateRecoveryCodes is deprecated. Use createIdentity to generate codes and ID together.")}const Oc=Object.freeze(Object.defineProperty({__proto__:null,createIdentity:No,decryptBinary:Lo,decryptMessage:Bo,deriveIdentityFromCodes:Li,deriveSharedKey:Mo,encryptBinary:Po,encryptMessage:ko,generateRecoveryCodes:Nc,hashRecoveryCodes:Oo,recoverIdentityFromCodes:Do},Symbol.toStringTag,{value:"Module"}));class Dc{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(s){this.flush(),this._parts.push(s)}append(s){this._pieces.push(s)}flush(){if(this._pieces.length>0){const s=new Uint8Array(this._pieces);this._parts.push(s),this._pieces=[]}}toArrayBuffer(){const s=[];for(const o of this._parts)s.push(o);return Mc(s).buffer}}function Mc(l){let s=0;for(const d of l)s+=d.byteLength;const o=new Uint8Array(s);let c=0;for(const d of l){const f=new Uint8Array(d.buffer,d.byteOffset,d.byteLength);o.set(f,c),c+=d.byteLength}return o}function Fo(l){return new kc(l).unpack()}function Uo(l){const s=new Bc,o=s.pack(l);return o instanceof Promise?o.then(()=>s.getBuffer()):s.getBuffer()}class kc{constructor(s){this.index=0,this.dataBuffer=s,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const s=this.unpack_uint8();if(s<128)return s;if((s^224)<32)return(s^224)-32;let o;if((o=s^160)<=15)return this.unpack_raw(o);if((o=s^176)<=15)return this.unpack_string(o);if((o=s^144)<=15)return this.unpack_array(o);if((o=s^128)<=15)return this.unpack_map(o);switch(s){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return o=this.unpack_uint16(),this.unpack_string(o);case 217:return o=this.unpack_uint32(),this.unpack_string(o);case 218:return o=this.unpack_uint16(),this.unpack_raw(o);case 219:return o=this.unpack_uint32(),this.unpack_raw(o);case 220:return o=this.unpack_uint16(),this.unpack_array(o);case 221:return o=this.unpack_uint32(),this.unpack_array(o);case 222:return o=this.unpack_uint16(),this.unpack_map(o);case 223:return o=this.unpack_uint32(),this.unpack_map(o)}}unpack_uint8(){const s=this.dataView[this.index]&255;return this.index++,s}unpack_uint16(){const s=this.read(2),o=(s[0]&255)*256+(s[1]&255);return this.index+=2,o}unpack_uint32(){const s=this.read(4),o=((s[0]*256+s[1])*256+s[2])*256+s[3];return this.index+=4,o}unpack_uint64(){const s=this.read(8),o=((((((s[0]*256+s[1])*256+s[2])*256+s[3])*256+s[4])*256+s[5])*256+s[6])*256+s[7];return this.index+=8,o}unpack_int8(){const s=this.unpack_uint8();return s<128?s:s-256}unpack_int16(){const s=this.unpack_uint16();return s<32768?s:s-65536}unpack_int32(){const s=this.unpack_uint32();return s<2**31?s:s-2**32}unpack_int64(){const s=this.unpack_uint64();return s<2**63?s:s-2**64}unpack_raw(s){if(this.length<this.index+s)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${s} ${this.length}`);const o=this.dataBuffer.slice(this.index,this.index+s);return this.index+=s,o}unpack_string(s){const o=this.read(s);let c=0,d="",f,p;for(;c<s;)f=o[c],f<160?(p=f,c++):(f^192)<32?(p=(f&31)<<6|o[c+1]&63,c+=2):(f^224)<16?(p=(f&15)<<12|(o[c+1]&63)<<6|o[c+2]&63,c+=3):(p=(f&7)<<18|(o[c+1]&63)<<12|(o[c+2]&63)<<6|o[c+3]&63,c+=4),d+=String.fromCodePoint(p);return this.index+=s,d}unpack_array(s){const o=new Array(s);for(let c=0;c<s;c++)o[c]=this.unpack();return o}unpack_map(s){const o={};for(let c=0;c<s;c++){const d=this.unpack();o[d]=this.unpack()}return o}unpack_float(){const s=this.unpack_uint32(),o=s>>31,c=(s>>23&255)-127,d=s&8388607|8388608;return(o===0?1:-1)*d*2**(c-23)}unpack_double(){const s=this.unpack_uint32(),o=this.unpack_uint32(),c=s>>31,d=(s>>20&2047)-1023,p=(s&1048575|1048576)*2**(d-20)+o*2**(d-52);return(c===0?1:-1)*p}read(s){const o=this.index;if(o+s<=this.length)return this.dataView.subarray(o,o+s);throw new Error("BinaryPackFailure: read index out of range")}}class Bc{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(s){if(typeof s=="string")this.pack_string(s);else if(typeof s=="number")Math.floor(s)===s?this.pack_integer(s):this.pack_double(s);else if(typeof s=="boolean")s===!0?this._bufferBuilder.append(195):s===!1&&this._bufferBuilder.append(194);else if(s===void 0)this._bufferBuilder.append(192);else if(typeof s=="object")if(s===null)this._bufferBuilder.append(192);else{const o=s.constructor;if(s instanceof Array){const c=this.pack_array(s);if(c instanceof Promise)return c.then(()=>this._bufferBuilder.flush())}else if(s instanceof ArrayBuffer)this.pack_bin(new Uint8Array(s));else if("BYTES_PER_ELEMENT"in s){const c=s;this.pack_bin(new Uint8Array(c.buffer,c.byteOffset,c.byteLength))}else if(s instanceof Date)this.pack_string(s.toString());else{if(s instanceof Blob)return s.arrayBuffer().then(c=>{this.pack_bin(new Uint8Array(c)),this._bufferBuilder.flush()});if(o==Object||o.toString().startsWith("class")){const c=this.pack_object(s);if(c instanceof Promise)return c.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${o.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof s}" not yet supported`);this._bufferBuilder.flush()}pack_bin(s){const o=s.length;if(o<=15)this.pack_uint8(160+o);else if(o<=65535)this._bufferBuilder.append(218),this.pack_uint16(o);else if(o<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(o);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(s)}pack_string(s){const o=this._textEncoder.encode(s),c=o.length;if(c<=15)this.pack_uint8(176+c);else if(c<=65535)this._bufferBuilder.append(216),this.pack_uint16(c);else if(c<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(c);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(o)}pack_array(s){const o=s.length;if(o<=15)this.pack_uint8(144+o);else if(o<=65535)this._bufferBuilder.append(220),this.pack_uint16(o);else if(o<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(o);else throw new Error("Invalid length");const c=d=>{if(d<o){const f=this.pack(s[d]);return f instanceof Promise?f.then(()=>c(d+1)):c(d+1)}};return c(0)}pack_integer(s){if(s>=-32&&s<=127)this._bufferBuilder.append(s&255);else if(s>=0&&s<=255)this._bufferBuilder.append(204),this.pack_uint8(s);else if(s>=-128&&s<=127)this._bufferBuilder.append(208),this.pack_int8(s);else if(s>=0&&s<=65535)this._bufferBuilder.append(205),this.pack_uint16(s);else if(s>=-32768&&s<=32767)this._bufferBuilder.append(209),this.pack_int16(s);else if(s>=0&&s<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(s);else if(s>=-2147483648&&s<=2147483647)this._bufferBuilder.append(210),this.pack_int32(s);else if(s>=-9223372036854776e3&&s<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(s);else if(s>=0&&s<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(s);else throw new Error("Invalid integer")}pack_double(s){let o=0;s<0&&(o=1,s=-s);const c=Math.floor(Math.log(s)/Math.LN2),d=s/2**c-1,f=Math.floor(d*2**52),p=2**32,w=o<<31|c+1023<<20|f/p&1048575,b=f%p;this._bufferBuilder.append(203),this.pack_int32(w),this.pack_int32(b)}pack_object(s){const o=Object.keys(s),c=o.length;if(c<=15)this.pack_uint8(128+c);else if(c<=65535)this._bufferBuilder.append(222),this.pack_uint16(c);else if(c<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(c);else throw new Error("Invalid length");const d=f=>{if(f<o.length){const p=o[f];if(s.hasOwnProperty(p)){this.pack(p);const w=this.pack(s[p]);if(w instanceof Promise)return w.then(()=>d(f+1))}return d(f+1)}};return d(0)}pack_uint8(s){this._bufferBuilder.append(s)}pack_uint16(s){this._bufferBuilder.append(s>>8),this._bufferBuilder.append(s&255)}pack_uint32(s){const o=s&4294967295;this._bufferBuilder.append((o&4278190080)>>>24),this._bufferBuilder.append((o&16711680)>>>16),this._bufferBuilder.append((o&65280)>>>8),this._bufferBuilder.append(o&255)}pack_uint64(s){const o=s/4294967296,c=s%2**32;this._bufferBuilder.append((o&4278190080)>>>24),this._bufferBuilder.append((o&16711680)>>>16),this._bufferBuilder.append((o&65280)>>>8),this._bufferBuilder.append(o&255),this._bufferBuilder.append((c&4278190080)>>>24),this._bufferBuilder.append((c&16711680)>>>16),this._bufferBuilder.append((c&65280)>>>8),this._bufferBuilder.append(c&255)}pack_int8(s){this._bufferBuilder.append(s&255)}pack_int16(s){this._bufferBuilder.append((s&65280)>>8),this._bufferBuilder.append(s&255)}pack_int32(s){this._bufferBuilder.append(s>>>24&255),this._bufferBuilder.append((s&16711680)>>>16),this._bufferBuilder.append((s&65280)>>>8),this._bufferBuilder.append(s&255)}pack_int64(s){const o=Math.floor(s/4294967296),c=s%2**32;this._bufferBuilder.append((o&4278190080)>>>24),this._bufferBuilder.append((o&16711680)>>>16),this._bufferBuilder.append((o&65280)>>>8),this._bufferBuilder.append(o&255),this._bufferBuilder.append((c&4278190080)>>>24),this._bufferBuilder.append((c&16711680)>>>16),this._bufferBuilder.append((c&65280)>>>8),this._bufferBuilder.append(c&255)}constructor(){this._bufferBuilder=new Dc,this._textEncoder=new TextEncoder}}let Vo=!0,Ho=!0;function jn(l,s,o){const c=l.match(s);return c&&c.length>=o&&parseFloat(c[o],10)}function hn(l,s,o){if(!l.RTCPeerConnection)return;const c=l.RTCPeerConnection.prototype,d=c.addEventListener;c.addEventListener=function(p,w){if(p!==s)return d.apply(this,arguments);const b=m=>{const A=o(m);A&&(w.handleEvent?w.handleEvent(A):w(A))};return this._eventMap=this._eventMap||{},this._eventMap[s]||(this._eventMap[s]=new Map),this._eventMap[s].set(w,b),d.apply(this,[p,b])};const f=c.removeEventListener;c.removeEventListener=function(p,w){if(p!==s||!this._eventMap||!this._eventMap[s])return f.apply(this,arguments);if(!this._eventMap[s].has(w))return f.apply(this,arguments);const b=this._eventMap[s].get(w);return this._eventMap[s].delete(w),this._eventMap[s].size===0&&delete this._eventMap[s],Object.keys(this._eventMap).length===0&&delete this._eventMap,f.apply(this,[p,b])},Object.defineProperty(c,"on"+s,{get(){return this["_on"+s]},set(p){this["_on"+s]&&(this.removeEventListener(s,this["_on"+s]),delete this["_on"+s]),p&&this.addEventListener(s,this["_on"+s]=p)},enumerable:!0,configurable:!0})}function Pc(l){return typeof l!="boolean"?new Error("Argument type: "+typeof l+". Please use a boolean."):(Vo=l,l?"adapter.js logging disabled":"adapter.js logging enabled")}function Lc(l){return typeof l!="boolean"?new Error("Argument type: "+typeof l+". Please use a boolean."):(Ho=!l,"adapter.js deprecation warnings "+(l?"disabled":"enabled"))}function Go(){if(typeof window=="object"){if(Vo)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Fi(l,s){Ho&&console.warn(l+" is deprecated, please use "+s+" instead.")}function Fc(l){const s={browser:null,version:null};if(typeof l>"u"||!l.navigator||!l.navigator.userAgent)return s.browser="Not a browser.",s;const{navigator:o}=l;if(o.userAgentData&&o.userAgentData.brands){const c=o.userAgentData.brands.find(d=>d.brand==="Chromium");if(c)return{browser:"chrome",version:parseInt(c.version,10)}}if(o.mozGetUserMedia)s.browser="firefox",s.version=parseInt(jn(o.userAgent,/Firefox\/(\d+)\./,1));else if(o.webkitGetUserMedia||l.isSecureContext===!1&&l.webkitRTCPeerConnection)s.browser="chrome",s.version=parseInt(jn(o.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(l.RTCPeerConnection&&o.userAgent.match(/AppleWebKit\/(\d+)\./))s.browser="safari",s.version=parseInt(jn(o.userAgent,/AppleWebKit\/(\d+)\./,1)),s.supportsUnifiedPlan=l.RTCRtpTransceiver&&"currentDirection"in l.RTCRtpTransceiver.prototype,s._safariVersion=jn(o.userAgent,/Version\/(\d+(\.?\d+))/,1);else return s.browser="Not a supported browser.",s;return s}function ms(l){return Object.prototype.toString.call(l)==="[object Object]"}function jo(l){return ms(l)?Object.keys(l).reduce(function(s,o){const c=ms(l[o]),d=c?jo(l[o]):l[o],f=c&&!Object.keys(d).length;return d===void 0||f?s:Object.assign(s,{[o]:d})},{}):l}function Ai(l,s,o){!s||o.has(s.id)||(o.set(s.id,s),Object.keys(s).forEach(c=>{c.endsWith("Id")?Ai(l,l.get(s[c]),o):c.endsWith("Ids")&&s[c].forEach(d=>{Ai(l,l.get(d),o)})}))}function ws(l,s,o){const c=o?"outbound-rtp":"inbound-rtp",d=new Map;if(s===null)return d;const f=[];return l.forEach(p=>{p.type==="track"&&p.trackIdentifier===s.id&&f.push(p)}),f.forEach(p=>{l.forEach(w=>{w.type===c&&w.trackId===p.id&&Ai(l,w,d)})}),d}const Cs=Go;function Wo(l,s){const o=l&&l.navigator;if(!o.mediaDevices)return;const c=function(w){if(typeof w!="object"||w.mandatory||w.optional)return w;const b={};return Object.keys(w).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;const A=typeof w[m]=="object"?w[m]:{ideal:w[m]};A.exact!==void 0&&typeof A.exact=="number"&&(A.min=A.max=A.exact);const _=function(O,D){return O?O+D.charAt(0).toUpperCase()+D.slice(1):D==="deviceId"?"sourceId":D};if(A.ideal!==void 0){b.optional=b.optional||[];let O={};typeof A.ideal=="number"?(O[_("min",m)]=A.ideal,b.optional.push(O),O={},O[_("max",m)]=A.ideal,b.optional.push(O)):(O[_("",m)]=A.ideal,b.optional.push(O))}A.exact!==void 0&&typeof A.exact!="number"?(b.mandatory=b.mandatory||{},b.mandatory[_("",m)]=A.exact):["min","max"].forEach(O=>{A[O]!==void 0&&(b.mandatory=b.mandatory||{},b.mandatory[_(O,m)]=A[O])})}),w.advanced&&(b.optional=(b.optional||[]).concat(w.advanced)),b},d=function(w,b){if(s.version>=61)return b(w);if(w=JSON.parse(JSON.stringify(w)),w&&typeof w.audio=="object"){const m=function(A,_,O){_ in A&&!(O in A)&&(A[O]=A[_],delete A[_])};w=JSON.parse(JSON.stringify(w)),m(w.audio,"autoGainControl","googAutoGainControl"),m(w.audio,"noiseSuppression","googNoiseSuppression"),w.audio=c(w.audio)}if(w&&typeof w.video=="object"){let m=w.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});const A=s.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&!(o.mediaDevices.getSupportedConstraints&&o.mediaDevices.getSupportedConstraints().facingMode&&!A)){delete w.video.facingMode;let _;if(m.exact==="environment"||m.ideal==="environment"?_=["back","rear"]:(m.exact==="user"||m.ideal==="user")&&(_=["front"]),_)return o.mediaDevices.enumerateDevices().then(O=>{O=O.filter(Z=>Z.kind==="videoinput");let D=O.find(Z=>_.some(G=>Z.label.toLowerCase().includes(G)));return!D&&O.length&&_.includes("back")&&(D=O[O.length-1]),D&&(w.video.deviceId=m.exact?{exact:D.deviceId}:{ideal:D.deviceId}),w.video=c(w.video),Cs("chrome: "+JSON.stringify(w)),b(w)})}w.video=c(w.video)}return Cs("chrome: "+JSON.stringify(w)),b(w)},f=function(w){return s.version>=64?w:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[w.name]||w.name,message:w.message,constraint:w.constraint||w.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},p=function(w,b,m){d(w,A=>{o.webkitGetUserMedia(A,b,_=>{m&&m(f(_))})})};if(o.getUserMedia=p.bind(o),o.mediaDevices.getUserMedia){const w=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(b){return d(b,m=>w(m).then(A=>{if(m.audio&&!A.getAudioTracks().length||m.video&&!A.getVideoTracks().length)throw A.getTracks().forEach(_=>{_.stop()}),new DOMException("","NotFoundError");return A},A=>Promise.reject(f(A))))}}}function Xo(l){l.MediaStream=l.MediaStream||l.webkitMediaStream}function zo(l){if(typeof l=="object"&&l.RTCPeerConnection&&!("ontrack"in l.RTCPeerConnection.prototype)){Object.defineProperty(l.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(o){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=o)},enumerable:!0,configurable:!0});const s=l.RTCPeerConnection.prototype.setRemoteDescription;l.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=c=>{c.stream.addEventListener("addtrack",d=>{let f;l.RTCPeerConnection.prototype.getReceivers?f=this.getReceivers().find(w=>w.track&&w.track.id===d.track.id):f={track:d.track};const p=new Event("track");p.track=d.track,p.receiver=f,p.transceiver={receiver:f},p.streams=[c.stream],this.dispatchEvent(p)}),c.stream.getTracks().forEach(d=>{let f;l.RTCPeerConnection.prototype.getReceivers?f=this.getReceivers().find(w=>w.track&&w.track.id===d.id):f={track:d};const p=new Event("track");p.track=d,p.receiver=f,p.transceiver={receiver:f},p.streams=[c.stream],this.dispatchEvent(p)})},this.addEventListener("addstream",this._ontrackpoly)),s.apply(this,arguments)}}else hn(l,"track",s=>(s.transceiver||Object.defineProperty(s,"transceiver",{value:{receiver:s.receiver}}),s))}function Yo(l){if(typeof l=="object"&&l.RTCPeerConnection&&!("getSenders"in l.RTCPeerConnection.prototype)&&"createDTMFSender"in l.RTCPeerConnection.prototype){const s=function(d,f){return{track:f,get dtmf(){return this._dtmf===void 0&&(f.kind==="audio"?this._dtmf=d.createDTMFSender(f):this._dtmf=null),this._dtmf},_pc:d}};if(!l.RTCPeerConnection.prototype.getSenders){l.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const d=l.RTCPeerConnection.prototype.addTrack;l.RTCPeerConnection.prototype.addTrack=function(w,b){let m=d.apply(this,arguments);return m||(m=s(this,w),this._senders.push(m)),m};const f=l.RTCPeerConnection.prototype.removeTrack;l.RTCPeerConnection.prototype.removeTrack=function(w){f.apply(this,arguments);const b=this._senders.indexOf(w);b!==-1&&this._senders.splice(b,1)}}const o=l.RTCPeerConnection.prototype.addStream;l.RTCPeerConnection.prototype.addStream=function(f){this._senders=this._senders||[],o.apply(this,[f]),f.getTracks().forEach(p=>{this._senders.push(s(this,p))})};const c=l.RTCPeerConnection.prototype.removeStream;l.RTCPeerConnection.prototype.removeStream=function(f){this._senders=this._senders||[],c.apply(this,[f]),f.getTracks().forEach(p=>{const w=this._senders.find(b=>b.track===p);w&&this._senders.splice(this._senders.indexOf(w),1)})}}else if(typeof l=="object"&&l.RTCPeerConnection&&"getSenders"in l.RTCPeerConnection.prototype&&"createDTMFSender"in l.RTCPeerConnection.prototype&&l.RTCRtpSender&&!("dtmf"in l.RTCRtpSender.prototype)){const s=l.RTCPeerConnection.prototype.getSenders;l.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach(d=>d._pc=this),c},Object.defineProperty(l.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function qo(l){if(!(typeof l=="object"&&l.RTCPeerConnection&&l.RTCRtpSender&&l.RTCRtpReceiver))return;if(!("getStats"in l.RTCRtpSender.prototype)){const o=l.RTCPeerConnection.prototype.getSenders;o&&(l.RTCPeerConnection.prototype.getSenders=function(){const f=o.apply(this,[]);return f.forEach(p=>p._pc=this),f});const c=l.RTCPeerConnection.prototype.addTrack;c&&(l.RTCPeerConnection.prototype.addTrack=function(){const f=c.apply(this,arguments);return f._pc=this,f}),l.RTCRtpSender.prototype.getStats=function(){const f=this;return this._pc.getStats().then(p=>ws(p,f.track,!0))}}if(!("getStats"in l.RTCRtpReceiver.prototype)){const o=l.RTCPeerConnection.prototype.getReceivers;o&&(l.RTCPeerConnection.prototype.getReceivers=function(){const d=o.apply(this,[]);return d.forEach(f=>f._pc=this),d}),hn(l,"track",c=>(c.receiver._pc=c.srcElement,c)),l.RTCRtpReceiver.prototype.getStats=function(){const d=this;return this._pc.getStats().then(f=>ws(f,d.track,!1))}}if(!("getStats"in l.RTCRtpSender.prototype&&"getStats"in l.RTCRtpReceiver.prototype))return;const s=l.RTCPeerConnection.prototype.getStats;l.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof l.MediaStreamTrack){const c=arguments[0];let d,f,p;return this.getSenders().forEach(w=>{w.track===c&&(d?p=!0:d=w)}),this.getReceivers().forEach(w=>(w.track===c&&(f?p=!0:f=w),w.track===c)),p||d&&f?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):d?d.getStats():f?f.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return s.apply(this,arguments)}}function Zo(l){l.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(p=>this._shimmedLocalStreams[p][0])};const s=l.RTCPeerConnection.prototype.addTrack;l.RTCPeerConnection.prototype.addTrack=function(p,w){if(!w)return s.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const b=s.apply(this,arguments);return this._shimmedLocalStreams[w.id]?this._shimmedLocalStreams[w.id].indexOf(b)===-1&&this._shimmedLocalStreams[w.id].push(b):this._shimmedLocalStreams[w.id]=[w,b],b};const o=l.RTCPeerConnection.prototype.addStream;l.RTCPeerConnection.prototype.addStream=function(p){this._shimmedLocalStreams=this._shimmedLocalStreams||{},p.getTracks().forEach(m=>{if(this.getSenders().find(_=>_.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const w=this.getSenders();o.apply(this,arguments);const b=this.getSenders().filter(m=>w.indexOf(m)===-1);this._shimmedLocalStreams[p.id]=[p].concat(b)};const c=l.RTCPeerConnection.prototype.removeStream;l.RTCPeerConnection.prototype.removeStream=function(p){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[p.id],c.apply(this,arguments)};const d=l.RTCPeerConnection.prototype.removeTrack;l.RTCPeerConnection.prototype.removeTrack=function(p){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},p&&Object.keys(this._shimmedLocalStreams).forEach(w=>{const b=this._shimmedLocalStreams[w].indexOf(p);b!==-1&&this._shimmedLocalStreams[w].splice(b,1),this._shimmedLocalStreams[w].length===1&&delete this._shimmedLocalStreams[w]}),d.apply(this,arguments)}}function Ko(l,s){if(!l.RTCPeerConnection)return;if(l.RTCPeerConnection.prototype.addTrack&&s.version>=65)return Zo(l);const o=l.RTCPeerConnection.prototype.getLocalStreams;l.RTCPeerConnection.prototype.getLocalStreams=function(){const A=o.apply(this);return this._reverseStreams=this._reverseStreams||{},A.map(_=>this._reverseStreams[_.id])};const c=l.RTCPeerConnection.prototype.addStream;l.RTCPeerConnection.prototype.addStream=function(A){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},A.getTracks().forEach(_=>{if(this.getSenders().find(D=>D.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[A.id]){const _=new l.MediaStream(A.getTracks());this._streams[A.id]=_,this._reverseStreams[_.id]=A,A=_}c.apply(this,[A])};const d=l.RTCPeerConnection.prototype.removeStream;l.RTCPeerConnection.prototype.removeStream=function(A){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.apply(this,[this._streams[A.id]||A]),delete this._reverseStreams[this._streams[A.id]?this._streams[A.id].id:A.id],delete this._streams[A.id]},l.RTCPeerConnection.prototype.addTrack=function(A,_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const O=[].slice.call(arguments,1);if(O.length!==1||!O[0].getTracks().find(G=>G===A))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(G=>G.track===A))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const Z=this._streams[_.id];if(Z)Z.addTrack(A),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const G=new l.MediaStream([A]);this._streams[_.id]=G,this._reverseStreams[G.id]=_,this.addStream(G)}return this.getSenders().find(G=>G.track===A)};function f(m,A){let _=A.sdp;return Object.keys(m._reverseStreams||[]).forEach(O=>{const D=m._reverseStreams[O],Z=m._streams[D.id];_=_.replace(new RegExp(Z.id,"g"),D.id)}),new RTCSessionDescription({type:A.type,sdp:_})}function p(m,A){let _=A.sdp;return Object.keys(m._reverseStreams||[]).forEach(O=>{const D=m._reverseStreams[O],Z=m._streams[D.id];_=_.replace(new RegExp(D.id,"g"),Z.id)}),new RTCSessionDescription({type:A.type,sdp:_})}["createOffer","createAnswer"].forEach(function(m){const A=l.RTCPeerConnection.prototype[m],_={[m](){const O=arguments;return arguments.length&&typeof arguments[0]=="function"?A.apply(this,[Z=>{const G=f(this,Z);O[0].apply(null,[G])},Z=>{O[1]&&O[1].apply(null,Z)},arguments[2]]):A.apply(this,arguments).then(Z=>f(this,Z))}};l.RTCPeerConnection.prototype[m]=_[m]});const w=l.RTCPeerConnection.prototype.setLocalDescription;l.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?w.apply(this,arguments):(arguments[0]=p(this,arguments[0]),w.apply(this,arguments))};const b=Object.getOwnPropertyDescriptor(l.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(l.RTCPeerConnection.prototype,"localDescription",{get(){const m=b.get.apply(this);return m.type===""?m:f(this,m)}}),l.RTCPeerConnection.prototype.removeTrack=function(A){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!A._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(A._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let O;Object.keys(this._streams).forEach(D=>{this._streams[D].getTracks().find(G=>A.track===G)&&(O=this._streams[D])}),O&&(O.getTracks().length===1?this.removeStream(this._reverseStreams[O.id]):O.removeTrack(A.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Ii(l,s){!l.RTCPeerConnection&&l.webkitRTCPeerConnection&&(l.RTCPeerConnection=l.webkitRTCPeerConnection),l.RTCPeerConnection&&s.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const c=l.RTCPeerConnection.prototype[o],d={[o](){return arguments[0]=new(o==="addIceCandidate"?l.RTCIceCandidate:l.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};l.RTCPeerConnection.prototype[o]=d[o]})}function Qo(l,s){hn(l,"negotiationneeded",o=>{const c=o.target;if(!((s.version<72||c.getConfiguration&&c.getConfiguration().sdpSemantics==="plan-b")&&c.signalingState!=="stable"))return o})}const ys=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Qo,shimAddTrackRemoveTrack:Ko,shimAddTrackRemoveTrackWithNative:Zo,shimGetSendersWithDtmf:Yo,shimGetUserMedia:Wo,shimMediaStream:Xo,shimOnTrack:zo,shimPeerConnection:Ii,shimSenderReceiverGetStats:qo},Symbol.toStringTag,{value:"Module"}));function Jo(l,s){const o=l&&l.navigator,c=l&&l.MediaStreamTrack;if(o.getUserMedia=function(d,f,p){Fi("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),o.mediaDevices.getUserMedia(d).then(f,p)},!(s.version>55&&"autoGainControl"in o.mediaDevices.getSupportedConstraints())){const d=function(p,w,b){w in p&&!(b in p)&&(p[b]=p[w],delete p[w])},f=o.mediaDevices.getUserMedia.bind(o.mediaDevices);if(o.mediaDevices.getUserMedia=function(p){return typeof p=="object"&&typeof p.audio=="object"&&(p=JSON.parse(JSON.stringify(p)),d(p.audio,"autoGainControl","mozAutoGainControl"),d(p.audio,"noiseSuppression","mozNoiseSuppression")),f(p)},c&&c.prototype.getSettings){const p=c.prototype.getSettings;c.prototype.getSettings=function(){const w=p.apply(this,arguments);return d(w,"mozAutoGainControl","autoGainControl"),d(w,"mozNoiseSuppression","noiseSuppression"),w}}if(c&&c.prototype.applyConstraints){const p=c.prototype.applyConstraints;c.prototype.applyConstraints=function(w){return this.kind==="audio"&&typeof w=="object"&&(w=JSON.parse(JSON.stringify(w)),d(w,"autoGainControl","mozAutoGainControl"),d(w,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[w])}}}}function Uc(l,s){l.navigator.mediaDevices&&"getDisplayMedia"in l.navigator.mediaDevices||l.navigator.mediaDevices&&(l.navigator.mediaDevices.getDisplayMedia=function(c){if(!(c&&c.video)){const d=new DOMException("getDisplayMedia without video constraints is undefined");return d.name="NotFoundError",d.code=8,Promise.reject(d)}return c.video===!0?c.video={mediaSource:s}:c.video.mediaSource=s,l.navigator.mediaDevices.getUserMedia(c)})}function $o(l){typeof l=="object"&&l.RTCTrackEvent&&"receiver"in l.RTCTrackEvent.prototype&&!("transceiver"in l.RTCTrackEvent.prototype)&&Object.defineProperty(l.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Si(l,s){if(typeof l!="object"||!(l.RTCPeerConnection||l.mozRTCPeerConnection))return;!l.RTCPeerConnection&&l.mozRTCPeerConnection&&(l.RTCPeerConnection=l.mozRTCPeerConnection),s.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(d){const f=l.RTCPeerConnection.prototype[d],p={[d](){return arguments[0]=new(d==="addIceCandidate"?l.RTCIceCandidate:l.RTCSessionDescription)(arguments[0]),f.apply(this,arguments)}};l.RTCPeerConnection.prototype[d]=p[d]});const o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},c=l.RTCPeerConnection.prototype.getStats;l.RTCPeerConnection.prototype.getStats=function(){const[f,p,w]=arguments;return c.apply(this,[f||null]).then(b=>{if(s.version<53&&!p)try{b.forEach(m=>{m.type=o[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;b.forEach((A,_)=>{b.set(_,Object.assign({},A,{type:o[A.type]||A.type}))})}return b}).then(p,w)}}function ea(l){if(!(typeof l=="object"&&l.RTCPeerConnection&&l.RTCRtpSender)||l.RTCRtpSender&&"getStats"in l.RTCRtpSender.prototype)return;const s=l.RTCPeerConnection.prototype.getSenders;s&&(l.RTCPeerConnection.prototype.getSenders=function(){const d=s.apply(this,[]);return d.forEach(f=>f._pc=this),d});const o=l.RTCPeerConnection.prototype.addTrack;o&&(l.RTCPeerConnection.prototype.addTrack=function(){const d=o.apply(this,arguments);return d._pc=this,d}),l.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ta(l){if(!(typeof l=="object"&&l.RTCPeerConnection&&l.RTCRtpSender)||l.RTCRtpSender&&"getStats"in l.RTCRtpReceiver.prototype)return;const s=l.RTCPeerConnection.prototype.getReceivers;s&&(l.RTCPeerConnection.prototype.getReceivers=function(){const c=s.apply(this,[]);return c.forEach(d=>d._pc=this),c}),hn(l,"track",o=>(o.receiver._pc=o.srcElement,o)),l.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function na(l){!l.RTCPeerConnection||"removeStream"in l.RTCPeerConnection.prototype||(l.RTCPeerConnection.prototype.removeStream=function(o){Fi("removeStream","removeTrack"),this.getSenders().forEach(c=>{c.track&&o.getTracks().includes(c.track)&&this.removeTrack(c)})})}function ra(l){l.DataChannel&&!l.RTCDataChannel&&(l.RTCDataChannel=l.DataChannel)}function ia(l){if(!(typeof l=="object"&&l.RTCPeerConnection))return;const s=l.RTCPeerConnection.prototype.addTransceiver;s&&(l.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let c=arguments[1]&&arguments[1].sendEncodings;c===void 0&&(c=[]),c=[...c];const d=c.length>0;d&&c.forEach(p=>{if("rid"in p&&!/^[a-z0-9]{0,16}$/i.test(p.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in p&&!(parseFloat(p.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in p&&!(parseFloat(p.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const f=s.apply(this,arguments);if(d){const{sender:p}=f,w=p.getParameters();(!("encodings"in w)||w.encodings.length===1&&Object.keys(w.encodings[0]).length===0)&&(w.encodings=c,p.sendEncodings=c,this.setParametersPromises.push(p.setParameters(w).then(()=>{delete p.sendEncodings}).catch(()=>{delete p.sendEncodings})))}return f})}function sa(l){if(!(typeof l=="object"&&l.RTCRtpSender))return;const s=l.RTCRtpSender.prototype.getParameters;s&&(l.RTCRtpSender.prototype.getParameters=function(){const c=s.apply(this,arguments);return"encodings"in c||(c.encodings=[].concat(this.sendEncodings||[{}])),c})}function oa(l){if(!(typeof l=="object"&&l.RTCPeerConnection))return;const s=l.RTCPeerConnection.prototype.createOffer;l.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>s.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):s.apply(this,arguments)}}function aa(l){if(!(typeof l=="object"&&l.RTCPeerConnection))return;const s=l.RTCPeerConnection.prototype.createAnswer;l.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>s.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):s.apply(this,arguments)}}const bs=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:ia,shimCreateAnswer:aa,shimCreateOffer:oa,shimGetDisplayMedia:Uc,shimGetParameters:sa,shimGetUserMedia:Jo,shimOnTrack:$o,shimPeerConnection:Si,shimRTCDataChannel:ra,shimReceiverGetStats:ta,shimRemoveStream:na,shimSenderGetStats:ea},Symbol.toStringTag,{value:"Module"}));function ca(l){if(!(typeof l!="object"||!l.RTCPeerConnection)){if("getLocalStreams"in l.RTCPeerConnection.prototype||(l.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in l.RTCPeerConnection.prototype)){const s=l.RTCPeerConnection.prototype.addTrack;l.RTCPeerConnection.prototype.addStream=function(c){this._localStreams||(this._localStreams=[]),this._localStreams.includes(c)||this._localStreams.push(c),c.getAudioTracks().forEach(d=>s.call(this,d,c)),c.getVideoTracks().forEach(d=>s.call(this,d,c))},l.RTCPeerConnection.prototype.addTrack=function(c,...d){return d&&d.forEach(f=>{this._localStreams?this._localStreams.includes(f)||this._localStreams.push(f):this._localStreams=[f]}),s.apply(this,arguments)}}"removeStream"in l.RTCPeerConnection.prototype||(l.RTCPeerConnection.prototype.removeStream=function(o){this._localStreams||(this._localStreams=[]);const c=this._localStreams.indexOf(o);if(c===-1)return;this._localStreams.splice(c,1);const d=o.getTracks();this.getSenders().forEach(f=>{d.includes(f.track)&&this.removeTrack(f)})})}}function la(l){if(!(typeof l!="object"||!l.RTCPeerConnection)&&("getRemoteStreams"in l.RTCPeerConnection.prototype||(l.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in l.RTCPeerConnection.prototype))){Object.defineProperty(l.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(o){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=o),this.addEventListener("track",this._onaddstreampoly=c=>{c.streams.forEach(d=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(d))return;this._remoteStreams.push(d);const f=new Event("addstream");f.stream=d,this.dispatchEvent(f)})})}});const s=l.RTCPeerConnection.prototype.setRemoteDescription;l.RTCPeerConnection.prototype.setRemoteDescription=function(){const c=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(d){d.streams.forEach(f=>{if(c._remoteStreams||(c._remoteStreams=[]),c._remoteStreams.indexOf(f)>=0)return;c._remoteStreams.push(f);const p=new Event("addstream");p.stream=f,c.dispatchEvent(p)})}),s.apply(c,arguments)}}}function ua(l){if(typeof l!="object"||!l.RTCPeerConnection)return;const s=l.RTCPeerConnection.prototype,o=s.createOffer,c=s.createAnswer,d=s.setLocalDescription,f=s.setRemoteDescription,p=s.addIceCandidate;s.createOffer=function(m,A){const _=arguments.length>=2?arguments[2]:arguments[0],O=o.apply(this,[_]);return A?(O.then(m,A),Promise.resolve()):O},s.createAnswer=function(m,A){const _=arguments.length>=2?arguments[2]:arguments[0],O=c.apply(this,[_]);return A?(O.then(m,A),Promise.resolve()):O};let w=function(b,m,A){const _=d.apply(this,[b]);return A?(_.then(m,A),Promise.resolve()):_};s.setLocalDescription=w,w=function(b,m,A){const _=f.apply(this,[b]);return A?(_.then(m,A),Promise.resolve()):_},s.setRemoteDescription=w,w=function(b,m,A){const _=p.apply(this,[b]);return A?(_.then(m,A),Promise.resolve()):_},s.addIceCandidate=w}function da(l){const s=l&&l.navigator;if(s.mediaDevices&&s.mediaDevices.getUserMedia){const o=s.mediaDevices,c=o.getUserMedia.bind(o);s.mediaDevices.getUserMedia=d=>c(ha(d))}!s.getUserMedia&&s.mediaDevices&&s.mediaDevices.getUserMedia&&(s.getUserMedia=(function(c,d,f){s.mediaDevices.getUserMedia(c).then(d,f)}).bind(s))}function ha(l){return l&&l.video!==void 0?Object.assign({},l,{video:jo(l.video)}):l}function fa(l){if(!l.RTCPeerConnection)return;const s=l.RTCPeerConnection;l.RTCPeerConnection=function(c,d){if(c&&c.iceServers){const f=[];for(let p=0;p<c.iceServers.length;p++){let w=c.iceServers[p];w.urls===void 0&&w.url?(Fi("RTCIceServer.url","RTCIceServer.urls"),w=JSON.parse(JSON.stringify(w)),w.urls=w.url,delete w.url,f.push(w)):f.push(c.iceServers[p])}c.iceServers=f}return new s(c,d)},l.RTCPeerConnection.prototype=s.prototype,"generateCertificate"in s&&Object.defineProperty(l.RTCPeerConnection,"generateCertificate",{get(){return s.generateCertificate}})}function ga(l){typeof l=="object"&&l.RTCTrackEvent&&"receiver"in l.RTCTrackEvent.prototype&&!("transceiver"in l.RTCTrackEvent.prototype)&&Object.defineProperty(l.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function pa(l){const s=l.RTCPeerConnection.prototype.createOffer;l.RTCPeerConnection.prototype.createOffer=function(c){if(c){typeof c.offerToReceiveAudio<"u"&&(c.offerToReceiveAudio=!!c.offerToReceiveAudio);const d=this.getTransceivers().find(p=>p.receiver.track.kind==="audio");c.offerToReceiveAudio===!1&&d?d.direction==="sendrecv"?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":d.direction==="recvonly"&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):c.offerToReceiveAudio===!0&&!d&&this.addTransceiver("audio",{direction:"recvonly"}),typeof c.offerToReceiveVideo<"u"&&(c.offerToReceiveVideo=!!c.offerToReceiveVideo);const f=this.getTransceivers().find(p=>p.receiver.track.kind==="video");c.offerToReceiveVideo===!1&&f?f.direction==="sendrecv"?f.setDirection?f.setDirection("sendonly"):f.direction="sendonly":f.direction==="recvonly"&&(f.setDirection?f.setDirection("inactive"):f.direction="inactive"):c.offerToReceiveVideo===!0&&!f&&this.addTransceiver("video",{direction:"recvonly"})}return s.apply(this,arguments)}}function xa(l){typeof l!="object"||l.AudioContext||(l.AudioContext=l.webkitAudioContext)}const Es=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:xa,shimCallbacksAPI:ua,shimConstraints:ha,shimCreateOfferLegacy:pa,shimGetUserMedia:da,shimLocalStreamsAPI:ca,shimRTCIceServerUrls:fa,shimRemoteStreamsAPI:la,shimTrackEventTransceiver:ga},Symbol.toStringTag,{value:"Module"}));var ar=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ui(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Wr={exports:{}},As;function Vc(){return As||(As=1,(function(l){const s={};s.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},s.localCName=s.generateIdentifier(),s.splitLines=function(o){return o.trim().split(`
`).map(c=>c.trim())},s.splitSections=function(o){return o.split(`
m=`).map((d,f)=>(f>0?"m="+d:d).trim()+`\r
`)},s.getDescription=function(o){const c=s.splitSections(o);return c&&c[0]},s.getMediaSections=function(o){const c=s.splitSections(o);return c.shift(),c},s.matchPrefix=function(o,c){return s.splitLines(o).filter(d=>d.indexOf(c)===0)},s.parseCandidate=function(o){let c;o.indexOf("a=candidate:")===0?c=o.substring(12).split(" "):c=o.substring(10).split(" ");const d={foundation:c[0],component:{1:"rtp",2:"rtcp"}[c[1]]||c[1],protocol:c[2].toLowerCase(),priority:parseInt(c[3],10),ip:c[4],address:c[4],port:parseInt(c[5],10),type:c[7]};for(let f=8;f<c.length;f+=2)switch(c[f]){case"raddr":d.relatedAddress=c[f+1];break;case"rport":d.relatedPort=parseInt(c[f+1],10);break;case"tcptype":d.tcpType=c[f+1];break;case"ufrag":d.ufrag=c[f+1],d.usernameFragment=c[f+1];break;default:d[c[f]]===void 0&&(d[c[f]]=c[f+1]);break}return d},s.writeCandidate=function(o){const c=[];c.push(o.foundation);const d=o.component;d==="rtp"?c.push(1):d==="rtcp"?c.push(2):c.push(d),c.push(o.protocol.toUpperCase()),c.push(o.priority),c.push(o.address||o.ip),c.push(o.port);const f=o.type;return c.push("typ"),c.push(f),f!=="host"&&o.relatedAddress&&o.relatedPort&&(c.push("raddr"),c.push(o.relatedAddress),c.push("rport"),c.push(o.relatedPort)),o.tcpType&&o.protocol.toLowerCase()==="tcp"&&(c.push("tcptype"),c.push(o.tcpType)),(o.usernameFragment||o.ufrag)&&(c.push("ufrag"),c.push(o.usernameFragment||o.ufrag)),"candidate:"+c.join(" ")},s.parseIceOptions=function(o){return o.substring(14).split(" ")},s.parseRtpMap=function(o){let c=o.substring(9).split(" ");const d={payloadType:parseInt(c.shift(),10)};return c=c[0].split("/"),d.name=c[0],d.clockRate=parseInt(c[1],10),d.channels=c.length===3?parseInt(c[2],10):1,d.numChannels=d.channels,d},s.writeRtpMap=function(o){let c=o.payloadType;o.preferredPayloadType!==void 0&&(c=o.preferredPayloadType);const d=o.channels||o.numChannels||1;return"a=rtpmap:"+c+" "+o.name+"/"+o.clockRate+(d!==1?"/"+d:"")+`\r
`},s.parseExtmap=function(o){const c=o.substring(9).split(" ");return{id:parseInt(c[0],10),direction:c[0].indexOf("/")>0?c[0].split("/")[1]:"sendrecv",uri:c[1],attributes:c.slice(2).join(" ")}},s.writeExtmap=function(o){return"a=extmap:"+(o.id||o.preferredId)+(o.direction&&o.direction!=="sendrecv"?"/"+o.direction:"")+" "+o.uri+(o.attributes?" "+o.attributes:"")+`\r
`},s.parseFmtp=function(o){const c={};let d;const f=o.substring(o.indexOf(" ")+1).split(";");for(let p=0;p<f.length;p++)d=f[p].trim().split("="),c[d[0].trim()]=d[1];return c},s.writeFmtp=function(o){let c="",d=o.payloadType;if(o.preferredPayloadType!==void 0&&(d=o.preferredPayloadType),o.parameters&&Object.keys(o.parameters).length){const f=[];Object.keys(o.parameters).forEach(p=>{o.parameters[p]!==void 0?f.push(p+"="+o.parameters[p]):f.push(p)}),c+="a=fmtp:"+d+" "+f.join(";")+`\r
`}return c},s.parseRtcpFb=function(o){const c=o.substring(o.indexOf(" ")+1).split(" ");return{type:c.shift(),parameter:c.join(" ")}},s.writeRtcpFb=function(o){let c="",d=o.payloadType;return o.preferredPayloadType!==void 0&&(d=o.preferredPayloadType),o.rtcpFeedback&&o.rtcpFeedback.length&&o.rtcpFeedback.forEach(f=>{c+="a=rtcp-fb:"+d+" "+f.type+(f.parameter&&f.parameter.length?" "+f.parameter:"")+`\r
`}),c},s.parseSsrcMedia=function(o){const c=o.indexOf(" "),d={ssrc:parseInt(o.substring(7,c),10)},f=o.indexOf(":",c);return f>-1?(d.attribute=o.substring(c+1,f),d.value=o.substring(f+1)):d.attribute=o.substring(c+1),d},s.parseSsrcGroup=function(o){const c=o.substring(13).split(" ");return{semantics:c.shift(),ssrcs:c.map(d=>parseInt(d,10))}},s.getMid=function(o){const c=s.matchPrefix(o,"a=mid:")[0];if(c)return c.substring(6)},s.parseFingerprint=function(o){const c=o.substring(14).split(" ");return{algorithm:c[0].toLowerCase(),value:c[1].toUpperCase()}},s.getDtlsParameters=function(o,c){return{role:"auto",fingerprints:s.matchPrefix(o+c,"a=fingerprint:").map(s.parseFingerprint)}},s.writeDtlsParameters=function(o,c){let d="a=setup:"+c+`\r
`;return o.fingerprints.forEach(f=>{d+="a=fingerprint:"+f.algorithm+" "+f.value+`\r
`}),d},s.parseCryptoLine=function(o){const c=o.substring(9).split(" ");return{tag:parseInt(c[0],10),cryptoSuite:c[1],keyParams:c[2],sessionParams:c.slice(3)}},s.writeCryptoLine=function(o){return"a=crypto:"+o.tag+" "+o.cryptoSuite+" "+(typeof o.keyParams=="object"?s.writeCryptoKeyParams(o.keyParams):o.keyParams)+(o.sessionParams?" "+o.sessionParams.join(" "):"")+`\r
`},s.parseCryptoKeyParams=function(o){if(o.indexOf("inline:")!==0)return null;const c=o.substring(7).split("|");return{keyMethod:"inline",keySalt:c[0],lifeTime:c[1],mkiValue:c[2]?c[2].split(":")[0]:void 0,mkiLength:c[2]?c[2].split(":")[1]:void 0}},s.writeCryptoKeyParams=function(o){return o.keyMethod+":"+o.keySalt+(o.lifeTime?"|"+o.lifeTime:"")+(o.mkiValue&&o.mkiLength?"|"+o.mkiValue+":"+o.mkiLength:"")},s.getCryptoParameters=function(o,c){return s.matchPrefix(o+c,"a=crypto:").map(s.parseCryptoLine)},s.getIceParameters=function(o,c){const d=s.matchPrefix(o+c,"a=ice-ufrag:")[0],f=s.matchPrefix(o+c,"a=ice-pwd:")[0];return d&&f?{usernameFragment:d.substring(12),password:f.substring(10)}:null},s.writeIceParameters=function(o){let c="a=ice-ufrag:"+o.usernameFragment+`\r
a=ice-pwd:`+o.password+`\r
`;return o.iceLite&&(c+=`a=ice-lite\r
`),c},s.parseRtpParameters=function(o){const c={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},f=s.splitLines(o)[0].split(" ");c.profile=f[2];for(let w=3;w<f.length;w++){const b=f[w],m=s.matchPrefix(o,"a=rtpmap:"+b+" ")[0];if(m){const A=s.parseRtpMap(m),_=s.matchPrefix(o,"a=fmtp:"+b+" ");switch(A.parameters=_.length?s.parseFmtp(_[0]):{},A.rtcpFeedback=s.matchPrefix(o,"a=rtcp-fb:"+b+" ").map(s.parseRtcpFb),c.codecs.push(A),A.name.toUpperCase()){case"RED":case"ULPFEC":c.fecMechanisms.push(A.name.toUpperCase());break}}}s.matchPrefix(o,"a=extmap:").forEach(w=>{c.headerExtensions.push(s.parseExtmap(w))});const p=s.matchPrefix(o,"a=rtcp-fb:* ").map(s.parseRtcpFb);return c.codecs.forEach(w=>{p.forEach(b=>{w.rtcpFeedback.find(A=>A.type===b.type&&A.parameter===b.parameter)||w.rtcpFeedback.push(b)})}),c},s.writeRtpDescription=function(o,c){let d="";d+="m="+o+" ",d+=c.codecs.length>0?"9":"0",d+=" "+(c.profile||"UDP/TLS/RTP/SAVPF")+" ",d+=c.codecs.map(p=>p.preferredPayloadType!==void 0?p.preferredPayloadType:p.payloadType).join(" ")+`\r
`,d+=`c=IN IP4 0.0.0.0\r
`,d+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,c.codecs.forEach(p=>{d+=s.writeRtpMap(p),d+=s.writeFmtp(p),d+=s.writeRtcpFb(p)});let f=0;return c.codecs.forEach(p=>{p.maxptime>f&&(f=p.maxptime)}),f>0&&(d+="a=maxptime:"+f+`\r
`),c.headerExtensions&&c.headerExtensions.forEach(p=>{d+=s.writeExtmap(p)}),d},s.parseRtpEncodingParameters=function(o){const c=[],d=s.parseRtpParameters(o),f=d.fecMechanisms.indexOf("RED")!==-1,p=d.fecMechanisms.indexOf("ULPFEC")!==-1,w=s.matchPrefix(o,"a=ssrc:").map(O=>s.parseSsrcMedia(O)).filter(O=>O.attribute==="cname"),b=w.length>0&&w[0].ssrc;let m;const A=s.matchPrefix(o,"a=ssrc-group:FID").map(O=>O.substring(17).split(" ").map(Z=>parseInt(Z,10)));A.length>0&&A[0].length>1&&A[0][0]===b&&(m=A[0][1]),d.codecs.forEach(O=>{if(O.name.toUpperCase()==="RTX"&&O.parameters.apt){let D={ssrc:b,codecPayloadType:parseInt(O.parameters.apt,10)};b&&m&&(D.rtx={ssrc:m}),c.push(D),f&&(D=JSON.parse(JSON.stringify(D)),D.fec={ssrc:b,mechanism:p?"red+ulpfec":"red"},c.push(D))}}),c.length===0&&b&&c.push({ssrc:b});let _=s.matchPrefix(o,"b=");return _.length&&(_[0].indexOf("b=TIAS:")===0?_=parseInt(_[0].substring(7),10):_[0].indexOf("b=AS:")===0?_=parseInt(_[0].substring(5),10)*1e3*.95-2e3*8:_=void 0,c.forEach(O=>{O.maxBitrate=_})),c},s.parseRtcpParameters=function(o){const c={},d=s.matchPrefix(o,"a=ssrc:").map(w=>s.parseSsrcMedia(w)).filter(w=>w.attribute==="cname")[0];d&&(c.cname=d.value,c.ssrc=d.ssrc);const f=s.matchPrefix(o,"a=rtcp-rsize");c.reducedSize=f.length>0,c.compound=f.length===0;const p=s.matchPrefix(o,"a=rtcp-mux");return c.mux=p.length>0,c},s.writeRtcpParameters=function(o){let c="";return o.reducedSize&&(c+=`a=rtcp-rsize\r
`),o.mux&&(c+=`a=rtcp-mux\r
`),o.ssrc!==void 0&&o.cname&&(c+="a=ssrc:"+o.ssrc+" cname:"+o.cname+`\r
`),c},s.parseMsid=function(o){let c;const d=s.matchPrefix(o,"a=msid:");if(d.length===1)return c=d[0].substring(7).split(" "),{stream:c[0],track:c[1]};const f=s.matchPrefix(o,"a=ssrc:").map(p=>s.parseSsrcMedia(p)).filter(p=>p.attribute==="msid");if(f.length>0)return c=f[0].value.split(" "),{stream:c[0],track:c[1]}},s.parseSctpDescription=function(o){const c=s.parseMLine(o),d=s.matchPrefix(o,"a=max-message-size:");let f;d.length>0&&(f=parseInt(d[0].substring(19),10)),isNaN(f)&&(f=65536);const p=s.matchPrefix(o,"a=sctp-port:");if(p.length>0)return{port:parseInt(p[0].substring(12),10),protocol:c.fmt,maxMessageSize:f};const w=s.matchPrefix(o,"a=sctpmap:");if(w.length>0){const b=w[0].substring(10).split(" ");return{port:parseInt(b[0],10),protocol:b[1],maxMessageSize:f}}},s.writeSctpDescription=function(o,c){let d=[];return o.protocol!=="DTLS/SCTP"?d=["m="+o.kind+" 9 "+o.protocol+" "+c.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+c.port+`\r
`]:d=["m="+o.kind+" 9 "+o.protocol+" "+c.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+c.port+" "+c.protocol+` 65535\r
`],c.maxMessageSize!==void 0&&d.push("a=max-message-size:"+c.maxMessageSize+`\r
`),d.join("")},s.generateSessionId=function(){return Math.random().toString().substr(2,22)},s.writeSessionBoilerplate=function(o,c,d){let f;const p=c!==void 0?c:2;return o?f=o:f=s.generateSessionId(),`v=0\r
o=`+(d||"thisisadapterortc")+" "+f+" "+p+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},s.getDirection=function(o,c){const d=s.splitLines(o);for(let f=0;f<d.length;f++)switch(d[f]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return d[f].substring(2)}return c?s.getDirection(c):"sendrecv"},s.getKind=function(o){return s.splitLines(o)[0].split(" ")[0].substring(2)},s.isRejected=function(o){return o.split(" ",2)[1]==="0"},s.parseMLine=function(o){const d=s.splitLines(o)[0].substring(2).split(" ");return{kind:d[0],port:parseInt(d[1],10),protocol:d[2],fmt:d.slice(3).join(" ")}},s.parseOLine=function(o){const d=s.matchPrefix(o,"o=")[0].substring(2).split(" ");return{username:d[0],sessionId:d[1],sessionVersion:parseInt(d[2],10),netType:d[3],addressType:d[4],address:d[5]}},s.isValidSDP=function(o){if(typeof o!="string"||o.length===0)return!1;const c=s.splitLines(o);for(let d=0;d<c.length;d++)if(c[d].length<2||c[d].charAt(1)!=="=")return!1;return!0},l.exports=s})(Wr)),Wr.exports}var ma=Vc();const Rn=Ui(ma),Hc=go({__proto__:null,default:Rn},[ma]);function lr(l){if(!l.RTCIceCandidate||l.RTCIceCandidate&&"foundation"in l.RTCIceCandidate.prototype)return;const s=l.RTCIceCandidate;l.RTCIceCandidate=function(c){if(typeof c=="object"&&c.candidate&&c.candidate.indexOf("a=")===0&&(c=JSON.parse(JSON.stringify(c)),c.candidate=c.candidate.substring(2)),c.candidate&&c.candidate.length){const d=new s(c),f=Rn.parseCandidate(c.candidate);for(const p in f)p in d||Object.defineProperty(d,p,{value:f[p]});return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new s(c)},l.RTCIceCandidate.prototype=s.prototype,hn(l,"icecandidate",o=>(o.candidate&&Object.defineProperty(o,"candidate",{value:new l.RTCIceCandidate(o.candidate),writable:"false"}),o))}function _i(l){!l.RTCIceCandidate||l.RTCIceCandidate&&"relayProtocol"in l.RTCIceCandidate.prototype||hn(l,"icecandidate",s=>{if(s.candidate){const o=Rn.parseCandidate(s.candidate.candidate);o.type==="relay"&&(s.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[o.priority>>24])}return s})}function ur(l,s){if(!l.RTCPeerConnection)return;"sctp"in l.RTCPeerConnection.prototype||Object.defineProperty(l.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const o=function(w){if(!w||!w.sdp)return!1;const b=Rn.splitSections(w.sdp);return b.shift(),b.some(m=>{const A=Rn.parseMLine(m);return A&&A.kind==="application"&&A.protocol.indexOf("SCTP")!==-1})},c=function(w){const b=w.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(b===null||b.length<2)return-1;const m=parseInt(b[1],10);return m!==m?-1:m},d=function(w){let b=65536;return s.browser==="firefox"&&(s.version<57?w===-1?b=16384:b=2147483637:s.version<60?b=s.version===57?65535:65536:b=2147483637),b},f=function(w,b){let m=65536;s.browser==="firefox"&&s.version===57&&(m=65535);const A=Rn.matchPrefix(w.sdp,"a=max-message-size:");return A.length>0?m=parseInt(A[0].substring(19),10):s.browser==="firefox"&&b!==-1&&(m=2147483637),m},p=l.RTCPeerConnection.prototype.setRemoteDescription;l.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,s.browser==="chrome"&&s.version>=76){const{sdpSemantics:b}=this.getConfiguration();b==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(o(arguments[0])){const b=c(arguments[0]),m=d(b),A=f(arguments[0],b);let _;m===0&&A===0?_=Number.POSITIVE_INFINITY:m===0||A===0?_=Math.max(m,A):_=Math.min(m,A);const O={};Object.defineProperty(O,"maxMessageSize",{get(){return _}}),this._sctp=O}return p.apply(this,arguments)}}function dr(l){if(!(l.RTCPeerConnection&&"createDataChannel"in l.RTCPeerConnection.prototype))return;function s(c,d){const f=c.send;c.send=function(){const w=arguments[0],b=w.length||w.size||w.byteLength;if(c.readyState==="open"&&d.sctp&&b>d.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+d.sctp.maxMessageSize+" bytes)");return f.apply(c,arguments)}}const o=l.RTCPeerConnection.prototype.createDataChannel;l.RTCPeerConnection.prototype.createDataChannel=function(){const d=o.apply(this,arguments);return s(d,this),d},hn(l,"datachannel",c=>(s(c.channel,c.target),c))}function Ti(l){if(!l.RTCPeerConnection||"connectionState"in l.RTCPeerConnection.prototype)return;const s=l.RTCPeerConnection.prototype;Object.defineProperty(s,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(s,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(o){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),o&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=o)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(o=>{const c=s[o];s[o]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=d=>{const f=d.target;if(f._lastConnectionState!==f.connectionState){f._lastConnectionState=f.connectionState;const p=new Event("connectionstatechange",d);f.dispatchEvent(p)}return d},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),c.apply(this,arguments)}})}function vi(l,s){if(!l.RTCPeerConnection||s.browser==="chrome"&&s.version>=71||s.browser==="safari"&&s._safariVersion>=13.1)return;const o=l.RTCPeerConnection.prototype.setRemoteDescription;l.RTCPeerConnection.prototype.setRemoteDescription=function(d){if(d&&d.sdp&&d.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const f=d.sdp.split(`
`).filter(p=>p.trim()!=="a=extmap-allow-mixed").join(`
`);l.RTCSessionDescription&&d instanceof l.RTCSessionDescription?arguments[0]=new l.RTCSessionDescription({type:d.type,sdp:f}):d.sdp=f}return o.apply(this,arguments)}}function hr(l,s){if(!(l.RTCPeerConnection&&l.RTCPeerConnection.prototype))return;const o=l.RTCPeerConnection.prototype.addIceCandidate;!o||o.length===0||(l.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(s.browser==="chrome"&&s.version<78||s.browser==="firefox"&&s.version<68||s.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function fr(l,s){if(!(l.RTCPeerConnection&&l.RTCPeerConnection.prototype))return;const o=l.RTCPeerConnection.prototype.setLocalDescription;!o||o.length===0||(l.RTCPeerConnection.prototype.setLocalDescription=function(){let d=arguments[0]||{};if(typeof d!="object"||d.type&&d.sdp)return o.apply(this,arguments);if(d={type:d.type,sdp:d.sdp},!d.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":d.type="offer";break;default:d.type="answer";break}return d.sdp||d.type!=="offer"&&d.type!=="answer"?o.apply(this,[d]):(d.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(p=>o.apply(this,[p]))})}const Gc=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:vi,shimAddIceCandidateNullOrEmpty:hr,shimConnectionState:Ti,shimMaxMessageSize:ur,shimParameterlessSetLocalDescription:fr,shimRTCIceCandidate:lr,shimRTCIceCandidateRelayProtocol:_i,shimSendThrowTypeError:dr},Symbol.toStringTag,{value:"Module"}));function jc({window:l}={},s={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const o=Go,c=Fc(l),d={browserDetails:c,commonShim:Gc,extractVersion:jn,disableLog:Pc,disableWarnings:Lc,sdp:Hc};switch(c.browser){case"chrome":if(!ys||!Ii||!s.shimChrome)return o("Chrome shim is not included in this adapter release."),d;if(c.version===null)return o("Chrome shim can not determine version, not shimming."),d;o("adapter.js shimming chrome."),d.browserShim=ys,hr(l,c),fr(l),Wo(l,c),Xo(l),Ii(l,c),zo(l),Ko(l,c),Yo(l),qo(l),Qo(l,c),lr(l),_i(l),Ti(l),ur(l,c),dr(l),vi(l,c);break;case"firefox":if(!bs||!Si||!s.shimFirefox)return o("Firefox shim is not included in this adapter release."),d;o("adapter.js shimming firefox."),d.browserShim=bs,hr(l,c),fr(l),Jo(l,c),Si(l,c),$o(l),na(l),ea(l),ta(l),ra(l),ia(l),sa(l),oa(l),aa(l),lr(l),Ti(l),ur(l,c),dr(l);break;case"safari":if(!Es||!s.shimSafari)return o("Safari shim is not included in this adapter release."),d;o("adapter.js shimming safari."),d.browserShim=Es,hr(l,c),fr(l),fa(l),pa(l),ua(l),ca(l),la(l),ga(l),da(l),xa(l),lr(l),_i(l),ur(l,c),dr(l),vi(l,c);break;default:o("Unsupported browser!");break}return d}const Is=jc({window:typeof window>"u"?void 0:window});function fn(l,s,o,c){Object.defineProperty(l,s,{get:o,set:c,enumerable:!0,configurable:!0})}class wa{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=s=>{const o=[],c=s.byteLength,d=Math.ceil(c/this.chunkedMTU);let f=0,p=0;for(;p<c;){const w=Math.min(c,p+this.chunkedMTU),b=s.slice(p,w),m={__peerData:this._dataCount,n:f,data:b,total:d};o.push(m),p=w,f++}return this._dataCount++,o}}}function Wc(l){let s=0;for(const d of l)s+=d.byteLength;const o=new Uint8Array(s);let c=0;for(const d of l)o.set(d,c),c+=d.byteLength;return o}const Xr=Is.default||Is,Hn=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const l=this.getBrowser(),s=this.getVersion();return this.supportedBrowsers.includes(l)?l==="chrome"?s>=this.minChromeVersion:l==="firefox"?s>=this.minFirefoxVersion:l==="safari"?!this.isIOS&&s>=this.minSafariVersion:!1:!1}getBrowser(){return Xr.browserDetails.browser}getVersion(){return Xr.browserDetails.version||0}isUnifiedPlanSupported(){const l=this.getBrowser(),s=Xr.browserDetails.version||0;if(l==="chrome"&&s<this.minChromeVersion)return!1;if(l==="firefox"&&s>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let o,c=!1;try{o=new RTCPeerConnection,o.addTransceiver("audio"),c=!0}catch{}finally{o&&o.close()}return c}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},Xc=l=>!l||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(l),Ca=()=>Math.random().toString(36).slice(2),Ss={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class zc extends wa{noop(){}blobToArrayBuffer(s,o){const c=new FileReader;return c.onload=function(d){d.target&&o(d.target.result)},c.readAsArrayBuffer(s),c}binaryStringToArrayBuffer(s){const o=new Uint8Array(s.length);for(let c=0;c<s.length;c++)o[c]=s.charCodeAt(c)&255;return o.buffer}isSecure(){return location.protocol==="https:"}constructor(...s){super(...s),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=Ss,this.browser=Hn.getBrowser(),this.browserVersion=Hn.getVersion(),this.pack=Uo,this.unpack=Fo,this.supports=(function(){const o={browser:Hn.isBrowserSupported(),webRTC:Hn.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!o.webRTC)return o;let c;try{c=new RTCPeerConnection(Ss),o.audioVideo=!0;let d;try{d=c.createDataChannel("_PEERJSTEST",{ordered:!0}),o.data=!0,o.reliable=!!d.ordered;try{d.binaryType="blob",o.binaryBlob=!Hn.isIOS}catch{}}catch{}finally{d&&d.close()}}catch{}finally{c&&c.close()}return o})(),this.validateId=Xc,this.randomToken=Ca}}const pt=new zc,Yc="PeerJS: ";class qc{get logLevel(){return this._logLevel}set logLevel(s){this._logLevel=s}log(...s){this._logLevel>=3&&this._print(3,...s)}warn(...s){this._logLevel>=2&&this._print(2,...s)}error(...s){this._logLevel>=1&&this._print(1,...s)}setLogFunction(s){this._print=s}_print(s,...o){const c=[Yc,...o];for(const d in c)c[d]instanceof Error&&(c[d]="("+c[d].name+") "+c[d].message);s>=3?console.log(...c):s>=2?console.warn("WARNING",...c):s>=1&&console.error("ERROR",...c)}constructor(){this._logLevel=0}}var ee=new qc,Vi={},Zc=Object.prototype.hasOwnProperty,ct="~";function zn(){}Object.create&&(zn.prototype=Object.create(null),new zn().__proto__||(ct=!1));function Kc(l,s,o){this.fn=l,this.context=s,this.once=o||!1}function ya(l,s,o,c,d){if(typeof o!="function")throw new TypeError("The listener must be a function");var f=new Kc(o,c||l,d),p=ct?ct+s:s;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function gr(l,s){--l._eventsCount===0?l._events=new zn:delete l._events[s]}function st(){this._events=new zn,this._eventsCount=0}st.prototype.eventNames=function(){var s=[],o,c;if(this._eventsCount===0)return s;for(c in o=this._events)Zc.call(o,c)&&s.push(ct?c.slice(1):c);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(o)):s};st.prototype.listeners=function(s){var o=ct?ct+s:s,c=this._events[o];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,f=c.length,p=new Array(f);d<f;d++)p[d]=c[d].fn;return p};st.prototype.listenerCount=function(s){var o=ct?ct+s:s,c=this._events[o];return c?c.fn?1:c.length:0};st.prototype.emit=function(s,o,c,d,f,p){var w=ct?ct+s:s;if(!this._events[w])return!1;var b=this._events[w],m=arguments.length,A,_;if(b.fn){switch(b.once&&this.removeListener(s,b.fn,void 0,!0),m){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,o),!0;case 3:return b.fn.call(b.context,o,c),!0;case 4:return b.fn.call(b.context,o,c,d),!0;case 5:return b.fn.call(b.context,o,c,d,f),!0;case 6:return b.fn.call(b.context,o,c,d,f,p),!0}for(_=1,A=new Array(m-1);_<m;_++)A[_-1]=arguments[_];b.fn.apply(b.context,A)}else{var O=b.length,D;for(_=0;_<O;_++)switch(b[_].once&&this.removeListener(s,b[_].fn,void 0,!0),m){case 1:b[_].fn.call(b[_].context);break;case 2:b[_].fn.call(b[_].context,o);break;case 3:b[_].fn.call(b[_].context,o,c);break;case 4:b[_].fn.call(b[_].context,o,c,d);break;default:if(!A)for(D=1,A=new Array(m-1);D<m;D++)A[D-1]=arguments[D];b[_].fn.apply(b[_].context,A)}}return!0};st.prototype.on=function(s,o,c){return ya(this,s,o,c,!1)};st.prototype.once=function(s,o,c){return ya(this,s,o,c,!0)};st.prototype.removeListener=function(s,o,c,d){var f=ct?ct+s:s;if(!this._events[f])return this;if(!o)return gr(this,f),this;var p=this._events[f];if(p.fn)p.fn===o&&(!d||p.once)&&(!c||p.context===c)&&gr(this,f);else{for(var w=0,b=[],m=p.length;w<m;w++)(p[w].fn!==o||d&&!p[w].once||c&&p[w].context!==c)&&b.push(p[w]);b.length?this._events[f]=b.length===1?b[0]:b:gr(this,f)}return this};st.prototype.removeAllListeners=function(s){var o;return s?(o=ct?ct+s:s,this._events[o]&&gr(this,o)):(this._events=new zn,this._eventsCount=0),this};st.prototype.off=st.prototype.removeListener;st.prototype.addListener=st.prototype.on;st.prefixed=ct;st.EventEmitter=st;Vi=st;var gn={};fn(gn,"ConnectionType",()=>en);fn(gn,"PeerErrorType",()=>je);fn(gn,"BaseConnectionErrorType",()=>Ri);fn(gn,"DataConnectionErrorType",()=>Hi);fn(gn,"SerializationType",()=>br);fn(gn,"SocketEventType",()=>Jt);fn(gn,"ServerMessageType",()=>it);var en=(function(l){return l.Data="data",l.Media="media",l})({}),je=(function(l){return l.BrowserIncompatible="browser-incompatible",l.Disconnected="disconnected",l.InvalidID="invalid-id",l.InvalidKey="invalid-key",l.Network="network",l.PeerUnavailable="peer-unavailable",l.SslUnavailable="ssl-unavailable",l.ServerError="server-error",l.SocketError="socket-error",l.SocketClosed="socket-closed",l.UnavailableID="unavailable-id",l.WebRTC="webrtc",l})({}),Ri=(function(l){return l.NegotiationFailed="negotiation-failed",l.ConnectionClosed="connection-closed",l})({}),Hi=(function(l){return l.NotOpenYet="not-open-yet",l.MessageToBig="message-too-big",l})({}),br=(function(l){return l.Binary="binary",l.BinaryUTF8="binary-utf8",l.JSON="json",l.None="raw",l})({}),Jt=(function(l){return l.Message="message",l.Disconnected="disconnected",l.Error="error",l.Close="close",l})({}),it=(function(l){return l.Heartbeat="HEARTBEAT",l.Candidate="CANDIDATE",l.Offer="OFFER",l.Answer="ANSWER",l.Open="OPEN",l.Error="ERROR",l.IdTaken="ID-TAKEN",l.InvalidKey="INVALID-KEY",l.Leave="LEAVE",l.Expire="EXPIRE",l})({});const ba="1.5.5";class Qc extends Vi.EventEmitter{constructor(s,o,c,d,f,p=5e3){super(),this.pingInterval=p,this._disconnected=!0,this._messagesQueue=[];const w=s?"wss://":"ws://";this._baseUrl=w+o+":"+c+d+"peerjs?key="+f}start(s,o){this._id=s;const c=`${this._baseUrl}&id=${s}&token=${o}`;this._socket||!this._disconnected||(this._socket=new WebSocket(c+"&version="+ba),this._disconnected=!1,this._socket.onmessage=d=>{let f;try{f=JSON.parse(d.data),ee.log("Server message received:",f)}catch{ee.log("Invalid server message",d.data);return}this.emit(Jt.Message,f)},this._socket.onclose=d=>{this._disconnected||(ee.log("Socket closed.",d),this._cleanup(),this._disconnected=!0,this.emit(Jt.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),ee.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){ee.log("Cannot send heartbeat, because socket closed");return}const s=JSON.stringify({type:it.Heartbeat});this._socket.send(s),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const s=[...this._messagesQueue];this._messagesQueue=[];for(const o of s)this.send(o)}send(s){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(s);return}if(!s.type){this.emit(Jt.Error,"Invalid message");return}if(!this._wsOpen())return;const o=JSON.stringify(s);this._socket.send(o)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class Ea{constructor(s){this.connection=s}startConnection(s){const o=this._startPeerConnection();if(this.connection.peerConnection=o,this.connection.type===en.Media&&s._stream&&this._addTracksToConnection(s._stream,o),s.originator){const c=this.connection,d={ordered:!!s.reliable},f=o.createDataChannel(c.label,d);c._initializeDataChannel(f),this._makeOffer()}else this.handleSDP("OFFER",s.sdp)}_startPeerConnection(){ee.log("Creating RTCPeerConnection.");const s=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(s),s}_setupListeners(s){const o=this.connection.peer,c=this.connection.connectionId,d=this.connection.type,f=this.connection.provider;ee.log("Listening for ICE candidates."),s.onicecandidate=p=>{!p.candidate||!p.candidate.candidate||(ee.log(`Received ICE candidates for ${o}:`,p.candidate),f.socket.send({type:it.Candidate,payload:{candidate:p.candidate,type:d,connectionId:c},dst:o}))},s.oniceconnectionstatechange=()=>{switch(s.iceConnectionState){case"failed":ee.log("iceConnectionState is failed, closing connections to "+o),this.connection.emitError(Ri.NegotiationFailed,"Negotiation of connection to "+o+" failed."),this.connection.close();break;case"closed":ee.log("iceConnectionState is closed, closing connections to "+o),this.connection.emitError(Ri.ConnectionClosed,"Connection to "+o+" closed."),this.connection.close();break;case"disconnected":ee.log("iceConnectionState changed to disconnected on the connection with "+o);break;case"completed":s.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",s.iceConnectionState)},ee.log("Listening for data channel"),s.ondatachannel=p=>{ee.log("Received data channel");const w=p.channel;f.getConnection(o,c)._initializeDataChannel(w)},ee.log("Listening for remote stream"),s.ontrack=p=>{ee.log("Received remote stream");const w=p.streams[0],b=f.getConnection(o,c);if(b.type===en.Media){const m=b;this._addStreamToMediaConnection(w,m)}}}cleanup(){ee.log("Cleaning up PeerConnection to "+this.connection.peer);const s=this.connection.peerConnection;if(!s)return;this.connection.peerConnection=null,s.onicecandidate=s.oniceconnectionstatechange=s.ondatachannel=s.ontrack=()=>{};const o=s.signalingState!=="closed";let c=!1;const d=this.connection.dataChannel;d&&(c=!!d.readyState&&d.readyState!=="closed"),(o||c)&&s.close()}async _makeOffer(){const s=this.connection.peerConnection,o=this.connection.provider;try{const c=await s.createOffer(this.connection.options.constraints);ee.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(c.sdp=this.connection.options.sdpTransform(c.sdp)||c.sdp);try{await s.setLocalDescription(c),ee.log("Set localDescription:",c,`for:${this.connection.peer}`);let d={sdp:c,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===en.Data){const f=this.connection;d={...d,label:f.label,reliable:f.reliable,serialization:f.serialization}}o.socket.send({type:it.Offer,payload:d,dst:this.connection.peer})}catch(d){d!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(o.emitError(je.WebRTC,d),ee.log("Failed to setLocalDescription, ",d))}}catch(c){o.emitError(je.WebRTC,c),ee.log("Failed to createOffer, ",c)}}async _makeAnswer(){const s=this.connection.peerConnection,o=this.connection.provider;try{const c=await s.createAnswer();ee.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(c.sdp=this.connection.options.sdpTransform(c.sdp)||c.sdp);try{await s.setLocalDescription(c),ee.log("Set localDescription:",c,`for:${this.connection.peer}`),o.socket.send({type:it.Answer,payload:{sdp:c,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(d){o.emitError(je.WebRTC,d),ee.log("Failed to setLocalDescription, ",d)}}catch(c){o.emitError(je.WebRTC,c),ee.log("Failed to create answer, ",c)}}async handleSDP(s,o){o=new RTCSessionDescription(o);const c=this.connection.peerConnection,d=this.connection.provider;ee.log("Setting remote description",o);const f=this;try{await c.setRemoteDescription(o),ee.log(`Set remoteDescription:${s} for:${this.connection.peer}`),s==="OFFER"&&await f._makeAnswer()}catch(p){d.emitError(je.WebRTC,p),ee.log("Failed to setRemoteDescription, ",p)}}async handleCandidate(s){ee.log("handleCandidate:",s);try{await this.connection.peerConnection.addIceCandidate(s),ee.log(`Added ICE candidate for:${this.connection.peer}`)}catch(o){this.connection.provider.emitError(je.WebRTC,o),ee.log("Failed to handleCandidate, ",o)}}_addTracksToConnection(s,o){if(ee.log(`add tracks from stream ${s.id} to peer connection`),!o.addTrack)return ee.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");s.getTracks().forEach(c=>{o.addTrack(c,s)})}_addStreamToMediaConnection(s,o){ee.log(`add stream ${s.id} to media connection ${o.connectionId}`),o.addStream(s)}}class Aa extends Vi.EventEmitter{emitError(s,o){ee.error("Error:",o),this.emit("error",new Jc(`${s}`,o))}}class Jc extends Error{constructor(s,o){typeof o=="string"?super(o):(super(),Object.assign(this,o)),this.type=s}}class Ia extends Aa{get open(){return this._open}constructor(s,o,c){super(),this.peer=s,this.provider=o,this.options=c,this._open=!1,this.metadata=c.metadata}}class pr extends Ia{static#e=this.ID_PREFIX="mc_";get type(){return en.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(s,o,c){super(s,o,c),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||pr.ID_PREFIX+pt.randomToken(),this._negotiator=new Ea(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(s){this.dataChannel=s,this.dataChannel.onopen=()=>{ee.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{ee.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(s){ee.log("Receiving stream",s),this._remoteStream=s,super.emit("stream",s)}handleMessage(s){const o=s.type,c=s.payload;switch(s.type){case it.Answer:this._negotiator.handleSDP(o,c.sdp),this._open=!0;break;case it.Candidate:this._negotiator.handleCandidate(c.candidate);break;default:ee.warn(`Unrecognized message type:${o} from peer:${this.peer}`);break}}answer(s,o={}){if(this._localStream){ee.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=s,o&&o.sdpTransform&&(this.options.sdpTransform=o.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:s});const c=this.provider._getMessages(this.connectionId);for(const d of c)this.handleMessage(d);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class $c{constructor(s){this._options=s}_buildRequest(s){const o=this._options.secure?"https":"http",{host:c,port:d,path:f,key:p}=this._options,w=new URL(`${o}://${c}:${d}${f}${p}/${s}`);return w.searchParams.set("ts",`${Date.now()}${Math.random()}`),w.searchParams.set("version",ba),fetch(w.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const s=await this._buildRequest("id");if(s.status!==200)throw new Error(`Error. Status:${s.status}`);return s.text()}catch(s){ee.error("Error retrieving ID",s);let o="";throw this._options.path==="/"&&this._options.host!==pt.CLOUD_HOST&&(o=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+o)}}async listAllPeers(){try{const s=await this._buildRequest("peers");if(s.status!==200){if(s.status===401){let o="";throw this._options.host===pt.CLOUD_HOST?o="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":o="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+o)}throw new Error(`Error. Status:${s.status}`)}return s.json()}catch(s){throw ee.error("Error retrieving list peers",s),new Error("Could not get list peers from the server."+s)}}}class xr extends Ia{static#e=this.ID_PREFIX="dc_";static#t=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return en.Data}constructor(s,o,c){super(s,o,c),this.connectionId=this.options.connectionId||xr.ID_PREFIX+Ca(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new Ea(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(s){this.dataChannel=s,this.dataChannel.onopen=()=>{ee.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=o=>{ee.log(`DC#${this.connectionId} dc onmessage:`,o.data)},this.dataChannel.onclose=()=>{ee.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(s){if(s?.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(s,o=!1){if(!this.open){this.emitError(Hi.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(s,o)}async handleMessage(s){const o=s.payload;switch(s.type){case it.Answer:await this._negotiator.handleSDP(s.type,o.sdp);break;case it.Candidate:await this._negotiator.handleCandidate(o.candidate);break;default:ee.warn("Unrecognized message type:",s.type,"from peer:",this.peer);break}}}class Gi extends xr{get bufferSize(){return this._bufferSize}_initializeDataChannel(s){super._initializeDataChannel(s),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",o=>this._handleDataMessage(o))}_bufferedSend(s){(this._buffering||!this._trySend(s))&&(this._buffer.push(s),this._bufferSize=this._buffer.length)}_trySend(s){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>xr.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(s)}catch(o){return ee.error(`DC#:${this.connectionId} Error when sending:`,o),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const s=this._buffer[0];this._trySend(s)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(s){if(s?.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...s){super(...s),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class zr extends Gi{close(s){super.close(s),this._chunkedData={}}constructor(s,o,c){super(s,o,c),this.chunker=new wa,this.serialization=br.Binary,this._chunkedData={}}_handleDataMessage({data:s}){const o=Fo(s),c=o.__peerData;if(c){if(c.type==="close"){this.close();return}this._handleChunk(o);return}this.emit("data",o)}_handleChunk(s){const o=s.__peerData,c=this._chunkedData[o]||{data:[],count:0,total:s.total};if(c.data[s.n]=new Uint8Array(s.data),c.count++,this._chunkedData[o]=c,c.total===c.count){delete this._chunkedData[o];const d=Wc(c.data);this._handleDataMessage({data:d})}}_send(s,o){const c=Uo(s);if(c instanceof Promise)return this._send_blob(c);if(!o&&c.byteLength>this.chunker.chunkedMTU){this._sendChunks(c);return}this._bufferedSend(c)}async _send_blob(s){const o=await s;if(o.byteLength>this.chunker.chunkedMTU){this._sendChunks(o);return}this._bufferedSend(o)}_sendChunks(s){const o=this.chunker.chunk(s);ee.log(`DC#${this.connectionId} Try to send ${o.length} chunks...`);for(const c of o)this.send(c,!0)}}class el extends Gi{_handleDataMessage({data:s}){super.emit("data",s)}_send(s,o){this._bufferedSend(s)}constructor(...s){super(...s),this.serialization=br.None}}class tl extends Gi{_handleDataMessage({data:s}){const o=this.parse(this.decoder.decode(s)),c=o.__peerData;if(c&&c.type==="close"){this.close();return}this.emit("data",o)}_send(s,o){const c=this.encoder.encode(this.stringify(s));if(c.byteLength>=pt.chunkedMTU){this.emitError(Hi.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(c)}constructor(...s){super(...s),this.serialization=br.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class ji extends Aa{static#e=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const s=Object.create(null);for(const[o,c]of this._connections)s[o]=c;return s}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(s,o){super(),this._serializers={raw:el,json:tl,binary:zr,"binary-utf8":zr,default:zr},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let c;if(s&&s.constructor==Object?o=s:s&&(c=s.toString()),o={debug:0,host:pt.CLOUD_HOST,port:pt.CLOUD_PORT,path:"/",key:ji.DEFAULT_KEY,token:pt.randomToken(),config:pt.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...o},this._options=o,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==pt.CLOUD_HOST?this._options.secure=pt.isSecure():this._options.host==pt.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&ee.setLogFunction(this._options.logFunction),ee.logLevel=this._options.debug||0,this._api=new $c(o),this._socket=this._createServerConnection(),!pt.supports.audioVideo&&!pt.supports.data){this._delayedAbort(je.BrowserIncompatible,"The current browser does not support WebRTC");return}if(c&&!pt.validateId(c)){this._delayedAbort(je.InvalidID,`ID "${c}" is invalid`);return}c?this._initialize(c):this._api.retrieveId().then(d=>this._initialize(d)).catch(d=>this._abort(je.ServerError,d))}_createServerConnection(){const s=new Qc(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return s.on(Jt.Message,o=>{this._handleMessage(o)}),s.on(Jt.Error,o=>{this._abort(je.SocketError,o)}),s.on(Jt.Disconnected,()=>{this.disconnected||(this.emitError(je.Network,"Lost connection to server."),this.disconnect())}),s.on(Jt.Close,()=>{this.disconnected||this._abort(je.SocketClosed,"Underlying socket is already closed.")}),s}_initialize(s){this._id=s,this.socket.start(s,this._options.token)}_handleMessage(s){const o=s.type,c=s.payload,d=s.src;switch(o){case it.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case it.Error:this._abort(je.ServerError,c.msg);break;case it.IdTaken:this._abort(je.UnavailableID,`ID "${this.id}" is taken`);break;case it.InvalidKey:this._abort(je.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case it.Leave:ee.log(`Received leave message from ${d}`),this._cleanupPeer(d),this._connections.delete(d);break;case it.Expire:this.emitError(je.PeerUnavailable,`Could not connect to peer ${d}`);break;case it.Offer:{const f=c.connectionId;let p=this.getConnection(d,f);if(p&&(p.close(),ee.warn(`Offer received for existing Connection ID:${f}`)),c.type===en.Media){const b=new pr(d,this,{connectionId:f,_payload:c,metadata:c.metadata});p=b,this._addConnection(d,p),this.emit("call",b)}else if(c.type===en.Data){const b=new this._serializers[c.serialization](d,this,{connectionId:f,_payload:c,metadata:c.metadata,label:c.label,serialization:c.serialization,reliable:c.reliable});p=b,this._addConnection(d,p),this.emit("connection",b)}else{ee.warn(`Received malformed connection type:${c.type}`);return}const w=this._getMessages(f);for(const b of w)p.handleMessage(b);break}default:{if(!c){ee.warn(`You received a malformed message from ${d} of type ${o}`);return}const f=c.connectionId,p=this.getConnection(d,f);p&&p.peerConnection?p.handleMessage(s):f?this._storeMessage(f,s):ee.warn("You received an unrecognized message:",s);break}}}_storeMessage(s,o){this._lostMessages.has(s)||this._lostMessages.set(s,[]),this._lostMessages.get(s).push(o)}_getMessages(s){const o=this._lostMessages.get(s);return o?(this._lostMessages.delete(s),o):[]}connect(s,o={}){if(o={serialization:"default",...o},this.disconnected){ee.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(je.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const c=new this._serializers[o.serialization](s,this,o);return this._addConnection(s,c),c}call(s,o,c={}){if(this.disconnected){ee.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(je.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!o){ee.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const d=new pr(s,this,{...c,_stream:o});return this._addConnection(s,d),d}_addConnection(s,o){ee.log(`add connection ${o.type}:${o.connectionId} to peerId:${s}`),this._connections.has(s)||this._connections.set(s,[]),this._connections.get(s).push(o)}_removeConnection(s){const o=this._connections.get(s.peer);if(o){const c=o.indexOf(s);c!==-1&&o.splice(c,1)}this._lostMessages.delete(s.connectionId)}getConnection(s,o){const c=this._connections.get(s);if(!c)return null;for(const d of c)if(d.connectionId===o)return d;return null}_delayedAbort(s,o){setTimeout(()=>{this._abort(s,o)},0)}_abort(s,o){ee.error("Aborting!"),this.emitError(s,o),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(ee.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const s of this._connections.keys())this._cleanupPeer(s),this._connections.delete(s);this.socket.removeAllListeners()}_cleanupPeer(s){const o=this._connections.get(s);if(o)for(const c of o)c.close()}disconnect(){if(this.disconnected)return;const s=this.id;ee.log(`Disconnect peer with ID:${s}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=s,this._id=null,this.emit("disconnected",s)}reconnect(){if(this.disconnected&&!this.destroyed)ee.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)ee.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(s=o=>{}){this._api.listAllPeers().then(o=>s(o)).catch(o=>this._abort(je.ServerError,o))}}var nl=ji;let Gt=null,$t=new Map,Ni=null;async function rl(l){if(Gt)return Gt;try{const s=await Nn();return s?(Ni=l,Gt=new nl(s.publicId,{debug:2,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478"}]}}),Gt.on("open",o=>{console.log("My peer ID is: "+o)}),Gt.on("connection",o=>{Sa(o)}),Gt.on("error",o=>{console.error("PeerJS error:",o)}),Gt):(console.log("No identity found, skipping network init"),null)}catch(s){return console.error("Failed to initialize network:",s),null}}function Sa(l){const s=l.peer;$t.set(s,l),l.on("open",()=>{console.log("Connection opened with:",s),il(s)}),l.on("data",async o=>{console.log("Received data:",o);try{await sl(s,o)}catch(c){console.error("Error handling incoming data:",c)}}),l.on("close",()=>{console.log("Connection closed:",s),$t.delete(s)}),l.on("error",o=>{console.error("Connection error:",o),$t.delete(s)})}async function il(l){try{const s=await _o(l);if(s.length===0)return;console.log(`Replaying ${s.length} messages to ${l}`);for(const o of s)await Oi(l,o.messageData,!1)&&await To(o.id)}catch(s){console.error("Error replaying messages:",s)}}async function sl(l,s){if(s.type==="text")await Xn(l,s.content,"text",!1,s.encrypted,s.iv);else if((s.type==="image"||s.type==="audio"||s.type==="file")&&s.blob){const o=await Io(s.blob,s.iv,s.type);await Xn(l,s.type==="image"?"ðŸ“· Image":s.type==="audio"?"ðŸŽ¤ Audio":"ðŸ“Ž File",s.type,!1,null,null,o)}Ni&&Ni(l,s)}async function ol(l){if(!Gt)return console.warn("Network not initialized"),null;if($t.has(l)){const o=$t.get(l);if(o.open)return o;$t.delete(l)}const s=Gt.connect(l,{reliable:!0});return new Promise((o,c)=>{s.on("open",()=>{console.log("Connected to:",l),$t.set(l,s),Sa(s),o(s)}),s.on("error",d=>{console.error("Connection failed:",d),c(d)}),setTimeout(()=>{s.open||c(new Error("Connection timeout"))},5e3)})}async function Oi(l,s,o=!0){try{let c=$t.get(l);if(!c||!c.open)try{c=await ol(l)}catch{console.warn(`Could not connect to ${l} to send message`)}if(c&&c.open)return c.send(s),!0;throw new Error("Connection failed")}catch(c){return console.error("Failed to send message:",c),o&&(console.log("Queueing message for offline delivery"),await So(l,s)),!1}}var Tn={},Yr,_s;function al(){return _s||(_s=1,Yr=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),Yr}var qr={},Qt={},Ts;function pn(){if(Ts)return Qt;Ts=1;let l;const s=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return Qt.getSymbolSize=function(c){if(!c)throw new Error('"version" cannot be null or undefined');if(c<1||c>40)throw new Error('"version" should be in range from 1 to 40');return c*4+17},Qt.getSymbolTotalCodewords=function(c){return s[c]},Qt.getBCHDigit=function(o){let c=0;for(;o!==0;)c++,o>>>=1;return c},Qt.setToSJISFunction=function(c){if(typeof c!="function")throw new Error('"toSJISFunc" is not a valid function.');l=c},Qt.isKanjiModeEnabled=function(){return typeof l<"u"},Qt.toSJIS=function(c){return l(c)},Qt}var Zr={},vs;function Wi(){return vs||(vs=1,(function(l){l.L={bit:1},l.M={bit:0},l.Q={bit:3},l.H={bit:2};function s(o){if(typeof o!="string")throw new Error("Param is not a string");switch(o.toLowerCase()){case"l":case"low":return l.L;case"m":case"medium":return l.M;case"q":case"quartile":return l.Q;case"h":case"high":return l.H;default:throw new Error("Unknown EC Level: "+o)}}l.isValid=function(c){return c&&typeof c.bit<"u"&&c.bit>=0&&c.bit<4},l.from=function(c,d){if(l.isValid(c))return c;try{return s(c)}catch{return d}}})(Zr)),Zr}var Kr,Rs;function cl(){if(Rs)return Kr;Rs=1;function l(){this.buffer=[],this.length=0}return l.prototype={get:function(s){const o=Math.floor(s/8);return(this.buffer[o]>>>7-s%8&1)===1},put:function(s,o){for(let c=0;c<o;c++)this.putBit((s>>>o-c-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(s){const o=Math.floor(this.length/8);this.buffer.length<=o&&this.buffer.push(0),s&&(this.buffer[o]|=128>>>this.length%8),this.length++}},Kr=l,Kr}var Qr,Ns;function ll(){if(Ns)return Qr;Ns=1;function l(s){if(!s||s<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=s,this.data=new Uint8Array(s*s),this.reservedBit=new Uint8Array(s*s)}return l.prototype.set=function(s,o,c,d){const f=s*this.size+o;this.data[f]=c,d&&(this.reservedBit[f]=!0)},l.prototype.get=function(s,o){return this.data[s*this.size+o]},l.prototype.xor=function(s,o,c){this.data[s*this.size+o]^=c},l.prototype.isReserved=function(s,o){return this.reservedBit[s*this.size+o]},Qr=l,Qr}var Jr={},Os;function ul(){return Os||(Os=1,(function(l){const s=pn().getSymbolSize;l.getRowColCoords=function(c){if(c===1)return[];const d=Math.floor(c/7)+2,f=s(c),p=f===145?26:Math.ceil((f-13)/(2*d-2))*2,w=[f-7];for(let b=1;b<d-1;b++)w[b]=w[b-1]-p;return w.push(6),w.reverse()},l.getPositions=function(c){const d=[],f=l.getRowColCoords(c),p=f.length;for(let w=0;w<p;w++)for(let b=0;b<p;b++)w===0&&b===0||w===0&&b===p-1||w===p-1&&b===0||d.push([f[w],f[b]]);return d}})(Jr)),Jr}var $r={},Ds;function dl(){if(Ds)return $r;Ds=1;const l=pn().getSymbolSize,s=7;return $r.getPositions=function(c){const d=l(c);return[[0,0],[d-s,0],[0,d-s]]},$r}var ei={},Ms;function hl(){return Ms||(Ms=1,(function(l){l.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const s={N1:3,N2:3,N3:40,N4:10};l.isValid=function(d){return d!=null&&d!==""&&!isNaN(d)&&d>=0&&d<=7},l.from=function(d){return l.isValid(d)?parseInt(d,10):void 0},l.getPenaltyN1=function(d){const f=d.size;let p=0,w=0,b=0,m=null,A=null;for(let _=0;_<f;_++){w=b=0,m=A=null;for(let O=0;O<f;O++){let D=d.get(_,O);D===m?w++:(w>=5&&(p+=s.N1+(w-5)),m=D,w=1),D=d.get(O,_),D===A?b++:(b>=5&&(p+=s.N1+(b-5)),A=D,b=1)}w>=5&&(p+=s.N1+(w-5)),b>=5&&(p+=s.N1+(b-5))}return p},l.getPenaltyN2=function(d){const f=d.size;let p=0;for(let w=0;w<f-1;w++)for(let b=0;b<f-1;b++){const m=d.get(w,b)+d.get(w,b+1)+d.get(w+1,b)+d.get(w+1,b+1);(m===4||m===0)&&p++}return p*s.N2},l.getPenaltyN3=function(d){const f=d.size;let p=0,w=0,b=0;for(let m=0;m<f;m++){w=b=0;for(let A=0;A<f;A++)w=w<<1&2047|d.get(m,A),A>=10&&(w===1488||w===93)&&p++,b=b<<1&2047|d.get(A,m),A>=10&&(b===1488||b===93)&&p++}return p*s.N3},l.getPenaltyN4=function(d){let f=0;const p=d.data.length;for(let b=0;b<p;b++)f+=d.data[b];return Math.abs(Math.ceil(f*100/p/5)-10)*s.N4};function o(c,d,f){switch(c){case l.Patterns.PATTERN000:return(d+f)%2===0;case l.Patterns.PATTERN001:return d%2===0;case l.Patterns.PATTERN010:return f%3===0;case l.Patterns.PATTERN011:return(d+f)%3===0;case l.Patterns.PATTERN100:return(Math.floor(d/2)+Math.floor(f/3))%2===0;case l.Patterns.PATTERN101:return d*f%2+d*f%3===0;case l.Patterns.PATTERN110:return(d*f%2+d*f%3)%2===0;case l.Patterns.PATTERN111:return(d*f%3+(d+f)%2)%2===0;default:throw new Error("bad maskPattern:"+c)}}l.applyMask=function(d,f){const p=f.size;for(let w=0;w<p;w++)for(let b=0;b<p;b++)f.isReserved(b,w)||f.xor(b,w,o(d,b,w))},l.getBestMask=function(d,f){const p=Object.keys(l.Patterns).length;let w=0,b=1/0;for(let m=0;m<p;m++){f(m),l.applyMask(m,d);const A=l.getPenaltyN1(d)+l.getPenaltyN2(d)+l.getPenaltyN3(d)+l.getPenaltyN4(d);l.applyMask(m,d),A<b&&(b=A,w=m)}return w}})(ei)),ei}var cr={},ks;function _a(){if(ks)return cr;ks=1;const l=Wi(),s=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],o=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return cr.getBlocksCount=function(d,f){switch(f){case l.L:return s[(d-1)*4+0];case l.M:return s[(d-1)*4+1];case l.Q:return s[(d-1)*4+2];case l.H:return s[(d-1)*4+3];default:return}},cr.getTotalCodewordsCount=function(d,f){switch(f){case l.L:return o[(d-1)*4+0];case l.M:return o[(d-1)*4+1];case l.Q:return o[(d-1)*4+2];case l.H:return o[(d-1)*4+3];default:return}},cr}var ti={},Gn={},Bs;function fl(){if(Bs)return Gn;Bs=1;const l=new Uint8Array(512),s=new Uint8Array(256);return(function(){let c=1;for(let d=0;d<255;d++)l[d]=c,s[c]=d,c<<=1,c&256&&(c^=285);for(let d=255;d<512;d++)l[d]=l[d-255]})(),Gn.log=function(c){if(c<1)throw new Error("log("+c+")");return s[c]},Gn.exp=function(c){return l[c]},Gn.mul=function(c,d){return c===0||d===0?0:l[s[c]+s[d]]},Gn}var Ps;function gl(){return Ps||(Ps=1,(function(l){const s=fl();l.mul=function(c,d){const f=new Uint8Array(c.length+d.length-1);for(let p=0;p<c.length;p++)for(let w=0;w<d.length;w++)f[p+w]^=s.mul(c[p],d[w]);return f},l.mod=function(c,d){let f=new Uint8Array(c);for(;f.length-d.length>=0;){const p=f[0];for(let b=0;b<d.length;b++)f[b]^=s.mul(d[b],p);let w=0;for(;w<f.length&&f[w]===0;)w++;f=f.slice(w)}return f},l.generateECPolynomial=function(c){let d=new Uint8Array([1]);for(let f=0;f<c;f++)d=l.mul(d,new Uint8Array([1,s.exp(f)]));return d}})(ti)),ti}var ni,Ls;function pl(){if(Ls)return ni;Ls=1;const l=gl();function s(o){this.genPoly=void 0,this.degree=o,this.degree&&this.initialize(this.degree)}return s.prototype.initialize=function(c){this.degree=c,this.genPoly=l.generateECPolynomial(this.degree)},s.prototype.encode=function(c){if(!this.genPoly)throw new Error("Encoder not initialized");const d=new Uint8Array(c.length+this.degree);d.set(c);const f=l.mod(d,this.genPoly),p=this.degree-f.length;if(p>0){const w=new Uint8Array(this.degree);return w.set(f,p),w}return f},ni=s,ni}var ri={},ii={},si={},Fs;function Ta(){return Fs||(Fs=1,si.isValid=function(s){return!isNaN(s)&&s>=1&&s<=40}),si}var Lt={},Us;function va(){if(Us)return Lt;Us=1;const l="[0-9]+",s="[A-Z $%*+\\-./:]+";let o="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";o=o.replace(/u/g,"\\u");const c="(?:(?![A-Z0-9 $%*+\\-./:]|"+o+`)(?:.|[\r
]))+`;Lt.KANJI=new RegExp(o,"g"),Lt.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),Lt.BYTE=new RegExp(c,"g"),Lt.NUMERIC=new RegExp(l,"g"),Lt.ALPHANUMERIC=new RegExp(s,"g");const d=new RegExp("^"+o+"$"),f=new RegExp("^"+l+"$"),p=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return Lt.testKanji=function(b){return d.test(b)},Lt.testNumeric=function(b){return f.test(b)},Lt.testAlphanumeric=function(b){return p.test(b)},Lt}var Vs;function xn(){return Vs||(Vs=1,(function(l){const s=Ta(),o=va();l.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},l.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},l.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},l.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},l.MIXED={bit:-1},l.getCharCountIndicator=function(f,p){if(!f.ccBits)throw new Error("Invalid mode: "+f);if(!s.isValid(p))throw new Error("Invalid version: "+p);return p>=1&&p<10?f.ccBits[0]:p<27?f.ccBits[1]:f.ccBits[2]},l.getBestModeForData=function(f){return o.testNumeric(f)?l.NUMERIC:o.testAlphanumeric(f)?l.ALPHANUMERIC:o.testKanji(f)?l.KANJI:l.BYTE},l.toString=function(f){if(f&&f.id)return f.id;throw new Error("Invalid mode")},l.isValid=function(f){return f&&f.bit&&f.ccBits};function c(d){if(typeof d!="string")throw new Error("Param is not a string");switch(d.toLowerCase()){case"numeric":return l.NUMERIC;case"alphanumeric":return l.ALPHANUMERIC;case"kanji":return l.KANJI;case"byte":return l.BYTE;default:throw new Error("Unknown mode: "+d)}}l.from=function(f,p){if(l.isValid(f))return f;try{return c(f)}catch{return p}}})(ii)),ii}var Hs;function xl(){return Hs||(Hs=1,(function(l){const s=pn(),o=_a(),c=Wi(),d=xn(),f=Ta(),p=7973,w=s.getBCHDigit(p);function b(O,D,Z){for(let G=1;G<=40;G++)if(D<=l.getCapacity(G,Z,O))return G}function m(O,D){return d.getCharCountIndicator(O,D)+4}function A(O,D){let Z=0;return O.forEach(function(G){const Ee=m(G.mode,D);Z+=Ee+G.getBitsLength()}),Z}function _(O,D){for(let Z=1;Z<=40;Z++)if(A(O,Z)<=l.getCapacity(Z,D,d.MIXED))return Z}l.from=function(D,Z){return f.isValid(D)?parseInt(D,10):Z},l.getCapacity=function(D,Z,G){if(!f.isValid(D))throw new Error("Invalid QR Code version");typeof G>"u"&&(G=d.BYTE);const Ee=s.getSymbolTotalCodewords(D),ae=o.getTotalCodewordsCount(D,Z),te=(Ee-ae)*8;if(G===d.MIXED)return te;const j=te-m(G,D);switch(G){case d.NUMERIC:return Math.floor(j/10*3);case d.ALPHANUMERIC:return Math.floor(j/11*2);case d.KANJI:return Math.floor(j/13);case d.BYTE:default:return Math.floor(j/8)}},l.getBestVersionForData=function(D,Z){let G;const Ee=c.from(Z,c.M);if(Array.isArray(D)){if(D.length>1)return _(D,Ee);if(D.length===0)return 1;G=D[0]}else G=D;return b(G.mode,G.getLength(),Ee)},l.getEncodedBits=function(D){if(!f.isValid(D)||D<7)throw new Error("Invalid QR Code version");let Z=D<<12;for(;s.getBCHDigit(Z)-w>=0;)Z^=p<<s.getBCHDigit(Z)-w;return D<<12|Z}})(ri)),ri}var oi={},Gs;function ml(){if(Gs)return oi;Gs=1;const l=pn(),s=1335,o=21522,c=l.getBCHDigit(s);return oi.getEncodedBits=function(f,p){const w=f.bit<<3|p;let b=w<<10;for(;l.getBCHDigit(b)-c>=0;)b^=s<<l.getBCHDigit(b)-c;return(w<<10|b)^o},oi}var ai={},ci,js;function wl(){if(js)return ci;js=1;const l=xn();function s(o){this.mode=l.NUMERIC,this.data=o.toString()}return s.getBitsLength=function(c){return 10*Math.floor(c/3)+(c%3?c%3*3+1:0)},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(c){let d,f,p;for(d=0;d+3<=this.data.length;d+=3)f=this.data.substr(d,3),p=parseInt(f,10),c.put(p,10);const w=this.data.length-d;w>0&&(f=this.data.substr(d),p=parseInt(f,10),c.put(p,w*3+1))},ci=s,ci}var li,Ws;function Cl(){if(Ws)return li;Ws=1;const l=xn(),s=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function o(c){this.mode=l.ALPHANUMERIC,this.data=c}return o.getBitsLength=function(d){return 11*Math.floor(d/2)+6*(d%2)},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(d){let f;for(f=0;f+2<=this.data.length;f+=2){let p=s.indexOf(this.data[f])*45;p+=s.indexOf(this.data[f+1]),d.put(p,11)}this.data.length%2&&d.put(s.indexOf(this.data[f]),6)},li=o,li}var ui,Xs;function yl(){if(Xs)return ui;Xs=1;const l=xn();function s(o){this.mode=l.BYTE,typeof o=="string"?this.data=new TextEncoder().encode(o):this.data=new Uint8Array(o)}return s.getBitsLength=function(c){return c*8},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(o){for(let c=0,d=this.data.length;c<d;c++)o.put(this.data[c],8)},ui=s,ui}var di,zs;function bl(){if(zs)return di;zs=1;const l=xn(),s=pn();function o(c){this.mode=l.KANJI,this.data=c}return o.getBitsLength=function(d){return d*13},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(c){let d;for(d=0;d<this.data.length;d++){let f=s.toSJIS(this.data[d]);if(f>=33088&&f<=40956)f-=33088;else if(f>=57408&&f<=60351)f-=49472;else throw new Error("Invalid SJIS character: "+this.data[d]+`
Make sure your charset is UTF-8`);f=(f>>>8&255)*192+(f&255),c.put(f,13)}},di=o,di}var hi={exports:{}},Ys;function El(){return Ys||(Ys=1,(function(l){var s={single_source_shortest_paths:function(o,c,d){var f={},p={};p[c]=0;var w=s.PriorityQueue.make();w.push(c,0);for(var b,m,A,_,O,D,Z,G,Ee;!w.empty();){b=w.pop(),m=b.value,_=b.cost,O=o[m]||{};for(A in O)O.hasOwnProperty(A)&&(D=O[A],Z=_+D,G=p[A],Ee=typeof p[A]>"u",(Ee||G>Z)&&(p[A]=Z,w.push(A,Z),f[A]=m))}if(typeof d<"u"&&typeof p[d]>"u"){var ae=["Could not find a path from ",c," to ",d,"."].join("");throw new Error(ae)}return f},extract_shortest_path_from_predecessor_list:function(o,c){for(var d=[],f=c;f;)d.push(f),o[f],f=o[f];return d.reverse(),d},find_path:function(o,c,d){var f=s.single_source_shortest_paths(o,c,d);return s.extract_shortest_path_from_predecessor_list(f,d)},PriorityQueue:{make:function(o){var c=s.PriorityQueue,d={},f;o=o||{};for(f in c)c.hasOwnProperty(f)&&(d[f]=c[f]);return d.queue=[],d.sorter=o.sorter||c.default_sorter,d},default_sorter:function(o,c){return o.cost-c.cost},push:function(o,c){var d={value:o,cost:c};this.queue.push(d),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};l.exports=s})(hi)),hi.exports}var qs;function Al(){return qs||(qs=1,(function(l){const s=xn(),o=wl(),c=Cl(),d=yl(),f=bl(),p=va(),w=pn(),b=El();function m(ae){return unescape(encodeURIComponent(ae)).length}function A(ae,te,j){const K=[];let _e;for(;(_e=ae.exec(j))!==null;)K.push({data:_e[0],index:_e.index,mode:te,length:_e[0].length});return K}function _(ae){const te=A(p.NUMERIC,s.NUMERIC,ae),j=A(p.ALPHANUMERIC,s.ALPHANUMERIC,ae);let K,_e;return w.isKanjiModeEnabled()?(K=A(p.BYTE,s.BYTE,ae),_e=A(p.KANJI,s.KANJI,ae)):(K=A(p.BYTE_KANJI,s.BYTE,ae),_e=[]),te.concat(j,K,_e).sort(function(L,Y){return L.index-Y.index}).map(function(L){return{data:L.data,mode:L.mode,length:L.length}})}function O(ae,te){switch(te){case s.NUMERIC:return o.getBitsLength(ae);case s.ALPHANUMERIC:return c.getBitsLength(ae);case s.KANJI:return f.getBitsLength(ae);case s.BYTE:return d.getBitsLength(ae)}}function D(ae){return ae.reduce(function(te,j){const K=te.length-1>=0?te[te.length-1]:null;return K&&K.mode===j.mode?(te[te.length-1].data+=j.data,te):(te.push(j),te)},[])}function Z(ae){const te=[];for(let j=0;j<ae.length;j++){const K=ae[j];switch(K.mode){case s.NUMERIC:te.push([K,{data:K.data,mode:s.ALPHANUMERIC,length:K.length},{data:K.data,mode:s.BYTE,length:K.length}]);break;case s.ALPHANUMERIC:te.push([K,{data:K.data,mode:s.BYTE,length:K.length}]);break;case s.KANJI:te.push([K,{data:K.data,mode:s.BYTE,length:m(K.data)}]);break;case s.BYTE:te.push([{data:K.data,mode:s.BYTE,length:m(K.data)}])}}return te}function G(ae,te){const j={},K={start:{}};let _e=["start"];for(let X=0;X<ae.length;X++){const L=ae[X],Y=[];for(let k=0;k<L.length;k++){const ce=L[k],$=""+X+k;Y.push($),j[$]={node:ce,lastCount:0},K[$]={};for(let V=0;V<_e.length;V++){const q=_e[V];j[q]&&j[q].node.mode===ce.mode?(K[q][$]=O(j[q].lastCount+ce.length,ce.mode)-O(j[q].lastCount,ce.mode),j[q].lastCount+=ce.length):(j[q]&&(j[q].lastCount=ce.length),K[q][$]=O(ce.length,ce.mode)+4+s.getCharCountIndicator(ce.mode,te))}}_e=Y}for(let X=0;X<_e.length;X++)K[_e[X]].end=0;return{map:K,table:j}}function Ee(ae,te){let j;const K=s.getBestModeForData(ae);if(j=s.from(te,K),j!==s.BYTE&&j.bit<K.bit)throw new Error('"'+ae+'" cannot be encoded with mode '+s.toString(j)+`.
 Suggested mode is: `+s.toString(K));switch(j===s.KANJI&&!w.isKanjiModeEnabled()&&(j=s.BYTE),j){case s.NUMERIC:return new o(ae);case s.ALPHANUMERIC:return new c(ae);case s.KANJI:return new f(ae);case s.BYTE:return new d(ae)}}l.fromArray=function(te){return te.reduce(function(j,K){return typeof K=="string"?j.push(Ee(K,null)):K.data&&j.push(Ee(K.data,K.mode)),j},[])},l.fromString=function(te,j){const K=_(te,w.isKanjiModeEnabled()),_e=Z(K),X=G(_e,j),L=b.find_path(X.map,"start","end"),Y=[];for(let k=1;k<L.length-1;k++)Y.push(X.table[L[k]].node);return l.fromArray(D(Y))},l.rawSplit=function(te){return l.fromArray(_(te,w.isKanjiModeEnabled()))}})(ai)),ai}var Zs;function Il(){if(Zs)return qr;Zs=1;const l=pn(),s=Wi(),o=cl(),c=ll(),d=ul(),f=dl(),p=hl(),w=_a(),b=pl(),m=xl(),A=ml(),_=xn(),O=Al();function D(X,L){const Y=X.size,k=f.getPositions(L);for(let ce=0;ce<k.length;ce++){const $=k[ce][0],V=k[ce][1];for(let q=-1;q<=7;q++)if(!($+q<=-1||Y<=$+q))for(let re=-1;re<=7;re++)V+re<=-1||Y<=V+re||(q>=0&&q<=6&&(re===0||re===6)||re>=0&&re<=6&&(q===0||q===6)||q>=2&&q<=4&&re>=2&&re<=4?X.set($+q,V+re,!0,!0):X.set($+q,V+re,!1,!0))}}function Z(X){const L=X.size;for(let Y=8;Y<L-8;Y++){const k=Y%2===0;X.set(Y,6,k,!0),X.set(6,Y,k,!0)}}function G(X,L){const Y=d.getPositions(L);for(let k=0;k<Y.length;k++){const ce=Y[k][0],$=Y[k][1];for(let V=-2;V<=2;V++)for(let q=-2;q<=2;q++)V===-2||V===2||q===-2||q===2||V===0&&q===0?X.set(ce+V,$+q,!0,!0):X.set(ce+V,$+q,!1,!0)}}function Ee(X,L){const Y=X.size,k=m.getEncodedBits(L);let ce,$,V;for(let q=0;q<18;q++)ce=Math.floor(q/3),$=q%3+Y-8-3,V=(k>>q&1)===1,X.set(ce,$,V,!0),X.set($,ce,V,!0)}function ae(X,L,Y){const k=X.size,ce=A.getEncodedBits(L,Y);let $,V;for($=0;$<15;$++)V=(ce>>$&1)===1,$<6?X.set($,8,V,!0):$<8?X.set($+1,8,V,!0):X.set(k-15+$,8,V,!0),$<8?X.set(8,k-$-1,V,!0):$<9?X.set(8,15-$-1+1,V,!0):X.set(8,15-$-1,V,!0);X.set(k-8,8,1,!0)}function te(X,L){const Y=X.size;let k=-1,ce=Y-1,$=7,V=0;for(let q=Y-1;q>0;q-=2)for(q===6&&q--;;){for(let re=0;re<2;re++)if(!X.isReserved(ce,q-re)){let P=!1;V<L.length&&(P=(L[V]>>>$&1)===1),X.set(ce,q-re,P),$--,$===-1&&(V++,$=7)}if(ce+=k,ce<0||Y<=ce){ce-=k,k=-k;break}}}function j(X,L,Y){const k=new o;Y.forEach(function(re){k.put(re.mode.bit,4),k.put(re.getLength(),_.getCharCountIndicator(re.mode,X)),re.write(k)});const ce=l.getSymbolTotalCodewords(X),$=w.getTotalCodewordsCount(X,L),V=(ce-$)*8;for(k.getLengthInBits()+4<=V&&k.put(0,4);k.getLengthInBits()%8!==0;)k.putBit(0);const q=(V-k.getLengthInBits())/8;for(let re=0;re<q;re++)k.put(re%2?17:236,8);return K(k,X,L)}function K(X,L,Y){const k=l.getSymbolTotalCodewords(L),ce=w.getTotalCodewordsCount(L,Y),$=k-ce,V=w.getBlocksCount(L,Y),q=k%V,re=V-q,P=Math.floor(k/V),ke=Math.floor($/V),de=ke+1,jt=P-ke,Rt=new b(jt);let Ct=0;const tn=new Array(V),qe=new Array(V);let St=0;const Qe=new Uint8Array(X.buffer);for(let yt=0;yt<V;yt++){const Ut=yt<re?ke:de;tn[yt]=Qe.slice(Ct,Ct+Ut),qe[yt]=Rt.encode(tn[yt]),Ct+=Ut,St=Math.max(St,Ut)}const nn=new Uint8Array(k);let se=0,xt,Ie;for(xt=0;xt<St;xt++)for(Ie=0;Ie<V;Ie++)xt<tn[Ie].length&&(nn[se++]=tn[Ie][xt]);for(xt=0;xt<jt;xt++)for(Ie=0;Ie<V;Ie++)nn[se++]=qe[Ie][xt];return nn}function _e(X,L,Y,k){let ce;if(Array.isArray(X))ce=O.fromArray(X);else if(typeof X=="string"){let P=L;if(!P){const ke=O.rawSplit(X);P=m.getBestVersionForData(ke,Y)}ce=O.fromString(X,P||40)}else throw new Error("Invalid data");const $=m.getBestVersionForData(ce,Y);if(!$)throw new Error("The amount of data is too big to be stored in a QR Code");if(!L)L=$;else if(L<$)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+$+`.
`);const V=j(L,Y,ce),q=l.getSymbolSize(L),re=new c(q);return D(re,L),Z(re),G(re,L),ae(re,Y,0),L>=7&&Ee(re,L),te(re,V),isNaN(k)&&(k=p.getBestMask(re,ae.bind(null,re,Y))),p.applyMask(k,re),ae(re,Y,k),{modules:re,version:L,errorCorrectionLevel:Y,maskPattern:k,segments:ce}}return qr.create=function(L,Y){if(typeof L>"u"||L==="")throw new Error("No input text");let k=s.M,ce,$;return typeof Y<"u"&&(k=s.from(Y.errorCorrectionLevel,s.M),ce=m.from(Y.version),$=p.from(Y.maskPattern),Y.toSJISFunc&&l.setToSJISFunction(Y.toSJISFunc)),_e(L,ce,k,$)},qr}var fi={},gi={},Ks;function Ra(){return Ks||(Ks=1,(function(l){function s(o){if(typeof o=="number"&&(o=o.toString()),typeof o!="string")throw new Error("Color should be defined as hex string");let c=o.slice().replace("#","").split("");if(c.length<3||c.length===5||c.length>8)throw new Error("Invalid hex color: "+o);(c.length===3||c.length===4)&&(c=Array.prototype.concat.apply([],c.map(function(f){return[f,f]}))),c.length===6&&c.push("F","F");const d=parseInt(c.join(""),16);return{r:d>>24&255,g:d>>16&255,b:d>>8&255,a:d&255,hex:"#"+c.slice(0,6).join("")}}l.getOptions=function(c){c||(c={}),c.color||(c.color={});const d=typeof c.margin>"u"||c.margin===null||c.margin<0?4:c.margin,f=c.width&&c.width>=21?c.width:void 0,p=c.scale||4;return{width:f,scale:f?4:p,margin:d,color:{dark:s(c.color.dark||"#000000ff"),light:s(c.color.light||"#ffffffff")},type:c.type,rendererOpts:c.rendererOpts||{}}},l.getScale=function(c,d){return d.width&&d.width>=c+d.margin*2?d.width/(c+d.margin*2):d.scale},l.getImageWidth=function(c,d){const f=l.getScale(c,d);return Math.floor((c+d.margin*2)*f)},l.qrToImageData=function(c,d,f){const p=d.modules.size,w=d.modules.data,b=l.getScale(p,f),m=Math.floor((p+f.margin*2)*b),A=f.margin*b,_=[f.color.light,f.color.dark];for(let O=0;O<m;O++)for(let D=0;D<m;D++){let Z=(O*m+D)*4,G=f.color.light;if(O>=A&&D>=A&&O<m-A&&D<m-A){const Ee=Math.floor((O-A)/b),ae=Math.floor((D-A)/b);G=_[w[Ee*p+ae]?1:0]}c[Z++]=G.r,c[Z++]=G.g,c[Z++]=G.b,c[Z]=G.a}}})(gi)),gi}var Qs;function Sl(){return Qs||(Qs=1,(function(l){const s=Ra();function o(d,f,p){d.clearRect(0,0,f.width,f.height),f.style||(f.style={}),f.height=p,f.width=p,f.style.height=p+"px",f.style.width=p+"px"}function c(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}l.render=function(f,p,w){let b=w,m=p;typeof b>"u"&&(!p||!p.getContext)&&(b=p,p=void 0),p||(m=c()),b=s.getOptions(b);const A=s.getImageWidth(f.modules.size,b),_=m.getContext("2d"),O=_.createImageData(A,A);return s.qrToImageData(O.data,f,b),o(_,m,A),_.putImageData(O,0,0),m},l.renderToDataURL=function(f,p,w){let b=w;typeof b>"u"&&(!p||!p.getContext)&&(b=p,p=void 0),b||(b={});const m=l.render(f,p,b),A=b.type||"image/png",_=b.rendererOpts||{};return m.toDataURL(A,_.quality)}})(fi)),fi}var pi={},Js;function _l(){if(Js)return pi;Js=1;const l=Ra();function s(d,f){const p=d.a/255,w=f+'="'+d.hex+'"';return p<1?w+" "+f+'-opacity="'+p.toFixed(2).slice(1)+'"':w}function o(d,f,p){let w=d+f;return typeof p<"u"&&(w+=" "+p),w}function c(d,f,p){let w="",b=0,m=!1,A=0;for(let _=0;_<d.length;_++){const O=Math.floor(_%f),D=Math.floor(_/f);!O&&!m&&(m=!0),d[_]?(A++,_>0&&O>0&&d[_-1]||(w+=m?o("M",O+p,.5+D+p):o("m",b,0),b=0,m=!1),O+1<f&&d[_+1]||(w+=o("h",A),A=0)):b++}return w}return pi.render=function(f,p,w){const b=l.getOptions(p),m=f.modules.size,A=f.modules.data,_=m+b.margin*2,O=b.color.light.a?"<path "+s(b.color.light,"fill")+' d="M0 0h'+_+"v"+_+'H0z"/>':"",D="<path "+s(b.color.dark,"stroke")+' d="'+c(A,m,b.margin)+'"/>',Z='viewBox="0 0 '+_+" "+_+'"',Ee='<svg xmlns="http://www.w3.org/2000/svg" '+(b.width?'width="'+b.width+'" height="'+b.width+'" ':"")+Z+' shape-rendering="crispEdges">'+O+D+`</svg>
`;return typeof w=="function"&&w(null,Ee),Ee},pi}var $s;function Tl(){if($s)return Tn;$s=1;const l=al(),s=Il(),o=Sl(),c=_l();function d(f,p,w,b,m){const A=[].slice.call(arguments,1),_=A.length,O=typeof A[_-1]=="function";if(!O&&!l())throw new Error("Callback required as last argument");if(O){if(_<2)throw new Error("Too few arguments provided");_===2?(m=w,w=p,p=b=void 0):_===3&&(p.getContext&&typeof m>"u"?(m=b,b=void 0):(m=b,b=w,w=p,p=void 0))}else{if(_<1)throw new Error("Too few arguments provided");return _===1?(w=p,p=b=void 0):_===2&&!p.getContext&&(b=w,w=p,p=void 0),new Promise(function(D,Z){try{const G=s.create(w,b);D(f(G,p,b))}catch(G){Z(G)}})}try{const D=s.create(w,b);m(null,f(D,p,b))}catch(D){m(D)}}return Tn.create=s.create,Tn.toCanvas=d.bind(null,o.render),Tn.toDataURL=d.bind(null,o.renderToDataURL),Tn.toString=d.bind(null,function(f,p,w){return c.render(f,w)}),Tn}var vl=Tl();const Rl=Ui(vl);var J;(function(l){l[l.QR_CODE=0]="QR_CODE",l[l.AZTEC=1]="AZTEC",l[l.CODABAR=2]="CODABAR",l[l.CODE_39=3]="CODE_39",l[l.CODE_93=4]="CODE_93",l[l.CODE_128=5]="CODE_128",l[l.DATA_MATRIX=6]="DATA_MATRIX",l[l.MAXICODE=7]="MAXICODE",l[l.ITF=8]="ITF",l[l.EAN_13=9]="EAN_13",l[l.EAN_8=10]="EAN_8",l[l.PDF_417=11]="PDF_417",l[l.RSS_14=12]="RSS_14",l[l.RSS_EXPANDED=13]="RSS_EXPANDED",l[l.UPC_A=14]="UPC_A",l[l.UPC_E=15]="UPC_E",l[l.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(J||(J={}));var eo=new Map([[J.QR_CODE,"QR_CODE"],[J.AZTEC,"AZTEC"],[J.CODABAR,"CODABAR"],[J.CODE_39,"CODE_39"],[J.CODE_93,"CODE_93"],[J.CODE_128,"CODE_128"],[J.DATA_MATRIX,"DATA_MATRIX"],[J.MAXICODE,"MAXICODE"],[J.ITF,"ITF"],[J.EAN_13,"EAN_13"],[J.EAN_8,"EAN_8"],[J.PDF_417,"PDF_417"],[J.RSS_14,"RSS_14"],[J.RSS_EXPANDED,"RSS_EXPANDED"],[J.UPC_A,"UPC_A"],[J.UPC_E,"UPC_E"],[J.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),to;(function(l){l[l.UNKNOWN=0]="UNKNOWN",l[l.URL=1]="URL"})(to||(to={}));function Nl(l){return Object.values(J).includes(l)}var mr;(function(l){l[l.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",l[l.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(mr||(mr={}));var Ol=(function(){function l(){}return l.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",l.SCAN_DEFAULT_FPS=2,l.DEFAULT_DISABLE_FLIP=!1,l.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,l.DEFAULT_SUPPORTED_SCAN_TYPE=[mr.SCAN_TYPE_CAMERA,mr.SCAN_TYPE_FILE],l})(),Na=(function(){function l(s,o){this.format=s,this.formatName=o}return l.prototype.toString=function(){return this.formatName},l.create=function(s){if(!eo.has(s))throw"".concat(s," not in html5QrcodeSupportedFormatsTextMap");return new l(s,eo.get(s))},l})(),no=(function(){function l(){}return l.createFromText=function(s){var o={text:s};return{decodedText:s,result:o}},l.createFromQrcodeResult=function(s){return{decodedText:s.text,result:s}},l})(),Di;(function(l){l[l.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",l[l.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",l[l.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(Di||(Di={}));var Dl=(function(){function l(){}return l.createFrom=function(s){return{errorMessage:s,type:Di.UNKWOWN_ERROR}},l})(),Ml=(function(){function l(s){this.verbose=s}return l.prototype.log=function(s){this.verbose&&console.log(s)},l.prototype.warn=function(s){this.verbose&&console.warn(s)},l.prototype.logError=function(s,o){(this.verbose||o===!0)&&console.error(s)},l.prototype.logErrors=function(s){if(s.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(s)},l})();function Ht(l){return typeof l>"u"||l===null}var vn=(function(){function l(){}return l.codeParseError=function(s){return"QR code parse error, error = ".concat(s)},l.errorGettingUserMedia=function(s){return"Error getting userMedia, error = ".concat(s)},l.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},l.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},l.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},l.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},l.scannerPaused=function(){return"Scanner paused"},l})(),Oa=(function(){function l(){}return l.isMediaStreamConstraintsValid=function(s,o){if(typeof s!="object"){var c=typeof s;return o.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(c,"."),!0),!1}for(var d=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],f=new Set(d),p=Object.keys(s),w=0,b=p;w<b.length;w++){var m=b[w];if(f.has(m))return o.logError("".concat(m," is not supported videoConstaints."),!0),!1}return!0},l})(),Wn={exports:{}},kl=Wn.exports,ro;function Bl(){return ro||(ro=1,(function(l,s){(function(o,c){c(s)})(kl,(function(o){function c(C){return C==null}var d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,e){C.__proto__=e}||function(C,e){for(var t in e)e.hasOwnProperty(t)&&(C[t]=e[t])};function f(C,e){d(C,e);function t(){this.constructor=C}C.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function p(C,e){var t=Object.setPrototypeOf;t?t(C,e):C.__proto__=e}function w(C,e){e===void 0&&(e=C.constructor);var t=Error.captureStackTrace;t&&t(C,e)}var b=(function(C){f(e,C);function e(t){var n=this.constructor,r=C.call(this,t)||this;return Object.defineProperty(r,"name",{value:n.name,enumerable:!1}),p(r,n.prototype),w(r),r}return e})(Error);class m extends b{constructor(e=void 0){super(e),this.message=e}getKind(){return this.constructor.kind}}m.kind="Exception";class A extends m{}A.kind="ArgumentException";class _ extends m{}_.kind="IllegalArgumentException";class O{constructor(e){if(this.binarizer=e,e===null)throw new _("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(e,t){return this.binarizer.getBlackRow(e,t)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(e,t,n,r){const i=this.binarizer.getLuminanceSource().crop(e,t,n,r);return new O(this.binarizer.createBinarizer(i))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const e=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new O(this.binarizer.createBinarizer(e))}rotateCounterClockwise45(){const e=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new O(this.binarizer.createBinarizer(e))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class D extends m{static getChecksumInstance(){return new D}}D.kind="ChecksumException";class Z{constructor(e){this.source=e}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class G{static arraycopy(e,t,n,r,i){for(;i--;)n[r++]=e[t++]}static currentTimeMillis(){return Date.now()}}class Ee extends m{}Ee.kind="IndexOutOfBoundsException";class ae extends Ee{constructor(e=void 0,t=void 0){super(t),this.index=e,this.message=t}}ae.kind="ArrayIndexOutOfBoundsException";class te{static fill(e,t){for(let n=0,r=e.length;n<r;n++)e[n]=t}static fillWithin(e,t,n,r){te.rangeCheck(e.length,t,n);for(let i=t;i<n;i++)e[i]=r}static rangeCheck(e,t,n){if(t>n)throw new _("fromIndex("+t+") > toIndex("+n+")");if(t<0)throw new ae(t);if(n>e)throw new ae(n)}static asList(...e){return e}static create(e,t,n){return Array.from({length:e}).map(i=>Array.from({length:t}).fill(n))}static createInt32Array(e,t,n){return Array.from({length:e}).map(i=>Int32Array.from({length:t}).fill(n))}static equals(e,t){if(!e||!t||!e.length||!t.length||e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}static hashCode(e){if(e===null)return 0;let t=1;for(const n of e)t=31*t+n;return t}static fillUint8Array(e,t){for(let n=0;n!==e.length;n++)e[n]=t}static copyOf(e,t){return e.slice(0,t)}static copyOfUint8Array(e,t){if(e.length<=t){const n=new Uint8Array(t);return n.set(e),n}return e.slice(0,t)}static copyOfRange(e,t,n){const r=n-t,i=new Int32Array(r);return G.arraycopy(e,t,i,0,r),i}static binarySearch(e,t,n){n===void 0&&(n=te.numberComparator);let r=0,i=e.length-1;for(;r<=i;){const a=i+r>>1,u=n(t,e[a]);if(u>0)r=a+1;else if(u<0)i=a-1;else return a}return-r-1}static numberComparator(e,t){return e-t}}class j{static numberOfTrailingZeros(e){let t;if(e===0)return 32;let n=31;return t=e<<16,t!==0&&(n-=16,e=t),t=e<<8,t!==0&&(n-=8,e=t),t=e<<4,t!==0&&(n-=4,e=t),t=e<<2,t!==0&&(n-=2,e=t),n-(e<<1>>>31)}static numberOfLeadingZeros(e){if(e===0)return 32;let t=1;return e>>>16||(t+=16,e<<=16),e>>>24||(t+=8,e<<=8),e>>>28||(t+=4,e<<=4),e>>>30||(t+=2,e<<=2),t-=e>>>31,t}static toHexString(e){return e.toString(16)}static toBinaryString(e){return String(parseInt(String(e),2))}static bitCount(e){return e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),e=e+(e>>>4)&252645135,e=e+(e>>>8),e=e+(e>>>16),e&63}static truncDivision(e,t){return Math.trunc(e/t)}static parseInt(e,t=void 0){return parseInt(e,t)}}j.MIN_VALUE_32_BITS=-2147483648,j.MAX_VALUE=Number.MAX_SAFE_INTEGER;class K{constructor(e,t){e===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=e,t==null?this.bits=K.makeArray(e):this.bits=t)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(e){if(e>this.bits.length*32){const t=K.makeArray(e);G.arraycopy(this.bits,0,t,0,this.bits.length),this.bits=t}}get(e){return(this.bits[Math.floor(e/32)]&1<<(e&31))!==0}set(e){this.bits[Math.floor(e/32)]|=1<<(e&31)}flip(e){this.bits[Math.floor(e/32)]^=1<<(e&31)}getNextSet(e){const t=this.size;if(e>=t)return t;const n=this.bits;let r=Math.floor(e/32),i=n[r];i&=~((1<<(e&31))-1);const a=n.length;for(;i===0;){if(++r===a)return t;i=n[r]}const u=r*32+j.numberOfTrailingZeros(i);return u>t?t:u}getNextUnset(e){const t=this.size;if(e>=t)return t;const n=this.bits;let r=Math.floor(e/32),i=~n[r];i&=~((1<<(e&31))-1);const a=n.length;for(;i===0;){if(++r===a)return t;i=~n[r]}const u=r*32+j.numberOfTrailingZeros(i);return u>t?t:u}setBulk(e,t){this.bits[Math.floor(e/32)]=t}setRange(e,t){if(t<e||e<0||t>this.size)throw new _;if(t===e)return;t--;const n=Math.floor(e/32),r=Math.floor(t/32),i=this.bits;for(let a=n;a<=r;a++){const u=a>n?0:e&31,g=(2<<(a<r?31:t&31))-(1<<u);i[a]|=g}}clear(){const e=this.bits.length,t=this.bits;for(let n=0;n<e;n++)t[n]=0}isRange(e,t,n){if(t<e||e<0||t>this.size)throw new _;if(t===e)return!0;t--;const r=Math.floor(e/32),i=Math.floor(t/32),a=this.bits;for(let u=r;u<=i;u++){const h=u>r?0:e&31,x=(2<<(u<i?31:t&31))-(1<<h)&4294967295;if((a[u]&x)!==(n?x:0))return!1}return!0}appendBit(e){this.ensureCapacity(this.size+1),e&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(e,t){if(t<0||t>32)throw new _("Num bits must be between 0 and 32");this.ensureCapacity(this.size+t);for(let n=t;n>0;n--)this.appendBit((e>>n-1&1)===1)}appendBitArray(e){const t=e.size;this.ensureCapacity(this.size+t);for(let n=0;n<t;n++)this.appendBit(e.get(n))}xor(e){if(this.size!==e.size)throw new _("Sizes don't match");const t=this.bits;for(let n=0,r=t.length;n<r;n++)t[n]^=e.bits[n]}toBytes(e,t,n,r){for(let i=0;i<r;i++){let a=0;for(let u=0;u<8;u++)this.get(e)&&(a|=1<<7-u),e++;t[n+i]=a}}getBitArray(){return this.bits}reverse(){const e=new Int32Array(this.bits.length),t=Math.floor((this.size-1)/32),n=t+1,r=this.bits;for(let i=0;i<n;i++){let a=r[i];a=a>>1&1431655765|(a&1431655765)<<1,a=a>>2&858993459|(a&858993459)<<2,a=a>>4&252645135|(a&252645135)<<4,a=a>>8&16711935|(a&16711935)<<8,a=a>>16&65535|(a&65535)<<16,e[t-i]=a}if(this.size!==n*32){const i=n*32-this.size;let a=e[0]>>>i;for(let u=1;u<n;u++){const h=e[u];a|=h<<32-i,e[u-1]=a,a=h>>>i}e[n-1]=a}this.bits=e}static makeArray(e){return new Int32Array(Math.floor((e+31)/32))}equals(e){if(!(e instanceof K))return!1;const t=e;return this.size===t.size&&te.equals(this.bits,t.bits)}hashCode(){return 31*this.size+te.hashCode(this.bits)}toString(){let e="";for(let t=0,n=this.size;t<n;t++)(t&7)===0&&(e+=" "),e+=this.get(t)?"X":".";return e}clone(){return new K(this.size,this.bits.slice())}}var _e;(function(C){C[C.OTHER=0]="OTHER",C[C.PURE_BARCODE=1]="PURE_BARCODE",C[C.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",C[C.TRY_HARDER=3]="TRY_HARDER",C[C.CHARACTER_SET=4]="CHARACTER_SET",C[C.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",C[C.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",C[C.ASSUME_GS1=7]="ASSUME_GS1",C[C.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",C[C.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",C[C.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(_e||(_e={}));var X=_e;class L extends m{static getFormatInstance(){return new L}}L.kind="FormatException";var Y;(function(C){C[C.Cp437=0]="Cp437",C[C.ISO8859_1=1]="ISO8859_1",C[C.ISO8859_2=2]="ISO8859_2",C[C.ISO8859_3=3]="ISO8859_3",C[C.ISO8859_4=4]="ISO8859_4",C[C.ISO8859_5=5]="ISO8859_5",C[C.ISO8859_6=6]="ISO8859_6",C[C.ISO8859_7=7]="ISO8859_7",C[C.ISO8859_8=8]="ISO8859_8",C[C.ISO8859_9=9]="ISO8859_9",C[C.ISO8859_10=10]="ISO8859_10",C[C.ISO8859_11=11]="ISO8859_11",C[C.ISO8859_13=12]="ISO8859_13",C[C.ISO8859_14=13]="ISO8859_14",C[C.ISO8859_15=14]="ISO8859_15",C[C.ISO8859_16=15]="ISO8859_16",C[C.SJIS=16]="SJIS",C[C.Cp1250=17]="Cp1250",C[C.Cp1251=18]="Cp1251",C[C.Cp1252=19]="Cp1252",C[C.Cp1256=20]="Cp1256",C[C.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",C[C.UTF8=22]="UTF8",C[C.ASCII=23]="ASCII",C[C.Big5=24]="Big5",C[C.GB18030=25]="GB18030",C[C.EUC_KR=26]="EUC_KR"})(Y||(Y={}));class k{constructor(e,t,n,...r){this.valueIdentifier=e,this.name=n,typeof t=="number"?this.values=Int32Array.from([t]):this.values=t,this.otherEncodingNames=r,k.VALUE_IDENTIFIER_TO_ECI.set(e,this),k.NAME_TO_ECI.set(n,this);const i=this.values;for(let a=0,u=i.length;a!==u;a++){const h=i[a];k.VALUES_TO_ECI.set(h,this)}for(const a of r)k.NAME_TO_ECI.set(a,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(e){if(e<0||e>=900)throw new L("incorect value");const t=k.VALUES_TO_ECI.get(e);if(t===void 0)throw new L("incorect value");return t}static getCharacterSetECIByName(e){const t=k.NAME_TO_ECI.get(e);if(t===void 0)throw new L("incorect value");return t}equals(e){if(!(e instanceof k))return!1;const t=e;return this.getName()===t.getName()}}k.VALUE_IDENTIFIER_TO_ECI=new Map,k.VALUES_TO_ECI=new Map,k.NAME_TO_ECI=new Map,k.Cp437=new k(Y.Cp437,Int32Array.from([0,2]),"Cp437"),k.ISO8859_1=new k(Y.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),k.ISO8859_2=new k(Y.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),k.ISO8859_3=new k(Y.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),k.ISO8859_4=new k(Y.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),k.ISO8859_5=new k(Y.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),k.ISO8859_6=new k(Y.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),k.ISO8859_7=new k(Y.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),k.ISO8859_8=new k(Y.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),k.ISO8859_9=new k(Y.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),k.ISO8859_10=new k(Y.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),k.ISO8859_11=new k(Y.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),k.ISO8859_13=new k(Y.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),k.ISO8859_14=new k(Y.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),k.ISO8859_15=new k(Y.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),k.ISO8859_16=new k(Y.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),k.SJIS=new k(Y.SJIS,20,"SJIS","Shift_JIS"),k.Cp1250=new k(Y.Cp1250,21,"Cp1250","windows-1250"),k.Cp1251=new k(Y.Cp1251,22,"Cp1251","windows-1251"),k.Cp1252=new k(Y.Cp1252,23,"Cp1252","windows-1252"),k.Cp1256=new k(Y.Cp1256,24,"Cp1256","windows-1256"),k.UnicodeBigUnmarked=new k(Y.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),k.UTF8=new k(Y.UTF8,26,"UTF8","UTF-8"),k.ASCII=new k(Y.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),k.Big5=new k(Y.Big5,28,"Big5"),k.GB18030=new k(Y.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),k.EUC_KR=new k(Y.EUC_KR,30,"EUC_KR","EUC-KR");class ce extends m{}ce.kind="UnsupportedOperationException";class ${static decode(e,t){const n=this.encodingName(t);return this.customDecoder?this.customDecoder(e,n):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(n)?this.decodeFallback(e,n):new TextDecoder(n).decode(e)}static shouldDecodeOnFallback(e){return!$.isBrowser()&&e==="ISO-8859-1"}static encode(e,t){const n=this.encodingName(t);return this.customEncoder?this.customEncoder(e,n):typeof TextEncoder>"u"?this.encodeFallback(e):new TextEncoder().encode(e)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(e){return typeof e=="string"?e:e.getName()}static encodingCharacterSet(e){return e instanceof k?e:k.getCharacterSetECIByName(e)}static decodeFallback(e,t){const n=this.encodingCharacterSet(t);if($.isDecodeFallbackSupported(n)){let r="";for(let i=0,a=e.length;i<a;i++){let u=e[i].toString(16);u.length<2&&(u="0"+u),r+="%"+u}return decodeURIComponent(r)}if(n.equals(k.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(e.buffer));throw new ce(`Encoding ${this.encodingName(t)} not supported by fallback.`)}static isDecodeFallbackSupported(e){return e.equals(k.UTF8)||e.equals(k.ISO8859_1)||e.equals(k.ASCII)}static encodeFallback(e){const n=btoa(unescape(encodeURIComponent(e))).split(""),r=[];for(let i=0;i<n.length;i++)r.push(n[i].charCodeAt(0));return new Uint8Array(r)}}class V{static castAsNonUtf8Char(e,t=null){const n=t?t.getName():this.ISO88591;return $.decode(new Uint8Array([e]),n)}static guessEncoding(e,t){if(t!=null&&t.get(X.CHARACTER_SET)!==void 0)return t.get(X.CHARACTER_SET).toString();const n=e.length;let r=!0,i=!0,a=!0,u=0,h=0,g=0,x=0,y=0,E=0,S=0,T=0,v=0,R=0,B=0;const H=e.length>3&&e[0]===239&&e[1]===187&&e[2]===191;for(let W=0;W<n&&(r||i||a);W++){const U=e[W]&255;a&&(u>0?(U&128)===0?a=!1:u--:(U&128)!==0&&((U&64)===0?a=!1:(u++,(U&32)===0?h++:(u++,(U&16)===0?g++:(u++,(U&8)===0?x++:a=!1))))),r&&(U>127&&U<160?r=!1:U>159&&(U<192||U===215||U===247)&&B++),i&&(y>0?U<64||U===127||U>252?i=!1:y--:U===128||U===160||U>239?i=!1:U>160&&U<224?(E++,T=0,S++,S>v&&(v=S)):U>127?(y++,S=0,T++,T>R&&(R=T)):(S=0,T=0))}return a&&u>0&&(a=!1),i&&y>0&&(i=!1),a&&(H||h+g+x>0)?V.UTF8:i&&(V.ASSUME_SHIFT_JIS||v>=3||R>=3)?V.SHIFT_JIS:r&&i?v===2&&E===2||B*10>=n?V.SHIFT_JIS:V.ISO88591:r?V.ISO88591:i?V.SHIFT_JIS:a?V.UTF8:V.PLATFORM_DEFAULT_ENCODING}static format(e,...t){let n=-1;function r(a,u,h,g,x,y){if(a==="%%")return"%";if(t[++n]===void 0)return;a=g?parseInt(g.substr(1)):void 0;let E=x?parseInt(x.substr(1)):void 0,S;switch(y){case"s":S=t[n];break;case"c":S=t[n][0];break;case"f":S=parseFloat(t[n]).toFixed(a);break;case"p":S=parseFloat(t[n]).toPrecision(a);break;case"e":S=parseFloat(t[n]).toExponential(a);break;case"x":S=parseInt(t[n]).toString(E||16);break;case"d":S=parseFloat(parseInt(t[n],E||10).toPrecision(a)).toFixed(0);break}S=typeof S=="object"?JSON.stringify(S):(+S).toString(E);let T=parseInt(h),v=h&&h[0]+""=="0"?"0":" ";for(;S.length<T;)S=u!==void 0?S+v:v+S;return S}let i=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return e.replace(i,r)}static getBytes(e,t){return $.encode(e,t)}static getCharCode(e,t=0){return e.charCodeAt(t)}static getCharAt(e){return String.fromCharCode(e)}}V.SHIFT_JIS=k.SJIS.getName(),V.GB2312="GB2312",V.ISO88591=k.ISO8859_1.getName(),V.EUC_JP="EUC_JP",V.UTF8=k.UTF8.getName(),V.PLATFORM_DEFAULT_ENCODING=V.UTF8,V.ASSUME_SHIFT_JIS=!1;class q{constructor(e=""){this.value=e}enableDecoding(e){return this.encoding=e,this}append(e){return typeof e=="string"?this.value+=e.toString():this.encoding?this.value+=V.castAsNonUtf8Char(e,this.encoding):this.value+=String.fromCharCode(e),this}appendChars(e,t,n){for(let r=t;t<t+n;r++)this.append(e[r]);return this}length(){return this.value.length}charAt(e){return this.value.charAt(e)}deleteCharAt(e){this.value=this.value.substr(0,e)+this.value.substring(e+1)}setCharAt(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+1)}substring(e,t){return this.value.substring(e,t)}setLengthToZero(){this.value=""}toString(){return this.value}insert(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+t.length)}}class re{constructor(e,t,n,r){if(this.width=e,this.height=t,this.rowSize=n,this.bits=r,t==null&&(t=e),this.height=t,e<1||t<1)throw new _("Both dimensions must be greater than 0");n==null&&(n=Math.floor((e+31)/32)),this.rowSize=n,r==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(e){const t=e.length,n=e[0].length,r=new re(n,t);for(let i=0;i<t;i++){const a=e[i];for(let u=0;u<n;u++)a[u]&&r.set(u,i)}return r}static parseFromString(e,t,n){if(e===null)throw new _("stringRepresentation cannot be null");const r=new Array(e.length);let i=0,a=0,u=-1,h=0,g=0;for(;g<e.length;)if(e.charAt(g)===`
`||e.charAt(g)==="\r"){if(i>a){if(u===-1)u=i-a;else if(i-a!==u)throw new _("row lengths do not match");a=i,h++}g++}else if(e.substring(g,g+t.length)===t)g+=t.length,r[i]=!0,i++;else if(e.substring(g,g+n.length)===n)g+=n.length,r[i]=!1,i++;else throw new _("illegal character encountered: "+e.substring(g));if(i>a){if(u===-1)u=i-a;else if(i-a!==u)throw new _("row lengths do not match");h++}const x=new re(u,h);for(let y=0;y<i;y++)r[y]&&x.set(Math.floor(y%u),Math.floor(y/u));return x}get(e,t){const n=t*this.rowSize+Math.floor(e/32);return(this.bits[n]>>>(e&31)&1)!==0}set(e,t){const n=t*this.rowSize+Math.floor(e/32);this.bits[n]|=1<<(e&31)&4294967295}unset(e,t){const n=t*this.rowSize+Math.floor(e/32);this.bits[n]&=~(1<<(e&31)&4294967295)}flip(e,t){const n=t*this.rowSize+Math.floor(e/32);this.bits[n]^=1<<(e&31)&4294967295}xor(e){if(this.width!==e.getWidth()||this.height!==e.getHeight()||this.rowSize!==e.getRowSize())throw new _("input matrix dimensions do not match");const t=new K(Math.floor(this.width/32)+1),n=this.rowSize,r=this.bits;for(let i=0,a=this.height;i<a;i++){const u=i*n,h=e.getRow(i,t).getBitArray();for(let g=0;g<n;g++)r[u+g]^=h[g]}}clear(){const e=this.bits,t=e.length;for(let n=0;n<t;n++)e[n]=0}setRegion(e,t,n,r){if(t<0||e<0)throw new _("Left and top must be nonnegative");if(r<1||n<1)throw new _("Height and width must be at least 1");const i=e+n,a=t+r;if(a>this.height||i>this.width)throw new _("The region must fit inside the matrix");const u=this.rowSize,h=this.bits;for(let g=t;g<a;g++){const x=g*u;for(let y=e;y<i;y++)h[x+Math.floor(y/32)]|=1<<(y&31)&4294967295}}getRow(e,t){t==null||t.getSize()<this.width?t=new K(this.width):t.clear();const n=this.rowSize,r=this.bits,i=e*n;for(let a=0;a<n;a++)t.setBulk(a*32,r[i+a]);return t}setRow(e,t){G.arraycopy(t.getBitArray(),0,this.bits,e*this.rowSize,this.rowSize)}rotate180(){const e=this.getWidth(),t=this.getHeight();let n=new K(e),r=new K(e);for(let i=0,a=Math.floor((t+1)/2);i<a;i++)n=this.getRow(i,n),r=this.getRow(t-1-i,r),n.reverse(),r.reverse(),this.setRow(i,r),this.setRow(t-1-i,n)}getEnclosingRectangle(){const e=this.width,t=this.height,n=this.rowSize,r=this.bits;let i=e,a=t,u=-1,h=-1;for(let g=0;g<t;g++)for(let x=0;x<n;x++){const y=r[g*n+x];if(y!==0){if(g<a&&(a=g),g>h&&(h=g),x*32<i){let E=0;for(;(y<<31-E&4294967295)===0;)E++;x*32+E<i&&(i=x*32+E)}if(x*32+31>u){let E=31;for(;!(y>>>E);)E--;x*32+E>u&&(u=x*32+E)}}}return u<i||h<a?null:Int32Array.from([i,a,u-i+1,h-a+1])}getTopLeftOnBit(){const e=this.rowSize,t=this.bits;let n=0;for(;n<t.length&&t[n]===0;)n++;if(n===t.length)return null;const r=n/e;let i=n%e*32;const a=t[n];let u=0;for(;(a<<31-u&4294967295)===0;)u++;return i+=u,Int32Array.from([i,r])}getBottomRightOnBit(){const e=this.rowSize,t=this.bits;let n=t.length-1;for(;n>=0&&t[n]===0;)n--;if(n<0)return null;const r=Math.floor(n/e);let i=Math.floor(n%e)*32;const a=t[n];let u=31;for(;!(a>>>u);)u--;return i+=u,Int32Array.from([i,r])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(e){if(!(e instanceof re))return!1;const t=e;return this.width===t.width&&this.height===t.height&&this.rowSize===t.rowSize&&te.equals(this.bits,t.bits)}hashCode(){let e=this.width;return e=31*e+this.width,e=31*e+this.height,e=31*e+this.rowSize,e=31*e+te.hashCode(this.bits),e}toString(e="X ",t="  ",n=`
`){return this.buildToString(e,t,n)}buildToString(e,t,n){let r=new q;for(let i=0,a=this.height;i<a;i++){for(let u=0,h=this.width;u<h;u++)r.append(this.get(u,i)?e:t);r.append(n)}return r.toString()}clone(){return new re(this.width,this.height,this.rowSize,this.bits.slice())}}class P extends m{static getNotFoundInstance(){return new P}}P.kind="NotFoundException";class ke extends Z{constructor(e){super(e),this.luminances=ke.EMPTY,this.buckets=new Int32Array(ke.LUMINANCE_BUCKETS)}getBlackRow(e,t){const n=this.getLuminanceSource(),r=n.getWidth();t==null||t.getSize()<r?t=new K(r):t.clear(),this.initArrays(r);const i=n.getRow(e,this.luminances),a=this.buckets;for(let h=0;h<r;h++)a[(i[h]&255)>>ke.LUMINANCE_SHIFT]++;const u=ke.estimateBlackPoint(a);if(r<3)for(let h=0;h<r;h++)(i[h]&255)<u&&t.set(h);else{let h=i[0]&255,g=i[1]&255;for(let x=1;x<r-1;x++){const y=i[x+1]&255;(g*4-h-y)/2<u&&t.set(x),h=g,g=y}}return t}getBlackMatrix(){const e=this.getLuminanceSource(),t=e.getWidth(),n=e.getHeight(),r=new re(t,n);this.initArrays(t);const i=this.buckets;for(let h=1;h<5;h++){const g=Math.floor(n*h/5),x=e.getRow(g,this.luminances),y=Math.floor(t*4/5);for(let E=Math.floor(t/5);E<y;E++){const S=x[E]&255;i[S>>ke.LUMINANCE_SHIFT]++}}const a=ke.estimateBlackPoint(i),u=e.getMatrix();for(let h=0;h<n;h++){const g=h*t;for(let x=0;x<t;x++)(u[g+x]&255)<a&&r.set(x,h)}return r}createBinarizer(e){return new ke(e)}initArrays(e){this.luminances.length<e&&(this.luminances=new Uint8ClampedArray(e));const t=this.buckets;for(let n=0;n<ke.LUMINANCE_BUCKETS;n++)t[n]=0}static estimateBlackPoint(e){const t=e.length;let n=0,r=0,i=0;for(let x=0;x<t;x++)e[x]>i&&(r=x,i=e[x]),e[x]>n&&(n=e[x]);let a=0,u=0;for(let x=0;x<t;x++){const y=x-r,E=e[x]*y*y;E>u&&(a=x,u=E)}if(r>a){const x=r;r=a,a=x}if(a-r<=t/16)throw new P;let h=a-1,g=-1;for(let x=a-1;x>r;x--){const y=x-r,E=y*y*(a-x)*(n-e[x]);E>g&&(h=x,g=E)}return h<<ke.LUMINANCE_SHIFT}}ke.LUMINANCE_BITS=5,ke.LUMINANCE_SHIFT=8-ke.LUMINANCE_BITS,ke.LUMINANCE_BUCKETS=1<<ke.LUMINANCE_BITS,ke.EMPTY=Uint8ClampedArray.from([0]);class de extends ke{constructor(e){super(e),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const e=this.getLuminanceSource(),t=e.getWidth(),n=e.getHeight();if(t>=de.MINIMUM_DIMENSION&&n>=de.MINIMUM_DIMENSION){const r=e.getMatrix();let i=t>>de.BLOCK_SIZE_POWER;(t&de.BLOCK_SIZE_MASK)!==0&&i++;let a=n>>de.BLOCK_SIZE_POWER;(n&de.BLOCK_SIZE_MASK)!==0&&a++;const u=de.calculateBlackPoints(r,i,a,t,n),h=new re(t,n);de.calculateThresholdForBlock(r,i,a,t,n,u,h),this.matrix=h}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(e){return new de(e)}static calculateThresholdForBlock(e,t,n,r,i,a,u){const h=i-de.BLOCK_SIZE,g=r-de.BLOCK_SIZE;for(let x=0;x<n;x++){let y=x<<de.BLOCK_SIZE_POWER;y>h&&(y=h);const E=de.cap(x,2,n-3);for(let S=0;S<t;S++){let T=S<<de.BLOCK_SIZE_POWER;T>g&&(T=g);const v=de.cap(S,2,t-3);let R=0;for(let H=-2;H<=2;H++){const W=a[E+H];R+=W[v-2]+W[v-1]+W[v]+W[v+1]+W[v+2]}const B=R/25;de.thresholdBlock(e,T,y,B,r,u)}}}static cap(e,t,n){return e<t?t:e>n?n:e}static thresholdBlock(e,t,n,r,i,a){for(let u=0,h=n*i+t;u<de.BLOCK_SIZE;u++,h+=i)for(let g=0;g<de.BLOCK_SIZE;g++)(e[h+g]&255)<=r&&a.set(t+g,n+u)}static calculateBlackPoints(e,t,n,r,i){const a=i-de.BLOCK_SIZE,u=r-de.BLOCK_SIZE,h=new Array(n);for(let g=0;g<n;g++){h[g]=new Int32Array(t);let x=g<<de.BLOCK_SIZE_POWER;x>a&&(x=a);for(let y=0;y<t;y++){let E=y<<de.BLOCK_SIZE_POWER;E>u&&(E=u);let S=0,T=255,v=0;for(let B=0,H=x*r+E;B<de.BLOCK_SIZE;B++,H+=r){for(let W=0;W<de.BLOCK_SIZE;W++){const U=e[H+W]&255;S+=U,U<T&&(T=U),U>v&&(v=U)}if(v-T>de.MIN_DYNAMIC_RANGE)for(B++,H+=r;B<de.BLOCK_SIZE;B++,H+=r)for(let W=0;W<de.BLOCK_SIZE;W++)S+=e[H+W]&255}let R=S>>de.BLOCK_SIZE_POWER*2;if(v-T<=de.MIN_DYNAMIC_RANGE&&(R=T/2,g>0&&y>0)){const B=(h[g-1][y]+2*h[g][y-1]+h[g-1][y-1])/4;T<B&&(R=B)}h[g][y]=R}}return h}}de.BLOCK_SIZE_POWER=3,de.BLOCK_SIZE=1<<de.BLOCK_SIZE_POWER,de.BLOCK_SIZE_MASK=de.BLOCK_SIZE-1,de.MINIMUM_DIMENSION=de.BLOCK_SIZE*5,de.MIN_DYNAMIC_RANGE=24;class jt{constructor(e,t){this.width=e,this.height=t}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(e,t,n,r){throw new ce("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new ce("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new ce("This luminance source does not support rotation by 45 degrees.")}toString(){const e=new Uint8ClampedArray(this.width);let t=new q;for(let n=0;n<this.height;n++){const r=this.getRow(n,e);for(let i=0;i<this.width;i++){const a=r[i]&255;let u;a<64?u="#":a<128?u="+":a<192?u=".":u=" ",t.append(u)}t.append(`
`)}return t.toString()}}class Rt extends jt{constructor(e){super(e.getWidth(),e.getHeight()),this.delegate=e}getRow(e,t){const n=this.delegate.getRow(e,t),r=this.getWidth();for(let i=0;i<r;i++)n[i]=255-(n[i]&255);return n}getMatrix(){const e=this.delegate.getMatrix(),t=this.getWidth()*this.getHeight(),n=new Uint8ClampedArray(t);for(let r=0;r<t;r++)n[r]=255-(e[r]&255);return n}isCropSupported(){return this.delegate.isCropSupported()}crop(e,t,n,r){return new Rt(this.delegate.crop(e,t,n,r))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new Rt(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new Rt(this.delegate.rotateCounterClockwise45())}}class Ct extends jt{constructor(e){super(e.width,e.height),this.canvas=e,this.tempCanvasElement=null,this.buffer=Ct.makeBufferFromCanvasImageData(e)}static makeBufferFromCanvasImageData(e){const t=e.getContext("2d").getImageData(0,0,e.width,e.height);return Ct.toGrayscaleBuffer(t.data,e.width,e.height)}static toGrayscaleBuffer(e,t,n){const r=new Uint8ClampedArray(t*n);for(let i=0,a=0,u=e.length;i<u;i+=4,a++){let h;if(e[i+3]===0)h=255;else{const x=e[i],y=e[i+1],E=e[i+2];h=306*x+601*y+117*E+512>>10}r[a]=h}return r}getRow(e,t){if(e<0||e>=this.getHeight())throw new _("Requested row is outside the image: "+e);const n=this.getWidth(),r=e*n;return t===null?t=this.buffer.slice(r,r+n):(t.length<n&&(t=new Uint8ClampedArray(n)),t.set(this.buffer.slice(r,r+n))),t}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(e,t,n,r){return super.crop(e,t,n,r),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const e=this.canvas.ownerDocument.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height,this.tempCanvasElement=e}return this.tempCanvasElement}rotate(e){const t=this.getTempCanvasElement(),n=t.getContext("2d"),r=e*Ct.DEGREE_TO_RADIANS,i=this.canvas.width,a=this.canvas.height,u=Math.ceil(Math.abs(Math.cos(r))*i+Math.abs(Math.sin(r))*a),h=Math.ceil(Math.abs(Math.sin(r))*i+Math.abs(Math.cos(r))*a);return t.width=u,t.height=h,n.translate(u/2,h/2),n.rotate(r),n.drawImage(this.canvas,i/-2,a/-2),this.buffer=Ct.makeBufferFromCanvasImageData(t),this}invert(){return new Rt(this)}}Ct.DEGREE_TO_RADIANS=Math.PI/180;class tn{constructor(e,t,n){this.deviceId=e,this.label=t,this.kind="videoinput",this.groupId=n||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var qe=(globalThis||ar||self||window||void 0)&&(globalThis||ar||self||window||void 0).__awaiter||function(C,e,t,n){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function u(x){try{g(n.next(x))}catch(y){a(y)}}function h(x){try{g(n.throw(x))}catch(y){a(y)}}function g(x){x.done?i(x.value):r(x.value).then(u,h)}g((n=n.apply(C,e||[])).next())})};class St{constructor(e,t=500,n){this.reader=e,this.timeBetweenScansMillis=t,this._hints=n,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(e){this._timeBetweenDecodingAttempts=e<0?0:e}set hints(e){this._hints=e||null}get hints(){return this._hints}listVideoInputDevices(){return qe(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const e=yield navigator.mediaDevices.enumerateDevices(),t=[];for(const n of e){const r=n.kind==="video"?"videoinput":n.kind;if(r!=="videoinput")continue;const i=n.deviceId||n.id,a=n.label||`Video device ${t.length+1}`,u=n.groupId,h={deviceId:i,label:a,kind:r,groupId:u};t.push(h)}return t})}getVideoInputDevices(){return qe(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(t=>new tn(t.deviceId,t.label))})}findDeviceById(e){return qe(this,void 0,void 0,function*(){const t=yield this.listVideoInputDevices();return t?t.find(n=>n.deviceId===e):null})}decodeFromInputVideoDevice(e,t){return qe(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(e,t)})}decodeOnceFromVideoDevice(e,t){return qe(this,void 0,void 0,function*(){this.reset();let n;e?n={deviceId:{exact:e}}:n={facingMode:"environment"};const r={video:n};return yield this.decodeOnceFromConstraints(r,t)})}decodeOnceFromConstraints(e,t){return qe(this,void 0,void 0,function*(){const n=yield navigator.mediaDevices.getUserMedia(e);return yield this.decodeOnceFromStream(n,t)})}decodeOnceFromStream(e,t){return qe(this,void 0,void 0,function*(){this.reset();const n=yield this.attachStreamToVideo(e,t);return yield this.decodeOnce(n)})}decodeFromInputVideoDeviceContinuously(e,t,n){return qe(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(e,t,n)})}decodeFromVideoDevice(e,t,n){return qe(this,void 0,void 0,function*(){let r;e?r={deviceId:{exact:e}}:r={facingMode:"environment"};const i={video:r};return yield this.decodeFromConstraints(i,t,n)})}decodeFromConstraints(e,t,n){return qe(this,void 0,void 0,function*(){const r=yield navigator.mediaDevices.getUserMedia(e);return yield this.decodeFromStream(r,t,n)})}decodeFromStream(e,t,n){return qe(this,void 0,void 0,function*(){this.reset();const r=yield this.attachStreamToVideo(e,t);return yield this.decodeContinuously(r,n)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(e,t){return qe(this,void 0,void 0,function*(){const n=this.prepareVideoElement(t);return this.addVideoSource(n,e),this.videoElement=n,this.stream=e,yield this.playVideoOnLoadAsync(n),n})}playVideoOnLoadAsync(e){return new Promise((t,n)=>this.playVideoOnLoad(e,()=>t()))}playVideoOnLoad(e,t){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(e),e.addEventListener("ended",this.videoEndedListener),e.addEventListener("canplay",this.videoCanPlayListener),e.addEventListener("playing",t),this.tryPlayVideo(e)}isVideoPlaying(e){return e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2}tryPlayVideo(e){return qe(this,void 0,void 0,function*(){if(this.isVideoPlaying(e)){console.warn("Trying to play video that is already playing.");return}try{yield e.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(e,t){const n=document.getElementById(e);if(!n)throw new A(`element with id '${e}' not found`);if(n.nodeName.toLowerCase()!==t.toLowerCase())throw new A(`element with id '${e}' must be an ${t} element`);return n}decodeFromImage(e,t){if(!e&&!t)throw new A("either imageElement with a src set or an url must be provided");return t&&!e?this.decodeFromImageUrl(t):this.decodeFromImageElement(e)}decodeFromVideo(e,t){if(!e&&!t)throw new A("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrl(t):this.decodeFromVideoElement(e)}decodeFromVideoContinuously(e,t,n){if(e===void 0&&t===void 0)throw new A("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrlContinuously(t,n):this.decodeFromVideoElementContinuously(e,n)}decodeFromImageElement(e){if(!e)throw new A("An image element must be provided.");this.reset();const t=this.prepareImageElement(e);this.imageElement=t;let n;return this.isImageLoaded(t)?n=this.decodeOnce(t,!1,!0):n=this._decodeOnLoadImage(t),n}decodeFromVideoElement(e){const t=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideo(t)}decodeFromVideoElementContinuously(e,t){const n=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideoContinuously(n,t)}_decodeFromVideoElementSetup(e){if(!e)throw new A("A video element must be provided.");this.reset();const t=this.prepareVideoElement(e);return this.videoElement=t,t}decodeFromImageUrl(e){if(!e)throw new A("An URL must be provided.");this.reset();const t=this.prepareImageElement();this.imageElement=t;const n=this._decodeOnLoadImage(t);return t.src=e,n}decodeFromVideoUrl(e){if(!e)throw new A("An URL must be provided.");this.reset();const t=this.prepareVideoElement(),n=this.decodeFromVideoElement(t);return t.src=e,n}decodeFromVideoUrlContinuously(e,t){if(!e)throw new A("An URL must be provided.");this.reset();const n=this.prepareVideoElement(),r=this.decodeFromVideoElementContinuously(n,t);return n.src=e,r}_decodeOnLoadImage(e){return new Promise((t,n)=>{this.imageLoadedListener=()=>this.decodeOnce(e,!1,!0).then(t,n),e.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(e){return qe(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(e),yield this.decodeOnce(e)})}_decodeOnLoadVideoContinuously(e,t){return qe(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(e),this.decodeContinuously(e,t)})}isImageLoaded(e){return!(!e.complete||e.naturalWidth===0)}prepareImageElement(e){let t;return typeof e>"u"&&(t=document.createElement("img"),t.width=200,t.height=200),typeof e=="string"&&(t=this.getMediaElement(e,"img")),e instanceof HTMLImageElement&&(t=e),t}prepareVideoElement(e){let t;return!e&&typeof document<"u"&&(t=document.createElement("video"),t.width=200,t.height=200),typeof e=="string"&&(t=this.getMediaElement(e,"video")),e instanceof HTMLVideoElement&&(t=e),t.setAttribute("autoplay","true"),t.setAttribute("muted","true"),t.setAttribute("playsinline","true"),t}decodeOnce(e,t=!0,n=!0){this._stopAsyncDecode=!1;const r=(i,a)=>{if(this._stopAsyncDecode){a(new P("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const u=this.decode(e);i(u)}catch(u){const h=t&&u instanceof P,x=(u instanceof D||u instanceof L)&&n;if(h||x)return setTimeout(r,this._timeBetweenDecodingAttempts,i,a);a(u)}};return new Promise((i,a)=>r(i,a))}decodeContinuously(e,t){this._stopContinuousDecode=!1;const n=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const r=this.decode(e);t(r,null),setTimeout(n,this.timeBetweenScansMillis)}catch(r){t(null,r);const i=r instanceof D||r instanceof L,a=r instanceof P;(i||a)&&setTimeout(n,this._timeBetweenDecodingAttempts)}};n()}decode(e){const t=this.createBinaryBitmap(e);return this.decodeBitmap(t)}_isHTMLVideoElement(e){return e.videoWidth!==0}drawFrameOnCanvas(e,t,n){t||(t={sx:0,sy:0,sWidth:e.videoWidth,sHeight:e.videoHeight,dx:0,dy:0,dWidth:e.videoWidth,dHeight:e.videoHeight}),n||(n=this.captureCanvasContext),n.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)}drawImageOnCanvas(e,t,n=this.captureCanvasContext){t||(t={sx:0,sy:0,sWidth:e.naturalWidth,sHeight:e.naturalHeight,dx:0,dy:0,dWidth:e.naturalWidth,dHeight:e.naturalHeight}),n||(n=this.captureCanvasContext),n.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)}createBinaryBitmap(e){this.getCaptureCanvasContext(e),this._isHTMLVideoElement(e)?this.drawFrameOnCanvas(e):this.drawImageOnCanvas(e);const t=this.getCaptureCanvas(e),n=new Ct(t),r=new de(n);return new O(r)}getCaptureCanvasContext(e){if(!this.captureCanvasContext){const n=this.getCaptureCanvas(e).getContext("2d");this.captureCanvasContext=n}return this.captureCanvasContext}getCaptureCanvas(e){if(!this.captureCanvas){const t=this.createCaptureCanvas(e);this.captureCanvas=t}return this.captureCanvas}decodeBitmap(e){return this.reader.decode(e,this._hints)}createCaptureCanvas(e){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const t=document.createElement("canvas");let n,r;return typeof e<"u"&&(e instanceof HTMLVideoElement?(n=e.videoWidth,r=e.videoHeight):e instanceof HTMLImageElement&&(n=e.naturalWidth||e.width,r=e.naturalHeight||e.height)),t.style.width=n+"px",t.style.height=r+"px",t.width=n,t.height=r,t}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(e=>e.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(e,t){try{e.srcObject=t}catch{e.src=URL.createObjectURL(t)}}cleanVideoSource(e){try{e.srcObject=null}catch{e.src=""}this.videoElement.removeAttribute("src")}}class Qe{constructor(e,t,n=t==null?0:8*t.length,r,i,a=G.currentTimeMillis()){this.text=e,this.rawBytes=t,this.numBits=n,this.resultPoints=r,this.format=i,this.timestamp=a,this.text=e,this.rawBytes=t,n==null?this.numBits=t==null?0:8*t.length:this.numBits=n,this.resultPoints=r,this.format=i,this.resultMetadata=null,a==null?this.timestamp=G.currentTimeMillis():this.timestamp=a}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(e,t){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(e,t)}putAllMetadata(e){e!==null&&(this.resultMetadata===null?this.resultMetadata=e:this.resultMetadata=new Map(e))}addResultPoints(e){const t=this.resultPoints;if(t===null)this.resultPoints=e;else if(e!==null&&e.length>0){const n=new Array(t.length+e.length);G.arraycopy(t,0,n,0,t.length),G.arraycopy(e,0,n,t.length,e.length),this.resultPoints=n}}getTimestamp(){return this.timestamp}toString(){return this.text}}var nn;(function(C){C[C.AZTEC=0]="AZTEC",C[C.CODABAR=1]="CODABAR",C[C.CODE_39=2]="CODE_39",C[C.CODE_93=3]="CODE_93",C[C.CODE_128=4]="CODE_128",C[C.DATA_MATRIX=5]="DATA_MATRIX",C[C.EAN_8=6]="EAN_8",C[C.EAN_13=7]="EAN_13",C[C.ITF=8]="ITF",C[C.MAXICODE=9]="MAXICODE",C[C.PDF_417=10]="PDF_417",C[C.QR_CODE=11]="QR_CODE",C[C.RSS_14=12]="RSS_14",C[C.RSS_EXPANDED=13]="RSS_EXPANDED",C[C.UPC_A=14]="UPC_A",C[C.UPC_E=15]="UPC_E",C[C.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(nn||(nn={}));var se=nn,xt;(function(C){C[C.OTHER=0]="OTHER",C[C.ORIENTATION=1]="ORIENTATION",C[C.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",C[C.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",C[C.ISSUE_NUMBER=4]="ISSUE_NUMBER",C[C.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",C[C.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",C[C.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",C[C.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",C[C.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",C[C.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(xt||(xt={}));var Ie=xt;class yt{constructor(e,t,n,r,i=-1,a=-1){this.rawBytes=e,this.text=t,this.byteSegments=n,this.ecLevel=r,this.structuredAppendSequenceNumber=i,this.structuredAppendParity=a,this.numBits=e==null?0:8*e.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(e){this.numBits=e}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(e){this.errorsCorrected=e}getErasures(){return this.erasures}setErasures(e){this.erasures=e}getOther(){return this.other}setOther(e){this.other=e}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Ut{exp(e){return this.expTable[e]}log(e){if(e===0)throw new _;return this.logTable[e]}static addOrSubtract(e,t){return e^t}}class lt{constructor(e,t){if(t.length===0)throw new _;this.field=e;const n=t.length;if(n>1&&t[0]===0){let r=1;for(;r<n&&t[r]===0;)r++;r===n?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(n-r),G.arraycopy(t,r,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(e){return this.coefficients[this.coefficients.length-1-e]}evaluateAt(e){if(e===0)return this.getCoefficient(0);const t=this.coefficients;let n;if(e===1){n=0;for(let a=0,u=t.length;a!==u;a++){const h=t[a];n=Ut.addOrSubtract(n,h)}return n}n=t[0];const r=t.length,i=this.field;for(let a=1;a<r;a++)n=Ut.addOrSubtract(i.multiply(e,n),t[a]);return n}addOrSubtract(e){if(!this.field.equals(e.field))throw new _("GenericGFPolys do not have same GenericGF field");if(this.isZero())return e;if(e.isZero())return this;let t=this.coefficients,n=e.coefficients;if(t.length>n.length){const a=t;t=n,n=a}let r=new Int32Array(n.length);const i=n.length-t.length;G.arraycopy(n,0,r,0,i);for(let a=i;a<n.length;a++)r[a]=Ut.addOrSubtract(t[a-i],n[a]);return new lt(this.field,r)}multiply(e){if(!this.field.equals(e.field))throw new _("GenericGFPolys do not have same GenericGF field");if(this.isZero()||e.isZero())return this.field.getZero();const t=this.coefficients,n=t.length,r=e.coefficients,i=r.length,a=new Int32Array(n+i-1),u=this.field;for(let h=0;h<n;h++){const g=t[h];for(let x=0;x<i;x++)a[h+x]=Ut.addOrSubtract(a[h+x],u.multiply(g,r[x]))}return new lt(u,a)}multiplyScalar(e){if(e===0)return this.field.getZero();if(e===1)return this;const t=this.coefficients.length,n=this.field,r=new Int32Array(t),i=this.coefficients;for(let a=0;a<t;a++)r[a]=n.multiply(i[a],e);return new lt(n,r)}multiplyByMonomial(e,t){if(e<0)throw new _;if(t===0)return this.field.getZero();const n=this.coefficients,r=n.length,i=new Int32Array(r+e),a=this.field;for(let u=0;u<r;u++)i[u]=a.multiply(n[u],t);return new lt(a,i)}divide(e){if(!this.field.equals(e.field))throw new _("GenericGFPolys do not have same GenericGF field");if(e.isZero())throw new _("Divide by 0");const t=this.field;let n=t.getZero(),r=this;const i=e.getCoefficient(e.getDegree()),a=t.inverse(i);for(;r.getDegree()>=e.getDegree()&&!r.isZero();){const u=r.getDegree()-e.getDegree(),h=t.multiply(r.getCoefficient(r.getDegree()),a),g=e.multiplyByMonomial(u,h),x=t.buildMonomial(u,h);n=n.addOrSubtract(x),r=r.addOrSubtract(g)}return[n,r]}toString(){let e="";for(let t=this.getDegree();t>=0;t--){let n=this.getCoefficient(t);if(n!==0){if(n<0?(e+=" - ",n=-n):e.length>0&&(e+=" + "),t===0||n!==1){const r=this.field.log(n);r===0?e+="1":r===1?e+="a":(e+="a^",e+=r)}t!==0&&(t===1?e+="x":(e+="x^",e+=t))}}return e}}class Yn extends m{}Yn.kind="ArithmeticException";class Ce extends Ut{constructor(e,t,n){super(),this.primitive=e,this.size=t,this.generatorBase=n;const r=new Int32Array(t);let i=1;for(let u=0;u<t;u++)r[u]=i,i*=2,i>=t&&(i^=e,i&=t-1);this.expTable=r;const a=new Int32Array(t);for(let u=0;u<t-1;u++)a[r[u]]=u;this.logTable=a,this.zero=new lt(this,Int32Array.from([0])),this.one=new lt(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(e,t){if(e<0)throw new _;if(t===0)return this.zero;const n=new Int32Array(e+1);return n[0]=t,new lt(this,n)}inverse(e){if(e===0)throw new Yn;return this.expTable[this.size-this.logTable[e]-1]}multiply(e,t){return e===0||t===0?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+j.toHexString(this.primitive)+","+this.size+")"}equals(e){return e===this}}Ce.AZTEC_DATA_12=new Ce(4201,4096,1),Ce.AZTEC_DATA_10=new Ce(1033,1024,1),Ce.AZTEC_DATA_6=new Ce(67,64,1),Ce.AZTEC_PARAM=new Ce(19,16,1),Ce.QR_CODE_FIELD_256=new Ce(285,256,0),Ce.DATA_MATRIX_FIELD_256=new Ce(301,256,1),Ce.AZTEC_DATA_8=Ce.DATA_MATRIX_FIELD_256,Ce.MAXICODE_FIELD_64=Ce.AZTEC_DATA_6;class mn extends m{}mn.kind="ReedSolomonException";class Nt extends m{}Nt.kind="IllegalStateException";class On{constructor(e){this.field=e}decode(e,t){const n=this.field,r=new lt(n,e),i=new Int32Array(t);let a=!0;for(let S=0;S<t;S++){const T=r.evaluateAt(n.exp(S+n.getGeneratorBase()));i[i.length-1-S]=T,T!==0&&(a=!1)}if(a)return;const u=new lt(n,i),h=this.runEuclideanAlgorithm(n.buildMonomial(t,1),u,t),g=h[0],x=h[1],y=this.findErrorLocations(g),E=this.findErrorMagnitudes(x,y);for(let S=0;S<y.length;S++){const T=e.length-1-n.log(y[S]);if(T<0)throw new mn("Bad error location");e[T]=Ce.addOrSubtract(e[T],E[S])}}runEuclideanAlgorithm(e,t,n){if(e.getDegree()<t.getDegree()){const S=e;e=t,t=S}const r=this.field;let i=e,a=t,u=r.getZero(),h=r.getOne();for(;a.getDegree()>=(n/2|0);){let S=i,T=u;if(i=a,u=h,i.isZero())throw new mn("r_{i-1} was zero");a=S;let v=r.getZero();const R=i.getCoefficient(i.getDegree()),B=r.inverse(R);for(;a.getDegree()>=i.getDegree()&&!a.isZero();){const H=a.getDegree()-i.getDegree(),W=r.multiply(a.getCoefficient(a.getDegree()),B);v=v.addOrSubtract(r.buildMonomial(H,W)),a=a.addOrSubtract(i.multiplyByMonomial(H,W))}if(h=v.multiply(u).addOrSubtract(T),a.getDegree()>=i.getDegree())throw new Nt("Division algorithm failed to reduce polynomial?")}const g=h.getCoefficient(0);if(g===0)throw new mn("sigmaTilde(0) was zero");const x=r.inverse(g),y=h.multiplyScalar(x),E=a.multiplyScalar(x);return[y,E]}findErrorLocations(e){const t=e.getDegree();if(t===1)return Int32Array.from([e.getCoefficient(1)]);const n=new Int32Array(t);let r=0;const i=this.field;for(let a=1;a<i.getSize()&&r<t;a++)e.evaluateAt(a)===0&&(n[r]=i.inverse(a),r++);if(r!==t)throw new mn("Error locator degree does not match number of roots");return n}findErrorMagnitudes(e,t){const n=t.length,r=new Int32Array(n),i=this.field;for(let a=0;a<n;a++){const u=i.inverse(t[a]);let h=1;for(let g=0;g<n;g++)if(a!==g){const x=i.multiply(t[g],u),y=(x&1)===0?x|1:x&-2;h=i.multiply(h,y)}r[a]=i.multiply(e.evaluateAt(u),i.inverse(h)),i.getGeneratorBase()!==0&&(r[a]=i.multiply(r[a],u))}return r}}var Je;(function(C){C[C.UPPER=0]="UPPER",C[C.LOWER=1]="LOWER",C[C.MIXED=2]="MIXED",C[C.DIGIT=3]="DIGIT",C[C.PUNCT=4]="PUNCT",C[C.BINARY=5]="BINARY"})(Je||(Je={}));class Ne{decode(e){this.ddata=e;let t=e.getBits(),n=this.extractBits(t),r=this.correctBits(n),i=Ne.convertBoolArrayToByteArray(r),a=Ne.getEncodedData(r),u=new yt(i,a,null,null);return u.setNumBits(r.length),u}static highLevelDecode(e){return this.getEncodedData(e)}static getEncodedData(e){let t=e.length,n=Je.UPPER,r=Je.UPPER,i="",a=0;for(;a<t;)if(r===Je.BINARY){if(t-a<5)break;let u=Ne.readCode(e,a,5);if(a+=5,u===0){if(t-a<11)break;u=Ne.readCode(e,a,11)+31,a+=11}for(let h=0;h<u;h++){if(t-a<8){a=t;break}const g=Ne.readCode(e,a,8);i+=V.castAsNonUtf8Char(g),a+=8}r=n}else{let u=r===Je.DIGIT?4:5;if(t-a<u)break;let h=Ne.readCode(e,a,u);a+=u;let g=Ne.getCharacter(r,h);g.startsWith("CTRL_")?(n=r,r=Ne.getTable(g.charAt(5)),g.charAt(6)==="L"&&(n=r)):(i+=g,r=n)}return i}static getTable(e){switch(e){case"L":return Je.LOWER;case"P":return Je.PUNCT;case"M":return Je.MIXED;case"D":return Je.DIGIT;case"B":return Je.BINARY;case"U":default:return Je.UPPER}}static getCharacter(e,t){switch(e){case Je.UPPER:return Ne.UPPER_TABLE[t];case Je.LOWER:return Ne.LOWER_TABLE[t];case Je.MIXED:return Ne.MIXED_TABLE[t];case Je.PUNCT:return Ne.PUNCT_TABLE[t];case Je.DIGIT:return Ne.DIGIT_TABLE[t];default:throw new Nt("Bad table")}}correctBits(e){let t,n;this.ddata.getNbLayers()<=2?(n=6,t=Ce.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(n=8,t=Ce.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(n=10,t=Ce.AZTEC_DATA_10):(n=12,t=Ce.AZTEC_DATA_12);let r=this.ddata.getNbDatablocks(),i=e.length/n;if(i<r)throw new L;let a=e.length%n,u=new Int32Array(i);for(let E=0;E<i;E++,a+=n)u[E]=Ne.readCode(e,a,n);try{new On(t).decode(u,i-r)}catch(E){throw new L(E)}let h=(1<<n)-1,g=0;for(let E=0;E<r;E++){let S=u[E];if(S===0||S===h)throw new L;(S===1||S===h-1)&&g++}let x=new Array(r*n-g),y=0;for(let E=0;E<r;E++){let S=u[E];if(S===1||S===h-1)x.fill(S>1,y,y+n-1),y+=n-1;else for(let T=n-1;T>=0;--T)x[y++]=(S&1<<T)!==0}return x}extractBits(e){let t=this.ddata.isCompact(),n=this.ddata.getNbLayers(),r=(t?11:14)+n*4,i=new Int32Array(r),a=new Array(this.totalBitsInLayer(n,t));if(t)for(let u=0;u<i.length;u++)i[u]=u;else{let u=r+1+2*j.truncDivision(j.truncDivision(r,2)-1,15),h=r/2,g=j.truncDivision(u,2);for(let x=0;x<h;x++){let y=x+j.truncDivision(x,15);i[h-x-1]=g-y-1,i[h+x]=g+y+1}}for(let u=0,h=0;u<n;u++){let g=(n-u)*4+(t?9:12),x=u*2,y=r-1-x;for(let E=0;E<g;E++){let S=E*2;for(let T=0;T<2;T++)a[h+S+T]=e.get(i[x+T],i[x+E]),a[h+2*g+S+T]=e.get(i[x+E],i[y-T]),a[h+4*g+S+T]=e.get(i[y-T],i[y-E]),a[h+6*g+S+T]=e.get(i[y-E],i[x+T])}h+=g*8}return a}static readCode(e,t,n){let r=0;for(let i=t;i<t+n;i++)r<<=1,e[i]&&(r|=1);return r}static readByte(e,t){let n=e.length-t;return n>=8?Ne.readCode(e,t,8):Ne.readCode(e,t,n)<<8-n}static convertBoolArrayToByteArray(e){let t=new Uint8Array((e.length+7)/8);for(let n=0;n<t.length;n++)t[n]=Ne.readByte(e,8*n);return t}totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}Ne.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],Ne.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],Ne.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],Ne.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],Ne.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class me{constructor(){}static round(e){return e===NaN?0:e<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:e>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e+(e<0?-.5:.5)|0}static distance(e,t,n,r){const i=e-n,a=t-r;return Math.sqrt(i*i+a*a)}static sum(e){let t=0;for(let n=0,r=e.length;n!==r;n++){const i=e[n];t+=i}return t}}class qn{static floatToIntBits(e){return e}}qn.MAX_VALUE=Number.MAX_SAFE_INTEGER;class ne{constructor(e,t){this.x=e,this.y=t}getX(){return this.x}getY(){return this.y}equals(e){if(e instanceof ne){const t=e;return this.x===t.x&&this.y===t.y}return!1}hashCode(){return 31*qn.floatToIntBits(this.x)+qn.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(e){const t=this.distance(e[0],e[1]),n=this.distance(e[1],e[2]),r=this.distance(e[0],e[2]);let i,a,u;if(n>=t&&n>=r?(a=e[0],i=e[1],u=e[2]):r>=n&&r>=t?(a=e[1],i=e[0],u=e[2]):(a=e[2],i=e[0],u=e[1]),this.crossProductZ(i,a,u)<0){const h=i;i=u,u=h}e[0]=i,e[1]=a,e[2]=u}static distance(e,t){return me.distance(e.x,e.y,t.x,t.y)}static crossProductZ(e,t,n){const r=t.x,i=t.y;return(n.x-r)*(e.y-i)-(n.y-i)*(e.x-r)}}class Zn{constructor(e,t){this.bits=e,this.points=t}getBits(){return this.bits}getPoints(){return this.points}}class zi extends Zn{constructor(e,t,n,r,i){super(e,t),this.compact=n,this.nbDatablocks=r,this.nbLayers=i}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class Vt{constructor(e,t,n,r){this.image=e,this.height=e.getHeight(),this.width=e.getWidth(),t==null&&(t=Vt.INIT_SIZE),n==null&&(n=e.getWidth()/2|0),r==null&&(r=e.getHeight()/2|0);const i=t/2|0;if(this.leftInit=n-i,this.rightInit=n+i,this.upInit=r-i,this.downInit=r+i,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new P}detect(){let e=this.leftInit,t=this.rightInit,n=this.upInit,r=this.downInit,i=!1,a=!0,u=!1,h=!1,g=!1,x=!1,y=!1;const E=this.width,S=this.height;for(;a;){a=!1;let T=!0;for(;(T||!h)&&t<E;)T=this.containsBlackPoint(n,r,t,!1),T?(t++,a=!0,h=!0):h||t++;if(t>=E){i=!0;break}let v=!0;for(;(v||!g)&&r<S;)v=this.containsBlackPoint(e,t,r,!0),v?(r++,a=!0,g=!0):g||r++;if(r>=S){i=!0;break}let R=!0;for(;(R||!x)&&e>=0;)R=this.containsBlackPoint(n,r,e,!1),R?(e--,a=!0,x=!0):x||e--;if(e<0){i=!0;break}let B=!0;for(;(B||!y)&&n>=0;)B=this.containsBlackPoint(e,t,n,!0),B?(n--,a=!0,y=!0):y||n--;if(n<0){i=!0;break}a&&(u=!0)}if(!i&&u){const T=t-e;let v=null;for(let W=1;v===null&&W<T;W++)v=this.getBlackPointOnSegment(e,r-W,e+W,r);if(v==null)throw new P;let R=null;for(let W=1;R===null&&W<T;W++)R=this.getBlackPointOnSegment(e,n+W,e+W,n);if(R==null)throw new P;let B=null;for(let W=1;B===null&&W<T;W++)B=this.getBlackPointOnSegment(t,n+W,t-W,n);if(B==null)throw new P;let H=null;for(let W=1;H===null&&W<T;W++)H=this.getBlackPointOnSegment(t,r-W,t-W,r);if(H==null)throw new P;return this.centerEdges(H,v,B,R)}else throw new P}getBlackPointOnSegment(e,t,n,r){const i=me.round(me.distance(e,t,n,r)),a=(n-e)/i,u=(r-t)/i,h=this.image;for(let g=0;g<i;g++){const x=me.round(e+g*a),y=me.round(t+g*u);if(h.get(x,y))return new ne(x,y)}return null}centerEdges(e,t,n,r){const i=e.getX(),a=e.getY(),u=t.getX(),h=t.getY(),g=n.getX(),x=n.getY(),y=r.getX(),E=r.getY(),S=Vt.CORR;return i<this.width/2?[new ne(y-S,E+S),new ne(u+S,h+S),new ne(g-S,x-S),new ne(i+S,a-S)]:[new ne(y+S,E+S),new ne(u+S,h-S),new ne(g-S,x+S),new ne(i-S,a-S)]}containsBlackPoint(e,t,n,r){const i=this.image;if(r){for(let a=e;a<=t;a++)if(i.get(a,n))return!0}else for(let a=e;a<=t;a++)if(i.get(n,a))return!0;return!1}}Vt.INIT_SIZE=10,Vt.CORR=1;class Er{static checkAndNudgePoints(e,t){const n=e.getWidth(),r=e.getHeight();let i=!0;for(let a=0;a<t.length&&i;a+=2){const u=Math.floor(t[a]),h=Math.floor(t[a+1]);if(u<-1||u>n||h<-1||h>r)throw new P;i=!1,u===-1?(t[a]=0,i=!0):u===n&&(t[a]=n-1,i=!0),h===-1?(t[a+1]=0,i=!0):h===r&&(t[a+1]=r-1,i=!0)}i=!0;for(let a=t.length-2;a>=0&&i;a-=2){const u=Math.floor(t[a]),h=Math.floor(t[a+1]);if(u<-1||u>n||h<-1||h>r)throw new P;i=!1,u===-1?(t[a]=0,i=!0):u===n&&(t[a]=n-1,i=!0),h===-1?(t[a+1]=0,i=!0):h===r&&(t[a+1]=r-1,i=!0)}}}class _t{constructor(e,t,n,r,i,a,u,h,g){this.a11=e,this.a21=t,this.a31=n,this.a12=r,this.a22=i,this.a32=a,this.a13=u,this.a23=h,this.a33=g}static quadrilateralToQuadrilateral(e,t,n,r,i,a,u,h,g,x,y,E,S,T,v,R){const B=_t.quadrilateralToSquare(e,t,n,r,i,a,u,h);return _t.squareToQuadrilateral(g,x,y,E,S,T,v,R).times(B)}transformPoints(e){const t=e.length,n=this.a11,r=this.a12,i=this.a13,a=this.a21,u=this.a22,h=this.a23,g=this.a31,x=this.a32,y=this.a33;for(let E=0;E<t;E+=2){const S=e[E],T=e[E+1],v=i*S+h*T+y;e[E]=(n*S+a*T+g)/v,e[E+1]=(r*S+u*T+x)/v}}transformPointsWithValues(e,t){const n=this.a11,r=this.a12,i=this.a13,a=this.a21,u=this.a22,h=this.a23,g=this.a31,x=this.a32,y=this.a33,E=e.length;for(let S=0;S<E;S++){const T=e[S],v=t[S],R=i*T+h*v+y;e[S]=(n*T+a*v+g)/R,t[S]=(r*T+u*v+x)/R}}static squareToQuadrilateral(e,t,n,r,i,a,u,h){const g=e-n+i-u,x=t-r+a-h;if(g===0&&x===0)return new _t(n-e,i-n,e,r-t,a-r,t,0,0,1);{const y=n-i,E=u-i,S=r-a,T=h-a,v=y*T-E*S,R=(g*T-E*x)/v,B=(y*x-g*S)/v;return new _t(n-e+R*n,u-e+B*u,e,r-t+R*r,h-t+B*h,t,R,B,1)}}static quadrilateralToSquare(e,t,n,r,i,a,u,h){return _t.squareToQuadrilateral(e,t,n,r,i,a,u,h).buildAdjoint()}buildAdjoint(){return new _t(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(e){return new _t(this.a11*e.a11+this.a21*e.a12+this.a31*e.a13,this.a11*e.a21+this.a21*e.a22+this.a31*e.a23,this.a11*e.a31+this.a21*e.a32+this.a31*e.a33,this.a12*e.a11+this.a22*e.a12+this.a32*e.a13,this.a12*e.a21+this.a22*e.a22+this.a32*e.a23,this.a12*e.a31+this.a22*e.a32+this.a32*e.a33,this.a13*e.a11+this.a23*e.a12+this.a33*e.a13,this.a13*e.a21+this.a23*e.a22+this.a33*e.a23,this.a13*e.a31+this.a23*e.a32+this.a33*e.a33)}}class Yi extends Er{sampleGrid(e,t,n,r,i,a,u,h,g,x,y,E,S,T,v,R,B,H,W){const U=_t.quadrilateralToQuadrilateral(r,i,a,u,h,g,x,y,E,S,T,v,R,B,H,W);return this.sampleGridWithTransform(e,t,n,U)}sampleGridWithTransform(e,t,n,r){if(t<=0||n<=0)throw new P;const i=new re(t,n),a=new Float32Array(2*t);for(let u=0;u<n;u++){const h=a.length,g=u+.5;for(let x=0;x<h;x+=2)a[x]=x/2+.5,a[x+1]=g;r.transformPoints(a),Er.checkAndNudgePoints(e,a);try{for(let x=0;x<h;x+=2)e.get(Math.floor(a[x]),Math.floor(a[x+1]))&&i.set(x/2,u)}catch{throw new P}}return i}}class Wt{static setGridSampler(e){Wt.gridSampler=e}static getInstance(){return Wt.gridSampler}}Wt.gridSampler=new Yi;class ot{constructor(e,t){this.x=e,this.y=t}toResultPoint(){return new ne(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class qi{constructor(e){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=e}detect(){return this.detectMirror(!1)}detectMirror(e){let t=this.getMatrixCenter(),n=this.getBullsEyeCorners(t);if(e){let a=n[0];n[0]=n[2],n[2]=a}this.extractParameters(n);let r=this.sampleGrid(this.image,n[this.shift%4],n[(this.shift+1)%4],n[(this.shift+2)%4],n[(this.shift+3)%4]),i=this.getMatrixCornerPoints(n);return new zi(r,i,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(e){if(!this.isValidPoint(e[0])||!this.isValidPoint(e[1])||!this.isValidPoint(e[2])||!this.isValidPoint(e[3]))throw new P;let t=2*this.nbCenterLayers,n=new Int32Array([this.sampleLine(e[0],e[1],t),this.sampleLine(e[1],e[2],t),this.sampleLine(e[2],e[3],t),this.sampleLine(e[3],e[0],t)]);this.shift=this.getRotation(n,t);let r=0;for(let a=0;a<4;a++){let u=n[(this.shift+a)%4];this.compact?(r<<=7,r+=u>>1&127):(r<<=10,r+=(u>>2&992)+(u>>1&31))}let i=this.getCorrectedParameterData(r,this.compact);this.compact?(this.nbLayers=(i>>6)+1,this.nbDataBlocks=(i&63)+1):(this.nbLayers=(i>>11)+1,this.nbDataBlocks=(i&2047)+1)}getRotation(e,t){let n=0;e.forEach((r,i,a)=>{let u=(r>>t-2<<1)+(r&1);n=(n<<3)+u}),n=((n&1)<<11)+(n>>1);for(let r=0;r<4;r++)if(j.bitCount(n^this.EXPECTED_CORNER_BITS[r])<=2)return r;throw new P}getCorrectedParameterData(e,t){let n,r;t?(n=7,r=2):(n=10,r=4);let i=n-r,a=new Int32Array(n);for(let h=n-1;h>=0;--h)a[h]=e&15,e>>=4;try{new On(Ce.AZTEC_PARAM).decode(a,i)}catch{throw new P}let u=0;for(let h=0;h<r;h++)u=(u<<4)+a[h];return u}getBullsEyeCorners(e){let t=e,n=e,r=e,i=e,a=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let y=this.getFirstDifferent(t,a,1,-1),E=this.getFirstDifferent(n,a,1,1),S=this.getFirstDifferent(r,a,-1,1),T=this.getFirstDifferent(i,a,-1,-1);if(this.nbCenterLayers>2){let v=this.distancePoint(T,y)*this.nbCenterLayers/(this.distancePoint(i,t)*(this.nbCenterLayers+2));if(v<.75||v>1.25||!this.isWhiteOrBlackRectangle(y,E,S,T))break}t=y,n=E,r=S,i=T,a=!a}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new P;this.compact=this.nbCenterLayers===5;let u=new ne(t.getX()+.5,t.getY()-.5),h=new ne(n.getX()+.5,n.getY()+.5),g=new ne(r.getX()-.5,r.getY()+.5),x=new ne(i.getX()-.5,i.getY()-.5);return this.expandSquare([u,h,g,x],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let e,t,n,r;try{let u=new Vt(this.image).detect();e=u[0],t=u[1],n=u[2],r=u[3]}catch{let h=this.image.getWidth()/2,g=this.image.getHeight()/2;e=this.getFirstDifferent(new ot(h+7,g-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new ot(h+7,g+7),!1,1,1).toResultPoint(),n=this.getFirstDifferent(new ot(h-7,g+7),!1,-1,1).toResultPoint(),r=this.getFirstDifferent(new ot(h-7,g-7),!1,-1,-1).toResultPoint()}let i=me.round((e.getX()+r.getX()+t.getX()+n.getX())/4),a=me.round((e.getY()+r.getY()+t.getY()+n.getY())/4);try{let u=new Vt(this.image,15,i,a).detect();e=u[0],t=u[1],n=u[2],r=u[3]}catch{e=this.getFirstDifferent(new ot(i+7,a-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new ot(i+7,a+7),!1,1,1).toResultPoint(),n=this.getFirstDifferent(new ot(i-7,a+7),!1,-1,1).toResultPoint(),r=this.getFirstDifferent(new ot(i-7,a-7),!1,-1,-1).toResultPoint()}return i=me.round((e.getX()+r.getX()+t.getX()+n.getX())/4),a=me.round((e.getY()+r.getY()+t.getY()+n.getY())/4),new ot(i,a)}getMatrixCornerPoints(e){return this.expandSquare(e,2*this.nbCenterLayers,this.getDimension())}sampleGrid(e,t,n,r,i){let a=Wt.getInstance(),u=this.getDimension(),h=u/2-this.nbCenterLayers,g=u/2+this.nbCenterLayers;return a.sampleGrid(e,u,u,h,h,g,h,g,g,h,g,t.getX(),t.getY(),n.getX(),n.getY(),r.getX(),r.getY(),i.getX(),i.getY())}sampleLine(e,t,n){let r=0,i=this.distanceResultPoint(e,t),a=i/n,u=e.getX(),h=e.getY(),g=a*(t.getX()-e.getX())/i,x=a*(t.getY()-e.getY())/i;for(let y=0;y<n;y++)this.image.get(me.round(u+y*g),me.round(h+y*x))&&(r|=1<<n-y-1);return r}isWhiteOrBlackRectangle(e,t,n,r){let i=3;e=new ot(e.getX()-i,e.getY()+i),t=new ot(t.getX()-i,t.getY()-i),n=new ot(n.getX()+i,n.getY()-i),r=new ot(r.getX()+i,r.getY()+i);let a=this.getColor(r,e);if(a===0)return!1;let u=this.getColor(e,t);return u!==a||(u=this.getColor(t,n),u!==a)?!1:(u=this.getColor(n,r),u===a)}getColor(e,t){let n=this.distancePoint(e,t),r=(t.getX()-e.getX())/n,i=(t.getY()-e.getY())/n,a=0,u=e.getX(),h=e.getY(),g=this.image.get(e.getX(),e.getY()),x=Math.ceil(n);for(let E=0;E<x;E++)u+=r,h+=i,this.image.get(me.round(u),me.round(h))!==g&&a++;let y=a/n;return y>.1&&y<.9?0:y<=.1===g?1:-1}getFirstDifferent(e,t,n,r){let i=e.getX()+n,a=e.getY()+r;for(;this.isValid(i,a)&&this.image.get(i,a)===t;)i+=n,a+=r;for(i-=n,a-=r;this.isValid(i,a)&&this.image.get(i,a)===t;)i+=n;for(i-=n;this.isValid(i,a)&&this.image.get(i,a)===t;)a+=r;return a-=r,new ot(i,a)}expandSquare(e,t,n){let r=n/(2*t),i=e[0].getX()-e[2].getX(),a=e[0].getY()-e[2].getY(),u=(e[0].getX()+e[2].getX())/2,h=(e[0].getY()+e[2].getY())/2,g=new ne(u+r*i,h+r*a),x=new ne(u-r*i,h-r*a);i=e[1].getX()-e[3].getX(),a=e[1].getY()-e[3].getY(),u=(e[1].getX()+e[3].getX())/2,h=(e[1].getY()+e[3].getY())/2;let y=new ne(u+r*i,h+r*a),E=new ne(u-r*i,h-r*a);return[g,y,x,E]}isValid(e,t){return e>=0&&e<this.image.getWidth()&&t>0&&t<this.image.getHeight()}isValidPoint(e){let t=me.round(e.getX()),n=me.round(e.getY());return this.isValid(t,n)}distancePoint(e,t){return me.distance(e.getX(),e.getY(),t.getX(),t.getY())}distanceResultPoint(e,t){return me.distance(e.getX(),e.getY(),t.getX(),t.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(j.truncDivision(this.nbLayers-4,8)+1)+15}}class Kn{decode(e,t=null){let n=null,r=new qi(e.getBlackMatrix()),i=null,a=null;try{let x=r.detectMirror(!1);i=x.getPoints(),this.reportFoundResultPoints(t,i),a=new Ne().decode(x)}catch(x){n=x}if(a==null)try{let x=r.detectMirror(!0);i=x.getPoints(),this.reportFoundResultPoints(t,i),a=new Ne().decode(x)}catch(x){throw n??x}let u=new Qe(a.getText(),a.getRawBytes(),a.getNumBits(),i,se.AZTEC,G.currentTimeMillis()),h=a.getByteSegments();h!=null&&u.putMetadata(Ie.BYTE_SEGMENTS,h);let g=a.getECLevel();return g!=null&&u.putMetadata(Ie.ERROR_CORRECTION_LEVEL,g),u}reportFoundResultPoints(e,t){if(e!=null){let n=e.get(X.NEED_RESULT_POINT_CALLBACK);n!=null&&t.forEach((r,i,a)=>{n.foundPossibleResultPoint(r)})}}reset(){}}class La extends St{constructor(e=500){super(new Kn,e)}}class Ge{decode(e,t){try{return this.doDecode(e,t)}catch{if(t&&t.get(X.TRY_HARDER)===!0&&e.isRotateSupported()){const i=e.rotateCounterClockwise(),a=this.doDecode(i,t),u=a.getResultMetadata();let h=270;u!==null&&u.get(Ie.ORIENTATION)===!0&&(h=h+u.get(Ie.ORIENTATION)%360),a.putMetadata(Ie.ORIENTATION,h);const g=a.getResultPoints();if(g!==null){const x=i.getHeight();for(let y=0;y<g.length;y++)g[y]=new ne(x-g[y].getY()-1,g[y].getX())}return a}else throw new P}}reset(){}doDecode(e,t){const n=e.getWidth(),r=e.getHeight();let i=new K(n);const a=t&&t.get(X.TRY_HARDER)===!0,u=Math.max(1,r>>(a?8:5));let h;a?h=r:h=15;const g=Math.trunc(r/2);for(let x=0;x<h;x++){const y=Math.trunc((x+1)/2),E=(x&1)===0,S=g+u*(E?y:-y);if(S<0||S>=r)break;try{i=e.getBlackRow(S,i)}catch{continue}for(let T=0;T<2;T++){if(T===1&&(i.reverse(),t&&t.get(X.NEED_RESULT_POINT_CALLBACK)===!0)){const v=new Map;t.forEach((R,B)=>v.set(B,R)),v.delete(X.NEED_RESULT_POINT_CALLBACK),t=v}try{const v=this.decodeRow(S,i,t);if(T===1){v.putMetadata(Ie.ORIENTATION,180);const R=v.getResultPoints();R!==null&&(R[0]=new ne(n-R[0].getX()-1,R[0].getY()),R[1]=new ne(n-R[1].getX()-1,R[1].getY()))}return v}catch{}}}throw new P}static recordPattern(e,t,n){const r=n.length;for(let g=0;g<r;g++)n[g]=0;const i=e.getSize();if(t>=i)throw new P;let a=!e.get(t),u=0,h=t;for(;h<i;){if(e.get(h)!==a)n[u]++;else{if(++u===r)break;n[u]=1,a=!a}h++}if(!(u===r||u===r-1&&h===i))throw new P}static recordPatternInReverse(e,t,n){let r=n.length,i=e.get(t);for(;t>0&&r>=0;)e.get(--t)!==i&&(r--,i=!i);if(r>=0)throw new P;Ge.recordPattern(e,t+1,n)}static patternMatchVariance(e,t,n){const r=e.length;let i=0,a=0;for(let g=0;g<r;g++)i+=e[g],a+=t[g];if(i<a)return Number.POSITIVE_INFINITY;const u=i/a;n*=u;let h=0;for(let g=0;g<r;g++){const x=e[g],y=t[g]*u,E=x>y?x-y:y-x;if(E>n)return Number.POSITIVE_INFINITY;h+=E}return h/i}}class z extends Ge{static findStartPattern(e){const t=e.getSize(),n=e.getNextSet(0);let r=0,i=Int32Array.from([0,0,0,0,0,0]),a=n,u=!1;const h=6;for(let g=n;g<t;g++)if(e.get(g)!==u)i[r]++;else{if(r===h-1){let x=z.MAX_AVG_VARIANCE,y=-1;for(let E=z.CODE_START_A;E<=z.CODE_START_C;E++){const S=Ge.patternMatchVariance(i,z.CODE_PATTERNS[E],z.MAX_INDIVIDUAL_VARIANCE);S<x&&(x=S,y=E)}if(y>=0&&e.isRange(Math.max(0,a-(g-a)/2),a,!1))return Int32Array.from([a,g,y]);a+=i[0]+i[1],i=i.slice(2,i.length-1),i[r-1]=0,i[r]=0,r--}else r++;i[r]=1,u=!u}throw new P}static decodeCode(e,t,n){Ge.recordPattern(e,n,t);let r=z.MAX_AVG_VARIANCE,i=-1;for(let a=0;a<z.CODE_PATTERNS.length;a++){const u=z.CODE_PATTERNS[a],h=this.patternMatchVariance(t,u,z.MAX_INDIVIDUAL_VARIANCE);h<r&&(r=h,i=a)}if(i>=0)return i;throw new P}decodeRow(e,t,n){const r=n&&n.get(X.ASSUME_GS1)===!0,i=z.findStartPattern(t),a=i[2];let u=0;const h=new Uint8Array(20);h[u++]=a;let g;switch(a){case z.CODE_START_A:g=z.CODE_CODE_A;break;case z.CODE_START_B:g=z.CODE_CODE_B;break;case z.CODE_START_C:g=z.CODE_CODE_C;break;default:throw new L}let x=!1,y=!1,E="",S=i[0],T=i[1];const v=Int32Array.from([0,0,0,0,0,0]);let R=0,B=0,H=a,W=0,U=!0,pe=!1,he=!1;for(;!x;){const _n=y;switch(y=!1,R=B,B=z.decodeCode(t,v,T),h[u++]=B,B!==z.CODE_STOP&&(U=!0),B!==z.CODE_STOP&&(W++,H+=W*B),S=T,T+=v.reduce((hc,fc)=>hc+fc,0),B){case z.CODE_START_A:case z.CODE_START_B:case z.CODE_START_C:throw new L}switch(g){case z.CODE_CODE_A:if(B<64)he===pe?E+=String.fromCharCode(32+B):E+=String.fromCharCode(32+B+128),he=!1;else if(B<96)he===pe?E+=String.fromCharCode(B-64):E+=String.fromCharCode(B+64),he=!1;else switch(B!==z.CODE_STOP&&(U=!1),B){case z.CODE_FNC_1:r&&(E.length===0?E+="]C1":E+="");break;case z.CODE_FNC_2:case z.CODE_FNC_3:break;case z.CODE_FNC_4_A:!pe&&he?(pe=!0,he=!1):pe&&he?(pe=!1,he=!1):he=!0;break;case z.CODE_SHIFT:y=!0,g=z.CODE_CODE_B;break;case z.CODE_CODE_B:g=z.CODE_CODE_B;break;case z.CODE_CODE_C:g=z.CODE_CODE_C;break;case z.CODE_STOP:x=!0;break}break;case z.CODE_CODE_B:if(B<96)he===pe?E+=String.fromCharCode(32+B):E+=String.fromCharCode(32+B+128),he=!1;else switch(B!==z.CODE_STOP&&(U=!1),B){case z.CODE_FNC_1:r&&(E.length===0?E+="]C1":E+="");break;case z.CODE_FNC_2:case z.CODE_FNC_3:break;case z.CODE_FNC_4_B:!pe&&he?(pe=!0,he=!1):pe&&he?(pe=!1,he=!1):he=!0;break;case z.CODE_SHIFT:y=!0,g=z.CODE_CODE_A;break;case z.CODE_CODE_A:g=z.CODE_CODE_A;break;case z.CODE_CODE_C:g=z.CODE_CODE_C;break;case z.CODE_STOP:x=!0;break}break;case z.CODE_CODE_C:if(B<100)B<10&&(E+="0"),E+=B;else switch(B!==z.CODE_STOP&&(U=!1),B){case z.CODE_FNC_1:r&&(E.length===0?E+="]C1":E+="");break;case z.CODE_CODE_A:g=z.CODE_CODE_A;break;case z.CODE_CODE_B:g=z.CODE_CODE_B;break;case z.CODE_STOP:x=!0;break}break}_n&&(g=g===z.CODE_CODE_A?z.CODE_CODE_B:z.CODE_CODE_A)}const ft=T-S;if(T=t.getNextUnset(T),!t.isRange(T,Math.min(t.getSize(),T+(T-S)/2),!1))throw new P;if(H-=W*R,H%103!==R)throw new D;const vt=E.length;if(vt===0)throw new P;vt>0&&U&&(g===z.CODE_CODE_C?E=E.substring(0,vt-2):E=E.substring(0,vt-1));const gt=(i[1]+i[0])/2,Re=S+ft/2,tt=h.length,mt=new Uint8Array(tt);for(let _n=0;_n<tt;_n++)mt[_n]=h[_n];const Sn=[new ne(gt,e),new ne(Re,e)];return new Qe(E,mt,0,Sn,se.CODE_128,new Date().getTime())}}z.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],z.MAX_AVG_VARIANCE=.25,z.MAX_INDIVIDUAL_VARIANCE=.7,z.CODE_SHIFT=98,z.CODE_CODE_C=99,z.CODE_CODE_B=100,z.CODE_CODE_A=101,z.CODE_FNC_1=102,z.CODE_FNC_2=97,z.CODE_FNC_3=96,z.CODE_FNC_4_A=101,z.CODE_FNC_4_B=100,z.CODE_START_A=103,z.CODE_START_B=104,z.CODE_START_C=105,z.CODE_STOP=106;class Xe extends Ge{constructor(e=!1,t=!1){super(),this.usingCheckDigit=e,this.extendedMode=t,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(e,t,n){let r=this.counters;r.fill(0),this.decodeRowResult="";let i=Xe.findAsteriskPattern(t,r),a=t.getNextSet(i[1]),u=t.getSize(),h,g;do{Xe.recordPattern(t,a,r);let v=Xe.toNarrowWidePattern(r);if(v<0)throw new P;h=Xe.patternToChar(v),this.decodeRowResult+=h,g=a;for(let R of r)a+=R;a=t.getNextSet(a)}while(h!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let x=0;for(let v of r)x+=v;let y=a-g-x;if(a!==u&&y*2<x)throw new P;if(this.usingCheckDigit){let v=this.decodeRowResult.length-1,R=0;for(let B=0;B<v;B++)R+=Xe.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(B));if(this.decodeRowResult.charAt(v)!==Xe.ALPHABET_STRING.charAt(R%43))throw new D;this.decodeRowResult=this.decodeRowResult.substring(0,v)}if(this.decodeRowResult.length===0)throw new P;let E;this.extendedMode?E=Xe.decodeExtended(this.decodeRowResult):E=this.decodeRowResult;let S=(i[1]+i[0])/2,T=g+x/2;return new Qe(E,null,0,[new ne(S,e),new ne(T,e)],se.CODE_39,new Date().getTime())}static findAsteriskPattern(e,t){let n=e.getSize(),r=e.getNextSet(0),i=0,a=r,u=!1,h=t.length;for(let g=r;g<n;g++)if(e.get(g)!==u)t[i]++;else{if(i===h-1){if(this.toNarrowWidePattern(t)===Xe.ASTERISK_ENCODING&&e.isRange(Math.max(0,a-Math.floor((g-a)/2)),a,!1))return[a,g];a+=t[0]+t[1],t.copyWithin(0,2,2+i-1),t[i-1]=0,t[i]=0,i--}else i++;t[i]=1,u=!u}throw new P}static toNarrowWidePattern(e){let t=e.length,n=0,r;do{let i=2147483647;for(let h of e)h<i&&h>n&&(i=h);n=i,r=0;let a=0,u=0;for(let h=0;h<t;h++){let g=e[h];g>n&&(u|=1<<t-1-h,r++,a+=g)}if(r===3){for(let h=0;h<t&&r>0;h++){let g=e[h];if(g>n&&(r--,g*2>=a))return-1}return u}}while(r>3);return-1}static patternToChar(e){for(let t=0;t<Xe.CHARACTER_ENCODINGS.length;t++)if(Xe.CHARACTER_ENCODINGS[t]===e)return Xe.ALPHABET_STRING.charAt(t);if(e===Xe.ASTERISK_ENCODING)return"*";throw new P}static decodeExtended(e){let t=e.length,n="";for(let r=0;r<t;r++){let i=e.charAt(r);if(i==="+"||i==="$"||i==="%"||i==="/"){let a=e.charAt(r+1),u="\0";switch(i){case"+":if(a>="A"&&a<="Z")u=String.fromCharCode(a.charCodeAt(0)+32);else throw new L;break;case"$":if(a>="A"&&a<="Z")u=String.fromCharCode(a.charCodeAt(0)-64);else throw new L;break;case"%":if(a>="A"&&a<="E")u=String.fromCharCode(a.charCodeAt(0)-38);else if(a>="F"&&a<="J")u=String.fromCharCode(a.charCodeAt(0)-11);else if(a>="K"&&a<="O")u=String.fromCharCode(a.charCodeAt(0)+16);else if(a>="P"&&a<="T")u=String.fromCharCode(a.charCodeAt(0)+43);else if(a==="U")u="\0";else if(a==="V")u="@";else if(a==="W")u="`";else if(a==="X"||a==="Y"||a==="Z")u="";else throw new L;break;case"/":if(a>="A"&&a<="O")u=String.fromCharCode(a.charCodeAt(0)-32);else if(a==="Z")u=":";else throw new L;break}n+=u,r++}else n+=i}return n}}Xe.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",Xe.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],Xe.ASTERISK_ENCODING=148;class Te extends Ge{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(e,t,n){let r=this.decodeStart(t),i=this.decodeEnd(t),a=new q;Te.decodeMiddle(t,r[1],i[0],a);let u=a.toString(),h=null;n!=null&&(h=n.get(X.ALLOWED_LENGTHS)),h==null&&(h=Te.DEFAULT_ALLOWED_LENGTHS);let g=u.length,x=!1,y=0;for(let T of h){if(g===T){x=!0;break}T>y&&(y=T)}if(!x&&g>y&&(x=!0),!x)throw new L;const E=[new ne(r[1],e),new ne(i[0],e)];return new Qe(u,null,0,E,se.ITF,new Date().getTime())}static decodeMiddle(e,t,n,r){let i=new Int32Array(10),a=new Int32Array(5),u=new Int32Array(5);for(i.fill(0),a.fill(0),u.fill(0);t<n;){Ge.recordPattern(e,t,i);for(let g=0;g<5;g++){let x=2*g;a[g]=i[x],u[g]=i[x+1]}let h=Te.decodeDigit(a);r.append(h.toString()),h=this.decodeDigit(u),r.append(h.toString()),i.forEach(function(g){t+=g})}}decodeStart(e){let t=Te.skipWhiteSpace(e),n=Te.findGuardPattern(e,t,Te.START_PATTERN);return this.narrowLineWidth=(n[1]-n[0])/4,this.validateQuietZone(e,n[0]),n}validateQuietZone(e,t){let n=this.narrowLineWidth*10;n=n<t?n:t;for(let r=t-1;n>0&&r>=0&&!e.get(r);r--)n--;if(n!==0)throw new P}static skipWhiteSpace(e){const t=e.getSize(),n=e.getNextSet(0);if(n===t)throw new P;return n}decodeEnd(e){e.reverse();try{let t=Te.skipWhiteSpace(e),n;try{n=Te.findGuardPattern(e,t,Te.END_PATTERN_REVERSED[0])}catch(i){i instanceof P&&(n=Te.findGuardPattern(e,t,Te.END_PATTERN_REVERSED[1]))}this.validateQuietZone(e,n[0]);let r=n[0];return n[0]=e.getSize()-n[1],n[1]=e.getSize()-r,n}finally{e.reverse()}}static findGuardPattern(e,t,n){let r=n.length,i=new Int32Array(r),a=e.getSize(),u=!1,h=0,g=t;i.fill(0);for(let x=t;x<a;x++)if(e.get(x)!==u)i[h]++;else{if(h===r-1){if(Ge.patternMatchVariance(i,n,Te.MAX_INDIVIDUAL_VARIANCE)<Te.MAX_AVG_VARIANCE)return[g,x];g+=i[0]+i[1],G.arraycopy(i,2,i,0,h-1),i[h-1]=0,i[h]=0,h--}else h++;i[h]=1,u=!u}throw new P}static decodeDigit(e){let t=Te.MAX_AVG_VARIANCE,n=-1,r=Te.PATTERNS.length;for(let i=0;i<r;i++){let a=Te.PATTERNS[i],u=Ge.patternMatchVariance(e,a,Te.MAX_INDIVIDUAL_VARIANCE);u<t?(t=u,n=i):u===t&&(n=-1)}if(n>=0)return n%10;throw new P}}Te.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],Te.MAX_AVG_VARIANCE=.38,Te.MAX_INDIVIDUAL_VARIANCE=.5,Te.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],Te.START_PATTERN=Int32Array.from([1,1,1,1]),Te.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Le extends Ge{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(e){let t=!1,n,r=0,i=Int32Array.from([0,0,0]);for(;!t;){i=Int32Array.from([0,0,0]),n=Le.findGuardPattern(e,r,!1,this.START_END_PATTERN,i);let a=n[0];r=n[1];let u=a-(r-a);u>=0&&(t=e.isRange(u,a,!1))}return n}static checkChecksum(e){return Le.checkStandardUPCEANChecksum(e)}static checkStandardUPCEANChecksum(e){let t=e.length;if(t===0)return!1;let n=parseInt(e.charAt(t-1),10);return Le.getStandardUPCEANChecksum(e.substring(0,t-1))===n}static getStandardUPCEANChecksum(e){let t=e.length,n=0;for(let r=t-1;r>=0;r-=2){let i=e.charAt(r).charCodeAt(0)-48;if(i<0||i>9)throw new L;n+=i}n*=3;for(let r=t-2;r>=0;r-=2){let i=e.charAt(r).charCodeAt(0)-48;if(i<0||i>9)throw new L;n+=i}return(1e3-n)%10}static decodeEnd(e,t){return Le.findGuardPattern(e,t,!1,Le.START_END_PATTERN,new Int32Array(Le.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(e,t,n,r){return this.findGuardPattern(e,t,n,r,new Int32Array(r.length))}static findGuardPattern(e,t,n,r,i){let a=e.getSize();t=n?e.getNextUnset(t):e.getNextSet(t);let u=0,h=t,g=r.length,x=n;for(let y=t;y<a;y++)if(e.get(y)!==x)i[u]++;else{if(u===g-1){if(Ge.patternMatchVariance(i,r,Le.MAX_INDIVIDUAL_VARIANCE)<Le.MAX_AVG_VARIANCE)return Int32Array.from([h,y]);h+=i[0]+i[1];let E=i.slice(2,i.length-1);for(let S=0;S<u-1;S++)i[S]=E[S];i[u-1]=0,i[u]=0,u--}else u++;i[u]=1,x=!x}throw new P}static decodeDigit(e,t,n,r){this.recordPattern(e,n,t);let i=this.MAX_AVG_VARIANCE,a=-1,u=r.length;for(let h=0;h<u;h++){let g=r[h],x=Ge.patternMatchVariance(t,g,Le.MAX_INDIVIDUAL_VARIANCE);x<i&&(i=x,a=h)}if(a>=0)return a;throw new P}}Le.MAX_AVG_VARIANCE=.48,Le.MAX_INDIVIDUAL_VARIANCE=.7,Le.START_END_PATTERN=Int32Array.from([1,1,1]),Le.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Le.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Le.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class Dn{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(e,t,n){let r=this.decodeRowStringBuffer,i=this.decodeMiddle(t,n,r),a=r.toString(),u=Dn.parseExtensionString(a),h=[new ne((n[0]+n[1])/2,e),new ne(i,e)],g=new Qe(a,null,0,h,se.UPC_EAN_EXTENSION,new Date().getTime());return u!=null&&g.putAllMetadata(u),g}decodeMiddle(e,t,n){let r=this.decodeMiddleCounters;r[0]=0,r[1]=0,r[2]=0,r[3]=0;let i=e.getSize(),a=t[1],u=0;for(let g=0;g<5&&a<i;g++){let x=Le.decodeDigit(e,r,a,Le.L_AND_G_PATTERNS);n+=String.fromCharCode(48+x%10);for(let y of r)a+=y;x>=10&&(u|=1<<4-g),g!==4&&(a=e.getNextSet(a),a=e.getNextUnset(a))}if(n.length!==5)throw new P;let h=this.determineCheckDigit(u);if(Dn.extensionChecksum(n.toString())!==h)throw new P;return a}static extensionChecksum(e){let t=e.length,n=0;for(let r=t-2;r>=0;r-=2)n+=e.charAt(r).charCodeAt(0)-48;n*=3;for(let r=t-1;r>=0;r-=2)n+=e.charAt(r).charCodeAt(0)-48;return n*=3,n%10}determineCheckDigit(e){for(let t=0;t<10;t++)if(e===this.CHECK_DIGIT_ENCODINGS[t])return t;throw new P}static parseExtensionString(e){if(e.length!==5)return null;let t=Dn.parseExtension5String(e);return t==null?null:new Map([[Ie.SUGGESTED_PRICE,t]])}static parseExtension5String(e){let t;switch(e.charAt(0)){case"0":t="Â£";break;case"5":t="$";break;case"9":switch(e){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}t="";break;default:t="";break}let n=parseInt(e.substring(1)),r=(n/100).toString(),i=n%100,a=i<10?"0"+i:i.toString();return t+r+"."+a}}class Ar{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(e,t,n){let r=this.decodeRowStringBuffer,i=this.decodeMiddle(t,n,r),a=r.toString(),u=Ar.parseExtensionString(a),h=[new ne((n[0]+n[1])/2,e),new ne(i,e)],g=new Qe(a,null,0,h,se.UPC_EAN_EXTENSION,new Date().getTime());return u!=null&&g.putAllMetadata(u),g}decodeMiddle(e,t,n){let r=this.decodeMiddleCounters;r[0]=0,r[1]=0,r[2]=0,r[3]=0;let i=e.getSize(),a=t[1],u=0;for(let h=0;h<2&&a<i;h++){let g=Le.decodeDigit(e,r,a,Le.L_AND_G_PATTERNS);n+=String.fromCharCode(48+g%10);for(let x of r)a+=x;g>=10&&(u|=1<<1-h),h!==1&&(a=e.getNextSet(a),a=e.getNextUnset(a))}if(n.length!==2)throw new P;if(parseInt(n.toString())%4!==u)throw new P;return a}static parseExtensionString(e){return e.length!==2?null:new Map([[Ie.ISSUE_NUMBER,parseInt(e)]])}}class Zi{static decodeRow(e,t,n){let r=Le.findGuardPattern(t,n,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new Dn().decodeRow(e,t,r)}catch{return new Ar().decodeRow(e,t,r)}}}Zi.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class ye extends Le{constructor(){super(),this.decodeRowStringBuffer="",ye.L_AND_G_PATTERNS=ye.L_PATTERNS.map(e=>Int32Array.from(e));for(let e=10;e<20;e++){let t=ye.L_PATTERNS[e-10],n=new Int32Array(t.length);for(let r=0;r<t.length;r++)n[r]=t[t.length-r-1];ye.L_AND_G_PATTERNS[e]=n}}decodeRow(e,t,n){let r=ye.findStartGuardPattern(t),i=n==null?null:n.get(X.NEED_RESULT_POINT_CALLBACK);if(i!=null){const U=new ne((r[0]+r[1])/2,e);i.foundPossibleResultPoint(U)}let a=this.decodeMiddle(t,r,this.decodeRowStringBuffer),u=a.rowOffset,h=a.resultString;if(i!=null){const U=new ne(u,e);i.foundPossibleResultPoint(U)}let g=this.decodeEnd(t,u);if(i!=null){const U=new ne((g[0]+g[1])/2,e);i.foundPossibleResultPoint(U)}let x=g[1],y=x+(x-g[0]);if(y>=t.getSize()||!t.isRange(x,y,!1))throw new P;let E=h.toString();if(E.length<8)throw new L;if(!ye.checkChecksum(E))throw new D;let S=(r[1]+r[0])/2,T=(g[1]+g[0])/2,v=this.getBarcodeFormat(),R=[new ne(S,e),new ne(T,e)],B=new Qe(E,null,0,R,v,new Date().getTime()),H=0;try{let U=Zi.decodeRow(e,t,g[1]);B.putMetadata(Ie.UPC_EAN_EXTENSION,U.getText()),B.putAllMetadata(U.getResultMetadata()),B.addResultPoints(U.getResultPoints()),H=U.getText().length}catch{}let W=n==null?null:n.get(X.ALLOWED_EAN_EXTENSIONS);if(W!=null){let U=!1;for(let pe in W)if(H.toString()===pe){U=!0;break}if(!U)throw new P}return B}decodeEnd(e,t){return ye.findGuardPattern(e,t,!1,ye.START_END_PATTERN,new Int32Array(ye.START_END_PATTERN.length).fill(0))}static checkChecksum(e){return ye.checkStandardUPCEANChecksum(e)}static checkStandardUPCEANChecksum(e){let t=e.length;if(t===0)return!1;let n=parseInt(e.charAt(t-1),10);return ye.getStandardUPCEANChecksum(e.substring(0,t-1))===n}static getStandardUPCEANChecksum(e){let t=e.length,n=0;for(let r=t-1;r>=0;r-=2){let i=e.charAt(r).charCodeAt(0)-48;if(i<0||i>9)throw new L;n+=i}n*=3;for(let r=t-2;r>=0;r-=2){let i=e.charAt(r).charCodeAt(0)-48;if(i<0||i>9)throw new L;n+=i}return(1e3-n)%10}}class rn extends ye{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(e,t,n){let r=this.decodeMiddleCounters;r[0]=0,r[1]=0,r[2]=0,r[3]=0;let i=e.getSize(),a=t[1],u=0;for(let g=0;g<6&&a<i;g++){let x=ye.decodeDigit(e,r,a,ye.L_AND_G_PATTERNS);n+=String.fromCharCode(48+x%10);for(let y of r)a+=y;x>=10&&(u|=1<<5-g)}n=rn.determineFirstDigit(n,u),a=ye.findGuardPattern(e,a,!0,ye.MIDDLE_PATTERN,new Int32Array(ye.MIDDLE_PATTERN.length).fill(0))[1];for(let g=0;g<6&&a<i;g++){let x=ye.decodeDigit(e,r,a,ye.L_PATTERNS);n+=String.fromCharCode(48+x);for(let y of r)a+=y}return{rowOffset:a,resultString:n}}getBarcodeFormat(){return se.EAN_13}static determineFirstDigit(e,t){for(let n=0;n<10;n++)if(t===this.FIRST_DIGIT_ENCODINGS[n])return e=String.fromCharCode(48+n)+e,e;throw new P}}rn.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class Ki extends ye{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(e,t,n){const r=this.decodeMiddleCounters;r[0]=0,r[1]=0,r[2]=0,r[3]=0;let i=e.getSize(),a=t[1];for(let h=0;h<4&&a<i;h++){let g=ye.decodeDigit(e,r,a,ye.L_PATTERNS);n+=String.fromCharCode(48+g);for(let x of r)a+=x}a=ye.findGuardPattern(e,a,!0,ye.MIDDLE_PATTERN,new Int32Array(ye.MIDDLE_PATTERN.length).fill(0))[1];for(let h=0;h<4&&a<i;h++){let g=ye.decodeDigit(e,r,a,ye.L_PATTERNS);n+=String.fromCharCode(48+g);for(let x of r)a+=x}return{rowOffset:a,resultString:n}}getBarcodeFormat(){return se.EAN_8}}class Qi extends ye{constructor(){super(...arguments),this.ean13Reader=new rn}getBarcodeFormat(){return se.UPC_A}decode(e,t){return this.maybeReturnResult(this.ean13Reader.decode(e))}decodeRow(e,t,n){return this.maybeReturnResult(this.ean13Reader.decodeRow(e,t,n))}decodeMiddle(e,t,n){return this.ean13Reader.decodeMiddle(e,t,n)}maybeReturnResult(e){let t=e.getText();if(t.charAt(0)==="0"){let n=new Qe(t.substring(1),null,null,e.getResultPoints(),se.UPC_A);return e.getResultMetadata()!=null&&n.putAllMetadata(e.getResultMetadata()),n}else throw new P}reset(){this.ean13Reader.reset()}}class Tt extends ye{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(e,t,n){const r=this.decodeMiddleCounters.map(g=>g);r[0]=0,r[1]=0,r[2]=0,r[3]=0;const i=e.getSize();let a=t[1],u=0;for(let g=0;g<6&&a<i;g++){const x=Tt.decodeDigit(e,r,a,Tt.L_AND_G_PATTERNS);n+=String.fromCharCode(48+x%10);for(let y of r)a+=y;x>=10&&(u|=1<<5-g)}let h=Tt.determineNumSysAndCheckDigit(n,u);return{rowOffset:a,resultString:h}}decodeEnd(e,t){return Tt.findGuardPatternWithoutCounters(e,t,!0,Tt.MIDDLE_END_PATTERN)}checkChecksum(e){return ye.checkChecksum(Tt.convertUPCEtoUPCA(e))}static determineNumSysAndCheckDigit(e,t){for(let n=0;n<=1;n++)for(let r=0;r<10;r++)if(t===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[n][r]){let i=String.fromCharCode(48+n),a=String.fromCharCode(48+r);return i+e+a}throw P.getNotFoundInstance()}getBarcodeFormat(){return se.UPC_E}static convertUPCEtoUPCA(e){const t=e.slice(1,7).split("").map(i=>i.charCodeAt(0)),n=new q;n.append(e.charAt(0));let r=t[5];switch(r){case 0:case 1:case 2:n.appendChars(t,0,2),n.append(r),n.append("0000"),n.appendChars(t,2,3);break;case 3:n.appendChars(t,0,3),n.append("00000"),n.appendChars(t,3,2);break;case 4:n.appendChars(t,0,4),n.append("00000"),n.append(t[4]);break;default:n.appendChars(t,0,5),n.append("0000"),n.append(r);break}return e.length>=8&&n.append(e.charAt(7)),n.toString()}}Tt.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Tt.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class Ir extends Ge{constructor(e){super();let t=e==null?null:e.get(X.POSSIBLE_FORMATS),n=[];c(t)?(n.push(new rn),n.push(new Qi),n.push(new Ki),n.push(new Tt)):(t.indexOf(se.EAN_13)>-1&&n.push(new rn),t.indexOf(se.UPC_A)>-1&&n.push(new Qi),t.indexOf(se.EAN_8)>-1&&n.push(new Ki),t.indexOf(se.UPC_E)>-1&&n.push(new Tt)),this.readers=n}decodeRow(e,t,n){for(let r of this.readers)try{const i=r.decodeRow(e,t,n),a=i.getBarcodeFormat()===se.EAN_13&&i.getText().charAt(0)==="0",u=n==null?null:n.get(X.POSSIBLE_FORMATS),h=u==null||u.includes(se.UPC_A);if(a&&h){const g=i.getRawBytes(),x=new Qe(i.getText().substring(1),g,g?g.length:null,i.getResultPoints(),se.UPC_A);return x.putAllMetadata(i.getResultMetadata()),x}return i}catch{}throw new P}reset(){for(let e of this.readers)e.reset()}}class nt extends Ge{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(e,t){for(let n=0;n<t.length;n++)if(Ge.patternMatchVariance(e,t[n],nt.MAX_INDIVIDUAL_VARIANCE)<nt.MAX_AVG_VARIANCE)return n;throw new P}static count(e){return me.sum(new Int32Array(e))}static increment(e,t){let n=0,r=t[0];for(let i=1;i<e.length;i++)t[i]>r&&(r=t[i],n=i);e[n]++}static decrement(e,t){let n=0,r=t[0];for(let i=1;i<e.length;i++)t[i]<r&&(r=t[i],n=i);e[n]--}static isFinderPattern(e){let t=e[0]+e[1],n=t+e[2]+e[3],r=t/n;if(r>=nt.MIN_FINDER_PATTERN_RATIO&&r<=nt.MAX_FINDER_PATTERN_RATIO){let i=Number.MAX_SAFE_INTEGER,a=Number.MIN_SAFE_INTEGER;for(let u of e)u>a&&(a=u),u<i&&(i=u);return a<10*i}return!1}}nt.MAX_AVG_VARIANCE=.2,nt.MAX_INDIVIDUAL_VARIANCE=.45,nt.MIN_FINDER_PATTERN_RATIO=9.5/12,nt.MAX_FINDER_PATTERN_RATIO=12.5/14;class wn{constructor(e,t){this.value=e,this.checksumPortion=t}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(e){if(!(e instanceof wn))return!1;const t=e;return this.value===t.value&&this.checksumPortion===t.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Qn{constructor(e,t,n,r,i){this.value=e,this.startEnd=t,this.value=e,this.startEnd=t,this.resultPoints=new Array,this.resultPoints.push(new ne(n,i)),this.resultPoints.push(new ne(r,i))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(e){if(!(e instanceof Qn))return!1;const t=e;return this.value===t.value}hashCode(){return this.value}}class Ot{constructor(){}static getRSSvalue(e,t,n){let r=0;for(let h of e)r+=h;let i=0,a=0,u=e.length;for(let h=0;h<u-1;h++){let g;for(g=1,a|=1<<h;g<e[h];g++,a&=~(1<<h)){let x=Ot.combins(r-g-1,u-h-2);if(n&&a===0&&r-g-(u-h-1)>=u-h-1&&(x-=Ot.combins(r-g-(u-h),u-h-2)),u-h-1>1){let y=0;for(let E=r-g-(u-h-2);E>t;E--)y+=Ot.combins(r-g-E-1,u-h-3);x-=y*(u-1-h)}else r-g>t&&x--;i+=x}r-=g}return i}static combins(e,t){let n,r;e-t>t?(r=t,n=e-t):(r=e-t,n=t);let i=1,a=1;for(let u=e;u>n;u--)i*=u,a<=r&&(i/=a,a++);for(;a<=r;)i/=a,a++;return i}}class Fa{static buildBitArray(e){let t=e.length*2-1;e[e.length-1].getRightChar()==null&&(t-=1);let n=12*t,r=new K(n),i=0,u=e[0].getRightChar().getValue();for(let h=11;h>=0;--h)(u&1<<h)!=0&&r.set(i),i++;for(let h=1;h<e.length;++h){let g=e[h],x=g.getLeftChar().getValue();for(let y=11;y>=0;--y)(x&1<<y)!=0&&r.set(i),i++;if(g.getRightChar()!=null){let y=g.getRightChar().getValue();for(let E=11;E>=0;--E)(y&1<<E)!=0&&r.set(i),i++}}return r}}class sn{constructor(e,t){t?this.decodedInformation=null:(this.finished=e,this.decodedInformation=t)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Sr{constructor(e){this.newPosition=e}getNewPosition(){return this.newPosition}}class ut extends Sr{constructor(e,t){super(e),this.value=t}getValue(){return this.value}isFNC1(){return this.value===ut.FNC1}}ut.FNC1="$";class on extends Sr{constructor(e,t,n){super(e),n?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=t}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class bt extends Sr{constructor(e,t,n){if(super(e),t<0||t>10||n<0||n>10)throw new L;this.firstDigit=t,this.secondDigit=n}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===bt.FNC1}isSecondDigitFNC1(){return this.secondDigit===bt.FNC1}isAnyFNC1(){return this.firstDigit===bt.FNC1||this.secondDigit===bt.FNC1}}bt.FNC1=10;class Q{constructor(){}static parseFieldsInGeneralPurpose(e){if(!e)return null;if(e.length<2)throw new P;let t=e.substring(0,2);for(let i of Q.TWO_DIGIT_DATA_LENGTH)if(i[0]===t)return i[1]===Q.VARIABLE_LENGTH?Q.processVariableAI(2,i[2],e):Q.processFixedAI(2,i[1],e);if(e.length<3)throw new P;let n=e.substring(0,3);for(let i of Q.THREE_DIGIT_DATA_LENGTH)if(i[0]===n)return i[1]===Q.VARIABLE_LENGTH?Q.processVariableAI(3,i[2],e):Q.processFixedAI(3,i[1],e);for(let i of Q.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(i[0]===n)return i[1]===Q.VARIABLE_LENGTH?Q.processVariableAI(4,i[2],e):Q.processFixedAI(4,i[1],e);if(e.length<4)throw new P;let r=e.substring(0,4);for(let i of Q.FOUR_DIGIT_DATA_LENGTH)if(i[0]===r)return i[1]===Q.VARIABLE_LENGTH?Q.processVariableAI(4,i[2],e):Q.processFixedAI(4,i[1],e);throw new P}static processFixedAI(e,t,n){if(n.length<e)throw new P;let r=n.substring(0,e);if(n.length<e+t)throw new P;let i=n.substring(e,e+t),a=n.substring(e+t),u="("+r+")"+i,h=Q.parseFieldsInGeneralPurpose(a);return h==null?u:u+h}static processVariableAI(e,t,n){let r=n.substring(0,e),i;n.length<e+t?i=n.length:i=e+t;let a=n.substring(e,i),u=n.substring(i),h="("+r+")"+a,g=Q.parseFieldsInGeneralPurpose(u);return g==null?h:h+g}}Q.VARIABLE_LENGTH=[],Q.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",Q.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",Q.VARIABLE_LENGTH,20],["22",Q.VARIABLE_LENGTH,29],["30",Q.VARIABLE_LENGTH,8],["37",Q.VARIABLE_LENGTH,8],["90",Q.VARIABLE_LENGTH,30],["91",Q.VARIABLE_LENGTH,30],["92",Q.VARIABLE_LENGTH,30],["93",Q.VARIABLE_LENGTH,30],["94",Q.VARIABLE_LENGTH,30],["95",Q.VARIABLE_LENGTH,30],["96",Q.VARIABLE_LENGTH,30],["97",Q.VARIABLE_LENGTH,3],["98",Q.VARIABLE_LENGTH,30],["99",Q.VARIABLE_LENGTH,30]],Q.THREE_DIGIT_DATA_LENGTH=[["240",Q.VARIABLE_LENGTH,30],["241",Q.VARIABLE_LENGTH,30],["242",Q.VARIABLE_LENGTH,6],["250",Q.VARIABLE_LENGTH,30],["251",Q.VARIABLE_LENGTH,30],["253",Q.VARIABLE_LENGTH,17],["254",Q.VARIABLE_LENGTH,20],["400",Q.VARIABLE_LENGTH,30],["401",Q.VARIABLE_LENGTH,30],["402",17],["403",Q.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",Q.VARIABLE_LENGTH,20],["421",Q.VARIABLE_LENGTH,15],["422",3],["423",Q.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],Q.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",Q.VARIABLE_LENGTH,15],["391",Q.VARIABLE_LENGTH,18],["392",Q.VARIABLE_LENGTH,15],["393",Q.VARIABLE_LENGTH,18],["703",Q.VARIABLE_LENGTH,30]],Q.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",Q.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",Q.VARIABLE_LENGTH,20],["8003",Q.VARIABLE_LENGTH,30],["8004",Q.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",Q.VARIABLE_LENGTH,30],["8008",Q.VARIABLE_LENGTH,12],["8018",18],["8020",Q.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",Q.VARIABLE_LENGTH,70],["8200",Q.VARIABLE_LENGTH,70]];class Cn{constructor(e){this.buffer=new q,this.information=e}decodeAllCodes(e,t){let n=t,r=null;do{let i=this.decodeGeneralPurposeField(n,r),a=Q.parseFieldsInGeneralPurpose(i.getNewString());if(a!=null&&e.append(a),i.isRemaining()?r=""+i.getRemainingValue():r=null,n===i.getNewPosition())break;n=i.getNewPosition()}while(!0);return e.toString()}isStillNumeric(e){if(e+7>this.information.getSize())return e+4<=this.information.getSize();for(let t=e;t<e+3;++t)if(this.information.get(t))return!0;return this.information.get(e+3)}decodeNumeric(e){if(e+7>this.information.getSize()){let i=this.extractNumericValueFromBitArray(e,4);return i===0?new bt(this.information.getSize(),bt.FNC1,bt.FNC1):new bt(this.information.getSize(),i-1,bt.FNC1)}let t=this.extractNumericValueFromBitArray(e,7),n=(t-8)/11,r=(t-8)%11;return new bt(e+7,n,r)}extractNumericValueFromBitArray(e,t){return Cn.extractNumericValueFromBitArray(this.information,e,t)}static extractNumericValueFromBitArray(e,t,n){let r=0;for(let i=0;i<n;++i)e.get(t+i)&&(r|=1<<n-i-1);return r}decodeGeneralPurposeField(e,t){this.buffer.setLengthToZero(),t!=null&&this.buffer.append(t),this.current.setPosition(e);let n=this.parseBlocks();return n!=null&&n.isRemaining()?new on(this.current.getPosition(),this.buffer.toString(),n.getRemainingValue()):new on(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let e,t;do{let n=this.current.getPosition();if(this.current.isAlpha()?(t=this.parseAlphaBlock(),e=t.isFinished()):this.current.isIsoIec646()?(t=this.parseIsoIec646Block(),e=t.isFinished()):(t=this.parseNumericBlock(),e=t.isFinished()),!(n!==this.current.getPosition())&&!e)break}while(!e);return t.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let e=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFirstDigitFNC1()){let t;return e.isSecondDigitFNC1()?t=new on(this.current.getPosition(),this.buffer.toString()):t=new on(this.current.getPosition(),this.buffer.toString(),e.getSecondDigit()),new sn(!0,t)}if(this.buffer.append(e.getFirstDigit()),e.isSecondDigitFNC1()){let t=new on(this.current.getPosition(),this.buffer.toString());return new sn(!0,t)}this.buffer.append(e.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new sn(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let e=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){let t=new on(this.current.getPosition(),this.buffer.toString());return new sn(!0,t)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new sn(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let e=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){let t=new on(this.current.getPosition(),this.buffer.toString());return new sn(!0,t)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new sn(!1)}isStillIsoIec646(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+7>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(e,7);if(n>=64&&n<116)return!0;if(e+8>this.information.getSize())return!1;let r=this.extractNumericValueFromBitArray(e,8);return r>=232&&r<253}decodeIsoIec646(e){let t=this.extractNumericValueFromBitArray(e,5);if(t===15)return new ut(e+5,ut.FNC1);if(t>=5&&t<15)return new ut(e+5,"0"+(t-5));let n=this.extractNumericValueFromBitArray(e,7);if(n>=64&&n<90)return new ut(e+7,""+(n+1));if(n>=90&&n<116)return new ut(e+7,""+(n+7));let r=this.extractNumericValueFromBitArray(e,8),i;switch(r){case 232:i="!";break;case 233:i='"';break;case 234:i="%";break;case 235:i="&";break;case 236:i="'";break;case 237:i="(";break;case 238:i=")";break;case 239:i="*";break;case 240:i="+";break;case 241:i=",";break;case 242:i="-";break;case 243:i=".";break;case 244:i="/";break;case 245:i=":";break;case 246:i=";";break;case 247:i="<";break;case 248:i="=";break;case 249:i=">";break;case 250:i="?";break;case 251:i="_";break;case 252:i=" ";break;default:throw new L}return new ut(e+8,i)}isStillAlpha(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+6>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(e,6);return n>=16&&n<63}decodeAlphanumeric(e){let t=this.extractNumericValueFromBitArray(e,5);if(t===15)return new ut(e+5,ut.FNC1);if(t>=5&&t<15)return new ut(e+5,"0"+(t-5));let n=this.extractNumericValueFromBitArray(e,6);if(n>=32&&n<58)return new ut(e+6,""+(n+33));let r;switch(n){case 58:r="*";break;case 59:r=",";break;case 60:r="-";break;case 61:r=".";break;case 62:r="/";break;default:throw new Nt("Decoding invalid alphanumeric value: "+n)}return new ut(e+6,r)}isAlphaTo646ToAlphaLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<5&&t+e<this.information.getSize();++t)if(t===2){if(!this.information.get(e+2))return!1}else if(this.information.get(e+t))return!1;return!0}isAlphaOr646ToNumericLatch(e){if(e+3>this.information.getSize())return!1;for(let t=e;t<e+3;++t)if(this.information.get(t))return!1;return!0}isNumericToAlphaNumericLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<4&&t+e<this.information.getSize();++t)if(this.information.get(e+t))return!1;return!0}}class _r{constructor(e){this.information=e,this.generalDecoder=new Cn(e)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class dt extends _r{constructor(e){super(e)}encodeCompressedGtin(e,t){e.append("(01)");let n=e.length();e.append("9"),this.encodeCompressedGtinWithoutAI(e,t,n)}encodeCompressedGtinWithoutAI(e,t,n){for(let r=0;r<4;++r){let i=this.getGeneralDecoder().extractNumericValueFromBitArray(t+10*r,10);i/100===0&&e.append("0"),i/10===0&&e.append("0"),e.append(i)}dt.appendCheckDigit(e,n)}static appendCheckDigit(e,t){let n=0;for(let r=0;r<13;r++){let i=e.charAt(r+t).charCodeAt(0)-48;n+=(r&1)===0?3*i:i}n=10-n%10,n===10&&(n=0),e.append(n)}}dt.GTIN_SIZE=40;class yn extends dt{constructor(e){super(e)}parseInformation(){let e=new q;e.append("(01)");let t=e.length(),n=this.getGeneralDecoder().extractNumericValueFromBitArray(yn.HEADER_SIZE,4);return e.append(n),this.encodeCompressedGtinWithoutAI(e,yn.HEADER_SIZE+4,t),this.getGeneralDecoder().decodeAllCodes(e,yn.HEADER_SIZE+44)}}yn.HEADER_SIZE=4;class Jn extends _r{constructor(e){super(e)}parseInformation(){let e=new q;return this.getGeneralDecoder().decodeAllCodes(e,Jn.HEADER_SIZE)}}Jn.HEADER_SIZE=5;class $n extends dt{constructor(e){super(e)}encodeCompressedWeight(e,t,n){let r=this.getGeneralDecoder().extractNumericValueFromBitArray(t,n);this.addWeightCode(e,r);let i=this.checkWeight(r),a=1e5;for(let u=0;u<5;++u)i/a===0&&e.append("0"),a/=10;e.append(i)}}class Dt extends $n{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()!=Dt.HEADER_SIZE+$n.GTIN_SIZE+Dt.WEIGHT_SIZE)throw new P;let e=new q;return this.encodeCompressedGtin(e,Dt.HEADER_SIZE),this.encodeCompressedWeight(e,Dt.HEADER_SIZE+$n.GTIN_SIZE,Dt.WEIGHT_SIZE),e.toString()}}Dt.HEADER_SIZE=5,Dt.WEIGHT_SIZE=15;class Ua extends Dt{constructor(e){super(e)}addWeightCode(e,t){e.append("(3103)")}checkWeight(e){return e}}class Va extends Dt{constructor(e){super(e)}addWeightCode(e,t){t<1e4?e.append("(3202)"):e.append("(3203)")}checkWeight(e){return e<1e4?e:e-1e4}}class Mt extends dt{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()<Mt.HEADER_SIZE+dt.GTIN_SIZE)throw new P;let e=new q;this.encodeCompressedGtin(e,Mt.HEADER_SIZE);let t=this.getGeneralDecoder().extractNumericValueFromBitArray(Mt.HEADER_SIZE+dt.GTIN_SIZE,Mt.LAST_DIGIT_SIZE);e.append("(392"),e.append(t),e.append(")");let n=this.getGeneralDecoder().decodeGeneralPurposeField(Mt.HEADER_SIZE+dt.GTIN_SIZE+Mt.LAST_DIGIT_SIZE,null);return e.append(n.getNewString()),e.toString()}}Mt.HEADER_SIZE=8,Mt.LAST_DIGIT_SIZE=2;class at extends dt{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()<at.HEADER_SIZE+dt.GTIN_SIZE)throw new P;let e=new q;this.encodeCompressedGtin(e,at.HEADER_SIZE);let t=this.getGeneralDecoder().extractNumericValueFromBitArray(at.HEADER_SIZE+dt.GTIN_SIZE,at.LAST_DIGIT_SIZE);e.append("(393"),e.append(t),e.append(")");let n=this.getGeneralDecoder().extractNumericValueFromBitArray(at.HEADER_SIZE+dt.GTIN_SIZE+at.LAST_DIGIT_SIZE,at.FIRST_THREE_DIGITS_SIZE);n/100==0&&e.append("0"),n/10==0&&e.append("0"),e.append(n);let r=this.getGeneralDecoder().decodeGeneralPurposeField(at.HEADER_SIZE+dt.GTIN_SIZE+at.LAST_DIGIT_SIZE+at.FIRST_THREE_DIGITS_SIZE,null);return e.append(r.getNewString()),e.toString()}}at.HEADER_SIZE=8,at.LAST_DIGIT_SIZE=2,at.FIRST_THREE_DIGITS_SIZE=10;class Be extends $n{constructor(e,t,n){super(e),this.dateCode=n,this.firstAIdigits=t}parseInformation(){if(this.getInformation().getSize()!=Be.HEADER_SIZE+Be.GTIN_SIZE+Be.WEIGHT_SIZE+Be.DATE_SIZE)throw new P;let e=new q;return this.encodeCompressedGtin(e,Be.HEADER_SIZE),this.encodeCompressedWeight(e,Be.HEADER_SIZE+Be.GTIN_SIZE,Be.WEIGHT_SIZE),this.encodeCompressedDate(e,Be.HEADER_SIZE+Be.GTIN_SIZE+Be.WEIGHT_SIZE),e.toString()}encodeCompressedDate(e,t){let n=this.getGeneralDecoder().extractNumericValueFromBitArray(t,Be.DATE_SIZE);if(n==38400)return;e.append("("),e.append(this.dateCode),e.append(")");let r=n%32;n/=32;let i=n%12+1;n/=12;let a=n;a/10==0&&e.append("0"),e.append(a),i/10==0&&e.append("0"),e.append(i),r/10==0&&e.append("0"),e.append(r)}addWeightCode(e,t){e.append("("),e.append(this.firstAIdigits),e.append(t/1e5),e.append(")")}checkWeight(e){return e%1e5}}Be.HEADER_SIZE=8,Be.WEIGHT_SIZE=20,Be.DATE_SIZE=16;function Ji(C){try{if(C.get(1))return new yn(C);if(!C.get(2))return new Jn(C);switch(Cn.extractNumericValueFromBitArray(C,1,4)){case 4:return new Ua(C);case 5:return new Va(C)}switch(Cn.extractNumericValueFromBitArray(C,1,5)){case 12:return new Mt(C);case 13:return new at(C)}switch(Cn.extractNumericValueFromBitArray(C,1,7)){case 56:return new Be(C,"310","11");case 57:return new Be(C,"320","11");case 58:return new Be(C,"310","13");case 59:return new Be(C,"320","13");case 60:return new Be(C,"310","15");case 61:return new Be(C,"320","15");case 62:return new Be(C,"310","17");case 63:return new Be(C,"320","17")}}catch(e){throw console.log(e),new Nt("unknown decoder: "+C)}}class Xt{constructor(e,t,n,r){this.leftchar=e,this.rightchar=t,this.finderpattern=n,this.maybeLast=r}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(e,t){return e instanceof Xt?Xt.equalsOrNull(e.leftchar,t.leftchar)&&Xt.equalsOrNull(e.rightchar,t.rightchar)&&Xt.equalsOrNull(e.finderpattern,t.finderpattern):!1}static equalsOrNull(e,t){return e===null?t===null:Xt.equals(e,t)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class Tr{constructor(e,t,n){this.pairs=e,this.rowNumber=t,this.wasReversed=n}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(e){return this.checkEqualitity(this,e)}toString(){return"{ "+this.pairs+" }"}equals(e,t){return e instanceof Tr?this.checkEqualitity(e,t)&&e.wasReversed===t.wasReversed:!1}checkEqualitity(e,t){if(!e||!t)return;let n;return e.forEach((r,i)=>{t.forEach(a=>{r.getLeftChar().getValue()===a.getLeftChar().getValue()&&r.getRightChar().getValue()===a.getRightChar().getValue()&&r.getFinderPatter().getValue()===a.getFinderPatter().getValue()&&(n=!0)})}),n}}class F extends nt{constructor(e){super(...arguments),this.pairs=new Array(F.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=e===!0}decodeRow(e,t,n){this.pairs.length=0,this.startFromEven=!1;try{return F.constructResult(this.decodeRow2pairs(e,t))}catch(r){this.verbose&&console.log(r)}return this.pairs.length=0,this.startFromEven=!0,F.constructResult(this.decodeRow2pairs(e,t))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(e,t){let n=!1;for(;!n;)try{this.pairs.push(this.retrieveNextPair(t,this.pairs,e))}catch(i){if(i instanceof P){if(!this.pairs.length)throw new P;n=!0}}if(this.checkChecksum())return this.pairs;let r;if(this.rows.length?r=!0:r=!1,this.storeRow(e,!1),r){let i=this.checkRowsBoolean(!1);if(i!=null||(i=this.checkRowsBoolean(!0),i!=null))return i}throw new P}checkRowsBoolean(e){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,e&&(this.rows=this.rows.reverse());let t=null;try{t=this.checkRows(new Array,0)}catch(n){this.verbose&&console.log(n)}return e&&(this.rows=this.rows.reverse()),t}checkRows(e,t){for(let n=t;n<this.rows.length;n++){let r=this.rows[n];this.pairs.length=0;for(let a of e)this.pairs.push(a.getPairs());if(this.pairs.push(r.getPairs()),!F.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let i=new Array(e);i.push(r);try{return this.checkRows(i,n+1)}catch(a){this.verbose&&console.log(a)}}throw new P}static isValidSequence(e){for(let t of F.FINDER_PATTERN_SEQUENCES){if(e.length>t.length)continue;let n=!0;for(let r=0;r<e.length;r++)if(e[r].getFinderPattern().getValue()!=t[r]){n=!1;break}if(n)return!0}return!1}storeRow(e,t){let n=0,r=!1,i=!1;for(;n<this.rows.length;){let a=this.rows[n];if(a.getRowNumber()>e){i=a.isEquivalent(this.pairs);break}r=a.isEquivalent(this.pairs),n++}i||r||F.isPartialRow(this.pairs,this.rows)||(this.rows.push(n,new Tr(this.pairs,e,t)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(e,t){for(let n of t)if(n.getPairs().length!==e.length){for(let r of n.getPairs())for(let i of e)if(Xt.equals(r,i))break}}static isPartialRow(e,t){for(let n of t){let r=!0;for(let i of e){let a=!1;for(let u of n.getPairs())if(i.equals(u)){a=!0;break}if(!a){r=!1;break}}if(r)return!0}return!1}getRows(){return this.rows}static constructResult(e){let t=Fa.buildBitArray(e),r=Ji(t).parseInformation(),i=e[0].getFinderPattern().getResultPoints(),a=e[e.length-1].getFinderPattern().getResultPoints(),u=[i[0],i[1],a[0],a[1]];return new Qe(r,null,null,u,se.RSS_EXPANDED,null)}checkChecksum(){let e=this.pairs.get(0),t=e.getLeftChar(),n=e.getRightChar();if(n==null)return!1;let r=n.getChecksumPortion(),i=2;for(let u=1;u<this.pairs.size();++u){let h=this.pairs.get(u);r+=h.getLeftChar().getChecksumPortion(),i++;let g=h.getRightChar();g!=null&&(r+=g.getChecksumPortion(),i++)}return r%=211,211*(i-4)+r==t.getValue()}static getNextSecondBar(e,t){let n;return e.get(t)?(n=e.getNextUnset(t),n=e.getNextSet(n)):(n=e.getNextSet(t),n=e.getNextUnset(n)),n}retrieveNextPair(e,t,n){let r=t.length%2==0;this.startFromEven&&(r=!r);let i,a=!0,u=-1;do this.findNextPair(e,t,u),i=this.parseFoundFinderPattern(e,n,r),i==null?u=F.getNextSecondBar(e,this.startEnd[0]):a=!1;while(a);let h=this.decodeDataCharacter(e,i,r,!0);if(!this.isEmptyPair(t)&&t[t.length-1].mustBeLast())throw new P;let g;try{g=this.decodeDataCharacter(e,i,r,!1)}catch(x){g=null,this.verbose&&console.log(x)}return new Xt(h,g,i,!0)}isEmptyPair(e){return e.length===0}findNextPair(e,t,n){let r=this.getDecodeFinderCounters();r[0]=0,r[1]=0,r[2]=0,r[3]=0;let i=e.getSize(),a;n>=0?a=n:this.isEmptyPair(t)?a=0:a=t[t.length-1].getFinderPattern().getStartEnd()[1];let u=t.length%2!=0;this.startFromEven&&(u=!u);let h=!1;for(;a<i&&(h=!e.get(a),!!h);)a++;let g=0,x=a;for(let y=a;y<i;y++)if(e.get(y)!=h)r[g]++;else{if(g==3){if(u&&F.reverseCounters(r),F.isFinderPattern(r)){this.startEnd[0]=x,this.startEnd[1]=y;return}u&&F.reverseCounters(r),x+=r[0]+r[1],r[0]=r[2],r[1]=r[3],r[2]=0,r[3]=0,g--}else g++;r[g]=1,h=!h}throw new P}static reverseCounters(e){let t=e.length;for(let n=0;n<t/2;++n){let r=e[n];e[n]=e[t-n-1],e[t-n-1]=r}}parseFoundFinderPattern(e,t,n){let r,i,a;if(n){let g=this.startEnd[0]-1;for(;g>=0&&!e.get(g);)g--;g++,r=this.startEnd[0]-g,i=g,a=this.startEnd[1]}else i=this.startEnd[0],a=e.getNextUnset(this.startEnd[1]+1),r=a-this.startEnd[1];let u=this.getDecodeFinderCounters();G.arraycopy(u,0,u,1,u.length-1),u[0]=r;let h;try{h=this.parseFinderValue(u,F.FINDER_PATTERNS)}catch{return null}return new Qn(h,[i,a],i,a,t)}decodeDataCharacter(e,t,n,r){let i=this.getDataCharacterCounters();for(let Re=0;Re<i.length;Re++)i[Re]=0;if(r)F.recordPatternInReverse(e,t.getStartEnd()[0],i);else{F.recordPattern(e,t.getStartEnd()[1],i);for(let Re=0,tt=i.length-1;Re<tt;Re++,tt--){let mt=i[Re];i[Re]=i[tt],i[tt]=mt}}let a=17,u=me.sum(new Int32Array(i))/a,h=(t.getStartEnd()[1]-t.getStartEnd()[0])/15;if(Math.abs(u-h)/h>.3)throw new P;let g=this.getOddCounts(),x=this.getEvenCounts(),y=this.getOddRoundingErrors(),E=this.getEvenRoundingErrors();for(let Re=0;Re<i.length;Re++){let tt=1*i[Re]/u,mt=tt+.5;if(mt<1){if(tt<.3)throw new P;mt=1}else if(mt>8){if(tt>8.7)throw new P;mt=8}let Sn=Re/2;(Re&1)==0?(g[Sn]=mt,y[Sn]=tt-mt):(x[Sn]=mt,E[Sn]=tt-mt)}this.adjustOddEvenCounts(a);let S=4*t.getValue()+(n?0:2)+(r?0:1)-1,T=0,v=0;for(let Re=g.length-1;Re>=0;Re--){if(F.isNotA1left(t,n,r)){let tt=F.WEIGHTS[S][2*Re];v+=g[Re]*tt}T+=g[Re]}let R=0;for(let Re=x.length-1;Re>=0;Re--)if(F.isNotA1left(t,n,r)){let tt=F.WEIGHTS[S][2*Re+1];R+=x[Re]*tt}let B=v+R;if((T&1)!=0||T>13||T<4)throw new P;let H=(13-T)/2,W=F.SYMBOL_WIDEST[H],U=9-W,pe=Ot.getRSSvalue(g,W,!0),he=Ot.getRSSvalue(x,U,!1),ft=F.EVEN_TOTAL_SUBSET[H],vt=F.GSUM[H],gt=pe*ft+he+vt;return new wn(gt,B)}static isNotA1left(e,t,n){return!(e.getValue()==0&&t&&n)}adjustOddEvenCounts(e){let t=me.sum(new Int32Array(this.getOddCounts())),n=me.sum(new Int32Array(this.getEvenCounts())),r=!1,i=!1;t>13?i=!0:t<4&&(r=!0);let a=!1,u=!1;n>13?u=!0:n<4&&(a=!0);let h=t+n-e,g=(t&1)==1,x=(n&1)==0;if(h==1)if(g){if(x)throw new P;i=!0}else{if(!x)throw new P;u=!0}else if(h==-1)if(g){if(x)throw new P;r=!0}else{if(!x)throw new P;a=!0}else if(h==0){if(g){if(!x)throw new P;t<n?(r=!0,u=!0):(i=!0,a=!0)}else if(x)throw new P}else throw new P;if(r){if(i)throw new P;F.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(i&&F.decrement(this.getOddCounts(),this.getOddRoundingErrors()),a){if(u)throw new P;F.increment(this.getEvenCounts(),this.getOddRoundingErrors())}u&&F.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}F.SYMBOL_WIDEST=[7,5,4,3,1],F.EVEN_TOTAL_SUBSET=[4,20,52,104,204],F.GSUM=[0,348,1388,2948,3988],F.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],F.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],F.FINDER_PAT_A=0,F.FINDER_PAT_B=1,F.FINDER_PAT_C=2,F.FINDER_PAT_D=3,F.FINDER_PAT_E=4,F.FINDER_PAT_F=5,F.FINDER_PATTERN_SEQUENCES=[[F.FINDER_PAT_A,F.FINDER_PAT_A],[F.FINDER_PAT_A,F.FINDER_PAT_B,F.FINDER_PAT_B],[F.FINDER_PAT_A,F.FINDER_PAT_C,F.FINDER_PAT_B,F.FINDER_PAT_D],[F.FINDER_PAT_A,F.FINDER_PAT_E,F.FINDER_PAT_B,F.FINDER_PAT_D,F.FINDER_PAT_C],[F.FINDER_PAT_A,F.FINDER_PAT_E,F.FINDER_PAT_B,F.FINDER_PAT_D,F.FINDER_PAT_D,F.FINDER_PAT_F],[F.FINDER_PAT_A,F.FINDER_PAT_E,F.FINDER_PAT_B,F.FINDER_PAT_D,F.FINDER_PAT_E,F.FINDER_PAT_F,F.FINDER_PAT_F],[F.FINDER_PAT_A,F.FINDER_PAT_A,F.FINDER_PAT_B,F.FINDER_PAT_B,F.FINDER_PAT_C,F.FINDER_PAT_C,F.FINDER_PAT_D,F.FINDER_PAT_D],[F.FINDER_PAT_A,F.FINDER_PAT_A,F.FINDER_PAT_B,F.FINDER_PAT_B,F.FINDER_PAT_C,F.FINDER_PAT_C,F.FINDER_PAT_D,F.FINDER_PAT_E,F.FINDER_PAT_E],[F.FINDER_PAT_A,F.FINDER_PAT_A,F.FINDER_PAT_B,F.FINDER_PAT_B,F.FINDER_PAT_C,F.FINDER_PAT_C,F.FINDER_PAT_D,F.FINDER_PAT_E,F.FINDER_PAT_F,F.FINDER_PAT_F],[F.FINDER_PAT_A,F.FINDER_PAT_A,F.FINDER_PAT_B,F.FINDER_PAT_B,F.FINDER_PAT_C,F.FINDER_PAT_D,F.FINDER_PAT_D,F.FINDER_PAT_E,F.FINDER_PAT_E,F.FINDER_PAT_F,F.FINDER_PAT_F]],F.MAX_PAIRS=11;class Ha extends wn{constructor(e,t,n){super(e,t),this.count=0,this.finderPattern=n}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class Fe extends nt{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(e,t,n){const r=this.decodePair(t,!1,e,n);Fe.addOrTally(this.possibleLeftPairs,r),t.reverse();let i=this.decodePair(t,!0,e,n);Fe.addOrTally(this.possibleRightPairs,i),t.reverse();for(let a of this.possibleLeftPairs)if(a.getCount()>1){for(let u of this.possibleRightPairs)if(u.getCount()>1&&Fe.checkChecksum(a,u))return Fe.constructResult(a,u)}throw new P}static addOrTally(e,t){if(t==null)return;let n=!1;for(let r of e)if(r.getValue()===t.getValue()){r.incrementCount(),n=!0;break}n||e.push(t)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(e,t){let n=4537077*e.getValue()+t.getValue(),r=new String(n).toString(),i=new q;for(let g=13-r.length;g>0;g--)i.append("0");i.append(r);let a=0;for(let g=0;g<13;g++){let x=i.charAt(g).charCodeAt(0)-48;a+=(g&1)===0?3*x:x}a=10-a%10,a===10&&(a=0),i.append(a.toString());let u=e.getFinderPattern().getResultPoints(),h=t.getFinderPattern().getResultPoints();return new Qe(i.toString(),null,0,[u[0],u[1],h[0],h[1]],se.RSS_14,new Date().getTime())}static checkChecksum(e,t){let n=(e.getChecksumPortion()+16*t.getChecksumPortion())%79,r=9*e.getFinderPattern().getValue()+t.getFinderPattern().getValue();return r>72&&r--,r>8&&r--,n===r}decodePair(e,t,n,r){try{let i=this.findFinderPattern(e,t),a=this.parseFoundFinderPattern(e,n,t,i),u=r==null?null:r.get(X.NEED_RESULT_POINT_CALLBACK);if(u!=null){let x=(i[0]+i[1])/2;t&&(x=e.getSize()-1-x),u.foundPossibleResultPoint(new ne(x,n))}let h=this.decodeDataCharacter(e,a,!0),g=this.decodeDataCharacter(e,a,!1);return new Ha(1597*h.getValue()+g.getValue(),h.getChecksumPortion()+4*g.getChecksumPortion(),a)}catch{return null}}decodeDataCharacter(e,t,n){let r=this.getDataCharacterCounters();for(let R=0;R<r.length;R++)r[R]=0;if(n)Ge.recordPatternInReverse(e,t.getStartEnd()[0],r);else{Ge.recordPattern(e,t.getStartEnd()[1]+1,r);for(let R=0,B=r.length-1;R<B;R++,B--){let H=r[R];r[R]=r[B],r[B]=H}}let i=n?16:15,a=me.sum(new Int32Array(r))/i,u=this.getOddCounts(),h=this.getEvenCounts(),g=this.getOddRoundingErrors(),x=this.getEvenRoundingErrors();for(let R=0;R<r.length;R++){let B=r[R]/a,H=Math.floor(B+.5);H<1?H=1:H>8&&(H=8);let W=Math.floor(R/2);(R&1)===0?(u[W]=H,g[W]=B-H):(h[W]=H,x[W]=B-H)}this.adjustOddEvenCounts(n,i);let y=0,E=0;for(let R=u.length-1;R>=0;R--)E*=9,E+=u[R],y+=u[R];let S=0,T=0;for(let R=h.length-1;R>=0;R--)S*=9,S+=h[R],T+=h[R];let v=E+3*S;if(n){if((y&1)!==0||y>12||y<4)throw new P;let R=(12-y)/2,B=Fe.OUTSIDE_ODD_WIDEST[R],H=9-B,W=Ot.getRSSvalue(u,B,!1),U=Ot.getRSSvalue(h,H,!0),pe=Fe.OUTSIDE_EVEN_TOTAL_SUBSET[R],he=Fe.OUTSIDE_GSUM[R];return new wn(W*pe+U+he,v)}else{if((T&1)!==0||T>10||T<4)throw new P;let R=(10-T)/2,B=Fe.INSIDE_ODD_WIDEST[R],H=9-B,W=Ot.getRSSvalue(u,B,!0),U=Ot.getRSSvalue(h,H,!1),pe=Fe.INSIDE_ODD_TOTAL_SUBSET[R],he=Fe.INSIDE_GSUM[R];return new wn(U*pe+W+he,v)}}findFinderPattern(e,t){let n=this.getDecodeFinderCounters();n[0]=0,n[1]=0,n[2]=0,n[3]=0;let r=e.getSize(),i=!1,a=0;for(;a<r&&(i=!e.get(a),t!==i);)a++;let u=0,h=a;for(let g=a;g<r;g++)if(e.get(g)!==i)n[u]++;else{if(u===3){if(nt.isFinderPattern(n))return[h,g];h+=n[0]+n[1],n[0]=n[2],n[1]=n[3],n[2]=0,n[3]=0,u--}else u++;n[u]=1,i=!i}throw new P}parseFoundFinderPattern(e,t,n,r){let i=e.get(r[0]),a=r[0]-1;for(;a>=0&&i!==e.get(a);)a--;a++;const u=r[0]-a,h=this.getDecodeFinderCounters(),g=new Int32Array(h.length);G.arraycopy(h,0,g,1,h.length-1),g[0]=u;const x=this.parseFinderValue(g,Fe.FINDER_PATTERNS);let y=a,E=r[1];return n&&(y=e.getSize()-1-y,E=e.getSize()-1-E),new Qn(x,[a,r[1]],y,E,t)}adjustOddEvenCounts(e,t){let n=me.sum(new Int32Array(this.getOddCounts())),r=me.sum(new Int32Array(this.getEvenCounts())),i=!1,a=!1,u=!1,h=!1;e?(n>12?a=!0:n<4&&(i=!0),r>12?h=!0:r<4&&(u=!0)):(n>11?a=!0:n<5&&(i=!0),r>10?h=!0:r<4&&(u=!0));let g=n+r-t,x=(n&1)===(e?1:0),y=(r&1)===1;if(g===1)if(x){if(y)throw new P;a=!0}else{if(!y)throw new P;h=!0}else if(g===-1)if(x){if(y)throw new P;i=!0}else{if(!y)throw new P;u=!0}else if(g===0){if(x){if(!y)throw new P;n<r?(i=!0,h=!0):(a=!0,u=!0)}else if(y)throw new P}else throw new P;if(i){if(a)throw new P;nt.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(a&&nt.decrement(this.getOddCounts(),this.getOddRoundingErrors()),u){if(h)throw new P;nt.increment(this.getEvenCounts(),this.getOddRoundingErrors())}h&&nt.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Fe.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],Fe.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],Fe.OUTSIDE_GSUM=[0,161,961,2015,2715],Fe.INSIDE_GSUM=[0,336,1036,1516],Fe.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],Fe.INSIDE_ODD_WIDEST=[2,4,6,8],Fe.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class bn extends Ge{constructor(e,t){super(),this.readers=[],this.verbose=t===!0;const n=e?e.get(X.POSSIBLE_FORMATS):null,r=e&&e.get(X.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;n?((n.includes(se.EAN_13)||n.includes(se.UPC_A)||n.includes(se.EAN_8)||n.includes(se.UPC_E))&&this.readers.push(new Ir(e)),n.includes(se.CODE_39)&&this.readers.push(new Xe(r)),n.includes(se.CODE_128)&&this.readers.push(new z),n.includes(se.ITF)&&this.readers.push(new Te),n.includes(se.RSS_14)&&this.readers.push(new Fe),n.includes(se.RSS_EXPANDED)&&this.readers.push(new F(this.verbose))):(this.readers.push(new Ir(e)),this.readers.push(new Xe),this.readers.push(new Ir(e)),this.readers.push(new z),this.readers.push(new Te),this.readers.push(new Fe),this.readers.push(new F(this.verbose)))}decodeRow(e,t,n){for(let r=0;r<this.readers.length;r++)try{return this.readers[r].decodeRow(e,t,n)}catch{}throw new P}reset(){this.readers.forEach(e=>e.reset())}}class Ga extends St{constructor(e=500,t){super(new bn(t),e,t)}}class Ae{constructor(e,t,n){this.ecCodewords=e,this.ecBlocks=[t],n&&this.ecBlocks.push(n)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class be{constructor(e,t){this.count=e,this.dataCodewords=t}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class xe{constructor(e,t,n,r,i,a){this.versionNumber=e,this.symbolSizeRows=t,this.symbolSizeColumns=n,this.dataRegionSizeRows=r,this.dataRegionSizeColumns=i,this.ecBlocks=a;let u=0;const h=a.getECCodewords(),g=a.getECBlocks();for(let x of g)u+=x.getCount()*(x.getDataCodewords()+h);this.totalCodewords=u}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(e,t){if((e&1)!==0||(t&1)!==0)throw new L;for(let n of xe.VERSIONS)if(n.symbolSizeRows===e&&n.symbolSizeColumns===t)return n;throw new L}toString(){return""+this.versionNumber}static buildVersions(){return[new xe(1,10,10,8,8,new Ae(5,new be(1,3))),new xe(2,12,12,10,10,new Ae(7,new be(1,5))),new xe(3,14,14,12,12,new Ae(10,new be(1,8))),new xe(4,16,16,14,14,new Ae(12,new be(1,12))),new xe(5,18,18,16,16,new Ae(14,new be(1,18))),new xe(6,20,20,18,18,new Ae(18,new be(1,22))),new xe(7,22,22,20,20,new Ae(20,new be(1,30))),new xe(8,24,24,22,22,new Ae(24,new be(1,36))),new xe(9,26,26,24,24,new Ae(28,new be(1,44))),new xe(10,32,32,14,14,new Ae(36,new be(1,62))),new xe(11,36,36,16,16,new Ae(42,new be(1,86))),new xe(12,40,40,18,18,new Ae(48,new be(1,114))),new xe(13,44,44,20,20,new Ae(56,new be(1,144))),new xe(14,48,48,22,22,new Ae(68,new be(1,174))),new xe(15,52,52,24,24,new Ae(42,new be(2,102))),new xe(16,64,64,14,14,new Ae(56,new be(2,140))),new xe(17,72,72,16,16,new Ae(36,new be(4,92))),new xe(18,80,80,18,18,new Ae(48,new be(4,114))),new xe(19,88,88,20,20,new Ae(56,new be(4,144))),new xe(20,96,96,22,22,new Ae(68,new be(4,174))),new xe(21,104,104,24,24,new Ae(56,new be(6,136))),new xe(22,120,120,18,18,new Ae(68,new be(6,175))),new xe(23,132,132,20,20,new Ae(62,new be(8,163))),new xe(24,144,144,22,22,new Ae(62,new be(8,156),new be(2,155))),new xe(25,8,18,6,16,new Ae(7,new be(1,5))),new xe(26,8,32,6,14,new Ae(11,new be(1,10))),new xe(27,12,26,10,24,new Ae(14,new be(1,16))),new xe(28,12,36,10,16,new Ae(18,new be(1,22))),new xe(29,16,36,14,16,new Ae(24,new be(1,32))),new xe(30,16,48,14,22,new Ae(28,new be(1,49)))]}}xe.VERSIONS=xe.buildVersions();class vr{constructor(e){const t=e.getHeight();if(t<8||t>144||(t&1)!==0)throw new L;this.version=vr.readVersion(e),this.mappingBitMatrix=this.extractDataRegion(e),this.readMappingMatrix=new re(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(e){const t=e.getHeight(),n=e.getWidth();return xe.getVersionForDimensions(t,n)}readCodewords(){const e=new Int8Array(this.version.getTotalCodewords());let t=0,n=4,r=0;const i=this.mappingBitMatrix.getHeight(),a=this.mappingBitMatrix.getWidth();let u=!1,h=!1,g=!1,x=!1;do if(n===i&&r===0&&!u)e[t++]=this.readCorner1(i,a)&255,n-=2,r+=2,u=!0;else if(n===i-2&&r===0&&(a&3)!==0&&!h)e[t++]=this.readCorner2(i,a)&255,n-=2,r+=2,h=!0;else if(n===i+4&&r===2&&(a&7)===0&&!g)e[t++]=this.readCorner3(i,a)&255,n-=2,r+=2,g=!0;else if(n===i-2&&r===0&&(a&7)===4&&!x)e[t++]=this.readCorner4(i,a)&255,n-=2,r+=2,x=!0;else{do n<i&&r>=0&&!this.readMappingMatrix.get(r,n)&&(e[t++]=this.readUtah(n,r,i,a)&255),n-=2,r+=2;while(n>=0&&r<a);n+=1,r+=3;do n>=0&&r<a&&!this.readMappingMatrix.get(r,n)&&(e[t++]=this.readUtah(n,r,i,a)&255),n+=2,r-=2;while(n<i&&r>=0);n+=3,r+=1}while(n<i||r<a);if(t!==this.version.getTotalCodewords())throw new L;return e}readModule(e,t,n,r){return e<0&&(e+=n,t+=4-(n+4&7)),t<0&&(t+=r,e+=4-(r+4&7)),this.readMappingMatrix.set(t,e),this.mappingBitMatrix.get(t,e)}readUtah(e,t,n,r){let i=0;return this.readModule(e-2,t-2,n,r)&&(i|=1),i<<=1,this.readModule(e-2,t-1,n,r)&&(i|=1),i<<=1,this.readModule(e-1,t-2,n,r)&&(i|=1),i<<=1,this.readModule(e-1,t-1,n,r)&&(i|=1),i<<=1,this.readModule(e-1,t,n,r)&&(i|=1),i<<=1,this.readModule(e,t-2,n,r)&&(i|=1),i<<=1,this.readModule(e,t-1,n,r)&&(i|=1),i<<=1,this.readModule(e,t,n,r)&&(i|=1),i}readCorner1(e,t){let n=0;return this.readModule(e-1,0,e,t)&&(n|=1),n<<=1,this.readModule(e-1,1,e,t)&&(n|=1),n<<=1,this.readModule(e-1,2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-1,e,t)&&(n|=1),n<<=1,this.readModule(1,t-1,e,t)&&(n|=1),n<<=1,this.readModule(2,t-1,e,t)&&(n|=1),n<<=1,this.readModule(3,t-1,e,t)&&(n|=1),n}readCorner2(e,t){let n=0;return this.readModule(e-3,0,e,t)&&(n|=1),n<<=1,this.readModule(e-2,0,e,t)&&(n|=1),n<<=1,this.readModule(e-1,0,e,t)&&(n|=1),n<<=1,this.readModule(0,t-4,e,t)&&(n|=1),n<<=1,this.readModule(0,t-3,e,t)&&(n|=1),n<<=1,this.readModule(0,t-2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-1,e,t)&&(n|=1),n<<=1,this.readModule(1,t-1,e,t)&&(n|=1),n}readCorner3(e,t){let n=0;return this.readModule(e-1,0,e,t)&&(n|=1),n<<=1,this.readModule(e-1,t-1,e,t)&&(n|=1),n<<=1,this.readModule(0,t-3,e,t)&&(n|=1),n<<=1,this.readModule(0,t-2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-1,e,t)&&(n|=1),n<<=1,this.readModule(1,t-3,e,t)&&(n|=1),n<<=1,this.readModule(1,t-2,e,t)&&(n|=1),n<<=1,this.readModule(1,t-1,e,t)&&(n|=1),n}readCorner4(e,t){let n=0;return this.readModule(e-3,0,e,t)&&(n|=1),n<<=1,this.readModule(e-2,0,e,t)&&(n|=1),n<<=1,this.readModule(e-1,0,e,t)&&(n|=1),n<<=1,this.readModule(0,t-2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-1,e,t)&&(n|=1),n<<=1,this.readModule(1,t-1,e,t)&&(n|=1),n<<=1,this.readModule(2,t-1,e,t)&&(n|=1),n<<=1,this.readModule(3,t-1,e,t)&&(n|=1),n}extractDataRegion(e){const t=this.version.getSymbolSizeRows(),n=this.version.getSymbolSizeColumns();if(e.getHeight()!==t)throw new _("Dimension of bitMatrix must match the version size");const r=this.version.getDataRegionSizeRows(),i=this.version.getDataRegionSizeColumns(),a=t/r|0,u=n/i|0,h=a*r,g=u*i,x=new re(g,h);for(let y=0;y<a;++y){const E=y*r;for(let S=0;S<u;++S){const T=S*i;for(let v=0;v<r;++v){const R=y*(r+2)+1+v,B=E+v;for(let H=0;H<i;++H){const W=S*(i+2)+1+H;if(e.get(W,R)){const U=T+H;x.set(U,B)}}}}}return x}}class Rr{constructor(e,t){this.numDataCodewords=e,this.codewords=t}static getDataBlocks(e,t){const n=t.getECBlocks();let r=0;const i=n.getECBlocks();for(let v of i)r+=v.getCount();const a=new Array(r);let u=0;for(let v of i)for(let R=0;R<v.getCount();R++){const B=v.getDataCodewords(),H=n.getECCodewords()+B;a[u++]=new Rr(B,new Uint8Array(H))}const g=a[0].codewords.length-n.getECCodewords(),x=g-1;let y=0;for(let v=0;v<x;v++)for(let R=0;R<u;R++)a[R].codewords[v]=e[y++];const E=t.getVersionNumber()===24,S=E?8:u;for(let v=0;v<S;v++)a[v].codewords[g-1]=e[y++];const T=a[0].codewords.length;for(let v=g;v<T;v++)for(let R=0;R<u;R++){const B=E?(R+8)%u:R,H=E&&B>7?v-1:v;a[B].codewords[H]=e[y++]}if(y!==e.length)throw new _;return a}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class Nr{constructor(e){this.bytes=e,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(e){if(e<1||e>32||e>this.available())throw new _(""+e);let t=0,n=this.bitOffset,r=this.byteOffset;const i=this.bytes;if(n>0){const a=8-n,u=e<a?e:a,h=a-u,g=255>>8-u<<h;t=(i[r]&g)>>h,e-=u,n+=u,n===8&&(n=0,r++)}if(e>0){for(;e>=8;)t=t<<8|i[r]&255,r++,e-=8;if(e>0){const a=8-e,u=255>>a<<a;t=t<<e|(i[r]&u)>>a,n+=e}}return this.bitOffset=n,this.byteOffset=r,t}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var ze;(function(C){C[C.PAD_ENCODE=0]="PAD_ENCODE",C[C.ASCII_ENCODE=1]="ASCII_ENCODE",C[C.C40_ENCODE=2]="C40_ENCODE",C[C.TEXT_ENCODE=3]="TEXT_ENCODE",C[C.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",C[C.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",C[C.BASE256_ENCODE=6]="BASE256_ENCODE"})(ze||(ze={}));class zt{static decode(e){const t=new Nr(e),n=new q,r=new q,i=new Array;let a=ze.ASCII_ENCODE;do if(a===ze.ASCII_ENCODE)a=this.decodeAsciiSegment(t,n,r);else{switch(a){case ze.C40_ENCODE:this.decodeC40Segment(t,n);break;case ze.TEXT_ENCODE:this.decodeTextSegment(t,n);break;case ze.ANSIX12_ENCODE:this.decodeAnsiX12Segment(t,n);break;case ze.EDIFACT_ENCODE:this.decodeEdifactSegment(t,n);break;case ze.BASE256_ENCODE:this.decodeBase256Segment(t,n,i);break;default:throw new L}a=ze.ASCII_ENCODE}while(a!==ze.PAD_ENCODE&&t.available()>0);return r.length()>0&&n.append(r.toString()),new yt(e,n.toString(),i.length===0?null:i,null)}static decodeAsciiSegment(e,t,n){let r=!1;do{let i=e.readBits(8);if(i===0)throw new L;if(i<=128)return r&&(i+=128),t.append(String.fromCharCode(i-1)),ze.ASCII_ENCODE;if(i===129)return ze.PAD_ENCODE;if(i<=229){const a=i-130;a<10&&t.append("0"),t.append(""+a)}else switch(i){case 230:return ze.C40_ENCODE;case 231:return ze.BASE256_ENCODE;case 232:t.append("");break;case 233:case 234:break;case 235:r=!0;break;case 236:t.append("[)>05"),n.insert(0,"");break;case 237:t.append("[)>06"),n.insert(0,"");break;case 238:return ze.ANSIX12_ENCODE;case 239:return ze.TEXT_ENCODE;case 240:return ze.EDIFACT_ENCODE;case 241:break;default:if(i!==254||e.available()!==0)throw new L;break}}while(e.available()>0);return ze.ASCII_ENCODE}static decodeC40Segment(e,t){let n=!1;const r=[];let i=0;do{if(e.available()===8)return;const a=e.readBits(8);if(a===254)return;this.parseTwoBytes(a,e.readBits(8),r);for(let u=0;u<3;u++){const h=r[u];switch(i){case 0:if(h<3)i=h+1;else if(h<this.C40_BASIC_SET_CHARS.length){const g=this.C40_BASIC_SET_CHARS[h];n?(t.append(String.fromCharCode(g.charCodeAt(0)+128)),n=!1):t.append(g)}else throw new L;break;case 1:n?(t.append(String.fromCharCode(h+128)),n=!1):t.append(String.fromCharCode(h)),i=0;break;case 2:if(h<this.C40_SHIFT2_SET_CHARS.length){const g=this.C40_SHIFT2_SET_CHARS[h];n?(t.append(String.fromCharCode(g.charCodeAt(0)+128)),n=!1):t.append(g)}else switch(h){case 27:t.append("");break;case 30:n=!0;break;default:throw new L}i=0;break;case 3:n?(t.append(String.fromCharCode(h+224)),n=!1):t.append(String.fromCharCode(h+96)),i=0;break;default:throw new L}}}while(e.available()>0)}static decodeTextSegment(e,t){let n=!1,r=[],i=0;do{if(e.available()===8)return;const a=e.readBits(8);if(a===254)return;this.parseTwoBytes(a,e.readBits(8),r);for(let u=0;u<3;u++){const h=r[u];switch(i){case 0:if(h<3)i=h+1;else if(h<this.TEXT_BASIC_SET_CHARS.length){const g=this.TEXT_BASIC_SET_CHARS[h];n?(t.append(String.fromCharCode(g.charCodeAt(0)+128)),n=!1):t.append(g)}else throw new L;break;case 1:n?(t.append(String.fromCharCode(h+128)),n=!1):t.append(String.fromCharCode(h)),i=0;break;case 2:if(h<this.TEXT_SHIFT2_SET_CHARS.length){const g=this.TEXT_SHIFT2_SET_CHARS[h];n?(t.append(String.fromCharCode(g.charCodeAt(0)+128)),n=!1):t.append(g)}else switch(h){case 27:t.append("");break;case 30:n=!0;break;default:throw new L}i=0;break;case 3:if(h<this.TEXT_SHIFT3_SET_CHARS.length){const g=this.TEXT_SHIFT3_SET_CHARS[h];n?(t.append(String.fromCharCode(g.charCodeAt(0)+128)),n=!1):t.append(g),i=0}else throw new L;break;default:throw new L}}}while(e.available()>0)}static decodeAnsiX12Segment(e,t){const n=[];do{if(e.available()===8)return;const r=e.readBits(8);if(r===254)return;this.parseTwoBytes(r,e.readBits(8),n);for(let i=0;i<3;i++){const a=n[i];switch(a){case 0:t.append("\r");break;case 1:t.append("*");break;case 2:t.append(">");break;case 3:t.append(" ");break;default:if(a<14)t.append(String.fromCharCode(a+44));else if(a<40)t.append(String.fromCharCode(a+51));else throw new L;break}}}while(e.available()>0)}static parseTwoBytes(e,t,n){let r=(e<<8)+t-1,i=Math.floor(r/1600);n[0]=i,r-=i*1600,i=Math.floor(r/40),n[1]=i,n[2]=r-i*40}static decodeEdifactSegment(e,t){do{if(e.available()<=16)return;for(let n=0;n<4;n++){let r=e.readBits(6);if(r===31){const i=8-e.getBitOffset();i!==8&&e.readBits(i);return}(r&32)===0&&(r|=64),t.append(String.fromCharCode(r))}}while(e.available()>0)}static decodeBase256Segment(e,t,n){let r=1+e.getByteOffset();const i=this.unrandomize255State(e.readBits(8),r++);let a;if(i===0?a=e.available()/8|0:i<250?a=i:a=250*(i-249)+this.unrandomize255State(e.readBits(8),r++),a<0)throw new L;const u=new Uint8Array(a);for(let h=0;h<a;h++){if(e.available()<8)throw new L;u[h]=this.unrandomize255State(e.readBits(8),r++)}n.push(u);try{t.append($.decode(u,V.ISO88591))}catch(h){throw new Nt("Platform does not support required encoding: "+h.message)}}static unrandomize255State(e,t){const n=149*t%255+1,r=e-n;return r>=0?r:r+256}}zt.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],zt.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],zt.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],zt.TEXT_SHIFT2_SET_CHARS=zt.C40_SHIFT2_SET_CHARS,zt.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class ja{constructor(){this.rsDecoder=new On(Ce.DATA_MATRIX_FIELD_256)}decode(e){const t=new vr(e),n=t.getVersion(),r=t.readCodewords(),i=Rr.getDataBlocks(r,n);let a=0;for(let g of i)a+=g.getNumDataCodewords();const u=new Uint8Array(a),h=i.length;for(let g=0;g<h;g++){const x=i[g],y=x.getCodewords(),E=x.getNumDataCodewords();this.correctErrors(y,E);for(let S=0;S<E;S++)u[S*h+g]=y[S]}return zt.decode(u)}correctErrors(e,t){const n=new Int32Array(e);try{this.rsDecoder.decode(n,e.length-t)}catch{throw new D}for(let r=0;r<t;r++)e[r]=n[r]}}class He{constructor(e){this.image=e,this.rectangleDetector=new Vt(this.image)}detect(){const e=this.rectangleDetector.detect();let t=this.detectSolid1(e);if(t=this.detectSolid2(t),t[3]=this.correctTopRight(t),!t[3])throw new P;t=this.shiftToModuleCenter(t);const n=t[0],r=t[1],i=t[2],a=t[3];let u=this.transitionsBetween(n,a)+1,h=this.transitionsBetween(i,a)+1;(u&1)===1&&(u+=1),(h&1)===1&&(h+=1),4*u<7*h&&4*h<7*u&&(u=h=Math.max(u,h));let g=He.sampleGrid(this.image,n,r,i,a,u,h);return new Zn(g,[n,r,i,a])}static shiftPoint(e,t,n){let r=(t.getX()-e.getX())/(n+1),i=(t.getY()-e.getY())/(n+1);return new ne(e.getX()+r,e.getY()+i)}static moveAway(e,t,n){let r=e.getX(),i=e.getY();return r<t?r-=1:r+=1,i<n?i-=1:i+=1,new ne(r,i)}detectSolid1(e){let t=e[0],n=e[1],r=e[3],i=e[2],a=this.transitionsBetween(t,n),u=this.transitionsBetween(n,r),h=this.transitionsBetween(r,i),g=this.transitionsBetween(i,t),x=a,y=[i,t,n,r];return x>u&&(x=u,y[0]=t,y[1]=n,y[2]=r,y[3]=i),x>h&&(x=h,y[0]=n,y[1]=r,y[2]=i,y[3]=t),x>g&&(y[0]=r,y[1]=i,y[2]=t,y[3]=n),y}detectSolid2(e){let t=e[0],n=e[1],r=e[2],i=e[3],a=this.transitionsBetween(t,i),u=He.shiftPoint(n,r,(a+1)*4),h=He.shiftPoint(r,n,(a+1)*4),g=this.transitionsBetween(u,t),x=this.transitionsBetween(h,i);return g<x?(e[0]=t,e[1]=n,e[2]=r,e[3]=i):(e[0]=n,e[1]=r,e[2]=i,e[3]=t),e}correctTopRight(e){let t=e[0],n=e[1],r=e[2],i=e[3],a=this.transitionsBetween(t,i),u=this.transitionsBetween(n,i),h=He.shiftPoint(t,n,(u+1)*4),g=He.shiftPoint(r,n,(a+1)*4);a=this.transitionsBetween(h,i),u=this.transitionsBetween(g,i);let x=new ne(i.getX()+(r.getX()-n.getX())/(a+1),i.getY()+(r.getY()-n.getY())/(a+1)),y=new ne(i.getX()+(t.getX()-n.getX())/(u+1),i.getY()+(t.getY()-n.getY())/(u+1));if(!this.isValid(x))return this.isValid(y)?y:null;if(!this.isValid(y))return x;let E=this.transitionsBetween(h,x)+this.transitionsBetween(g,x),S=this.transitionsBetween(h,y)+this.transitionsBetween(g,y);return E>S?x:y}shiftToModuleCenter(e){let t=e[0],n=e[1],r=e[2],i=e[3],a=this.transitionsBetween(t,i)+1,u=this.transitionsBetween(r,i)+1,h=He.shiftPoint(t,n,u*4),g=He.shiftPoint(r,n,a*4);a=this.transitionsBetween(h,i)+1,u=this.transitionsBetween(g,i)+1,(a&1)===1&&(a+=1),(u&1)===1&&(u+=1);let x=(t.getX()+n.getX()+r.getX()+i.getX())/4,y=(t.getY()+n.getY()+r.getY()+i.getY())/4;t=He.moveAway(t,x,y),n=He.moveAway(n,x,y),r=He.moveAway(r,x,y),i=He.moveAway(i,x,y);let E,S;return h=He.shiftPoint(t,n,u*4),h=He.shiftPoint(h,i,a*4),E=He.shiftPoint(n,t,u*4),E=He.shiftPoint(E,r,a*4),g=He.shiftPoint(r,i,u*4),g=He.shiftPoint(g,n,a*4),S=He.shiftPoint(i,r,u*4),S=He.shiftPoint(S,t,a*4),[h,E,g,S]}isValid(e){return e.getX()>=0&&e.getX()<this.image.getWidth()&&e.getY()>0&&e.getY()<this.image.getHeight()}static sampleGrid(e,t,n,r,i,a,u){return Wt.getInstance().sampleGrid(e,a,u,.5,.5,a-.5,.5,a-.5,u-.5,.5,u-.5,t.getX(),t.getY(),i.getX(),i.getY(),r.getX(),r.getY(),n.getX(),n.getY())}transitionsBetween(e,t){let n=Math.trunc(e.getX()),r=Math.trunc(e.getY()),i=Math.trunc(t.getX()),a=Math.trunc(t.getY()),u=Math.abs(a-r)>Math.abs(i-n);if(u){let v=n;n=r,r=v,v=i,i=a,a=v}let h=Math.abs(i-n),g=Math.abs(a-r),x=-h/2,y=r<a?1:-1,E=n<i?1:-1,S=0,T=this.image.get(u?r:n,u?n:r);for(let v=n,R=r;v!==i;v+=E){let B=this.image.get(u?R:v,u?v:R);if(B!==T&&(S++,T=B),x+=g,x>0){if(R===a)break;R+=y,x-=h}}return S}}class Yt{constructor(){this.decoder=new ja}decode(e,t=null){let n,r;if(t!=null&&t.has(X.PURE_BARCODE)){const g=Yt.extractPureBits(e.getBlackMatrix());n=this.decoder.decode(g),r=Yt.NO_POINTS}else{const g=new He(e.getBlackMatrix()).detect();n=this.decoder.decode(g.getBits()),r=g.getPoints()}const i=n.getRawBytes(),a=new Qe(n.getText(),i,8*i.length,r,se.DATA_MATRIX,G.currentTimeMillis()),u=n.getByteSegments();u!=null&&a.putMetadata(Ie.BYTE_SEGMENTS,u);const h=n.getECLevel();return h!=null&&a.putMetadata(Ie.ERROR_CORRECTION_LEVEL,h),a}reset(){}static extractPureBits(e){const t=e.getTopLeftOnBit(),n=e.getBottomRightOnBit();if(t==null||n==null)throw new P;const r=this.moduleSize(t,e);let i=t[1];const a=n[1];let u=t[0];const g=(n[0]-u+1)/r,x=(a-i+1)/r;if(g<=0||x<=0)throw new P;const y=r/2;i+=y,u+=y;const E=new re(g,x);for(let S=0;S<x;S++){const T=i+S*r;for(let v=0;v<g;v++)e.get(u+v*r,T)&&E.set(v,S)}return E}static moduleSize(e,t){const n=t.getWidth();let r=e[0];const i=e[1];for(;r<n&&t.get(r,i);)r++;if(r===n)throw new P;const a=r-e[0];if(a===0)throw new P;return a}}Yt.NO_POINTS=[];class Wa extends St{constructor(e=500){super(new Yt,e)}}var En;(function(C){C[C.L=0]="L",C[C.M=1]="M",C[C.Q=2]="Q",C[C.H=3]="H"})(En||(En={}));class Oe{constructor(e,t,n){this.value=e,this.stringValue=t,this.bits=n,Oe.FOR_BITS.set(n,this),Oe.FOR_VALUE.set(e,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(e){switch(e){case"L":return Oe.L;case"M":return Oe.M;case"Q":return Oe.Q;case"H":return Oe.H;default:throw new A(e+"not available")}}toString(){return this.stringValue}equals(e){if(!(e instanceof Oe))return!1;const t=e;return this.value===t.value}static forBits(e){if(e<0||e>=Oe.FOR_BITS.size)throw new _;return Oe.FOR_BITS.get(e)}}Oe.FOR_BITS=new Map,Oe.FOR_VALUE=new Map,Oe.L=new Oe(En.L,"L",1),Oe.M=new Oe(En.M,"M",0),Oe.Q=new Oe(En.Q,"Q",3),Oe.H=new Oe(En.H,"H",2);class rt{constructor(e){this.errorCorrectionLevel=Oe.forBits(e>>3&3),this.dataMask=e&7}static numBitsDiffering(e,t){return j.bitCount(e^t)}static decodeFormatInformation(e,t){const n=rt.doDecodeFormatInformation(e,t);return n!==null?n:rt.doDecodeFormatInformation(e^rt.FORMAT_INFO_MASK_QR,t^rt.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(e,t){let n=Number.MAX_SAFE_INTEGER,r=0;for(const i of rt.FORMAT_INFO_DECODE_LOOKUP){const a=i[0];if(a===e||a===t)return new rt(i[1]);let u=rt.numBitsDiffering(e,a);u<n&&(r=i[1],n=u),e!==t&&(u=rt.numBitsDiffering(t,a),u<n&&(r=i[1],n=u))}return n<=3?new rt(r):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(e){if(!(e instanceof rt))return!1;const t=e;return this.errorCorrectionLevel===t.errorCorrectionLevel&&this.dataMask===t.dataMask}}rt.FORMAT_INFO_MASK_QR=21522,rt.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class N{constructor(e,...t){this.ecCodewordsPerBlock=e,this.ecBlocks=t}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let e=0;const t=this.ecBlocks;for(const n of t)e+=n.getCount();return e}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class I{constructor(e,t){this.count=e,this.dataCodewords=t}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class ie{constructor(e,t,...n){this.versionNumber=e,this.alignmentPatternCenters=t,this.ecBlocks=n;let r=0;const i=n[0].getECCodewordsPerBlock(),a=n[0].getECBlocks();for(const u of a)r+=u.getCount()*(u.getDataCodewords()+i);this.totalCodewords=r}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(e){return this.ecBlocks[e.getValue()]}static getProvisionalVersionForDimension(e){if(e%4!==1)throw new L;try{return this.getVersionForNumber((e-17)/4)}catch{throw new L}}static getVersionForNumber(e){if(e<1||e>40)throw new _;return ie.VERSIONS[e-1]}static decodeVersionInformation(e){let t=Number.MAX_SAFE_INTEGER,n=0;for(let r=0;r<ie.VERSION_DECODE_INFO.length;r++){const i=ie.VERSION_DECODE_INFO[r];if(i===e)return ie.getVersionForNumber(r+7);const a=rt.numBitsDiffering(e,i);a<t&&(n=r+7,t=a)}return t<=3?ie.getVersionForNumber(n):null}buildFunctionPattern(){const e=this.getDimensionForVersion(),t=new re(e);t.setRegion(0,0,9,9),t.setRegion(e-8,0,8,9),t.setRegion(0,e-8,9,8);const n=this.alignmentPatternCenters.length;for(let r=0;r<n;r++){const i=this.alignmentPatternCenters[r]-2;for(let a=0;a<n;a++)r===0&&(a===0||a===n-1)||r===n-1&&a===0||t.setRegion(this.alignmentPatternCenters[a]-2,i,5,5)}return t.setRegion(6,9,1,e-17),t.setRegion(9,6,e-17,1),this.versionNumber>6&&(t.setRegion(e-11,0,3,6),t.setRegion(0,e-11,6,3)),t}toString(){return""+this.versionNumber}}ie.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),ie.VERSIONS=[new ie(1,new Int32Array(0),new N(7,new I(1,19)),new N(10,new I(1,16)),new N(13,new I(1,13)),new N(17,new I(1,9))),new ie(2,Int32Array.from([6,18]),new N(10,new I(1,34)),new N(16,new I(1,28)),new N(22,new I(1,22)),new N(28,new I(1,16))),new ie(3,Int32Array.from([6,22]),new N(15,new I(1,55)),new N(26,new I(1,44)),new N(18,new I(2,17)),new N(22,new I(2,13))),new ie(4,Int32Array.from([6,26]),new N(20,new I(1,80)),new N(18,new I(2,32)),new N(26,new I(2,24)),new N(16,new I(4,9))),new ie(5,Int32Array.from([6,30]),new N(26,new I(1,108)),new N(24,new I(2,43)),new N(18,new I(2,15),new I(2,16)),new N(22,new I(2,11),new I(2,12))),new ie(6,Int32Array.from([6,34]),new N(18,new I(2,68)),new N(16,new I(4,27)),new N(24,new I(4,19)),new N(28,new I(4,15))),new ie(7,Int32Array.from([6,22,38]),new N(20,new I(2,78)),new N(18,new I(4,31)),new N(18,new I(2,14),new I(4,15)),new N(26,new I(4,13),new I(1,14))),new ie(8,Int32Array.from([6,24,42]),new N(24,new I(2,97)),new N(22,new I(2,38),new I(2,39)),new N(22,new I(4,18),new I(2,19)),new N(26,new I(4,14),new I(2,15))),new ie(9,Int32Array.from([6,26,46]),new N(30,new I(2,116)),new N(22,new I(3,36),new I(2,37)),new N(20,new I(4,16),new I(4,17)),new N(24,new I(4,12),new I(4,13))),new ie(10,Int32Array.from([6,28,50]),new N(18,new I(2,68),new I(2,69)),new N(26,new I(4,43),new I(1,44)),new N(24,new I(6,19),new I(2,20)),new N(28,new I(6,15),new I(2,16))),new ie(11,Int32Array.from([6,30,54]),new N(20,new I(4,81)),new N(30,new I(1,50),new I(4,51)),new N(28,new I(4,22),new I(4,23)),new N(24,new I(3,12),new I(8,13))),new ie(12,Int32Array.from([6,32,58]),new N(24,new I(2,92),new I(2,93)),new N(22,new I(6,36),new I(2,37)),new N(26,new I(4,20),new I(6,21)),new N(28,new I(7,14),new I(4,15))),new ie(13,Int32Array.from([6,34,62]),new N(26,new I(4,107)),new N(22,new I(8,37),new I(1,38)),new N(24,new I(8,20),new I(4,21)),new N(22,new I(12,11),new I(4,12))),new ie(14,Int32Array.from([6,26,46,66]),new N(30,new I(3,115),new I(1,116)),new N(24,new I(4,40),new I(5,41)),new N(20,new I(11,16),new I(5,17)),new N(24,new I(11,12),new I(5,13))),new ie(15,Int32Array.from([6,26,48,70]),new N(22,new I(5,87),new I(1,88)),new N(24,new I(5,41),new I(5,42)),new N(30,new I(5,24),new I(7,25)),new N(24,new I(11,12),new I(7,13))),new ie(16,Int32Array.from([6,26,50,74]),new N(24,new I(5,98),new I(1,99)),new N(28,new I(7,45),new I(3,46)),new N(24,new I(15,19),new I(2,20)),new N(30,new I(3,15),new I(13,16))),new ie(17,Int32Array.from([6,30,54,78]),new N(28,new I(1,107),new I(5,108)),new N(28,new I(10,46),new I(1,47)),new N(28,new I(1,22),new I(15,23)),new N(28,new I(2,14),new I(17,15))),new ie(18,Int32Array.from([6,30,56,82]),new N(30,new I(5,120),new I(1,121)),new N(26,new I(9,43),new I(4,44)),new N(28,new I(17,22),new I(1,23)),new N(28,new I(2,14),new I(19,15))),new ie(19,Int32Array.from([6,30,58,86]),new N(28,new I(3,113),new I(4,114)),new N(26,new I(3,44),new I(11,45)),new N(26,new I(17,21),new I(4,22)),new N(26,new I(9,13),new I(16,14))),new ie(20,Int32Array.from([6,34,62,90]),new N(28,new I(3,107),new I(5,108)),new N(26,new I(3,41),new I(13,42)),new N(30,new I(15,24),new I(5,25)),new N(28,new I(15,15),new I(10,16))),new ie(21,Int32Array.from([6,28,50,72,94]),new N(28,new I(4,116),new I(4,117)),new N(26,new I(17,42)),new N(28,new I(17,22),new I(6,23)),new N(30,new I(19,16),new I(6,17))),new ie(22,Int32Array.from([6,26,50,74,98]),new N(28,new I(2,111),new I(7,112)),new N(28,new I(17,46)),new N(30,new I(7,24),new I(16,25)),new N(24,new I(34,13))),new ie(23,Int32Array.from([6,30,54,78,102]),new N(30,new I(4,121),new I(5,122)),new N(28,new I(4,47),new I(14,48)),new N(30,new I(11,24),new I(14,25)),new N(30,new I(16,15),new I(14,16))),new ie(24,Int32Array.from([6,28,54,80,106]),new N(30,new I(6,117),new I(4,118)),new N(28,new I(6,45),new I(14,46)),new N(30,new I(11,24),new I(16,25)),new N(30,new I(30,16),new I(2,17))),new ie(25,Int32Array.from([6,32,58,84,110]),new N(26,new I(8,106),new I(4,107)),new N(28,new I(8,47),new I(13,48)),new N(30,new I(7,24),new I(22,25)),new N(30,new I(22,15),new I(13,16))),new ie(26,Int32Array.from([6,30,58,86,114]),new N(28,new I(10,114),new I(2,115)),new N(28,new I(19,46),new I(4,47)),new N(28,new I(28,22),new I(6,23)),new N(30,new I(33,16),new I(4,17))),new ie(27,Int32Array.from([6,34,62,90,118]),new N(30,new I(8,122),new I(4,123)),new N(28,new I(22,45),new I(3,46)),new N(30,new I(8,23),new I(26,24)),new N(30,new I(12,15),new I(28,16))),new ie(28,Int32Array.from([6,26,50,74,98,122]),new N(30,new I(3,117),new I(10,118)),new N(28,new I(3,45),new I(23,46)),new N(30,new I(4,24),new I(31,25)),new N(30,new I(11,15),new I(31,16))),new ie(29,Int32Array.from([6,30,54,78,102,126]),new N(30,new I(7,116),new I(7,117)),new N(28,new I(21,45),new I(7,46)),new N(30,new I(1,23),new I(37,24)),new N(30,new I(19,15),new I(26,16))),new ie(30,Int32Array.from([6,26,52,78,104,130]),new N(30,new I(5,115),new I(10,116)),new N(28,new I(19,47),new I(10,48)),new N(30,new I(15,24),new I(25,25)),new N(30,new I(23,15),new I(25,16))),new ie(31,Int32Array.from([6,30,56,82,108,134]),new N(30,new I(13,115),new I(3,116)),new N(28,new I(2,46),new I(29,47)),new N(30,new I(42,24),new I(1,25)),new N(30,new I(23,15),new I(28,16))),new ie(32,Int32Array.from([6,34,60,86,112,138]),new N(30,new I(17,115)),new N(28,new I(10,46),new I(23,47)),new N(30,new I(10,24),new I(35,25)),new N(30,new I(19,15),new I(35,16))),new ie(33,Int32Array.from([6,30,58,86,114,142]),new N(30,new I(17,115),new I(1,116)),new N(28,new I(14,46),new I(21,47)),new N(30,new I(29,24),new I(19,25)),new N(30,new I(11,15),new I(46,16))),new ie(34,Int32Array.from([6,34,62,90,118,146]),new N(30,new I(13,115),new I(6,116)),new N(28,new I(14,46),new I(23,47)),new N(30,new I(44,24),new I(7,25)),new N(30,new I(59,16),new I(1,17))),new ie(35,Int32Array.from([6,30,54,78,102,126,150]),new N(30,new I(12,121),new I(7,122)),new N(28,new I(12,47),new I(26,48)),new N(30,new I(39,24),new I(14,25)),new N(30,new I(22,15),new I(41,16))),new ie(36,Int32Array.from([6,24,50,76,102,128,154]),new N(30,new I(6,121),new I(14,122)),new N(28,new I(6,47),new I(34,48)),new N(30,new I(46,24),new I(10,25)),new N(30,new I(2,15),new I(64,16))),new ie(37,Int32Array.from([6,28,54,80,106,132,158]),new N(30,new I(17,122),new I(4,123)),new N(28,new I(29,46),new I(14,47)),new N(30,new I(49,24),new I(10,25)),new N(30,new I(24,15),new I(46,16))),new ie(38,Int32Array.from([6,32,58,84,110,136,162]),new N(30,new I(4,122),new I(18,123)),new N(28,new I(13,46),new I(32,47)),new N(30,new I(48,24),new I(14,25)),new N(30,new I(42,15),new I(32,16))),new ie(39,Int32Array.from([6,26,54,82,110,138,166]),new N(30,new I(20,117),new I(4,118)),new N(28,new I(40,47),new I(7,48)),new N(30,new I(43,24),new I(22,25)),new N(30,new I(10,15),new I(67,16))),new ie(40,Int32Array.from([6,30,58,86,114,142,170]),new N(30,new I(19,118),new I(6,119)),new N(28,new I(18,47),new I(31,48)),new N(30,new I(34,24),new I(34,25)),new N(30,new I(20,15),new I(61,16)))];var Ze;(function(C){C[C.DATA_MASK_000=0]="DATA_MASK_000",C[C.DATA_MASK_001=1]="DATA_MASK_001",C[C.DATA_MASK_010=2]="DATA_MASK_010",C[C.DATA_MASK_011=3]="DATA_MASK_011",C[C.DATA_MASK_100=4]="DATA_MASK_100",C[C.DATA_MASK_101=5]="DATA_MASK_101",C[C.DATA_MASK_110=6]="DATA_MASK_110",C[C.DATA_MASK_111=7]="DATA_MASK_111"})(Ze||(Ze={}));class Et{constructor(e,t){this.value=e,this.isMasked=t}unmaskBitMatrix(e,t){for(let n=0;n<t;n++)for(let r=0;r<t;r++)this.isMasked(n,r)&&e.flip(r,n)}}Et.values=new Map([[Ze.DATA_MASK_000,new Et(Ze.DATA_MASK_000,(C,e)=>(C+e&1)===0)],[Ze.DATA_MASK_001,new Et(Ze.DATA_MASK_001,(C,e)=>(C&1)===0)],[Ze.DATA_MASK_010,new Et(Ze.DATA_MASK_010,(C,e)=>e%3===0)],[Ze.DATA_MASK_011,new Et(Ze.DATA_MASK_011,(C,e)=>(C+e)%3===0)],[Ze.DATA_MASK_100,new Et(Ze.DATA_MASK_100,(C,e)=>(Math.floor(C/2)+Math.floor(e/3)&1)===0)],[Ze.DATA_MASK_101,new Et(Ze.DATA_MASK_101,(C,e)=>C*e%6===0)],[Ze.DATA_MASK_110,new Et(Ze.DATA_MASK_110,(C,e)=>C*e%6<3)],[Ze.DATA_MASK_111,new Et(Ze.DATA_MASK_111,(C,e)=>(C+e+C*e%3&1)===0)]]);class Xa{constructor(e){const t=e.getHeight();if(t<21||(t&3)!==1)throw new L;this.bitMatrix=e}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let e=0;for(let i=0;i<6;i++)e=this.copyBit(i,8,e);e=this.copyBit(7,8,e),e=this.copyBit(8,8,e),e=this.copyBit(8,7,e);for(let i=5;i>=0;i--)e=this.copyBit(8,i,e);const t=this.bitMatrix.getHeight();let n=0;const r=t-7;for(let i=t-1;i>=r;i--)n=this.copyBit(8,i,n);for(let i=t-8;i<t;i++)n=this.copyBit(i,8,n);if(this.parsedFormatInfo=rt.decodeFormatInformation(e,n),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new L}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const e=this.bitMatrix.getHeight(),t=Math.floor((e-17)/4);if(t<=6)return ie.getVersionForNumber(t);let n=0;const r=e-11;for(let a=5;a>=0;a--)for(let u=e-9;u>=r;u--)n=this.copyBit(u,a,n);let i=ie.decodeVersionInformation(n);if(i!==null&&i.getDimensionForVersion()===e)return this.parsedVersion=i,i;n=0;for(let a=5;a>=0;a--)for(let u=e-9;u>=r;u--)n=this.copyBit(a,u,n);if(i=ie.decodeVersionInformation(n),i!==null&&i.getDimensionForVersion()===e)return this.parsedVersion=i,i;throw new L}copyBit(e,t,n){return(this.isMirror?this.bitMatrix.get(t,e):this.bitMatrix.get(e,t))?n<<1|1:n<<1}readCodewords(){const e=this.readFormatInformation(),t=this.readVersion(),n=Et.values.get(e.getDataMask()),r=this.bitMatrix.getHeight();n.unmaskBitMatrix(this.bitMatrix,r);const i=t.buildFunctionPattern();let a=!0;const u=new Uint8Array(t.getTotalCodewords());let h=0,g=0,x=0;for(let y=r-1;y>0;y-=2){y===6&&y--;for(let E=0;E<r;E++){const S=a?r-1-E:E;for(let T=0;T<2;T++)i.get(y-T,S)||(x++,g<<=1,this.bitMatrix.get(y-T,S)&&(g|=1),x===8&&(u[h++]=g,x=0,g=0))}a=!a}if(h!==t.getTotalCodewords())throw new L;return u}remask(){if(this.parsedFormatInfo===null)return;const e=Et.values[this.parsedFormatInfo.getDataMask()],t=this.bitMatrix.getHeight();e.unmaskBitMatrix(this.bitMatrix,t)}setMirror(e){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=e}mirror(){const e=this.bitMatrix;for(let t=0,n=e.getWidth();t<n;t++)for(let r=t+1,i=e.getHeight();r<i;r++)e.get(t,r)!==e.get(r,t)&&(e.flip(r,t),e.flip(t,r))}}class Or{constructor(e,t){this.numDataCodewords=e,this.codewords=t}static getDataBlocks(e,t,n){if(e.length!==t.getTotalCodewords())throw new _;const r=t.getECBlocksForLevel(n);let i=0;const a=r.getECBlocks();for(const T of a)i+=T.getCount();const u=new Array(i);let h=0;for(const T of a)for(let v=0;v<T.getCount();v++){const R=T.getDataCodewords(),B=r.getECCodewordsPerBlock()+R;u[h++]=new Or(R,new Uint8Array(B))}const g=u[0].codewords.length;let x=u.length-1;for(;x>=0&&u[x].codewords.length!==g;)x--;x++;const y=g-r.getECCodewordsPerBlock();let E=0;for(let T=0;T<y;T++)for(let v=0;v<h;v++)u[v].codewords[T]=e[E++];for(let T=x;T<h;T++)u[T].codewords[y]=e[E++];const S=u[0].codewords.length;for(let T=y;T<S;T++)for(let v=0;v<h;v++){const R=v<x?T:T+1;u[v].codewords[R]=e[E++]}return u}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var At;(function(C){C[C.TERMINATOR=0]="TERMINATOR",C[C.NUMERIC=1]="NUMERIC",C[C.ALPHANUMERIC=2]="ALPHANUMERIC",C[C.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",C[C.BYTE=4]="BYTE",C[C.ECI=5]="ECI",C[C.KANJI=6]="KANJI",C[C.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",C[C.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",C[C.HANZI=9]="HANZI"})(At||(At={}));class oe{constructor(e,t,n,r){this.value=e,this.stringValue=t,this.characterCountBitsForVersions=n,this.bits=r,oe.FOR_BITS.set(r,this),oe.FOR_VALUE.set(e,this)}static forBits(e){const t=oe.FOR_BITS.get(e);if(t===void 0)throw new _;return t}getCharacterCountBits(e){const t=e.getVersionNumber();let n;return t<=9?n=0:t<=26?n=1:n=2,this.characterCountBitsForVersions[n]}getValue(){return this.value}getBits(){return this.bits}equals(e){if(!(e instanceof oe))return!1;const t=e;return this.value===t.value}toString(){return this.stringValue}}oe.FOR_BITS=new Map,oe.FOR_VALUE=new Map,oe.TERMINATOR=new oe(At.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),oe.NUMERIC=new oe(At.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),oe.ALPHANUMERIC=new oe(At.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),oe.STRUCTURED_APPEND=new oe(At.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),oe.BYTE=new oe(At.BYTE,"BYTE",Int32Array.from([8,16,16]),4),oe.ECI=new oe(At.ECI,"ECI",Int32Array.from([0,0,0]),7),oe.KANJI=new oe(At.KANJI,"KANJI",Int32Array.from([8,10,12]),8),oe.FNC1_FIRST_POSITION=new oe(At.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),oe.FNC1_SECOND_POSITION=new oe(At.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),oe.HANZI=new oe(At.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class Pe{static decode(e,t,n,r){const i=new Nr(e);let a=new q;const u=new Array;let h=-1,g=-1;try{let x=null,y=!1,E;do{if(i.available()<4)E=oe.TERMINATOR;else{const S=i.readBits(4);E=oe.forBits(S)}switch(E){case oe.TERMINATOR:break;case oe.FNC1_FIRST_POSITION:case oe.FNC1_SECOND_POSITION:y=!0;break;case oe.STRUCTURED_APPEND:if(i.available()<16)throw new L;h=i.readBits(8),g=i.readBits(8);break;case oe.ECI:const S=Pe.parseECIValue(i);if(x=k.getCharacterSetECIByValue(S),x===null)throw new L;break;case oe.HANZI:const T=i.readBits(4),v=i.readBits(E.getCharacterCountBits(t));T===Pe.GB2312_SUBSET&&Pe.decodeHanziSegment(i,a,v);break;default:const R=i.readBits(E.getCharacterCountBits(t));switch(E){case oe.NUMERIC:Pe.decodeNumericSegment(i,a,R);break;case oe.ALPHANUMERIC:Pe.decodeAlphanumericSegment(i,a,R,y);break;case oe.BYTE:Pe.decodeByteSegment(i,a,R,x,u,r);break;case oe.KANJI:Pe.decodeKanjiSegment(i,a,R);break;default:throw new L}break}}while(E!==oe.TERMINATOR)}catch{throw new L}return new yt(e,a.toString(),u.length===0?null:u,n===null?null:n.toString(),h,g)}static decodeHanziSegment(e,t,n){if(n*13>e.available())throw new L;const r=new Uint8Array(2*n);let i=0;for(;n>0;){const a=e.readBits(13);let u=a/96<<8&4294967295|a%96;u<959?u+=41377:u+=42657,r[i]=u>>8&255,r[i+1]=u&255,i+=2,n--}try{t.append($.decode(r,V.GB2312))}catch(a){throw new L(a)}}static decodeKanjiSegment(e,t,n){if(n*13>e.available())throw new L;const r=new Uint8Array(2*n);let i=0;for(;n>0;){const a=e.readBits(13);let u=a/192<<8&4294967295|a%192;u<7936?u+=33088:u+=49472,r[i]=u>>8,r[i+1]=u,i+=2,n--}try{t.append($.decode(r,V.SHIFT_JIS))}catch(a){throw new L(a)}}static decodeByteSegment(e,t,n,r,i,a){if(8*n>e.available())throw new L;const u=new Uint8Array(n);for(let g=0;g<n;g++)u[g]=e.readBits(8);let h;r===null?h=V.guessEncoding(u,a):h=r.getName();try{t.append($.decode(u,h))}catch(g){throw new L(g)}i.push(u)}static toAlphaNumericChar(e){if(e>=Pe.ALPHANUMERIC_CHARS.length)throw new L;return Pe.ALPHANUMERIC_CHARS[e]}static decodeAlphanumericSegment(e,t,n,r){const i=t.length();for(;n>1;){if(e.available()<11)throw new L;const a=e.readBits(11);t.append(Pe.toAlphaNumericChar(Math.floor(a/45))),t.append(Pe.toAlphaNumericChar(a%45)),n-=2}if(n===1){if(e.available()<6)throw new L;t.append(Pe.toAlphaNumericChar(e.readBits(6)))}if(r)for(let a=i;a<t.length();a++)t.charAt(a)==="%"&&(a<t.length()-1&&t.charAt(a+1)==="%"?t.deleteCharAt(a+1):t.setCharAt(a,""))}static decodeNumericSegment(e,t,n){for(;n>=3;){if(e.available()<10)throw new L;const r=e.readBits(10);if(r>=1e3)throw new L;t.append(Pe.toAlphaNumericChar(Math.floor(r/100))),t.append(Pe.toAlphaNumericChar(Math.floor(r/10)%10)),t.append(Pe.toAlphaNumericChar(r%10)),n-=3}if(n===2){if(e.available()<7)throw new L;const r=e.readBits(7);if(r>=100)throw new L;t.append(Pe.toAlphaNumericChar(Math.floor(r/10))),t.append(Pe.toAlphaNumericChar(r%10))}else if(n===1){if(e.available()<4)throw new L;const r=e.readBits(4);if(r>=10)throw new L;t.append(Pe.toAlphaNumericChar(r))}}static parseECIValue(e){const t=e.readBits(8);if((t&128)===0)return t&127;if((t&192)===128){const n=e.readBits(8);return(t&63)<<8&4294967295|n}if((t&224)===192){const n=e.readBits(16);return(t&31)<<16&4294967295|n}throw new L}}Pe.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Pe.GB2312_SUBSET=1;class $i{constructor(e){this.mirrored=e}isMirrored(){return this.mirrored}applyMirroredCorrection(e){if(!this.mirrored||e===null||e.length<3)return;const t=e[0];e[0]=e[2],e[2]=t}}class za{constructor(){this.rsDecoder=new On(Ce.QR_CODE_FIELD_256)}decodeBooleanArray(e,t){return this.decodeBitMatrix(re.parseFromBooleanArray(e),t)}decodeBitMatrix(e,t){const n=new Xa(e);let r=null;try{return this.decodeBitMatrixParser(n,t)}catch(i){r=i}try{n.remask(),n.setMirror(!0),n.readVersion(),n.readFormatInformation(),n.mirror();const i=this.decodeBitMatrixParser(n,t);return i.setOther(new $i(!0)),i}catch(i){throw r!==null?r:i}}decodeBitMatrixParser(e,t){const n=e.readVersion(),r=e.readFormatInformation().getErrorCorrectionLevel(),i=e.readCodewords(),a=Or.getDataBlocks(i,n,r);let u=0;for(const x of a)u+=x.getNumDataCodewords();const h=new Uint8Array(u);let g=0;for(const x of a){const y=x.getCodewords(),E=x.getNumDataCodewords();this.correctErrors(y,E);for(let S=0;S<E;S++)h[g++]=y[S]}return Pe.decode(h,n,r,t)}correctErrors(e,t){const n=new Int32Array(e);try{this.rsDecoder.decode(n,e.length-t)}catch{throw new D}for(let r=0;r<t;r++)e[r]=n[r]}}class Dr extends ne{constructor(e,t,n){super(e,t),this.estimatedModuleSize=n}aboutEquals(e,t,n){if(Math.abs(t-this.getY())<=e&&Math.abs(n-this.getX())<=e){const r=Math.abs(e-this.estimatedModuleSize);return r<=1||r<=this.estimatedModuleSize}return!1}combineEstimate(e,t,n){const r=(this.getX()+t)/2,i=(this.getY()+e)/2,a=(this.estimatedModuleSize+n)/2;return new Dr(r,i,a)}}class er{constructor(e,t,n,r,i,a,u){this.image=e,this.startX=t,this.startY=n,this.width=r,this.height=i,this.moduleSize=a,this.resultPointCallback=u,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const e=this.startX,t=this.height,n=this.width,r=e+n,i=this.startY+t/2,a=new Int32Array(3),u=this.image;for(let h=0;h<t;h++){const g=i+((h&1)===0?Math.floor((h+1)/2):-Math.floor((h+1)/2));a[0]=0,a[1]=0,a[2]=0;let x=e;for(;x<r&&!u.get(x,g);)x++;let y=0;for(;x<r;){if(u.get(x,g))if(y===1)a[1]++;else if(y===2){if(this.foundPatternCross(a)){const E=this.handlePossibleCenter(a,g,x);if(E!==null)return E}a[0]=a[2],a[1]=1,a[2]=0,y=1}else a[++y]++;else y===1&&y++,a[y]++;x++}if(this.foundPatternCross(a)){const E=this.handlePossibleCenter(a,g,r);if(E!==null)return E}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new P}static centerFromEnd(e,t){return t-e[2]-e[1]/2}foundPatternCross(e){const t=this.moduleSize,n=t/2;for(let r=0;r<3;r++)if(Math.abs(t-e[r])>=n)return!1;return!0}crossCheckVertical(e,t,n,r){const i=this.image,a=i.getHeight(),u=this.crossCheckStateCount;u[0]=0,u[1]=0,u[2]=0;let h=e;for(;h>=0&&i.get(t,h)&&u[1]<=n;)u[1]++,h--;if(h<0||u[1]>n)return NaN;for(;h>=0&&!i.get(t,h)&&u[0]<=n;)u[0]++,h--;if(u[0]>n)return NaN;for(h=e+1;h<a&&i.get(t,h)&&u[1]<=n;)u[1]++,h++;if(h===a||u[1]>n)return NaN;for(;h<a&&!i.get(t,h)&&u[2]<=n;)u[2]++,h++;if(u[2]>n)return NaN;const g=u[0]+u[1]+u[2];return 5*Math.abs(g-r)>=2*r?NaN:this.foundPatternCross(u)?er.centerFromEnd(u,h):NaN}handlePossibleCenter(e,t,n){const r=e[0]+e[1]+e[2],i=er.centerFromEnd(e,n),a=this.crossCheckVertical(t,i,2*e[1],r);if(!isNaN(a)){const u=(e[0]+e[1]+e[2])/3;for(const g of this.possibleCenters)if(g.aboutEquals(u,a,i))return g.combineEstimate(a,i,u);const h=new Dr(i,a,u);this.possibleCenters.push(h),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(h)}return null}}class Mr extends ne{constructor(e,t,n,r){super(e,t),this.estimatedModuleSize=n,this.count=r,r===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(e,t,n){if(Math.abs(t-this.getY())<=e&&Math.abs(n-this.getX())<=e){const r=Math.abs(e-this.estimatedModuleSize);return r<=1||r<=this.estimatedModuleSize}return!1}combineEstimate(e,t,n){const r=this.count+1,i=(this.count*this.getX()+t)/r,a=(this.count*this.getY()+e)/r,u=(this.count*this.estimatedModuleSize+n)/r;return new Mr(i,a,u,r)}}class Ya{constructor(e){this.bottomLeft=e[0],this.topLeft=e[1],this.topRight=e[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class Ke{constructor(e,t){this.image=e,this.resultPointCallback=t,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=t}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(e){const t=e!=null&&e.get(X.TRY_HARDER)!==void 0,n=e!=null&&e.get(X.PURE_BARCODE)!==void 0,r=this.image,i=r.getHeight(),a=r.getWidth();let u=Math.floor(3*i/(4*Ke.MAX_MODULES));(u<Ke.MIN_SKIP||t)&&(u=Ke.MIN_SKIP);let h=!1;const g=new Int32Array(5);for(let y=u-1;y<i&&!h;y+=u){g[0]=0,g[1]=0,g[2]=0,g[3]=0,g[4]=0;let E=0;for(let S=0;S<a;S++)if(r.get(S,y))(E&1)===1&&E++,g[E]++;else if((E&1)===0)if(E===4)if(Ke.foundPatternCross(g)){if(this.handlePossibleCenter(g,y,S,n)===!0)if(u=2,this.hasSkipped===!0)h=this.haveMultiplyConfirmedCenters();else{const v=this.findRowSkip();v>g[2]&&(y+=v-g[2]-u,S=a-1)}else{g[0]=g[2],g[1]=g[3],g[2]=g[4],g[3]=1,g[4]=0,E=3;continue}E=0,g[0]=0,g[1]=0,g[2]=0,g[3]=0,g[4]=0}else g[0]=g[2],g[1]=g[3],g[2]=g[4],g[3]=1,g[4]=0,E=3;else g[++E]++;else g[E]++;Ke.foundPatternCross(g)&&this.handlePossibleCenter(g,y,a,n)===!0&&(u=g[0],this.hasSkipped&&(h=this.haveMultiplyConfirmedCenters()))}const x=this.selectBestPatterns();return ne.orderBestPatterns(x),new Ya(x)}static centerFromEnd(e,t){return t-e[4]-e[3]-e[2]/2}static foundPatternCross(e){let t=0;for(let i=0;i<5;i++){const a=e[i];if(a===0)return!1;t+=a}if(t<7)return!1;const n=t/7,r=n/2;return Math.abs(n-e[0])<r&&Math.abs(n-e[1])<r&&Math.abs(3*n-e[2])<3*r&&Math.abs(n-e[3])<r&&Math.abs(n-e[4])<r}getCrossCheckStateCount(){const e=this.crossCheckStateCount;return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e}crossCheckDiagonal(e,t,n,r){const i=this.getCrossCheckStateCount();let a=0;const u=this.image;for(;e>=a&&t>=a&&u.get(t-a,e-a);)i[2]++,a++;if(e<a||t<a)return!1;for(;e>=a&&t>=a&&!u.get(t-a,e-a)&&i[1]<=n;)i[1]++,a++;if(e<a||t<a||i[1]>n)return!1;for(;e>=a&&t>=a&&u.get(t-a,e-a)&&i[0]<=n;)i[0]++,a++;if(i[0]>n)return!1;const h=u.getHeight(),g=u.getWidth();for(a=1;e+a<h&&t+a<g&&u.get(t+a,e+a);)i[2]++,a++;if(e+a>=h||t+a>=g)return!1;for(;e+a<h&&t+a<g&&!u.get(t+a,e+a)&&i[3]<n;)i[3]++,a++;if(e+a>=h||t+a>=g||i[3]>=n)return!1;for(;e+a<h&&t+a<g&&u.get(t+a,e+a)&&i[4]<n;)i[4]++,a++;if(i[4]>=n)return!1;const x=i[0]+i[1]+i[2]+i[3]+i[4];return Math.abs(x-r)<2*r&&Ke.foundPatternCross(i)}crossCheckVertical(e,t,n,r){const i=this.image,a=i.getHeight(),u=this.getCrossCheckStateCount();let h=e;for(;h>=0&&i.get(t,h);)u[2]++,h--;if(h<0)return NaN;for(;h>=0&&!i.get(t,h)&&u[1]<=n;)u[1]++,h--;if(h<0||u[1]>n)return NaN;for(;h>=0&&i.get(t,h)&&u[0]<=n;)u[0]++,h--;if(u[0]>n)return NaN;for(h=e+1;h<a&&i.get(t,h);)u[2]++,h++;if(h===a)return NaN;for(;h<a&&!i.get(t,h)&&u[3]<n;)u[3]++,h++;if(h===a||u[3]>=n)return NaN;for(;h<a&&i.get(t,h)&&u[4]<n;)u[4]++,h++;if(u[4]>=n)return NaN;const g=u[0]+u[1]+u[2]+u[3]+u[4];return 5*Math.abs(g-r)>=2*r?NaN:Ke.foundPatternCross(u)?Ke.centerFromEnd(u,h):NaN}crossCheckHorizontal(e,t,n,r){const i=this.image,a=i.getWidth(),u=this.getCrossCheckStateCount();let h=e;for(;h>=0&&i.get(h,t);)u[2]++,h--;if(h<0)return NaN;for(;h>=0&&!i.get(h,t)&&u[1]<=n;)u[1]++,h--;if(h<0||u[1]>n)return NaN;for(;h>=0&&i.get(h,t)&&u[0]<=n;)u[0]++,h--;if(u[0]>n)return NaN;for(h=e+1;h<a&&i.get(h,t);)u[2]++,h++;if(h===a)return NaN;for(;h<a&&!i.get(h,t)&&u[3]<n;)u[3]++,h++;if(h===a||u[3]>=n)return NaN;for(;h<a&&i.get(h,t)&&u[4]<n;)u[4]++,h++;if(u[4]>=n)return NaN;const g=u[0]+u[1]+u[2]+u[3]+u[4];return 5*Math.abs(g-r)>=r?NaN:Ke.foundPatternCross(u)?Ke.centerFromEnd(u,h):NaN}handlePossibleCenter(e,t,n,r){const i=e[0]+e[1]+e[2]+e[3]+e[4];let a=Ke.centerFromEnd(e,n),u=this.crossCheckVertical(t,Math.floor(a),e[2],i);if(!isNaN(u)&&(a=this.crossCheckHorizontal(Math.floor(a),Math.floor(u),e[2],i),!isNaN(a)&&(!r||this.crossCheckDiagonal(Math.floor(u),Math.floor(a),e[2],i)))){const h=i/7;let g=!1;const x=this.possibleCenters;for(let y=0,E=x.length;y<E;y++){const S=x[y];if(S.aboutEquals(h,u,a)){x[y]=S.combineEstimate(u,a,h),g=!0;break}}if(!g){const y=new Mr(a,u,h);x.push(y),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(y)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let t=null;for(const n of this.possibleCenters)if(n.getCount()>=Ke.CENTER_QUORUM)if(t==null)t=n;else return this.hasSkipped=!0,Math.floor((Math.abs(t.getX()-n.getX())-Math.abs(t.getY()-n.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let e=0,t=0;const n=this.possibleCenters.length;for(const a of this.possibleCenters)a.getCount()>=Ke.CENTER_QUORUM&&(e++,t+=a.getEstimatedModuleSize());if(e<3)return!1;const r=t/n;let i=0;for(const a of this.possibleCenters)i+=Math.abs(a.getEstimatedModuleSize()-r);return i<=.05*t}selectBestPatterns(){const e=this.possibleCenters.length;if(e<3)throw new P;const t=this.possibleCenters;let n;if(e>3){let r=0,i=0;for(const h of this.possibleCenters){const g=h.getEstimatedModuleSize();r+=g,i+=g*g}n=r/e;let a=Math.sqrt(i/e-n*n);t.sort((h,g)=>{const x=Math.abs(g.getEstimatedModuleSize()-n),y=Math.abs(h.getEstimatedModuleSize()-n);return x<y?-1:x>y?1:0});const u=Math.max(.2*n,a);for(let h=0;h<t.length&&t.length>3;h++){const g=t[h];Math.abs(g.getEstimatedModuleSize()-n)>u&&(t.splice(h,1),h--)}}if(t.length>3){let r=0;for(const i of t)r+=i.getEstimatedModuleSize();n=r/t.length,t.sort((i,a)=>{if(a.getCount()===i.getCount()){const u=Math.abs(a.getEstimatedModuleSize()-n),h=Math.abs(i.getEstimatedModuleSize()-n);return u<h?1:u>h?-1:0}else return a.getCount()-i.getCount()}),t.splice(3)}return[t[0],t[1],t[2]]}}Ke.CENTER_QUORUM=2,Ke.MIN_SKIP=3,Ke.MAX_MODULES=57;class Mn{constructor(e){this.image=e}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(e){this.resultPointCallback=e==null?null:e.get(X.NEED_RESULT_POINT_CALLBACK);const n=new Ke(this.image,this.resultPointCallback).find(e);return this.processFinderPatternInfo(n)}processFinderPatternInfo(e){const t=e.getTopLeft(),n=e.getTopRight(),r=e.getBottomLeft(),i=this.calculateModuleSize(t,n,r);if(i<1)throw new P("No pattern found in proccess finder.");const a=Mn.computeDimension(t,n,r,i),u=ie.getProvisionalVersionForDimension(a),h=u.getDimensionForVersion()-7;let g=null;if(u.getAlignmentPatternCenters().length>0){const S=n.getX()-t.getX()+r.getX(),T=n.getY()-t.getY()+r.getY(),v=1-3/h,R=Math.floor(t.getX()+v*(S-t.getX())),B=Math.floor(t.getY()+v*(T-t.getY()));for(let H=4;H<=16;H<<=1)try{g=this.findAlignmentInRegion(i,R,B,H);break}catch(W){if(!(W instanceof P))throw W}}const x=Mn.createTransform(t,n,r,g,a),y=Mn.sampleGrid(this.image,x,a);let E;return g===null?E=[r,t,n]:E=[r,t,n,g],new Zn(y,E)}static createTransform(e,t,n,r,i){const a=i-3.5;let u,h,g,x;return r!==null?(u=r.getX(),h=r.getY(),g=a-3,x=g):(u=t.getX()-e.getX()+n.getX(),h=t.getY()-e.getY()+n.getY(),g=a,x=a),_t.quadrilateralToQuadrilateral(3.5,3.5,a,3.5,g,x,3.5,a,e.getX(),e.getY(),t.getX(),t.getY(),u,h,n.getX(),n.getY())}static sampleGrid(e,t,n){return Wt.getInstance().sampleGridWithTransform(e,n,n,t)}static computeDimension(e,t,n,r){const i=me.round(ne.distance(e,t)/r),a=me.round(ne.distance(e,n)/r);let u=Math.floor((i+a)/2)+7;switch(u&3){case 0:u++;break;case 2:u--;break;case 3:throw new P("Dimensions could be not found.")}return u}calculateModuleSize(e,t,n){return(this.calculateModuleSizeOneWay(e,t)+this.calculateModuleSizeOneWay(e,n))/2}calculateModuleSizeOneWay(e,t){const n=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(t.getX()),Math.floor(t.getY())),r=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(e.getX()),Math.floor(e.getY()));return isNaN(n)?r/7:isNaN(r)?n/7:(n+r)/14}sizeOfBlackWhiteBlackRunBothWays(e,t,n,r){let i=this.sizeOfBlackWhiteBlackRun(e,t,n,r),a=1,u=e-(n-e);u<0?(a=e/(e-u),u=0):u>=this.image.getWidth()&&(a=(this.image.getWidth()-1-e)/(u-e),u=this.image.getWidth()-1);let h=Math.floor(t-(r-t)*a);return a=1,h<0?(a=t/(t-h),h=0):h>=this.image.getHeight()&&(a=(this.image.getHeight()-1-t)/(h-t),h=this.image.getHeight()-1),u=Math.floor(e+(u-e)*a),i+=this.sizeOfBlackWhiteBlackRun(e,t,u,h),i-1}sizeOfBlackWhiteBlackRun(e,t,n,r){const i=Math.abs(r-t)>Math.abs(n-e);if(i){let S=e;e=t,t=S,S=n,n=r,r=S}const a=Math.abs(n-e),u=Math.abs(r-t);let h=-a/2;const g=e<n?1:-1,x=t<r?1:-1;let y=0;const E=n+g;for(let S=e,T=t;S!==E;S+=g){const v=i?T:S,R=i?S:T;if(y===1===this.image.get(v,R)){if(y===2)return me.distance(S,T,e,t);y++}if(h+=u,h>0){if(T===r)break;T+=x,h-=a}}return y===2?me.distance(n+g,r,e,t):NaN}findAlignmentInRegion(e,t,n,r){const i=Math.floor(r*e),a=Math.max(0,t-i),u=Math.min(this.image.getWidth()-1,t+i);if(u-a<e*3)throw new P("Alignment top exceeds estimated module size.");const h=Math.max(0,n-i),g=Math.min(this.image.getHeight()-1,n+i);if(g-h<e*3)throw new P("Alignment bottom exceeds estimated module size.");return new er(this.image,a,h,u-a,g-h,e,this.resultPointCallback).find()}}class qt{constructor(){this.decoder=new za}getDecoder(){return this.decoder}decode(e,t){let n,r;if(t!=null&&t.get(X.PURE_BARCODE)!==void 0){const h=qt.extractPureBits(e.getBlackMatrix());n=this.decoder.decodeBitMatrix(h,t),r=qt.NO_POINTS}else{const h=new Mn(e.getBlackMatrix()).detect(t);n=this.decoder.decodeBitMatrix(h.getBits(),t),r=h.getPoints()}n.getOther()instanceof $i&&n.getOther().applyMirroredCorrection(r);const i=new Qe(n.getText(),n.getRawBytes(),void 0,r,se.QR_CODE,void 0),a=n.getByteSegments();a!==null&&i.putMetadata(Ie.BYTE_SEGMENTS,a);const u=n.getECLevel();return u!==null&&i.putMetadata(Ie.ERROR_CORRECTION_LEVEL,u),n.hasStructuredAppend()&&(i.putMetadata(Ie.STRUCTURED_APPEND_SEQUENCE,n.getStructuredAppendSequenceNumber()),i.putMetadata(Ie.STRUCTURED_APPEND_PARITY,n.getStructuredAppendParity())),i}reset(){}static extractPureBits(e){const t=e.getTopLeftOnBit(),n=e.getBottomRightOnBit();if(t===null||n===null)throw new P;const r=this.moduleSize(t,e);let i=t[1],a=n[1],u=t[0],h=n[0];if(u>=h||i>=a)throw new P;if(a-i!==h-u&&(h=u+(a-i),h>=e.getWidth()))throw new P;const g=Math.round((h-u+1)/r),x=Math.round((a-i+1)/r);if(g<=0||x<=0)throw new P;if(x!==g)throw new P;const y=Math.floor(r/2);i+=y,u+=y;const E=u+Math.floor((g-1)*r)-h;if(E>0){if(E>y)throw new P;u-=E}const S=i+Math.floor((x-1)*r)-a;if(S>0){if(S>y)throw new P;i-=S}const T=new re(g,x);for(let v=0;v<x;v++){const R=i+Math.floor(v*r);for(let B=0;B<g;B++)e.get(u+Math.floor(B*r),R)&&T.set(B,v)}return T}static moduleSize(e,t){const n=t.getHeight(),r=t.getWidth();let i=e[0],a=e[1],u=!0,h=0;for(;i<r&&a<n;){if(u!==t.get(i,a)){if(++h===5)break;u=!u}i++,a++}if(i===r||a===n)throw new P;return(i-e[0])/7}}qt.NO_POINTS=new Array;class ue{PDF417Common(){}static getBitCountSum(e){return me.sum(e)}static toIntArray(e){if(e==null||!e.length)return ue.EMPTY_INT_ARRAY;const t=new Int32Array(e.length);let n=0;for(const r of e)t[n++]=r;return t}static getCodeword(e){const t=te.binarySearch(ue.SYMBOL_TABLE,e&262143);return t<0?-1:(ue.CODEWORD_TABLE[t]-1)%ue.NUMBER_OF_CODEWORDS}}ue.NUMBER_OF_CODEWORDS=929,ue.MAX_CODEWORDS_IN_BARCODE=ue.NUMBER_OF_CODEWORDS-1,ue.MIN_ROWS_IN_BARCODE=3,ue.MAX_ROWS_IN_BARCODE=90,ue.MODULES_IN_CODEWORD=17,ue.MODULES_IN_STOP_PATTERN=18,ue.BARS_IN_MODULE=8,ue.EMPTY_INT_ARRAY=new Int32Array([]),ue.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),ue.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class qa{constructor(e,t){this.bits=e,this.points=t}getBits(){return this.bits}getPoints(){return this.points}}class fe{static detectMultiple(e,t,n){let r=e.getBlackMatrix(),i=fe.detect(n,r);return i.length||(r=r.clone(),r.rotate180(),i=fe.detect(n,r)),new qa(r,i)}static detect(e,t){const n=new Array;let r=0,i=0,a=!1;for(;r<t.getHeight();){const u=fe.findVertices(t,r,i);if(u[0]==null&&u[3]==null){if(!a)break;a=!1,i=0;for(const h of n)h[1]!=null&&(r=Math.trunc(Math.max(r,h[1].getY()))),h[3]!=null&&(r=Math.max(r,Math.trunc(h[3].getY())));r+=fe.ROW_STEP;continue}if(a=!0,n.push(u),!e)break;u[2]!=null?(i=Math.trunc(u[2].getX()),r=Math.trunc(u[2].getY())):(i=Math.trunc(u[4].getX()),r=Math.trunc(u[4].getY()))}return n}static findVertices(e,t,n){const r=e.getHeight(),i=e.getWidth(),a=new Array(8);return fe.copyToResult(a,fe.findRowsWithPattern(e,r,i,t,n,fe.START_PATTERN),fe.INDEXES_START_PATTERN),a[4]!=null&&(n=Math.trunc(a[4].getX()),t=Math.trunc(a[4].getY())),fe.copyToResult(a,fe.findRowsWithPattern(e,r,i,t,n,fe.STOP_PATTERN),fe.INDEXES_STOP_PATTERN),a}static copyToResult(e,t,n){for(let r=0;r<n.length;r++)e[n[r]]=t[r]}static findRowsWithPattern(e,t,n,r,i,a){const u=new Array(4);let h=!1;const g=new Int32Array(a.length);for(;r<t;r+=fe.ROW_STEP){let y=fe.findGuardPattern(e,i,r,n,!1,a,g);if(y!=null){for(;r>0;){const E=fe.findGuardPattern(e,i,--r,n,!1,a,g);if(E!=null)y=E;else{r++;break}}u[0]=new ne(y[0],r),u[1]=new ne(y[1],r),h=!0;break}}let x=r+1;if(h){let y=0,E=Int32Array.from([Math.trunc(u[0].getX()),Math.trunc(u[1].getX())]);for(;x<t;x++){const S=fe.findGuardPattern(e,E[0],x,n,!1,a,g);if(S!=null&&Math.abs(E[0]-S[0])<fe.MAX_PATTERN_DRIFT&&Math.abs(E[1]-S[1])<fe.MAX_PATTERN_DRIFT)E=S,y=0;else{if(y>fe.SKIPPED_ROW_COUNT_MAX)break;y++}}x-=y+1,u[2]=new ne(E[0],x),u[3]=new ne(E[1],x)}return x-r<fe.BARCODE_MIN_HEIGHT&&te.fill(u,null),u}static findGuardPattern(e,t,n,r,i,a,u){te.fillWithin(u,0,u.length,0);let h=t,g=0;for(;e.get(h,n)&&h>0&&g++<fe.MAX_PIXEL_DRIFT;)h--;let x=h,y=0,E=a.length;for(let S=i;x<r;x++)if(e.get(x,n)!==S)u[y]++;else{if(y===E-1){if(fe.patternMatchVariance(u,a,fe.MAX_INDIVIDUAL_VARIANCE)<fe.MAX_AVG_VARIANCE)return new Int32Array([h,x]);h+=u[0]+u[1],G.arraycopy(u,2,u,0,y-1),u[y-1]=0,u[y]=0,y--}else y++;u[y]=1,S=!S}return y===E-1&&fe.patternMatchVariance(u,a,fe.MAX_INDIVIDUAL_VARIANCE)<fe.MAX_AVG_VARIANCE?new Int32Array([h,x-1]):null}static patternMatchVariance(e,t,n){let r=e.length,i=0,a=0;for(let g=0;g<r;g++)i+=e[g],a+=t[g];if(i<a)return 1/0;let u=i/a;n*=u;let h=0;for(let g=0;g<r;g++){let x=e[g],y=t[g]*u,E=x>y?x-y:y-x;if(E>n)return 1/0;h+=E}return h/i}}fe.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),fe.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),fe.MAX_AVG_VARIANCE=.42,fe.MAX_INDIVIDUAL_VARIANCE=.8,fe.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),fe.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),fe.MAX_PIXEL_DRIFT=3,fe.MAX_PATTERN_DRIFT=5,fe.SKIPPED_ROW_COUNT_MAX=25,fe.ROW_STEP=5,fe.BARCODE_MIN_HEIGHT=10;class $e{constructor(e,t){if(t.length===0)throw new _;this.field=e;let n=t.length;if(n>1&&t[0]===0){let r=1;for(;r<n&&t[r]===0;)r++;r===n?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(n-r),G.arraycopy(t,r,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(e){return this.coefficients[this.coefficients.length-1-e]}evaluateAt(e){if(e===0)return this.getCoefficient(0);if(e===1){let r=0;for(let i of this.coefficients)r=this.field.add(r,i);return r}let t=this.coefficients[0],n=this.coefficients.length;for(let r=1;r<n;r++)t=this.field.add(this.field.multiply(e,t),this.coefficients[r]);return t}add(e){if(!this.field.equals(e.field))throw new _("ModulusPolys do not have same ModulusGF field");if(this.isZero())return e;if(e.isZero())return this;let t=this.coefficients,n=e.coefficients;if(t.length>n.length){let a=t;t=n,n=a}let r=new Int32Array(n.length),i=n.length-t.length;G.arraycopy(n,0,r,0,i);for(let a=i;a<n.length;a++)r[a]=this.field.add(t[a-i],n[a]);return new $e(this.field,r)}subtract(e){if(!this.field.equals(e.field))throw new _("ModulusPolys do not have same ModulusGF field");return e.isZero()?this:this.add(e.negative())}multiply(e){return e instanceof $e?this.multiplyOther(e):this.multiplyScalar(e)}multiplyOther(e){if(!this.field.equals(e.field))throw new _("ModulusPolys do not have same ModulusGF field");if(this.isZero()||e.isZero())return new $e(this.field,new Int32Array([0]));let t=this.coefficients,n=t.length,r=e.coefficients,i=r.length,a=new Int32Array(n+i-1);for(let u=0;u<n;u++){let h=t[u];for(let g=0;g<i;g++)a[u+g]=this.field.add(a[u+g],this.field.multiply(h,r[g]))}return new $e(this.field,a)}negative(){let e=this.coefficients.length,t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=this.field.subtract(0,this.coefficients[n]);return new $e(this.field,t)}multiplyScalar(e){if(e===0)return new $e(this.field,new Int32Array([0]));if(e===1)return this;let t=this.coefficients.length,n=new Int32Array(t);for(let r=0;r<t;r++)n[r]=this.field.multiply(this.coefficients[r],e);return new $e(this.field,n)}multiplyByMonomial(e,t){if(e<0)throw new _;if(t===0)return new $e(this.field,new Int32Array([0]));let n=this.coefficients.length,r=new Int32Array(n+e);for(let i=0;i<n;i++)r[i]=this.field.multiply(this.coefficients[i],t);return new $e(this.field,r)}toString(){let e=new q;for(let t=this.getDegree();t>=0;t--){let n=this.getCoefficient(t);n!==0&&(n<0?(e.append(" - "),n=-n):e.length()>0&&e.append(" + "),(t===0||n!==1)&&e.append(n),t!==0&&(t===1?e.append("x"):(e.append("x^"),e.append(t))))}return e.toString()}}class Za{add(e,t){return(e+t)%this.modulus}subtract(e,t){return(this.modulus+e-t)%this.modulus}exp(e){return this.expTable[e]}log(e){if(e===0)throw new _;return this.logTable[e]}inverse(e){if(e===0)throw new Yn;return this.expTable[this.modulus-this.logTable[e]-1]}multiply(e,t){return e===0||t===0?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.modulus-1)]}getSize(){return this.modulus}equals(e){return e===this}}class kr extends Za{constructor(e,t){super(),this.modulus=e,this.expTable=new Int32Array(e),this.logTable=new Int32Array(e);let n=1;for(let r=0;r<e;r++)this.expTable[r]=n,n=n*t%e;for(let r=0;r<e-1;r++)this.logTable[this.expTable[r]]=r;this.zero=new $e(this,new Int32Array([0])),this.one=new $e(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(e,t){if(e<0)throw new _;if(t===0)return this.zero;let n=new Int32Array(e+1);return n[0]=t,new $e(this,n)}}kr.PDF417_GF=new kr(ue.NUMBER_OF_CODEWORDS,3);class es{constructor(){this.field=kr.PDF417_GF}decode(e,t,n){let r=new $e(this.field,e),i=new Int32Array(t),a=!1;for(let T=t;T>0;T--){let v=r.evaluateAt(this.field.exp(T));i[t-T]=v,v!==0&&(a=!0)}if(!a)return 0;let u=this.field.getOne();if(n!=null)for(const T of n){let v=this.field.exp(e.length-1-T),R=new $e(this.field,new Int32Array([this.field.subtract(0,v),1]));u=u.multiply(R)}let h=new $e(this.field,i),g=this.runEuclideanAlgorithm(this.field.buildMonomial(t,1),h,t),x=g[0],y=g[1],E=this.findErrorLocations(x),S=this.findErrorMagnitudes(y,x,E);for(let T=0;T<E.length;T++){let v=e.length-1-this.field.log(E[T]);if(v<0)throw D.getChecksumInstance();e[v]=this.field.subtract(e[v],S[T])}return E.length}runEuclideanAlgorithm(e,t,n){if(e.getDegree()<t.getDegree()){let E=e;e=t,t=E}let r=e,i=t,a=this.field.getZero(),u=this.field.getOne();for(;i.getDegree()>=Math.round(n/2);){let E=r,S=a;if(r=i,a=u,r.isZero())throw D.getChecksumInstance();i=E;let T=this.field.getZero(),v=r.getCoefficient(r.getDegree()),R=this.field.inverse(v);for(;i.getDegree()>=r.getDegree()&&!i.isZero();){let B=i.getDegree()-r.getDegree(),H=this.field.multiply(i.getCoefficient(i.getDegree()),R);T=T.add(this.field.buildMonomial(B,H)),i=i.subtract(r.multiplyByMonomial(B,H))}u=T.multiply(a).subtract(S).negative()}let h=u.getCoefficient(0);if(h===0)throw D.getChecksumInstance();let g=this.field.inverse(h),x=u.multiply(g),y=i.multiply(g);return[x,y]}findErrorLocations(e){let t=e.getDegree(),n=new Int32Array(t),r=0;for(let i=1;i<this.field.getSize()&&r<t;i++)e.evaluateAt(i)===0&&(n[r]=this.field.inverse(i),r++);if(r!==t)throw D.getChecksumInstance();return n}findErrorMagnitudes(e,t,n){let r=t.getDegree(),i=new Int32Array(r);for(let g=1;g<=r;g++)i[r-g]=this.field.multiply(g,t.getCoefficient(g));let a=new $e(this.field,i),u=n.length,h=new Int32Array(u);for(let g=0;g<u;g++){let x=this.field.inverse(n[g]),y=this.field.subtract(0,e.evaluateAt(x)),E=this.field.inverse(a.evaluateAt(x));h[g]=this.field.multiply(y,E)}return h}}class an{constructor(e,t,n,r,i){e instanceof an?this.constructor_2(e):this.constructor_1(e,t,n,r,i)}constructor_1(e,t,n,r,i){const a=t==null||n==null,u=r==null||i==null;if(a&&u)throw new P;a?(t=new ne(0,r.getY()),n=new ne(0,i.getY())):u&&(r=new ne(e.getWidth()-1,t.getY()),i=new ne(e.getWidth()-1,n.getY())),this.image=e,this.topLeft=t,this.bottomLeft=n,this.topRight=r,this.bottomRight=i,this.minX=Math.trunc(Math.min(t.getX(),n.getX())),this.maxX=Math.trunc(Math.max(r.getX(),i.getX())),this.minY=Math.trunc(Math.min(t.getY(),r.getY())),this.maxY=Math.trunc(Math.max(n.getY(),i.getY()))}constructor_2(e){this.image=e.image,this.topLeft=e.getTopLeft(),this.bottomLeft=e.getBottomLeft(),this.topRight=e.getTopRight(),this.bottomRight=e.getBottomRight(),this.minX=e.getMinX(),this.maxX=e.getMaxX(),this.minY=e.getMinY(),this.maxY=e.getMaxY()}static merge(e,t){return e==null?t:t==null?e:new an(e.image,e.topLeft,e.bottomLeft,t.topRight,t.bottomRight)}addMissingRows(e,t,n){let r=this.topLeft,i=this.bottomLeft,a=this.topRight,u=this.bottomRight;if(e>0){let h=n?this.topLeft:this.topRight,g=Math.trunc(h.getY()-e);g<0&&(g=0);let x=new ne(h.getX(),g);n?r=x:a=x}if(t>0){let h=n?this.bottomLeft:this.bottomRight,g=Math.trunc(h.getY()+t);g>=this.image.getHeight()&&(g=this.image.getHeight()-1);let x=new ne(h.getX(),g);n?i=x:u=x}return new an(this.image,r,i,a,u)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class Ka{constructor(e,t,n,r){this.columnCount=e,this.errorCorrectionLevel=r,this.rowCountUpperPart=t,this.rowCountLowerPart=n,this.rowCount=t+n}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class kn{constructor(){this.buffer=""}static form(e,t){let n=-1;function r(a,u,h,g,x,y){if(a==="%%")return"%";if(t[++n]===void 0)return;a=g?parseInt(g.substr(1)):void 0;let E=x?parseInt(x.substr(1)):void 0,S;switch(y){case"s":S=t[n];break;case"c":S=t[n][0];break;case"f":S=parseFloat(t[n]).toFixed(a);break;case"p":S=parseFloat(t[n]).toPrecision(a);break;case"e":S=parseFloat(t[n]).toExponential(a);break;case"x":S=parseInt(t[n]).toString(E||16);break;case"d":S=parseFloat(parseInt(t[n],E||10).toPrecision(a)).toFixed(0);break}S=typeof S=="object"?JSON.stringify(S):(+S).toString(E);let T=parseInt(h),v=h&&h[0]+""=="0"?"0":" ";for(;S.length<T;)S=u!==void 0?S+v:v+S;return S}let i=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return e.replace(i,r)}format(e,...t){this.buffer+=kn.form(e,t)}toString(){return this.buffer}}class Bn{constructor(e){this.boundingBox=new an(e),this.codewords=new Array(e.getMaxY()-e.getMinY()+1)}getCodewordNearby(e){let t=this.getCodeword(e);if(t!=null)return t;for(let n=1;n<Bn.MAX_NEARBY_DISTANCE;n++){let r=this.imageRowToCodewordIndex(e)-n;if(r>=0&&(t=this.codewords[r],t!=null)||(r=this.imageRowToCodewordIndex(e)+n,r<this.codewords.length&&(t=this.codewords[r],t!=null)))return t}return null}imageRowToCodewordIndex(e){return e-this.boundingBox.getMinY()}setCodeword(e,t){this.codewords[this.imageRowToCodewordIndex(e)]=t}getCodeword(e){return this.codewords[this.imageRowToCodewordIndex(e)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const e=new kn;let t=0;for(const n of this.codewords){if(n==null){e.format("%3d:    |   %n",t++);continue}e.format("%3d: %3d|%3d%n",t++,n.getRowNumber(),n.getValue())}return e.toString()}}Bn.MAX_NEARBY_DISTANCE=5;class Pn{constructor(){this.values=new Map}setValue(e){e=Math.trunc(e);let t=this.values.get(e);t==null&&(t=0),t++,this.values.set(e,t)}getValue(){let e=-1,t=new Array;for(const[n,r]of this.values.entries()){const i={getKey:()=>n,getValue:()=>r};i.getValue()>e?(e=i.getValue(),t=[],t.push(i.getKey())):i.getValue()===e&&t.push(i.getKey())}return ue.toIntArray(t)}getConfidence(e){return this.values.get(e)}}class ts extends Bn{constructor(e,t){super(e),this._isLeft=t}setRowNumbers(){for(let e of this.getCodewords())e?.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(e){let t=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(t,e);let n=this.getBoundingBox(),r=this._isLeft?n.getTopLeft():n.getTopRight(),i=this._isLeft?n.getBottomLeft():n.getBottomRight(),a=this.imageRowToCodewordIndex(Math.trunc(r.getY())),u=this.imageRowToCodewordIndex(Math.trunc(i.getY())),h=-1,g=1,x=0;for(let y=a;y<u;y++){if(t[y]==null)continue;let E=t[y],S=E.getRowNumber()-h;if(S===0)x++;else if(S===1)g=Math.max(g,x),x=1,h=E.getRowNumber();else if(S<0||E.getRowNumber()>=e.getRowCount()||S>y)t[y]=null;else{let T;g>2?T=(g-2)*S:T=S;let v=T>=y;for(let R=1;R<=T&&!v;R++)v=t[y-R]!=null;v?t[y]=null:(h=E.getRowNumber(),x=1)}}}getRowHeights(){let e=this.getBarcodeMetadata();if(e==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(e);let t=new Int32Array(e.getRowCount());for(let n of this.getCodewords())if(n!=null){let r=n.getRowNumber();if(r>=t.length)continue;t[r]++}return t}adjustIncompleteIndicatorColumnRowNumbers(e){let t=this.getBoundingBox(),n=this._isLeft?t.getTopLeft():t.getTopRight(),r=this._isLeft?t.getBottomLeft():t.getBottomRight(),i=this.imageRowToCodewordIndex(Math.trunc(n.getY())),a=this.imageRowToCodewordIndex(Math.trunc(r.getY())),u=this.getCodewords(),h=-1;for(let g=i;g<a;g++){if(u[g]==null)continue;let x=u[g];x.setRowNumberAsRowIndicatorColumn();let y=x.getRowNumber()-h;y===0||(y===1?h=x.getRowNumber():x.getRowNumber()>=e.getRowCount()?u[g]=null:h=x.getRowNumber())}}getBarcodeMetadata(){let e=this.getCodewords(),t=new Pn,n=new Pn,r=new Pn,i=new Pn;for(let u of e){if(u==null)continue;u.setRowNumberAsRowIndicatorColumn();let h=u.getValue()%30,g=u.getRowNumber();switch(this._isLeft||(g+=2),g%3){case 0:n.setValue(h*3+1);break;case 1:i.setValue(h/3),r.setValue(h%3);break;case 2:t.setValue(h+1);break}}if(t.getValue().length===0||n.getValue().length===0||r.getValue().length===0||i.getValue().length===0||t.getValue()[0]<1||n.getValue()[0]+r.getValue()[0]<ue.MIN_ROWS_IN_BARCODE||n.getValue()[0]+r.getValue()[0]>ue.MAX_ROWS_IN_BARCODE)return null;let a=new Ka(t.getValue()[0],n.getValue()[0],r.getValue()[0],i.getValue()[0]);return this.removeIncorrectCodewords(e,a),a}removeIncorrectCodewords(e,t){for(let n=0;n<e.length;n++){let r=e[n];if(e[n]==null)continue;let i=r.getValue()%30,a=r.getRowNumber();if(a>t.getRowCount()){e[n]=null;continue}switch(this._isLeft||(a+=2),a%3){case 0:i*3+1!==t.getRowCountUpperPart()&&(e[n]=null);break;case 1:(Math.trunc(i/3)!==t.getErrorCorrectionLevel()||i%3!==t.getRowCountLowerPart())&&(e[n]=null);break;case 2:i+1!==t.getColumnCount()&&(e[n]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class Ln{constructor(e,t){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=e,this.barcodeColumnCount=e.getColumnCount(),this.boundingBox=t,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let e=ue.MAX_CODEWORDS_IN_BARCODE,t;do t=e,e=this.adjustRowNumbersAndGetCount();while(e>0&&e<t);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(e){e?.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let e=this.adjustRowNumbersByRow();if(e===0)return 0;for(let t=1;t<this.barcodeColumnCount+1;t++){let n=this.detectionResultColumns[t].getCodewords();for(let r=0;r<n.length;r++)n[r]!=null&&(n[r].hasValidRowNumber()||this.adjustRowNumbers(t,r,n))}return e}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let e=this.detectionResultColumns[0].getCodewords(),t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let n=0;n<e.length;n++)if(e[n]!=null&&t[n]!=null&&e[n].getRowNumber()===t[n].getRowNumber())for(let r=1;r<=this.barcodeColumnCount;r++){let i=this.detectionResultColumns[r].getCodewords()[n];i!=null&&(i.setRowNumber(e[n].getRowNumber()),i.hasValidRowNumber()||(this.detectionResultColumns[r].getCodewords()[n]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let e=0,t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let n=0;n<t.length;n++){if(t[n]==null)continue;let r=t[n].getRowNumber(),i=0;for(let a=this.barcodeColumnCount+1;a>0&&i<this.ADJUST_ROW_NUMBER_SKIP;a--){let u=this.detectionResultColumns[a].getCodewords()[n];u!=null&&(i=Ln.adjustRowNumberIfValid(r,i,u),u.hasValidRowNumber()||e++)}}return e}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let e=0,t=this.detectionResultColumns[0].getCodewords();for(let n=0;n<t.length;n++){if(t[n]==null)continue;let r=t[n].getRowNumber(),i=0;for(let a=1;a<this.barcodeColumnCount+1&&i<this.ADJUST_ROW_NUMBER_SKIP;a++){let u=this.detectionResultColumns[a].getCodewords()[n];u!=null&&(i=Ln.adjustRowNumberIfValid(r,i,u),u.hasValidRowNumber()||e++)}}return e}static adjustRowNumberIfValid(e,t,n){return n==null||n.hasValidRowNumber()||(n.isValidRowNumber(e)?(n.setRowNumber(e),t=0):++t),t}adjustRowNumbers(e,t,n){if(!this.detectionResultColumns[e-1])return;let r=n[t],i=this.detectionResultColumns[e-1].getCodewords(),a=i;this.detectionResultColumns[e+1]!=null&&(a=this.detectionResultColumns[e+1].getCodewords());let u=new Array(14);u[2]=i[t],u[3]=a[t],t>0&&(u[0]=n[t-1],u[4]=i[t-1],u[5]=a[t-1]),t>1&&(u[8]=n[t-2],u[10]=i[t-2],u[11]=a[t-2]),t<n.length-1&&(u[1]=n[t+1],u[6]=i[t+1],u[7]=a[t+1]),t<n.length-2&&(u[9]=n[t+2],u[12]=i[t+2],u[13]=a[t+2]);for(let h of u)if(Ln.adjustRowNumber(r,h))return}static adjustRowNumber(e,t){return t==null?!1:t.hasValidRowNumber()&&t.getBucket()===e.getBucket()?(e.setRowNumber(t.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(e){this.boundingBox=e}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(e,t){this.detectionResultColumns[e]=t}getDetectionResultColumn(e){return this.detectionResultColumns[e]}toString(){let e=this.detectionResultColumns[0];e==null&&(e=this.detectionResultColumns[this.barcodeColumnCount+1]);let t=new kn;for(let n=0;n<e.getCodewords().length;n++){t.format("CW %3d:",n);for(let r=0;r<this.barcodeColumnCount+2;r++){if(this.detectionResultColumns[r]==null){t.format("    |   ");continue}let i=this.detectionResultColumns[r].getCodewords()[n];if(i==null){t.format("    |   ");continue}t.format(" %3d|%3d",i.getRowNumber(),i.getValue())}t.format("%n")}return t.toString()}}class Fn{constructor(e,t,n,r){this.rowNumber=Fn.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(e),this.endX=Math.trunc(t),this.bucket=Math.trunc(n),this.value=Math.trunc(r)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(e){return e!==Fn.BARCODE_ROW_UNKNOWN&&this.bucket===e%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(e){this.rowNumber=e}toString(){return this.rowNumber+"|"+this.value}}Fn.BARCODE_ROW_UNKNOWN=-1;class ht{static initialize(){for(let e=0;e<ue.SYMBOL_TABLE.length;e++){let t=ue.SYMBOL_TABLE[e],n=t&1;for(let r=0;r<ue.BARS_IN_MODULE;r++){let i=0;for(;(t&1)===n;)i+=1,t>>=1;n=t&1,ht.RATIOS_TABLE[e]||(ht.RATIOS_TABLE[e]=new Array(ue.BARS_IN_MODULE)),ht.RATIOS_TABLE[e][ue.BARS_IN_MODULE-r-1]=Math.fround(i/ue.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(e){let t=ht.getDecodedCodewordValue(ht.sampleBitCounts(e));return t!==-1?t:ht.getClosestDecodedValue(e)}static sampleBitCounts(e){let t=me.sum(e),n=new Int32Array(ue.BARS_IN_MODULE),r=0,i=0;for(let a=0;a<ue.MODULES_IN_CODEWORD;a++){let u=t/(2*ue.MODULES_IN_CODEWORD)+a*t/ue.MODULES_IN_CODEWORD;i+e[r]<=u&&(i+=e[r],r++),n[r]++}return n}static getDecodedCodewordValue(e){let t=ht.getBitValue(e);return ue.getCodeword(t)===-1?-1:t}static getBitValue(e){let t=0;for(let n=0;n<e.length;n++)for(let r=0;r<e[n];r++)t=t<<1|(n%2===0?1:0);return Math.trunc(t)}static getClosestDecodedValue(e){let t=me.sum(e),n=new Array(ue.BARS_IN_MODULE);if(t>1)for(let a=0;a<n.length;a++)n[a]=Math.fround(e[a]/t);let r=qn.MAX_VALUE,i=-1;this.bSymbolTableReady||ht.initialize();for(let a=0;a<ht.RATIOS_TABLE.length;a++){let u=0,h=ht.RATIOS_TABLE[a];for(let g=0;g<ue.BARS_IN_MODULE;g++){let x=Math.fround(h[g]-n[g]);if(u+=Math.fround(x*x),u>=r)break}u<r&&(r=u,i=ue.SYMBOL_TABLE[a])}return i}}ht.bSymbolTableReady=!1,ht.RATIOS_TABLE=new Array(ue.SYMBOL_TABLE.length).map(C=>new Array(ue.BARS_IN_MODULE));class ns{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(e){this.segmentIndex=e}getFileId(){return this.fileId}setFileId(e){this.fileId=e}getOptionalData(){return this.optionalData}setOptionalData(e){this.optionalData=e}isLastSegment(){return this.lastSegment}setLastSegment(e){this.lastSegment=e}getSegmentCount(){return this.segmentCount}setSegmentCount(e){this.segmentCount=e}getSender(){return this.sender||null}setSender(e){this.sender=e}getAddressee(){return this.addressee||null}setAddressee(e){this.addressee=e}getFileName(){return this.fileName}setFileName(e){this.fileName=e}getFileSize(){return this.fileSize}setFileSize(e){this.fileSize=e}getChecksum(){return this.checksum}setChecksum(e){this.checksum=e}getTimestamp(){return this.timestamp}setTimestamp(e){this.timestamp=e}}class rs{static parseLong(e,t=void 0){return parseInt(e,t)}}class is extends m{}is.kind="NullPointerException";class Qa{writeBytes(e){this.writeBytesOffset(e,0,e.length)}writeBytesOffset(e,t,n){if(e==null)throw new is;if(t<0||t>e.length||n<0||t+n>e.length||t+n<0)throw new Ee;if(n===0)return;for(let r=0;r<n;r++)this.write(e[t+r])}flush(){}close(){}}class Ja extends m{}class $a extends Qa{constructor(e=32){if(super(),this.count=0,e<0)throw new _("Negative initial size: "+e);this.buf=new Uint8Array(e)}ensureCapacity(e){e-this.buf.length>0&&this.grow(e)}grow(e){let n=this.buf.length<<1;if(n-e<0&&(n=e),n<0){if(e<0)throw new Ja;n=j.MAX_VALUE}this.buf=te.copyOfUint8Array(this.buf,n)}write(e){this.ensureCapacity(this.count+1),this.buf[this.count]=e,this.count+=1}writeBytesOffset(e,t,n){if(t<0||t>e.length||n<0||t+n-e.length>0)throw new Ee;this.ensureCapacity(this.count+n),G.arraycopy(e,t,this.buf,this.count,n),this.count+=n}writeTo(e){e.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return te.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(e){return e?typeof e=="string"?this.toString_string(e):this.toString_number(e):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(e){return new String(this.buf).toString()}toString_number(e){return new String(this.buf).toString()}close(){}}var Se;(function(C){C[C.ALPHA=0]="ALPHA",C[C.LOWER=1]="LOWER",C[C.MIXED=2]="MIXED",C[C.PUNCT=3]="PUNCT",C[C.ALPHA_SHIFT=4]="ALPHA_SHIFT",C[C.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(Se||(Se={}));function ss(){if(typeof window<"u")return window.BigInt||null;if(typeof ar<"u")return ar.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let tr;function Zt(C){if(typeof tr>"u"&&(tr=ss()),tr===null)throw new Error("BigInt is not supported!");return tr(C)}function ec(){let C=[];C[0]=Zt(1);let e=Zt(900);C[1]=e;for(let t=2;t<16;t++)C[t]=C[t-1]*e;return C}class M{static decode(e,t){let n=new q(""),r=k.ISO8859_1;n.enableDecoding(r);let i=1,a=e[i++],u=new ns;for(;i<e[0];){switch(a){case M.TEXT_COMPACTION_MODE_LATCH:i=M.textCompaction(e,i,n);break;case M.BYTE_COMPACTION_MODE_LATCH:case M.BYTE_COMPACTION_MODE_LATCH_6:i=M.byteCompaction(a,e,r,i,n);break;case M.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(e[i++]);break;case M.NUMERIC_COMPACTION_MODE_LATCH:i=M.numericCompaction(e,i,n);break;case M.ECI_CHARSET:k.getCharacterSetECIByValue(e[i++]);break;case M.ECI_GENERAL_PURPOSE:i+=2;break;case M.ECI_USER_DEFINED:i++;break;case M.BEGIN_MACRO_PDF417_CONTROL_BLOCK:i=M.decodeMacroBlock(e,i,u);break;case M.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case M.MACRO_PDF417_TERMINATOR:throw new L;default:i--,i=M.textCompaction(e,i,n);break}if(i<e.length)a=e[i++];else throw L.getFormatInstance()}if(n.length()===0)throw L.getFormatInstance();let h=new yt(null,n.toString(),null,t);return h.setOther(u),h}static decodeMacroBlock(e,t,n){if(t+M.NUMBER_OF_SEQUENCE_CODEWORDS>e[0])throw L.getFormatInstance();let r=new Int32Array(M.NUMBER_OF_SEQUENCE_CODEWORDS);for(let u=0;u<M.NUMBER_OF_SEQUENCE_CODEWORDS;u++,t++)r[u]=e[t];n.setSegmentIndex(j.parseInt(M.decodeBase900toBase10(r,M.NUMBER_OF_SEQUENCE_CODEWORDS)));let i=new q;t=M.textCompaction(e,t,i),n.setFileId(i.toString());let a=-1;for(e[t]===M.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(a=t+1);t<e[0];)switch(e[t]){case M.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(t++,e[t]){case M.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let u=new q;t=M.textCompaction(e,t+1,u),n.setFileName(u.toString());break;case M.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let h=new q;t=M.textCompaction(e,t+1,h),n.setSender(h.toString());break;case M.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let g=new q;t=M.textCompaction(e,t+1,g),n.setAddressee(g.toString());break;case M.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let x=new q;t=M.numericCompaction(e,t+1,x),n.setSegmentCount(j.parseInt(x.toString()));break;case M.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let y=new q;t=M.numericCompaction(e,t+1,y),n.setTimestamp(rs.parseLong(y.toString()));break;case M.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let E=new q;t=M.numericCompaction(e,t+1,E),n.setChecksum(j.parseInt(E.toString()));break;case M.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let S=new q;t=M.numericCompaction(e,t+1,S),n.setFileSize(rs.parseLong(S.toString()));break;default:throw L.getFormatInstance()}break;case M.MACRO_PDF417_TERMINATOR:t++,n.setLastSegment(!0);break;default:throw L.getFormatInstance()}if(a!==-1){let u=t-a;n.isLastSegment()&&u--,n.setOptionalData(te.copyOfRange(e,a,a+u))}return t}static textCompaction(e,t,n){let r=new Int32Array((e[0]-t)*2),i=new Int32Array((e[0]-t)*2),a=0,u=!1;for(;t<e[0]&&!u;){let h=e[t++];if(h<M.TEXT_COMPACTION_MODE_LATCH)r[a]=h/30,r[a+1]=h%30,a+=2;else switch(h){case M.TEXT_COMPACTION_MODE_LATCH:r[a++]=M.TEXT_COMPACTION_MODE_LATCH;break;case M.BYTE_COMPACTION_MODE_LATCH:case M.BYTE_COMPACTION_MODE_LATCH_6:case M.NUMERIC_COMPACTION_MODE_LATCH:case M.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case M.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case M.MACRO_PDF417_TERMINATOR:t--,u=!0;break;case M.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r[a]=M.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,h=e[t++],i[a]=h,a++;break}}return M.decodeTextCompaction(r,i,a,n),t}static decodeTextCompaction(e,t,n,r){let i=Se.ALPHA,a=Se.ALPHA,u=0;for(;u<n;){let h=e[u],g="";switch(i){case Se.ALPHA:if(h<26)g=String.fromCharCode(65+h);else switch(h){case 26:g=" ";break;case M.LL:i=Se.LOWER;break;case M.ML:i=Se.MIXED;break;case M.PS:a=i,i=Se.PUNCT_SHIFT;break;case M.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[u]);break;case M.TEXT_COMPACTION_MODE_LATCH:i=Se.ALPHA;break}break;case Se.LOWER:if(h<26)g=String.fromCharCode(97+h);else switch(h){case 26:g=" ";break;case M.AS:a=i,i=Se.ALPHA_SHIFT;break;case M.ML:i=Se.MIXED;break;case M.PS:a=i,i=Se.PUNCT_SHIFT;break;case M.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[u]);break;case M.TEXT_COMPACTION_MODE_LATCH:i=Se.ALPHA;break}break;case Se.MIXED:if(h<M.PL)g=M.MIXED_CHARS[h];else switch(h){case M.PL:i=Se.PUNCT;break;case 26:g=" ";break;case M.LL:i=Se.LOWER;break;case M.AL:i=Se.ALPHA;break;case M.PS:a=i,i=Se.PUNCT_SHIFT;break;case M.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[u]);break;case M.TEXT_COMPACTION_MODE_LATCH:i=Se.ALPHA;break}break;case Se.PUNCT:if(h<M.PAL)g=M.PUNCT_CHARS[h];else switch(h){case M.PAL:i=Se.ALPHA;break;case M.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[u]);break;case M.TEXT_COMPACTION_MODE_LATCH:i=Se.ALPHA;break}break;case Se.ALPHA_SHIFT:if(i=a,h<26)g=String.fromCharCode(65+h);else switch(h){case 26:g=" ";break;case M.TEXT_COMPACTION_MODE_LATCH:i=Se.ALPHA;break}break;case Se.PUNCT_SHIFT:if(i=a,h<M.PAL)g=M.PUNCT_CHARS[h];else switch(h){case M.PAL:i=Se.ALPHA;break;case M.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[u]);break;case M.TEXT_COMPACTION_MODE_LATCH:i=Se.ALPHA;break}break}g!==""&&r.append(g),u++}}static byteCompaction(e,t,n,r,i){let a=new $a,u=0,h=0,g=!1;switch(e){case M.BYTE_COMPACTION_MODE_LATCH:let x=new Int32Array(6),y=t[r++];for(;r<t[0]&&!g;)switch(x[u++]=y,h=900*h+y,y=t[r++],y){case M.TEXT_COMPACTION_MODE_LATCH:case M.BYTE_COMPACTION_MODE_LATCH:case M.NUMERIC_COMPACTION_MODE_LATCH:case M.BYTE_COMPACTION_MODE_LATCH_6:case M.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case M.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case M.MACRO_PDF417_TERMINATOR:r--,g=!0;break;default:if(u%5===0&&u>0){for(let E=0;E<6;++E)a.write(Number(Zt(h)>>Zt(8*(5-E))));h=0,u=0}break}r===t[0]&&y<M.TEXT_COMPACTION_MODE_LATCH&&(x[u++]=y);for(let E=0;E<u;E++)a.write(x[E]);break;case M.BYTE_COMPACTION_MODE_LATCH_6:for(;r<t[0]&&!g;){let E=t[r++];if(E<M.TEXT_COMPACTION_MODE_LATCH)u++,h=900*h+E;else switch(E){case M.TEXT_COMPACTION_MODE_LATCH:case M.BYTE_COMPACTION_MODE_LATCH:case M.NUMERIC_COMPACTION_MODE_LATCH:case M.BYTE_COMPACTION_MODE_LATCH_6:case M.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case M.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case M.MACRO_PDF417_TERMINATOR:r--,g=!0;break}if(u%5===0&&u>0){for(let S=0;S<6;++S)a.write(Number(Zt(h)>>Zt(8*(5-S))));h=0,u=0}}break}return i.append($.decode(a.toByteArray(),n)),r}static numericCompaction(e,t,n){let r=0,i=!1,a=new Int32Array(M.MAX_NUMERIC_CODEWORDS);for(;t<e[0]&&!i;){let u=e[t++];if(t===e[0]&&(i=!0),u<M.TEXT_COMPACTION_MODE_LATCH)a[r]=u,r++;else switch(u){case M.TEXT_COMPACTION_MODE_LATCH:case M.BYTE_COMPACTION_MODE_LATCH:case M.BYTE_COMPACTION_MODE_LATCH_6:case M.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case M.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case M.MACRO_PDF417_TERMINATOR:t--,i=!0;break}(r%M.MAX_NUMERIC_CODEWORDS===0||u===M.NUMERIC_COMPACTION_MODE_LATCH||i)&&r>0&&(n.append(M.decodeBase900toBase10(a,r)),r=0)}return t}static decodeBase900toBase10(e,t){let n=Zt(0);for(let i=0;i<t;i++)n+=M.EXP900[t-i-1]*Zt(e[i]);let r=n.toString();if(r.charAt(0)!=="1")throw new L;return r.substring(1)}}M.TEXT_COMPACTION_MODE_LATCH=900,M.BYTE_COMPACTION_MODE_LATCH=901,M.NUMERIC_COMPACTION_MODE_LATCH=902,M.BYTE_COMPACTION_MODE_LATCH_6=924,M.ECI_USER_DEFINED=925,M.ECI_GENERAL_PURPOSE=926,M.ECI_CHARSET=927,M.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,M.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,M.MACRO_PDF417_TERMINATOR=922,M.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,M.MAX_NUMERIC_CODEWORDS=15,M.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,M.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,M.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,M.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,M.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,M.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,M.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,M.PL=25,M.LL=27,M.AS=27,M.ML=28,M.AL=28,M.PS=29,M.PAL=29,M.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,M.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",M.EXP900=ss()?ec():[],M.NUMBER_OF_SEQUENCE_CODEWORDS=2;class ge{constructor(){}static decode(e,t,n,r,i,a,u){let h=new an(e,t,n,r,i),g=null,x=null,y;for(let T=!0;;T=!1){if(t!=null&&(g=ge.getRowIndicatorColumn(e,h,t,!0,a,u)),r!=null&&(x=ge.getRowIndicatorColumn(e,h,r,!1,a,u)),y=ge.merge(g,x),y==null)throw P.getNotFoundInstance();let v=y.getBoundingBox();if(T&&v!=null&&(v.getMinY()<h.getMinY()||v.getMaxY()>h.getMaxY()))h=v;else break}y.setBoundingBox(h);let E=y.getBarcodeColumnCount()+1;y.setDetectionResultColumn(0,g),y.setDetectionResultColumn(E,x);let S=g!=null;for(let T=1;T<=E;T++){let v=S?T:E-T;if(y.getDetectionResultColumn(v)!==void 0)continue;let R;v===0||v===E?R=new ts(h,v===0):R=new Bn(h),y.setDetectionResultColumn(v,R);let B=-1,H=B;for(let W=h.getMinY();W<=h.getMaxY();W++){if(B=ge.getStartColumn(y,v,W,S),B<0||B>h.getMaxX()){if(H===-1)continue;B=H}let U=ge.detectCodeword(e,h.getMinX(),h.getMaxX(),S,B,W,a,u);U!=null&&(R.setCodeword(W,U),H=B,a=Math.min(a,U.getWidth()),u=Math.max(u,U.getWidth()))}}return ge.createDecoderResult(y)}static merge(e,t){if(e==null&&t==null)return null;let n=ge.getBarcodeMetadata(e,t);if(n==null)return null;let r=an.merge(ge.adjustBoundingBox(e),ge.adjustBoundingBox(t));return new Ln(n,r)}static adjustBoundingBox(e){if(e==null)return null;let t=e.getRowHeights();if(t==null)return null;let n=ge.getMax(t),r=0;for(let u of t)if(r+=n-u,u>0)break;let i=e.getCodewords();for(let u=0;r>0&&i[u]==null;u++)r--;let a=0;for(let u=t.length-1;u>=0&&(a+=n-t[u],!(t[u]>0));u--);for(let u=i.length-1;a>0&&i[u]==null;u--)a--;return e.getBoundingBox().addMissingRows(r,a,e.isLeft())}static getMax(e){let t=-1;for(let n of e)t=Math.max(t,n);return t}static getBarcodeMetadata(e,t){let n;if(e==null||(n=e.getBarcodeMetadata())==null)return t==null?null:t.getBarcodeMetadata();let r;return t==null||(r=t.getBarcodeMetadata())==null?n:n.getColumnCount()!==r.getColumnCount()&&n.getErrorCorrectionLevel()!==r.getErrorCorrectionLevel()&&n.getRowCount()!==r.getRowCount()?null:n}static getRowIndicatorColumn(e,t,n,r,i,a){let u=new ts(t,r);for(let h=0;h<2;h++){let g=h===0?1:-1,x=Math.trunc(Math.trunc(n.getX()));for(let y=Math.trunc(Math.trunc(n.getY()));y<=t.getMaxY()&&y>=t.getMinY();y+=g){let E=ge.detectCodeword(e,0,e.getWidth(),r,x,y,i,a);E!=null&&(u.setCodeword(y,E),r?x=E.getStartX():x=E.getEndX())}}return u}static adjustCodewordCount(e,t){let n=t[0][1],r=n.getValue(),i=e.getBarcodeColumnCount()*e.getBarcodeRowCount()-ge.getNumberOfECCodeWords(e.getBarcodeECLevel());if(r.length===0){if(i<1||i>ue.MAX_CODEWORDS_IN_BARCODE)throw P.getNotFoundInstance();n.setValue(i)}else r[0]!==i&&n.setValue(i)}static createDecoderResult(e){let t=ge.createBarcodeMatrix(e);ge.adjustCodewordCount(e,t);let n=new Array,r=new Int32Array(e.getBarcodeRowCount()*e.getBarcodeColumnCount()),i=[],a=new Array;for(let h=0;h<e.getBarcodeRowCount();h++)for(let g=0;g<e.getBarcodeColumnCount();g++){let x=t[h][g+1].getValue(),y=h*e.getBarcodeColumnCount()+g;x.length===0?n.push(y):x.length===1?r[y]=x[0]:(a.push(y),i.push(x))}let u=new Array(i.length);for(let h=0;h<u.length;h++)u[h]=i[h];return ge.createDecoderResultFromAmbiguousValues(e.getBarcodeECLevel(),r,ue.toIntArray(n),ue.toIntArray(a),u)}static createDecoderResultFromAmbiguousValues(e,t,n,r,i){let a=new Int32Array(r.length),u=100;for(;u-- >0;){for(let h=0;h<a.length;h++)t[r[h]]=i[h][a[h]];try{return ge.decodeCodewords(t,e,n)}catch(h){if(!(h instanceof D))throw h}if(a.length===0)throw D.getChecksumInstance();for(let h=0;h<a.length;h++)if(a[h]<i[h].length-1){a[h]++;break}else if(a[h]=0,h===a.length-1)throw D.getChecksumInstance()}throw D.getChecksumInstance()}static createBarcodeMatrix(e){let t=Array.from({length:e.getBarcodeRowCount()},()=>new Array(e.getBarcodeColumnCount()+2));for(let r=0;r<t.length;r++)for(let i=0;i<t[r].length;i++)t[r][i]=new Pn;let n=0;for(let r of e.getDetectionResultColumns()){if(r!=null){for(let i of r.getCodewords())if(i!=null){let a=i.getRowNumber();if(a>=0){if(a>=t.length)continue;t[a][n].setValue(i.getValue())}}}n++}return t}static isValidBarcodeColumn(e,t){return t>=0&&t<=e.getBarcodeColumnCount()+1}static getStartColumn(e,t,n,r){let i=r?1:-1,a=null;if(ge.isValidBarcodeColumn(e,t-i)&&(a=e.getDetectionResultColumn(t-i).getCodeword(n)),a!=null)return r?a.getEndX():a.getStartX();if(a=e.getDetectionResultColumn(t).getCodewordNearby(n),a!=null)return r?a.getStartX():a.getEndX();if(ge.isValidBarcodeColumn(e,t-i)&&(a=e.getDetectionResultColumn(t-i).getCodewordNearby(n)),a!=null)return r?a.getEndX():a.getStartX();let u=0;for(;ge.isValidBarcodeColumn(e,t-i);){t-=i;for(let h of e.getDetectionResultColumn(t).getCodewords())if(h!=null)return(r?h.getEndX():h.getStartX())+i*u*(h.getEndX()-h.getStartX());u++}return r?e.getBoundingBox().getMinX():e.getBoundingBox().getMaxX()}static detectCodeword(e,t,n,r,i,a,u,h){i=ge.adjustCodewordStartColumn(e,t,n,r,i,a);let g=ge.getModuleBitCount(e,t,n,r,i,a);if(g==null)return null;let x,y=me.sum(g);if(r)x=i+y;else{for(let T=0;T<g.length/2;T++){let v=g[T];g[T]=g[g.length-1-T],g[g.length-1-T]=v}x=i,i=x-y}if(!ge.checkCodewordSkew(y,u,h))return null;let E=ht.getDecodedValue(g),S=ue.getCodeword(E);return S===-1?null:new Fn(i,x,ge.getCodewordBucketNumber(E),S)}static getModuleBitCount(e,t,n,r,i,a){let u=i,h=new Int32Array(8),g=0,x=r?1:-1,y=r;for(;(r?u<n:u>=t)&&g<h.length;)e.get(u,a)===y?(h[g]++,u+=x):(g++,y=!y);return g===h.length||u===(r?n:t)&&g===h.length-1?h:null}static getNumberOfECCodeWords(e){return 2<<e}static adjustCodewordStartColumn(e,t,n,r,i,a){let u=i,h=r?-1:1;for(let g=0;g<2;g++){for(;(r?u>=t:u<n)&&r===e.get(u,a);){if(Math.abs(i-u)>ge.CODEWORD_SKEW_SIZE)return i;u+=h}h=-h,r=!r}return u}static checkCodewordSkew(e,t,n){return t-ge.CODEWORD_SKEW_SIZE<=e&&e<=n+ge.CODEWORD_SKEW_SIZE}static decodeCodewords(e,t,n){if(e.length===0)throw L.getFormatInstance();let r=1<<t+1,i=ge.correctErrors(e,n,r);ge.verifyCodewordCount(e,r);let a=M.decode(e,""+t);return a.setErrorsCorrected(i),a.setErasures(n.length),a}static correctErrors(e,t,n){if(t!=null&&t.length>n/2+ge.MAX_ERRORS||n<0||n>ge.MAX_EC_CODEWORDS)throw D.getChecksumInstance();return ge.errorCorrection.decode(e,n,t)}static verifyCodewordCount(e,t){if(e.length<4)throw L.getFormatInstance();let n=e[0];if(n>e.length)throw L.getFormatInstance();if(n===0)if(t<e.length)e[0]=e.length-t;else throw L.getFormatInstance()}static getBitCountForCodeword(e){let t=new Int32Array(8),n=0,r=t.length-1;for(;!((e&1)!==n&&(n=e&1,r--,r<0));)t[r]++,e>>=1;return t}static getCodewordBucketNumber(e){return e instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(e):this.getCodewordBucketNumber_number(e)}static getCodewordBucketNumber_number(e){return ge.getCodewordBucketNumber(ge.getBitCountForCodeword(e))}static getCodewordBucketNumber_Int32Array(e){return(e[0]-e[2]+e[4]-e[6]+9)%9}static toString(e){let t=new kn;for(let n=0;n<e.length;n++){t.format("Row %2d: ",n);for(let r=0;r<e[n].length;r++){let i=e[n][r];i.getValue().length===0?t.format("        ",null):t.format("%4d(%2d)",i.getValue()[0],i.getConfidence(i.getValue()[0]))}t.format("%n")}return t.toString()}}ge.CODEWORD_SKEW_SIZE=2,ge.MAX_ERRORS=3,ge.MAX_EC_CODEWORDS=512,ge.errorCorrection=new es;class et{decode(e,t=null){let n=et.decode(e,t,!1);if(n==null||n.length===0||n[0]==null)throw P.getNotFoundInstance();return n[0]}decodeMultiple(e,t=null){try{return et.decode(e,t,!0)}catch(n){throw n instanceof L||n instanceof D?P.getNotFoundInstance():n}}static decode(e,t,n){const r=new Array,i=fe.detectMultiple(e,t,n);for(const a of i.getPoints()){const u=ge.decode(i.getBits(),a[4],a[5],a[6],a[7],et.getMinCodewordWidth(a),et.getMaxCodewordWidth(a)),h=new Qe(u.getText(),u.getRawBytes(),void 0,a,se.PDF_417);h.putMetadata(Ie.ERROR_CORRECTION_LEVEL,u.getECLevel());const g=u.getOther();g!=null&&h.putMetadata(Ie.PDF417_EXTRA_METADATA,g),r.push(h)}return r.map(a=>a)}static getMaxWidth(e,t){return e==null||t==null?0:Math.trunc(Math.abs(e.getX()-t.getX()))}static getMinWidth(e,t){return e==null||t==null?j.MAX_VALUE:Math.trunc(Math.abs(e.getX()-t.getX()))}static getMaxCodewordWidth(e){return Math.floor(Math.max(Math.max(et.getMaxWidth(e[0],e[4]),et.getMaxWidth(e[6],e[2])*ue.MODULES_IN_CODEWORD/ue.MODULES_IN_STOP_PATTERN),Math.max(et.getMaxWidth(e[1],e[5]),et.getMaxWidth(e[7],e[3])*ue.MODULES_IN_CODEWORD/ue.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(e){return Math.floor(Math.min(Math.min(et.getMinWidth(e[0],e[4]),et.getMinWidth(e[6],e[2])*ue.MODULES_IN_CODEWORD/ue.MODULES_IN_STOP_PATTERN),Math.min(et.getMinWidth(e[1],e[5]),et.getMinWidth(e[7],e[3])*ue.MODULES_IN_CODEWORD/ue.MODULES_IN_STOP_PATTERN)))}reset(){}}class nr extends m{}nr.kind="ReaderException";class os{constructor(e,t){this.verbose=e===!0,t&&this.setHints(t)}decode(e,t){return t&&this.setHints(t),this.decodeInternal(e)}decodeWithState(e){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(e)}setHints(e){this.hints=e;const t=!c(e)&&e.get(X.TRY_HARDER)===!0,n=c(e)?null:e.get(X.POSSIBLE_FORMATS),r=new Array;if(!c(n)){const i=n.some(a=>a===se.UPC_A||a===se.UPC_E||a===se.EAN_13||a===se.EAN_8||a===se.CODABAR||a===se.CODE_39||a===se.CODE_93||a===se.CODE_128||a===se.ITF||a===se.RSS_14||a===se.RSS_EXPANDED);i&&!t&&r.push(new bn(e,this.verbose)),n.includes(se.QR_CODE)&&r.push(new qt),n.includes(se.DATA_MATRIX)&&r.push(new Yt),n.includes(se.AZTEC)&&r.push(new Kn),n.includes(se.PDF_417)&&r.push(new et),i&&t&&r.push(new bn(e,this.verbose))}r.length===0&&(t||r.push(new bn(e,this.verbose)),r.push(new qt),r.push(new Yt),r.push(new Kn),r.push(new et),t&&r.push(new bn(e,this.verbose))),this.readers=r}reset(){if(this.readers!==null)for(const e of this.readers)e.reset()}decodeInternal(e){if(this.readers===null)throw new nr("No readers where selected, nothing can be read.");for(const t of this.readers)try{return t.decode(e,this.hints)}catch(n){if(n instanceof nr)continue}throw new P("No MultiFormat Readers were able to detect the code.")}}class tc extends St{constructor(e=null,t=500){const n=new os;n.setHints(e),super(n,t)}decodeBitmap(e){return this.reader.decodeWithState(e)}}class nc extends St{constructor(e=500){super(new et,e)}}class rc extends St{constructor(e=500){super(new qt,e)}}var Br;(function(C){C[C.ERROR_CORRECTION=0]="ERROR_CORRECTION",C[C.CHARACTER_SET=1]="CHARACTER_SET",C[C.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",C[C.MIN_SIZE=3]="MIN_SIZE",C[C.MAX_SIZE=4]="MAX_SIZE",C[C.MARGIN=5]="MARGIN",C[C.PDF417_COMPACT=6]="PDF417_COMPACT",C[C.PDF417_COMPACTION=7]="PDF417_COMPACTION",C[C.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",C[C.AZTEC_LAYERS=9]="AZTEC_LAYERS",C[C.QR_VERSION=10]="QR_VERSION"})(Br||(Br={}));var Ye=Br;class Pr{constructor(e){this.field=e,this.cachedGenerators=[],this.cachedGenerators.push(new lt(e,Int32Array.from([1])))}buildGenerator(e){const t=this.cachedGenerators;if(e>=t.length){let n=t[t.length-1];const r=this.field;for(let i=t.length;i<=e;i++){const a=n.multiply(new lt(r,Int32Array.from([1,r.exp(i-1+r.getGeneratorBase())])));t.push(a),n=a}}return t[e]}encode(e,t){if(t===0)throw new _("No error correction bytes");const n=e.length-t;if(n<=0)throw new _("No data bytes provided");const r=this.buildGenerator(t),i=new Int32Array(n);G.arraycopy(e,0,i,0,n);let a=new lt(this.field,i);a=a.multiplyByMonomial(t,1);const h=a.divide(r)[1].getCoefficients(),g=t-h.length;for(let x=0;x<g;x++)e[n+x]=0;G.arraycopy(h,0,e,n+g,h.length)}}class Ue{constructor(){}static applyMaskPenaltyRule1(e){return Ue.applyMaskPenaltyRule1Internal(e,!0)+Ue.applyMaskPenaltyRule1Internal(e,!1)}static applyMaskPenaltyRule2(e){let t=0;const n=e.getArray(),r=e.getWidth(),i=e.getHeight();for(let a=0;a<i-1;a++){const u=n[a];for(let h=0;h<r-1;h++){const g=u[h];g===u[h+1]&&g===n[a+1][h]&&g===n[a+1][h+1]&&t++}}return Ue.N2*t}static applyMaskPenaltyRule3(e){let t=0;const n=e.getArray(),r=e.getWidth(),i=e.getHeight();for(let a=0;a<i;a++)for(let u=0;u<r;u++){const h=n[a];u+6<r&&h[u]===1&&h[u+1]===0&&h[u+2]===1&&h[u+3]===1&&h[u+4]===1&&h[u+5]===0&&h[u+6]===1&&(Ue.isWhiteHorizontal(h,u-4,u)||Ue.isWhiteHorizontal(h,u+7,u+11))&&t++,a+6<i&&n[a][u]===1&&n[a+1][u]===0&&n[a+2][u]===1&&n[a+3][u]===1&&n[a+4][u]===1&&n[a+5][u]===0&&n[a+6][u]===1&&(Ue.isWhiteVertical(n,u,a-4,a)||Ue.isWhiteVertical(n,u,a+7,a+11))&&t++}return t*Ue.N3}static isWhiteHorizontal(e,t,n){t=Math.max(t,0),n=Math.min(n,e.length);for(let r=t;r<n;r++)if(e[r]===1)return!1;return!0}static isWhiteVertical(e,t,n,r){n=Math.max(n,0),r=Math.min(r,e.length);for(let i=n;i<r;i++)if(e[i][t]===1)return!1;return!0}static applyMaskPenaltyRule4(e){let t=0;const n=e.getArray(),r=e.getWidth(),i=e.getHeight();for(let h=0;h<i;h++){const g=n[h];for(let x=0;x<r;x++)g[x]===1&&t++}const a=e.getHeight()*e.getWidth();return Math.floor(Math.abs(t*2-a)*10/a)*Ue.N4}static getDataMaskBit(e,t,n){let r,i;switch(e){case 0:r=n+t&1;break;case 1:r=n&1;break;case 2:r=t%3;break;case 3:r=(n+t)%3;break;case 4:r=Math.floor(n/2)+Math.floor(t/3)&1;break;case 5:i=n*t,r=(i&1)+i%3;break;case 6:i=n*t,r=(i&1)+i%3&1;break;case 7:i=n*t,r=i%3+(n+t&1)&1;break;default:throw new _("Invalid mask pattern: "+e)}return r===0}static applyMaskPenaltyRule1Internal(e,t){let n=0;const r=t?e.getHeight():e.getWidth(),i=t?e.getWidth():e.getHeight(),a=e.getArray();for(let u=0;u<r;u++){let h=0,g=-1;for(let x=0;x<i;x++){const y=t?a[u][x]:a[x][u];y===g?h++:(h>=5&&(n+=Ue.N1+(h-5)),h=1,g=y)}h>=5&&(n+=Ue.N1+(h-5))}return n}}Ue.N1=3,Ue.N2=3,Ue.N3=40,Ue.N4=10;class rr{constructor(e,t){this.width=e,this.height=t;const n=new Array(t);for(let r=0;r!==t;r++)n[r]=new Uint8Array(e);this.bytes=n}getHeight(){return this.height}getWidth(){return this.width}get(e,t){return this.bytes[t][e]}getArray(){return this.bytes}setNumber(e,t,n){this.bytes[t][e]=n}setBoolean(e,t,n){this.bytes[t][e]=n?1:0}clear(e){for(const t of this.bytes)te.fill(t,e)}equals(e){if(!(e instanceof rr))return!1;const t=e;if(this.width!==t.width||this.height!==t.height)return!1;for(let n=0,r=this.height;n<r;++n){const i=this.bytes[n],a=t.bytes[n];for(let u=0,h=this.width;u<h;++u)if(i[u]!==a[u])return!1}return!0}toString(){const e=new q;for(let t=0,n=this.height;t<n;++t){const r=this.bytes[t];for(let i=0,a=this.width;i<a;++i)switch(r[i]){case 0:e.append(" 0");break;case 1:e.append(" 1");break;default:e.append("  ");break}e.append(`
`)}return e.toString()}}class cn{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const e=new q;return e.append(`<<
`),e.append(" mode: "),e.append(this.mode?this.mode.toString():"null"),e.append(`
 ecLevel: `),e.append(this.ecLevel?this.ecLevel.toString():"null"),e.append(`
 version: `),e.append(this.version?this.version.toString():"null"),e.append(`
 maskPattern: `),e.append(this.maskPattern.toString()),this.matrix?(e.append(`
 matrix:
`),e.append(this.matrix.toString())):e.append(`
 matrix: null
`),e.append(`>>
`),e.toString()}setMode(e){this.mode=e}setECLevel(e){this.ecLevel=e}setVersion(e){this.version=e}setMaskPattern(e){this.maskPattern=e}setMatrix(e){this.matrix=e}static isValidMaskPattern(e){return e>=0&&e<cn.NUM_MASK_PATTERNS}}cn.NUM_MASK_PATTERNS=8;class ve extends m{}ve.kind="WriterException";class le{constructor(){}static clearMatrix(e){e.clear(255)}static buildMatrix(e,t,n,r,i){le.clearMatrix(i),le.embedBasicPatterns(n,i),le.embedTypeInfo(t,r,i),le.maybeEmbedVersionInfo(n,i),le.embedDataBits(e,r,i)}static embedBasicPatterns(e,t){le.embedPositionDetectionPatternsAndSeparators(t),le.embedDarkDotAtLeftBottomCorner(t),le.maybeEmbedPositionAdjustmentPatterns(e,t),le.embedTimingPatterns(t)}static embedTypeInfo(e,t,n){const r=new K;le.makeTypeInfoBits(e,t,r);for(let i=0,a=r.getSize();i<a;++i){const u=r.get(r.getSize()-1-i),h=le.TYPE_INFO_COORDINATES[i],g=h[0],x=h[1];if(n.setBoolean(g,x,u),i<8){const y=n.getWidth()-i-1;n.setBoolean(y,8,u)}else{const E=n.getHeight()-7+(i-8);n.setBoolean(8,E,u)}}}static maybeEmbedVersionInfo(e,t){if(e.getVersionNumber()<7)return;const n=new K;le.makeVersionInfoBits(e,n);let r=17;for(let i=0;i<6;++i)for(let a=0;a<3;++a){const u=n.get(r);r--,t.setBoolean(i,t.getHeight()-11+a,u),t.setBoolean(t.getHeight()-11+a,i,u)}}static embedDataBits(e,t,n){let r=0,i=-1,a=n.getWidth()-1,u=n.getHeight()-1;for(;a>0;){for(a===6&&(a-=1);u>=0&&u<n.getHeight();){for(let h=0;h<2;++h){const g=a-h;if(!le.isEmpty(n.get(g,u)))continue;let x;r<e.getSize()?(x=e.get(r),++r):x=!1,t!==255&&Ue.getDataMaskBit(t,g,u)&&(x=!x),n.setBoolean(g,u,x)}u+=i}i=-i,u+=i,a-=2}if(r!==e.getSize())throw new ve("Not all bits consumed: "+r+"/"+e.getSize())}static findMSBSet(e){return 32-j.numberOfLeadingZeros(e)}static calculateBCHCode(e,t){if(t===0)throw new _("0 polynomial");const n=le.findMSBSet(t);for(e<<=n-1;le.findMSBSet(e)>=n;)e^=t<<le.findMSBSet(e)-n;return e}static makeTypeInfoBits(e,t,n){if(!cn.isValidMaskPattern(t))throw new ve("Invalid mask pattern");const r=e.getBits()<<3|t;n.appendBits(r,5);const i=le.calculateBCHCode(r,le.TYPE_INFO_POLY);n.appendBits(i,10);const a=new K;if(a.appendBits(le.TYPE_INFO_MASK_PATTERN,15),n.xor(a),n.getSize()!==15)throw new ve("should not happen but we got: "+n.getSize())}static makeVersionInfoBits(e,t){t.appendBits(e.getVersionNumber(),6);const n=le.calculateBCHCode(e.getVersionNumber(),le.VERSION_INFO_POLY);if(t.appendBits(n,12),t.getSize()!==18)throw new ve("should not happen but we got: "+t.getSize())}static isEmpty(e){return e===255}static embedTimingPatterns(e){for(let t=8;t<e.getWidth()-8;++t){const n=(t+1)%2;le.isEmpty(e.get(t,6))&&e.setNumber(t,6,n),le.isEmpty(e.get(6,t))&&e.setNumber(6,t,n)}}static embedDarkDotAtLeftBottomCorner(e){if(e.get(8,e.getHeight()-8)===0)throw new ve;e.setNumber(8,e.getHeight()-8,1)}static embedHorizontalSeparationPattern(e,t,n){for(let r=0;r<8;++r){if(!le.isEmpty(n.get(e+r,t)))throw new ve;n.setNumber(e+r,t,0)}}static embedVerticalSeparationPattern(e,t,n){for(let r=0;r<7;++r){if(!le.isEmpty(n.get(e,t+r)))throw new ve;n.setNumber(e,t+r,0)}}static embedPositionAdjustmentPattern(e,t,n){for(let r=0;r<5;++r){const i=le.POSITION_ADJUSTMENT_PATTERN[r];for(let a=0;a<5;++a)n.setNumber(e+a,t+r,i[a])}}static embedPositionDetectionPattern(e,t,n){for(let r=0;r<7;++r){const i=le.POSITION_DETECTION_PATTERN[r];for(let a=0;a<7;++a)n.setNumber(e+a,t+r,i[a])}}static embedPositionDetectionPatternsAndSeparators(e){const t=le.POSITION_DETECTION_PATTERN[0].length;le.embedPositionDetectionPattern(0,0,e),le.embedPositionDetectionPattern(e.getWidth()-t,0,e),le.embedPositionDetectionPattern(0,e.getWidth()-t,e);const n=8;le.embedHorizontalSeparationPattern(0,n-1,e),le.embedHorizontalSeparationPattern(e.getWidth()-n,n-1,e),le.embedHorizontalSeparationPattern(0,e.getWidth()-n,e);const r=7;le.embedVerticalSeparationPattern(r,0,e),le.embedVerticalSeparationPattern(e.getHeight()-r-1,0,e),le.embedVerticalSeparationPattern(r,e.getHeight()-r,e)}static maybeEmbedPositionAdjustmentPatterns(e,t){if(e.getVersionNumber()<2)return;const n=e.getVersionNumber()-1,r=le.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[n];for(let i=0,a=r.length;i!==a;i++){const u=r[i];if(u>=0)for(let h=0;h!==a;h++){const g=r[h];g>=0&&le.isEmpty(t.get(g,u))&&le.embedPositionAdjustmentPattern(g-2,u-2,t)}}}}le.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),le.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),le.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),le.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),le.VERSION_INFO_POLY=7973,le.TYPE_INFO_POLY=1335,le.TYPE_INFO_MASK_PATTERN=21522;class ic{constructor(e,t){this.dataBytes=e,this.errorCorrectionBytes=t}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class De{constructor(){}static calculateMaskPenalty(e){return Ue.applyMaskPenaltyRule1(e)+Ue.applyMaskPenaltyRule2(e)+Ue.applyMaskPenaltyRule3(e)+Ue.applyMaskPenaltyRule4(e)}static encode(e,t,n=null){let r=De.DEFAULT_BYTE_MODE_ENCODING;const i=n!==null&&n.get(Ye.CHARACTER_SET)!==void 0;i&&(r=n.get(Ye.CHARACTER_SET).toString());const a=this.chooseMode(e,r),u=new K;if(a===oe.BYTE&&(i||De.DEFAULT_BYTE_MODE_ENCODING!==r)){const W=k.getCharacterSetECIByName(r);W!==void 0&&this.appendECI(W,u)}this.appendModeInfo(a,u);const h=new K;this.appendBytes(e,a,h,r);let g;if(n!==null&&n.get(Ye.QR_VERSION)!==void 0){const W=Number.parseInt(n.get(Ye.QR_VERSION).toString(),10);g=ie.getVersionForNumber(W);const U=this.calculateBitsNeeded(a,u,h,g);if(!this.willFit(U,g,t))throw new ve("Data too big for requested version")}else g=this.recommendVersion(t,a,u,h);const x=new K;x.appendBitArray(u);const y=a===oe.BYTE?h.getSizeInBytes():e.length;this.appendLengthInfo(y,g,a,x),x.appendBitArray(h);const E=g.getECBlocksForLevel(t),S=g.getTotalCodewords()-E.getTotalECCodewords();this.terminateBits(S,x);const T=this.interleaveWithECBytes(x,g.getTotalCodewords(),S,E.getNumBlocks()),v=new cn;v.setECLevel(t),v.setMode(a),v.setVersion(g);const R=g.getDimensionForVersion(),B=new rr(R,R),H=this.chooseMaskPattern(T,t,g,B);return v.setMaskPattern(H),le.buildMatrix(T,t,g,H,B),v.setMatrix(B),v}static recommendVersion(e,t,n,r){const i=this.calculateBitsNeeded(t,n,r,ie.getVersionForNumber(1)),a=this.chooseVersion(i,e),u=this.calculateBitsNeeded(t,n,r,a);return this.chooseVersion(u,e)}static calculateBitsNeeded(e,t,n,r){return t.getSize()+e.getCharacterCountBits(r)+n.getSize()}static getAlphanumericCode(e){return e<De.ALPHANUMERIC_TABLE.length?De.ALPHANUMERIC_TABLE[e]:-1}static chooseMode(e,t=null){if(k.SJIS.getName()===t&&this.isOnlyDoubleByteKanji(e))return oe.KANJI;let n=!1,r=!1;for(let i=0,a=e.length;i<a;++i){const u=e.charAt(i);if(De.isDigit(u))n=!0;else if(this.getAlphanumericCode(u.charCodeAt(0))!==-1)r=!0;else return oe.BYTE}return r?oe.ALPHANUMERIC:n?oe.NUMERIC:oe.BYTE}static isOnlyDoubleByteKanji(e){let t;try{t=$.encode(e,k.SJIS)}catch{return!1}const n=t.length;if(n%2!==0)return!1;for(let r=0;r<n;r+=2){const i=t[r]&255;if((i<129||i>159)&&(i<224||i>235))return!1}return!0}static chooseMaskPattern(e,t,n,r){let i=Number.MAX_SAFE_INTEGER,a=-1;for(let u=0;u<cn.NUM_MASK_PATTERNS;u++){le.buildMatrix(e,t,n,u,r);let h=this.calculateMaskPenalty(r);h<i&&(i=h,a=u)}return a}static chooseVersion(e,t){for(let n=1;n<=40;n++){const r=ie.getVersionForNumber(n);if(De.willFit(e,r,t))return r}throw new ve("Data too big")}static willFit(e,t,n){const r=t.getTotalCodewords(),a=t.getECBlocksForLevel(n).getTotalECCodewords(),u=r-a,h=(e+7)/8;return u>=h}static terminateBits(e,t){const n=e*8;if(t.getSize()>n)throw new ve("data bits cannot fit in the QR Code"+t.getSize()+" > "+n);for(let a=0;a<4&&t.getSize()<n;++a)t.appendBit(!1);const r=t.getSize()&7;if(r>0)for(let a=r;a<8;a++)t.appendBit(!1);const i=e-t.getSizeInBytes();for(let a=0;a<i;++a)t.appendBits((a&1)===0?236:17,8);if(t.getSize()!==n)throw new ve("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(e,t,n,r,i,a){if(r>=n)throw new ve("Block ID too large");const u=e%n,h=n-u,g=Math.floor(e/n),x=g+1,y=Math.floor(t/n),E=y+1,S=g-y,T=x-E;if(S!==T)throw new ve("EC bytes mismatch");if(n!==h+u)throw new ve("RS blocks mismatch");if(e!==(y+S)*h+(E+T)*u)throw new ve("Total bytes mismatch");r<h?(i[0]=y,a[0]=S):(i[0]=E,a[0]=T)}static interleaveWithECBytes(e,t,n,r){if(e.getSizeInBytes()!==n)throw new ve("Number of bits and data bytes does not match");let i=0,a=0,u=0;const h=new Array;for(let x=0;x<r;++x){const y=new Int32Array(1),E=new Int32Array(1);De.getNumDataBytesAndNumECBytesForBlockID(t,n,r,x,y,E);const S=y[0],T=new Uint8Array(S);e.toBytes(8*i,T,0,S);const v=De.generateECBytes(T,E[0]);h.push(new ic(T,v)),a=Math.max(a,S),u=Math.max(u,v.length),i+=y[0]}if(n!==i)throw new ve("Data bytes does not match offset");const g=new K;for(let x=0;x<a;++x)for(const y of h){const E=y.getDataBytes();x<E.length&&g.appendBits(E[x],8)}for(let x=0;x<u;++x)for(const y of h){const E=y.getErrorCorrectionBytes();x<E.length&&g.appendBits(E[x],8)}if(t!==g.getSizeInBytes())throw new ve("Interleaving error: "+t+" and "+g.getSizeInBytes()+" differ.");return g}static generateECBytes(e,t){const n=e.length,r=new Int32Array(n+t);for(let a=0;a<n;a++)r[a]=e[a]&255;new Pr(Ce.QR_CODE_FIELD_256).encode(r,t);const i=new Uint8Array(t);for(let a=0;a<t;a++)i[a]=r[n+a];return i}static appendModeInfo(e,t){t.appendBits(e.getBits(),4)}static appendLengthInfo(e,t,n,r){const i=n.getCharacterCountBits(t);if(e>=1<<i)throw new ve(e+" is bigger than "+((1<<i)-1));r.appendBits(e,i)}static appendBytes(e,t,n,r){switch(t){case oe.NUMERIC:De.appendNumericBytes(e,n);break;case oe.ALPHANUMERIC:De.appendAlphanumericBytes(e,n);break;case oe.BYTE:De.append8BitBytes(e,n,r);break;case oe.KANJI:De.appendKanjiBytes(e,n);break;default:throw new ve("Invalid mode: "+t)}}static getDigit(e){return e.charCodeAt(0)-48}static isDigit(e){const t=De.getDigit(e);return t>=0&&t<=9}static appendNumericBytes(e,t){const n=e.length;let r=0;for(;r<n;){const i=De.getDigit(e.charAt(r));if(r+2<n){const a=De.getDigit(e.charAt(r+1)),u=De.getDigit(e.charAt(r+2));t.appendBits(i*100+a*10+u,10),r+=3}else if(r+1<n){const a=De.getDigit(e.charAt(r+1));t.appendBits(i*10+a,7),r+=2}else t.appendBits(i,4),r++}}static appendAlphanumericBytes(e,t){const n=e.length;let r=0;for(;r<n;){const i=De.getAlphanumericCode(e.charCodeAt(r));if(i===-1)throw new ve;if(r+1<n){const a=De.getAlphanumericCode(e.charCodeAt(r+1));if(a===-1)throw new ve;t.appendBits(i*45+a,11),r+=2}else t.appendBits(i,6),r++}}static append8BitBytes(e,t,n){let r;try{r=$.encode(e,n)}catch(i){throw new ve(i)}for(let i=0,a=r.length;i!==a;i++){const u=r[i];t.appendBits(u,8)}}static appendKanjiBytes(e,t){let n;try{n=$.encode(e,k.SJIS)}catch(i){throw new ve(i)}const r=n.length;for(let i=0;i<r;i+=2){const a=n[i]&255,u=n[i+1]&255,h=a<<8&4294967295|u;let g=-1;if(h>=33088&&h<=40956?g=h-33088:h>=57408&&h<=60351&&(g=h-49472),g===-1)throw new ve("Invalid byte sequence");const x=(g>>8)*192+(g&255);t.appendBits(x,13)}}static appendECI(e,t){t.appendBits(oe.ECI.getBits(),4),t.appendBits(e.getValue(),8)}}De.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),De.DEFAULT_BYTE_MODE_ENCODING=k.UTF8.getName();class ln{write(e,t,n,r=null){if(e.length===0)throw new _("Found empty contents");if(t<0||n<0)throw new _("Requested dimensions are too small: "+t+"x"+n);let i=Oe.L,a=ln.QUIET_ZONE_SIZE;r!==null&&(r.get(Ye.ERROR_CORRECTION)!==void 0&&(i=Oe.fromString(r.get(Ye.ERROR_CORRECTION).toString())),r.get(Ye.MARGIN)!==void 0&&(a=Number.parseInt(r.get(Ye.MARGIN).toString(),10)));const u=De.encode(e,i,r);return this.renderResult(u,t,n,a)}writeToDom(e,t,n,r,i=null){typeof e=="string"&&(e=document.querySelector(e));const a=this.write(t,n,r,i);e&&e.appendChild(a)}renderResult(e,t,n,r){const i=e.getMatrix();if(i===null)throw new Nt;const a=i.getWidth(),u=i.getHeight(),h=a+r*2,g=u+r*2,x=Math.max(t,h),y=Math.max(n,g),E=Math.min(Math.floor(x/h),Math.floor(y/g)),S=Math.floor((x-a*E)/2),T=Math.floor((y-u*E)/2),v=this.createSVGElement(x,y);for(let R=0,B=T;R<u;R++,B+=E)for(let H=0,W=S;H<a;H++,W+=E)if(i.get(H,R)===1){const U=this.createSvgRectElement(W,B,E,E);v.appendChild(U)}return v}createSVGElement(e,t){const n=document.createElementNS(ln.SVG_NS,"svg");return n.setAttributeNS(null,"height",e.toString()),n.setAttributeNS(null,"width",t.toString()),n}createSvgRectElement(e,t,n,r){const i=document.createElementNS(ln.SVG_NS,"rect");return i.setAttributeNS(null,"x",e.toString()),i.setAttributeNS(null,"y",t.toString()),i.setAttributeNS(null,"height",n.toString()),i.setAttributeNS(null,"width",r.toString()),i.setAttributeNS(null,"fill","#000000"),i}}ln.QUIET_ZONE_SIZE=4,ln.SVG_NS="http://www.w3.org/2000/svg";class An{encode(e,t,n,r,i){if(e.length===0)throw new _("Found empty contents");if(t!==se.QR_CODE)throw new _("Can only encode QR_CODE, but got "+t);if(n<0||r<0)throw new _(`Requested dimensions are too small: ${n}x${r}`);let a=Oe.L,u=An.QUIET_ZONE_SIZE;i!==null&&(i.get(Ye.ERROR_CORRECTION)!==void 0&&(a=Oe.fromString(i.get(Ye.ERROR_CORRECTION).toString())),i.get(Ye.MARGIN)!==void 0&&(u=Number.parseInt(i.get(Ye.MARGIN).toString(),10)));const h=De.encode(e,a,i);return An.renderResult(h,n,r,u)}static renderResult(e,t,n,r){const i=e.getMatrix();if(i===null)throw new Nt;const a=i.getWidth(),u=i.getHeight(),h=a+r*2,g=u+r*2,x=Math.max(t,h),y=Math.max(n,g),E=Math.min(Math.floor(x/h),Math.floor(y/g)),S=Math.floor((x-a*E)/2),T=Math.floor((y-u*E)/2),v=new re(x,y);for(let R=0,B=T;R<u;R++,B+=E)for(let H=0,W=S;H<a;H++,W+=E)i.get(H,R)===1&&v.setRegion(W,B,E,E);return v}}An.QUIET_ZONE_SIZE=4;class sc{encode(e,t,n,r,i){let a;switch(t){case se.QR_CODE:a=new An;break;default:throw new _("No encoder available for format "+t)}return a.encode(e,t,n,r,i)}}class kt extends jt{constructor(e,t,n,r,i,a,u,h){if(super(a,u),this.yuvData=e,this.dataWidth=t,this.dataHeight=n,this.left=r,this.top=i,r+a>t||i+u>n)throw new _("Crop rectangle does not fit within image data.");h&&this.reverseHorizontal(a,u)}getRow(e,t){if(e<0||e>=this.getHeight())throw new _("Requested row is outside the image: "+e);const n=this.getWidth();(t==null||t.length<n)&&(t=new Uint8ClampedArray(n));const r=(e+this.top)*this.dataWidth+this.left;return G.arraycopy(this.yuvData,r,t,0,n),t}getMatrix(){const e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.yuvData;const n=e*t,r=new Uint8ClampedArray(n);let i=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return G.arraycopy(this.yuvData,i,r,0,n),r;for(let a=0;a<t;a++){const u=a*e;G.arraycopy(this.yuvData,i,r,u,e),i+=this.dataWidth}return r}isCropSupported(){return!0}crop(e,t,n,r){return new kt(this.yuvData,this.dataWidth,this.dataHeight,this.left+e,this.top+t,n,r,!1)}renderThumbnail(){const e=this.getWidth()/kt.THUMBNAIL_SCALE_FACTOR,t=this.getHeight()/kt.THUMBNAIL_SCALE_FACTOR,n=new Int32Array(e*t),r=this.yuvData;let i=this.top*this.dataWidth+this.left;for(let a=0;a<t;a++){const u=a*e;for(let h=0;h<e;h++){const g=r[i+h*kt.THUMBNAIL_SCALE_FACTOR]&255;n[u+h]=4278190080|g*65793}i+=this.dataWidth*kt.THUMBNAIL_SCALE_FACTOR}return n}getThumbnailWidth(){return this.getWidth()/kt.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/kt.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(e,t){const n=this.yuvData;for(let r=0,i=this.top*this.dataWidth+this.left;r<t;r++,i+=this.dataWidth){const a=i+e/2;for(let u=i,h=i+e-1;u<a;u++,h--){const g=n[u];n[u]=n[h],n[h]=g}}}invert(){return new Rt(this)}}kt.THUMBNAIL_SCALE_FACTOR=2;class Lr extends jt{constructor(e,t,n,r,i,a,u){if(super(t,n),this.dataWidth=r,this.dataHeight=i,this.left=a,this.top=u,e.BYTES_PER_ELEMENT===4){const h=t*n,g=new Uint8ClampedArray(h);for(let x=0;x<h;x++){const y=e[x],E=y>>16&255,S=y>>7&510,T=y&255;g[x]=(E+S+T)/4&255}this.luminances=g}else this.luminances=e;if(r===void 0&&(this.dataWidth=t),i===void 0&&(this.dataHeight=n),a===void 0&&(this.left=0),u===void 0&&(this.top=0),this.left+t>this.dataWidth||this.top+n>this.dataHeight)throw new _("Crop rectangle does not fit within image data.")}getRow(e,t){if(e<0||e>=this.getHeight())throw new _("Requested row is outside the image: "+e);const n=this.getWidth();(t==null||t.length<n)&&(t=new Uint8ClampedArray(n));const r=(e+this.top)*this.dataWidth+this.left;return G.arraycopy(this.luminances,r,t,0,n),t}getMatrix(){const e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.luminances;const n=e*t,r=new Uint8ClampedArray(n);let i=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return G.arraycopy(this.luminances,i,r,0,n),r;for(let a=0;a<t;a++){const u=a*e;G.arraycopy(this.luminances,i,r,u,e),i+=this.dataWidth}return r}isCropSupported(){return!0}crop(e,t,n,r){return new Lr(this.luminances,n,r,this.dataWidth,this.dataHeight,this.left+e,this.top+t)}invert(){return new Rt(this)}}class as extends k{static forName(e){return this.getCharacterSetECIByName(e)}}class Fr{}Fr.ISO_8859_1=k.ISO8859_1;class cs{isCompact(){return this.compact}setCompact(e){this.compact=e}getSize(){return this.size}setSize(e){this.size=e}getLayers(){return this.layers}setLayers(e){this.layers=e}getCodeWords(){return this.codeWords}setCodeWords(e){this.codeWords=e}getMatrix(){return this.matrix}setMatrix(e){this.matrix=e}}class ls{static singletonList(e){return[e]}static min(e,t){return e.sort(t)[0]}}class oc{constructor(e){this.previous=e}getPrevious(){return this.previous}}class In extends oc{constructor(e,t,n){super(e),this.value=t,this.bitCount=n}appendTo(e,t){e.appendBits(this.value,this.bitCount)}add(e,t){return new In(this,e,t)}addBinaryShift(e,t){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new In(this,e,t)}toString(){let e=this.value&(1<<this.bitCount)-1;return e|=1<<this.bitCount,"<"+j.toBinaryString(e|1<<this.bitCount).substring(1)+">"}}class Ur extends In{constructor(e,t,n){super(e,0,0),this.binaryShiftStart=t,this.binaryShiftByteCount=n}appendTo(e,t){for(let n=0;n<this.binaryShiftByteCount;n++)(n===0||n===31&&this.binaryShiftByteCount<=62)&&(e.appendBits(31,5),this.binaryShiftByteCount>62?e.appendBits(this.binaryShiftByteCount-31,16):n===0?e.appendBits(Math.min(this.binaryShiftByteCount,31),5):e.appendBits(this.binaryShiftByteCount-31,5)),e.appendBits(t[this.binaryShiftStart+n],8)}addBinaryShift(e,t){return new Ur(this,e,t)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function ac(C,e,t){return new Ur(C,e,t)}function Un(C,e,t){return new In(C,e,t)}const cc=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],Kt=0,ir=1,It=2,us=3,Bt=4,lc=new In(null,0,0),Vr=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])];function uc(C){for(let e of C)te.fill(e,-1);return C[Kt][Bt]=0,C[ir][Bt]=0,C[ir][Kt]=28,C[us][Bt]=0,C[It][Bt]=0,C[It][Kt]=15,C}const ds=uc(te.createInt32Array(6,6));class Pt{constructor(e,t,n,r){this.token=e,this.mode=t,this.binaryShiftByteCount=n,this.bitCount=r}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(e,t){let n=this.bitCount,r=this.token;if(e!==this.mode){let a=Vr[this.mode][e];r=Un(r,a&65535,a>>16),n+=a>>16}let i=e===It?4:5;return r=Un(r,t,i),new Pt(r,e,0,n+i)}shiftAndAppend(e,t){let n=this.token,r=this.mode===It?4:5;return n=Un(n,ds[this.mode][e],r),n=Un(n,t,5),new Pt(n,this.mode,0,this.bitCount+r+5)}addBinaryShiftChar(e){let t=this.token,n=this.mode,r=this.bitCount;if(this.mode===Bt||this.mode===It){let u=Vr[n][Kt];t=Un(t,u&65535,u>>16),r+=u>>16,n=Kt}let i=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,a=new Pt(t,n,this.binaryShiftByteCount+1,r+i);return a.binaryShiftByteCount===2078&&(a=a.endBinaryShift(e+1)),a}endBinaryShift(e){if(this.binaryShiftByteCount===0)return this;let t=this.token;return t=ac(t,e-this.binaryShiftByteCount,this.binaryShiftByteCount),new Pt(t,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(e){let t=this.bitCount+(Vr[this.mode][e.mode]>>16);return this.binaryShiftByteCount<e.binaryShiftByteCount?t+=Pt.calculateBinaryShiftCost(e)-Pt.calculateBinaryShiftCost(this):this.binaryShiftByteCount>e.binaryShiftByteCount&&e.binaryShiftByteCount>0&&(t+=10),t<=e.bitCount}toBitArray(e){let t=[];for(let r=this.endBinaryShift(e.length).token;r!==null;r=r.getPrevious())t.unshift(r);let n=new K;for(const r of t)r.appendTo(n,e);return n}toString(){return V.format("%s bits=%d bytes=%d",cc[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(e){return e.binaryShiftByteCount>62?21:e.binaryShiftByteCount>31?20:e.binaryShiftByteCount>0?10:0}}Pt.INITIAL_STATE=new Pt(lc,Kt,0,0);function dc(C){const e=V.getCharCode(" "),t=V.getCharCode("."),n=V.getCharCode(",");C[Kt][e]=1;const r=V.getCharCode("Z"),i=V.getCharCode("A");for(let E=i;E<=r;E++)C[Kt][E]=E-i+2;C[ir][e]=1;const a=V.getCharCode("z"),u=V.getCharCode("a");for(let E=u;E<=a;E++)C[ir][E]=E-u+2;C[It][e]=1;const h=V.getCharCode("9"),g=V.getCharCode("0");for(let E=g;E<=h;E++)C[It][E]=E-g+2;C[It][n]=12,C[It][t]=13;const x=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let E=0;E<x.length;E++)C[us][V.getCharCode(x[E])]=E;const y=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let E=0;E<y.length;E++)V.getCharCode(y[E])>0&&(C[Bt][V.getCharCode(y[E])]=E);return C}const Hr=dc(te.createInt32Array(5,256));class Vn{constructor(e){this.text=e}encode(){const e=V.getCharCode(" "),t=V.getCharCode(`
`);let n=ls.singletonList(Pt.INITIAL_STATE);for(let i=0;i<this.text.length;i++){let a,u=i+1<this.text.length?this.text[i+1]:0;switch(this.text[i]){case V.getCharCode("\r"):a=u===t?2:0;break;case V.getCharCode("."):a=u===e?3:0;break;case V.getCharCode(","):a=u===e?4:0;break;case V.getCharCode(":"):a=u===e?5:0;break;default:a=0}a>0?(n=Vn.updateStateListForPair(n,i,a),i++):n=this.updateStateListForChar(n,i)}return ls.min(n,(i,a)=>i.getBitCount()-a.getBitCount()).toBitArray(this.text)}updateStateListForChar(e,t){const n=[];for(let r of e)this.updateStateForChar(r,t,n);return Vn.simplifyStates(n)}updateStateForChar(e,t,n){let r=this.text[t]&255,i=Hr[e.getMode()][r]>0,a=null;for(let u=0;u<=Bt;u++){let h=Hr[u][r];if(h>0){if(a==null&&(a=e.endBinaryShift(t)),!i||u===e.getMode()||u===It){const g=a.latchAndAppend(u,h);n.push(g)}if(!i&&ds[e.getMode()][u]>=0){const g=a.shiftAndAppend(u,h);n.push(g)}}}if(e.getBinaryShiftByteCount()>0||Hr[e.getMode()][r]===0){let u=e.addBinaryShiftChar(t);n.push(u)}}static updateStateListForPair(e,t,n){const r=[];for(let i of e)this.updateStateForPair(i,t,n,r);return this.simplifyStates(r)}static updateStateForPair(e,t,n,r){let i=e.endBinaryShift(t);if(r.push(i.latchAndAppend(Bt,n)),e.getMode()!==Bt&&r.push(i.shiftAndAppend(Bt,n)),n===3||n===4){let a=i.latchAndAppend(It,16-n).latchAndAppend(It,1);r.push(a)}if(e.getBinaryShiftByteCount()>0){let a=e.addBinaryShiftChar(t).addBinaryShiftChar(t+1);r.push(a)}}static simplifyStates(e){let t=[];for(const n of e){let r=!0;for(const i of t){if(i.isBetterThanOrEqualTo(n)){r=!1;break}n.isBetterThanOrEqualTo(i)&&(t=t.filter(a=>a!==i))}r&&t.push(n)}return t}}class we{constructor(){}static encodeBytes(e){return we.encode(e,we.DEFAULT_EC_PERCENT,we.DEFAULT_AZTEC_LAYERS)}static encode(e,t,n){let r=new Vn(e).encode(),i=j.truncDivision(r.getSize()*t,100)+11,a=r.getSize()+i,u,h,g,x,y;if(n!==we.DEFAULT_AZTEC_LAYERS){if(u=n<0,h=Math.abs(n),h>(u?we.MAX_NB_BITS_COMPACT:we.MAX_NB_BITS))throw new _(V.format("Illegal value %s for layers",n));g=we.totalBitsInLayer(h,u),x=we.WORD_SIZE[h];let U=g-g%x;if(y=we.stuffBits(r,x),y.getSize()+i>U)throw new _("Data to large for user specified layer");if(u&&y.getSize()>x*64)throw new _("Data to large for user specified layer")}else{x=0,y=null;for(let U=0;;U++){if(U>we.MAX_NB_BITS)throw new _("Data too large for an Aztec code");if(u=U<=3,h=u?U+1:U,g=we.totalBitsInLayer(h,u),a>g)continue;(y==null||x!==we.WORD_SIZE[h])&&(x=we.WORD_SIZE[h],y=we.stuffBits(r,x));let pe=g-g%x;if(!(u&&y.getSize()>x*64)&&y.getSize()+i<=pe)break}}let E=we.generateCheckWords(y,g,x),S=y.getSize()/x,T=we.generateModeMessage(u,h,S),v=(u?11:14)+h*4,R=new Int32Array(v),B;if(u){B=v;for(let U=0;U<R.length;U++)R[U]=U}else{B=v+1+2*j.truncDivision(j.truncDivision(v,2)-1,15);let U=j.truncDivision(v,2),pe=j.truncDivision(B,2);for(let he=0;he<U;he++){let ft=he+j.truncDivision(he,15);R[U-he-1]=pe-ft-1,R[U+he]=pe+ft+1}}let H=new re(B);for(let U=0,pe=0;U<h;U++){let he=(h-U)*4+(u?9:12);for(let ft=0;ft<he;ft++){let vt=ft*2;for(let gt=0;gt<2;gt++)E.get(pe+vt+gt)&&H.set(R[U*2+gt],R[U*2+ft]),E.get(pe+he*2+vt+gt)&&H.set(R[U*2+ft],R[v-1-U*2-gt]),E.get(pe+he*4+vt+gt)&&H.set(R[v-1-U*2-gt],R[v-1-U*2-ft]),E.get(pe+he*6+vt+gt)&&H.set(R[v-1-U*2-ft],R[U*2+gt])}pe+=he*8}if(we.drawModeMessage(H,u,B,T),u)we.drawBullsEye(H,j.truncDivision(B,2),5);else{we.drawBullsEye(H,j.truncDivision(B,2),7);for(let U=0,pe=0;U<j.truncDivision(v,2)-1;U+=15,pe+=16)for(let he=j.truncDivision(B,2)&1;he<B;he+=2)H.set(j.truncDivision(B,2)-pe,he),H.set(j.truncDivision(B,2)+pe,he),H.set(he,j.truncDivision(B,2)-pe),H.set(he,j.truncDivision(B,2)+pe)}let W=new cs;return W.setCompact(u),W.setSize(B),W.setLayers(h),W.setCodeWords(S),W.setMatrix(H),W}static drawBullsEye(e,t,n){for(let r=0;r<n;r+=2)for(let i=t-r;i<=t+r;i++)e.set(i,t-r),e.set(i,t+r),e.set(t-r,i),e.set(t+r,i);e.set(t-n,t-n),e.set(t-n+1,t-n),e.set(t-n,t-n+1),e.set(t+n,t-n),e.set(t+n,t-n+1),e.set(t+n,t+n-1)}static generateModeMessage(e,t,n){let r=new K;return e?(r.appendBits(t-1,2),r.appendBits(n-1,6),r=we.generateCheckWords(r,28,4)):(r.appendBits(t-1,5),r.appendBits(n-1,11),r=we.generateCheckWords(r,40,4)),r}static drawModeMessage(e,t,n,r){let i=j.truncDivision(n,2);if(t)for(let a=0;a<7;a++){let u=i-3+a;r.get(a)&&e.set(u,i-5),r.get(a+7)&&e.set(i+5,u),r.get(20-a)&&e.set(u,i+5),r.get(27-a)&&e.set(i-5,u)}else for(let a=0;a<10;a++){let u=i-5+a+j.truncDivision(a,5);r.get(a)&&e.set(u,i-7),r.get(a+10)&&e.set(i+7,u),r.get(29-a)&&e.set(u,i+7),r.get(39-a)&&e.set(i-7,u)}}static generateCheckWords(e,t,n){let r=e.getSize()/n,i=new Pr(we.getGF(n)),a=j.truncDivision(t,n),u=we.bitsToWords(e,n,a);i.encode(u,a-r);let h=t%n,g=new K;g.appendBits(0,h);for(const x of Array.from(u))g.appendBits(x,n);return g}static bitsToWords(e,t,n){let r=new Int32Array(n),i,a;for(i=0,a=e.getSize()/t;i<a;i++){let u=0;for(let h=0;h<t;h++)u|=e.get(i*t+h)?1<<t-h-1:0;r[i]=u}return r}static getGF(e){switch(e){case 4:return Ce.AZTEC_PARAM;case 6:return Ce.AZTEC_DATA_6;case 8:return Ce.AZTEC_DATA_8;case 10:return Ce.AZTEC_DATA_10;case 12:return Ce.AZTEC_DATA_12;default:throw new _("Unsupported word size "+e)}}static stuffBits(e,t){let n=new K,r=e.getSize(),i=(1<<t)-2;for(let a=0;a<r;a+=t){let u=0;for(let h=0;h<t;h++)(a+h>=r||e.get(a+h))&&(u|=1<<t-1-h);(u&i)===i?(n.appendBits(u&i,t),a--):(u&i)===0?(n.appendBits(u|1,t),a--):n.appendBits(u,t)}return n}static totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}we.DEFAULT_EC_PERCENT=33,we.DEFAULT_AZTEC_LAYERS=0,we.MAX_NB_BITS=32,we.MAX_NB_BITS_COMPACT=4,we.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class sr{encode(e,t,n,r){return this.encodeWithHints(e,t,n,r,null)}encodeWithHints(e,t,n,r,i){let a=Fr.ISO_8859_1,u=we.DEFAULT_EC_PERCENT,h=we.DEFAULT_AZTEC_LAYERS;return i!=null&&(i.has(Ye.CHARACTER_SET)&&(a=as.forName(i.get(Ye.CHARACTER_SET).toString())),i.has(Ye.ERROR_CORRECTION)&&(u=j.parseInt(i.get(Ye.ERROR_CORRECTION).toString())),i.has(Ye.AZTEC_LAYERS)&&(h=j.parseInt(i.get(Ye.AZTEC_LAYERS).toString()))),sr.encodeLayers(e,t,n,r,a,u,h)}static encodeLayers(e,t,n,r,i,a,u){if(t!==se.AZTEC)throw new _("Can only encode AZTEC, but got "+t);let h=we.encode(V.getBytes(e,i),a,u);return sr.renderResult(h,n,r)}static renderResult(e,t,n){let r=e.getMatrix();if(r==null)throw new Nt;let i=r.getWidth(),a=r.getHeight(),u=Math.max(t,i),h=Math.max(n,a),g=Math.min(u/i,h/a),x=(u-i*g)/2,y=(h-a*g)/2,E=new re(u,h);for(let S=0,T=y;S<a;S++,T+=g)for(let v=0,R=x;v<i;v++,R+=g)r.get(v,S)&&E.setRegion(R,T,g,g);return E}}o.AbstractExpandedDecoder=_r,o.ArgumentException=A,o.ArithmeticException=Yn,o.AztecCode=cs,o.AztecCodeReader=Kn,o.AztecCodeWriter=sr,o.AztecDecoder=Ne,o.AztecDetector=qi,o.AztecDetectorResult=zi,o.AztecEncoder=we,o.AztecHighLevelEncoder=Vn,o.AztecPoint=ot,o.BarcodeFormat=se,o.Binarizer=Z,o.BinaryBitmap=O,o.BitArray=K,o.BitMatrix=re,o.BitSource=Nr,o.BrowserAztecCodeReader=La,o.BrowserBarcodeReader=Ga,o.BrowserCodeReader=St,o.BrowserDatamatrixCodeReader=Wa,o.BrowserMultiFormatReader=tc,o.BrowserPDF417Reader=nc,o.BrowserQRCodeReader=rc,o.BrowserQRCodeSvgWriter=ln,o.CharacterSetECI=k,o.ChecksumException=D,o.Code128Reader=z,o.Code39Reader=Xe,o.DataMatrixDecodedBitStreamParser=zt,o.DataMatrixReader=Yt,o.DecodeHintType=X,o.DecoderResult=yt,o.DefaultGridSampler=Yi,o.DetectorResult=Zn,o.EAN13Reader=rn,o.EncodeHintType=Ye,o.Exception=m,o.FormatException=L,o.GenericGF=Ce,o.GenericGFPoly=lt,o.GlobalHistogramBinarizer=ke,o.GridSampler=Er,o.GridSamplerInstance=Wt,o.HTMLCanvasElementLuminanceSource=Ct,o.HybridBinarizer=de,o.ITFReader=Te,o.IllegalArgumentException=_,o.IllegalStateException=Nt,o.InvertedLuminanceSource=Rt,o.LuminanceSource=jt,o.MathUtils=me,o.MultiFormatOneDReader=bn,o.MultiFormatReader=os,o.MultiFormatWriter=sc,o.NotFoundException=P,o.OneDReader=Ge,o.PDF417DecodedBitStreamParser=M,o.PDF417DecoderErrorCorrection=es,o.PDF417Reader=et,o.PDF417ResultMetadata=ns,o.PerspectiveTransform=_t,o.PlanarYUVLuminanceSource=kt,o.QRCodeByteMatrix=rr,o.QRCodeDataMask=Et,o.QRCodeDecodedBitStreamParser=Pe,o.QRCodeDecoderErrorCorrectionLevel=Oe,o.QRCodeDecoderFormatInformation=rt,o.QRCodeEncoder=De,o.QRCodeEncoderQRCode=cn,o.QRCodeMaskUtil=Ue,o.QRCodeMatrixUtil=le,o.QRCodeMode=oe,o.QRCodeReader=qt,o.QRCodeVersion=ie,o.QRCodeWriter=An,o.RGBLuminanceSource=Lr,o.RSS14Reader=Fe,o.RSSExpandedReader=F,o.ReaderException=nr,o.ReedSolomonDecoder=On,o.ReedSolomonEncoder=Pr,o.ReedSolomonException=mn,o.Result=Qe,o.ResultMetadataType=Ie,o.ResultPoint=ne,o.StringUtils=V,o.UnsupportedOperationException=ce,o.VideoInputDevice=tn,o.WhiteRectangleDetector=Vt,o.WriterException=ve,o.ZXingArrays=te,o.ZXingCharset=as,o.ZXingInteger=j,o.ZXingStandardCharsets=Fr,o.ZXingStringBuilder=q,o.ZXingStringEncoding=$,o.ZXingSystem=G,o.createAbstractExpandedDecoder=Ji,Object.defineProperty(o,"__esModule",{value:!0})}))})(Wn,Wn.exports)),Wn.exports}var Me=Bl();const Pl=Ui(Me),Ll=go({__proto__:null,default:Pl},[Me]);var io=(function(){function l(s,o,c){if(this.formatMap=new Map([[J.QR_CODE,Me.BarcodeFormat.QR_CODE],[J.AZTEC,Me.BarcodeFormat.AZTEC],[J.CODABAR,Me.BarcodeFormat.CODABAR],[J.CODE_39,Me.BarcodeFormat.CODE_39],[J.CODE_93,Me.BarcodeFormat.CODE_93],[J.CODE_128,Me.BarcodeFormat.CODE_128],[J.DATA_MATRIX,Me.BarcodeFormat.DATA_MATRIX],[J.MAXICODE,Me.BarcodeFormat.MAXICODE],[J.ITF,Me.BarcodeFormat.ITF],[J.EAN_13,Me.BarcodeFormat.EAN_13],[J.EAN_8,Me.BarcodeFormat.EAN_8],[J.PDF_417,Me.BarcodeFormat.PDF_417],[J.RSS_14,Me.BarcodeFormat.RSS_14],[J.RSS_EXPANDED,Me.BarcodeFormat.RSS_EXPANDED],[J.UPC_A,Me.BarcodeFormat.UPC_A],[J.UPC_E,Me.BarcodeFormat.UPC_E],[J.UPC_EAN_EXTENSION,Me.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!Ll)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=o,this.logger=c;var d=this.createZXingFormats(s),f=new Map;f.set(Me.DecodeHintType.POSSIBLE_FORMATS,d),f.set(Me.DecodeHintType.TRY_HARDER,!1),this.hints=f}return l.prototype.decodeAsync=function(s){var o=this;return new Promise(function(c,d){try{c(o.decode(s))}catch(f){d(f)}})},l.prototype.decode=function(s){var o=new Me.MultiFormatReader(this.verbose,this.hints),c=new Me.HTMLCanvasElementLuminanceSource(s),d=new Me.BinaryBitmap(new Me.HybridBinarizer(c)),f=o.decode(d);return{text:f.text,format:Na.create(this.toHtml5QrcodeSupportedFormats(f.format)),debugData:this.createDebugData()}},l.prototype.createReverseFormatMap=function(){var s=new Map;return this.formatMap.forEach(function(o,c,d){s.set(o,c)}),s},l.prototype.toHtml5QrcodeSupportedFormats=function(s){if(!this.reverseFormatMap.has(s))throw"reverseFormatMap doesn't have ".concat(s);return this.reverseFormatMap.get(s)},l.prototype.createZXingFormats=function(s){for(var o=[],c=0,d=s;c<d.length;c++){var f=d[c];this.formatMap.has(f)?o.push(this.formatMap.get(f)):this.logger.logError("".concat(f," is not supported by")+"ZXingHtml5QrcodeShim")}return o},l.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},l})(),Fl=function(l,s,o,c){function d(f){return f instanceof o?f:new o(function(p){p(f)})}return new(o||(o=Promise))(function(f,p){function w(A){try{m(c.next(A))}catch(_){p(_)}}function b(A){try{m(c.throw(A))}catch(_){p(_)}}function m(A){A.done?f(A.value):d(A.value).then(w,b)}m((c=c.apply(l,s||[])).next())})},Ul=function(l,s){var o={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},c,d,f,p;return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(m){return function(A){return b([m,A])}}function b(m){if(c)throw new TypeError("Generator is already executing.");for(;p&&(p=0,m[0]&&(o=0)),o;)try{if(c=1,d&&(f=m[0]&2?d.return:m[0]?d.throw||((f=d.return)&&f.call(d),0):d.next)&&!(f=f.call(d,m[1])).done)return f;switch(d=0,f&&(m=[m[0]&2,f.value]),m[0]){case 0:case 1:f=m;break;case 4:return o.label++,{value:m[1],done:!1};case 5:o.label++,d=m[1],m=[0];continue;case 7:m=o.ops.pop(),o.trys.pop();continue;default:if(f=o.trys,!(f=f.length>0&&f[f.length-1])&&(m[0]===6||m[0]===2)){o=0;continue}if(m[0]===3&&(!f||m[1]>f[0]&&m[1]<f[3])){o.label=m[1];break}if(m[0]===6&&o.label<f[1]){o.label=f[1],f=m;break}if(f&&o.label<f[2]){o.label=f[2],o.ops.push(m);break}f[2]&&o.ops.pop(),o.trys.pop();continue}m=s.call(l,o)}catch(A){m=[6,A],d=0}finally{c=f=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},so=(function(){function l(s,o,c){if(this.formatMap=new Map([[J.QR_CODE,"qr_code"],[J.AZTEC,"aztec"],[J.CODABAR,"codabar"],[J.CODE_39,"code_39"],[J.CODE_93,"code_93"],[J.CODE_128,"code_128"],[J.DATA_MATRIX,"data_matrix"],[J.ITF,"itf"],[J.EAN_13,"ean_13"],[J.EAN_8,"ean_8"],[J.PDF_417,"pdf417"],[J.UPC_A,"upc_a"],[J.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!l.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=o,this.logger=c;var d=this.createBarcodeDetectorFormats(s);if(this.detector=new BarcodeDetector(d),!this.detector)throw"BarcodeDetector detector not supported"}return l.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var s=new BarcodeDetector({formats:["qr_code"]});return typeof s<"u"},l.prototype.decodeAsync=function(s){return Fl(this,void 0,void 0,function(){var o,c;return Ul(this,function(d){switch(d.label){case 0:return[4,this.detector.detect(s)];case 1:if(o=d.sent(),!o||o.length===0)throw"No barcode or QR code detected.";return c=this.selectLargestBarcode(o),[2,{text:c.rawValue,format:Na.create(this.toHtml5QrcodeSupportedFormats(c.format)),debugData:this.createDebugData()}]}})})},l.prototype.selectLargestBarcode=function(s){for(var o=null,c=0,d=0,f=s;d<f.length;d++){var p=f[d],w=p.boundingBox.width*p.boundingBox.height;w>c&&(c=w,o=p)}if(!o)throw"No largest barcode found";return o},l.prototype.createBarcodeDetectorFormats=function(s){for(var o=[],c=0,d=s;c<d.length;c++){var f=d[c];this.formatMap.has(f)?o.push(this.formatMap.get(f)):this.logger.warn("".concat(f," is not supported by")+"BarcodeDetectorDelegate")}return{formats:o}},l.prototype.toHtml5QrcodeSupportedFormats=function(s){if(!this.reverseFormatMap.has(s))throw"reverseFormatMap doesn't have ".concat(s);return this.reverseFormatMap.get(s)},l.prototype.createReverseFormatMap=function(){var s=new Map;return this.formatMap.forEach(function(o,c,d){s.set(o,c)}),s},l.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},l})(),oo=function(l,s,o,c){function d(f){return f instanceof o?f:new o(function(p){p(f)})}return new(o||(o=Promise))(function(f,p){function w(A){try{m(c.next(A))}catch(_){p(_)}}function b(A){try{m(c.throw(A))}catch(_){p(_)}}function m(A){A.done?f(A.value):d(A.value).then(w,b)}m((c=c.apply(l,s||[])).next())})},ao=function(l,s){var o={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},c,d,f,p;return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(m){return function(A){return b([m,A])}}function b(m){if(c)throw new TypeError("Generator is already executing.");for(;p&&(p=0,m[0]&&(o=0)),o;)try{if(c=1,d&&(f=m[0]&2?d.return:m[0]?d.throw||((f=d.return)&&f.call(d),0):d.next)&&!(f=f.call(d,m[1])).done)return f;switch(d=0,f&&(m=[m[0]&2,f.value]),m[0]){case 0:case 1:f=m;break;case 4:return o.label++,{value:m[1],done:!1};case 5:o.label++,d=m[1],m=[0];continue;case 7:m=o.ops.pop(),o.trys.pop();continue;default:if(f=o.trys,!(f=f.length>0&&f[f.length-1])&&(m[0]===6||m[0]===2)){o=0;continue}if(m[0]===3&&(!f||m[1]>f[0]&&m[1]<f[3])){o.label=m[1];break}if(m[0]===6&&o.label<f[1]){o.label=f[1],f=m;break}if(f&&o.label<f[2]){o.label=f[2],o.ops.push(m);break}f[2]&&o.ops.pop(),o.trys.pop();continue}m=s.call(l,o)}catch(A){m=[6,A],d=0}finally{c=f=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Vl=(function(){function l(s,o,c,d){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=c,o&&so.isSupported()?(this.primaryDecoder=new so(s,c,d),this.secondaryDecoder=new io(s,c,d)):this.primaryDecoder=new io(s,c,d)}return l.prototype.decodeAsync=function(s){return oo(this,void 0,void 0,function(){var o;return ao(this,function(c){switch(c.label){case 0:o=performance.now(),c.label=1;case 1:return c.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(s)];case 2:return[2,c.sent()];case 3:return this.possiblyLogPerformance(o),[7];case 4:return[2]}})})},l.prototype.decodeRobustlyAsync=function(s){return oo(this,void 0,void 0,function(){var o,c;return ao(this,function(d){switch(d.label){case 0:o=performance.now(),d.label=1;case 1:return d.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(s)];case 2:return[2,d.sent()];case 3:if(c=d.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(s)];throw c;case 4:return this.possiblyLogPerformance(o),[7];case 5:return[2]}})})},l.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},l.prototype.possiblyLogPerformance=function(s){if(this.verbose){var o=performance.now()-s;this.executionResults.push(o),this.executions++,this.possiblyFlushPerformanceReport()}},l.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var s=0,o=0,c=this.executionResults;o<c.length;o++){var d=c[o];s+=d}var f=s/this.executionResults.length;console.log("".concat(f," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},l})(),Xi=(function(){var l=function(s,o){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var f in d)Object.prototype.hasOwnProperty.call(d,f)&&(c[f]=d[f])},l(s,o)};return function(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");l(s,o);function c(){this.constructor=s}s.prototype=o===null?Object.create(o):(c.prototype=o.prototype,new c)}})(),wr=function(l,s,o,c){function d(f){return f instanceof o?f:new o(function(p){p(f)})}return new(o||(o=Promise))(function(f,p){function w(A){try{m(c.next(A))}catch(_){p(_)}}function b(A){try{m(c.throw(A))}catch(_){p(_)}}function m(A){A.done?f(A.value):d(A.value).then(w,b)}m((c=c.apply(l,s||[])).next())})},Cr=function(l,s){var o={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},c,d,f,p;return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(m){return function(A){return b([m,A])}}function b(m){if(c)throw new TypeError("Generator is already executing.");for(;p&&(p=0,m[0]&&(o=0)),o;)try{if(c=1,d&&(f=m[0]&2?d.return:m[0]?d.throw||((f=d.return)&&f.call(d),0):d.next)&&!(f=f.call(d,m[1])).done)return f;switch(d=0,f&&(m=[m[0]&2,f.value]),m[0]){case 0:case 1:f=m;break;case 4:return o.label++,{value:m[1],done:!1};case 5:o.label++,d=m[1],m=[0];continue;case 7:m=o.ops.pop(),o.trys.pop();continue;default:if(f=o.trys,!(f=f.length>0&&f[f.length-1])&&(m[0]===6||m[0]===2)){o=0;continue}if(m[0]===3&&(!f||m[1]>f[0]&&m[1]<f[3])){o.label=m[1];break}if(m[0]===6&&o.label<f[1]){o.label=f[1],f=m;break}if(f&&o.label<f[2]){o.label=f[2],o.ops.push(m);break}f[2]&&o.ops.pop(),o.trys.pop();continue}m=s.call(l,o)}catch(A){m=[6,A],d=0}finally{c=f=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Da=(function(){function l(s,o){this.name=s,this.track=o}return l.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},l.prototype.apply=function(s){var o={};o[this.name]=s;var c={advanced:[o]};return this.track.applyConstraints(c)},l.prototype.value=function(){var s=this.track.getSettings();if(this.name in s){var o=s[this.name];return o}return null},l})(),Hl=(function(l){Xi(s,l);function s(o,c){return l.call(this,o,c)||this}return s.prototype.min=function(){return this.getCapabilities().min},s.prototype.max=function(){return this.getCapabilities().max},s.prototype.step=function(){return this.getCapabilities().step},s.prototype.apply=function(o){var c={};c[this.name]=o;var d={advanced:[c]};return this.track.applyConstraints(d)},s.prototype.getCapabilities=function(){this.failIfNotSupported();var o=this.track.getCapabilities(),c=o[this.name];return{min:c.min,max:c.max,step:c.step}},s.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},s})(Da),Gl=(function(l){Xi(s,l);function s(o){return l.call(this,"zoom",o)||this}return s})(Hl),jl=(function(l){Xi(s,l);function s(o){return l.call(this,"torch",o)||this}return s})(Da),Wl=(function(){function l(s){this.track=s}return l.prototype.zoomFeature=function(){return new Gl(this.track)},l.prototype.torchFeature=function(){return new jl(this.track)},l})(),Xl=(function(){function l(s,o,c){this.isClosed=!1,this.parentElement=s,this.mediaStream=o,this.callbacks=c,this.surface=this.createVideoElement(this.parentElement.clientWidth),s.append(this.surface)}return l.prototype.createVideoElement=function(s){var o=document.createElement("video");return o.style.width="".concat(s,"px"),o.style.display="block",o.muted=!0,o.setAttribute("muted","true"),o.playsInline=!0,o},l.prototype.setupSurface=function(){var s=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var o=function(){var c=s.surface.clientWidth,d=s.surface.clientHeight;s.callbacks.onRenderSurfaceReady(c,d),s.surface.removeEventListener("playing",o)};this.surface.addEventListener("playing",o),this.surface.srcObject=this.mediaStream,this.surface.play()},l.create=function(s,o,c,d){return wr(this,void 0,void 0,function(){var f,p;return Cr(this,function(w){switch(w.label){case 0:return f=new l(s,o,d),c.aspectRatio?(p={aspectRatio:c.aspectRatio},[4,f.getFirstTrackOrFail().applyConstraints(p)]):[3,2];case 1:w.sent(),w.label=2;case 2:return f.setupSurface(),[2,f]}})})},l.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},l.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},l.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},l.prototype.resume=function(s){this.failIfClosed();var o=this,c=function(){setTimeout(s,200),o.surface.removeEventListener("playing",c)};this.surface.addEventListener("playing",c),this.surface.play()},l.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},l.prototype.getSurface=function(){return this.failIfClosed(),this.surface},l.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},l.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},l.prototype.applyVideoConstraints=function(s){return wr(this,void 0,void 0,function(){return Cr(this,function(o){if("aspectRatio"in s)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(s)]})})},l.prototype.close=function(){if(this.isClosed)return Promise.resolve();var s=this;return new Promise(function(o,c){var d=s.mediaStream.getVideoTracks(),f=d.length,p=0;s.mediaStream.getVideoTracks().forEach(function(w){s.mediaStream.removeTrack(w),w.stop(),++p,p>=f&&(s.isClosed=!0,s.parentElement.removeChild(s.surface),o())})})},l.prototype.getCapabilities=function(){return new Wl(this.getFirstTrackOrFail())},l})(),zl=(function(){function l(s){this.mediaStream=s}return l.prototype.render=function(s,o,c){return wr(this,void 0,void 0,function(){return Cr(this,function(d){return[2,Xl.create(s,this.mediaStream,o,c)]})})},l.create=function(s){return wr(this,void 0,void 0,function(){var o,c;return Cr(this,function(d){switch(d.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return o={audio:!1,video:s},[4,navigator.mediaDevices.getUserMedia(o)];case 1:return c=d.sent(),[2,new l(c)]}})})},l})(),co=function(l,s,o,c){function d(f){return f instanceof o?f:new o(function(p){p(f)})}return new(o||(o=Promise))(function(f,p){function w(A){try{m(c.next(A))}catch(_){p(_)}}function b(A){try{m(c.throw(A))}catch(_){p(_)}}function m(A){A.done?f(A.value):d(A.value).then(w,b)}m((c=c.apply(l,s||[])).next())})},lo=function(l,s){var o={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},c,d,f,p;return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(m){return function(A){return b([m,A])}}function b(m){if(c)throw new TypeError("Generator is already executing.");for(;p&&(p=0,m[0]&&(o=0)),o;)try{if(c=1,d&&(f=m[0]&2?d.return:m[0]?d.throw||((f=d.return)&&f.call(d),0):d.next)&&!(f=f.call(d,m[1])).done)return f;switch(d=0,f&&(m=[m[0]&2,f.value]),m[0]){case 0:case 1:f=m;break;case 4:return o.label++,{value:m[1],done:!1};case 5:o.label++,d=m[1],m=[0];continue;case 7:m=o.ops.pop(),o.trys.pop();continue;default:if(f=o.trys,!(f=f.length>0&&f[f.length-1])&&(m[0]===6||m[0]===2)){o=0;continue}if(m[0]===3&&(!f||m[1]>f[0]&&m[1]<f[3])){o.label=m[1];break}if(m[0]===6&&o.label<f[1]){o.label=f[1],f=m;break}if(f&&o.label<f[2]){o.label=f[2],o.ops.push(m);break}f[2]&&o.ops.pop(),o.trys.pop();continue}m=s.call(l,o)}catch(A){m=[6,A],d=0}finally{c=f=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Yl=(function(){function l(){}return l.failIfNotSupported=function(){return co(this,void 0,void 0,function(){return lo(this,function(s){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new l]})})},l.prototype.create=function(s){return co(this,void 0,void 0,function(){return lo(this,function(o){return[2,zl.create(s)]})})},l})(),ql=function(l,s,o,c){function d(f){return f instanceof o?f:new o(function(p){p(f)})}return new(o||(o=Promise))(function(f,p){function w(A){try{m(c.next(A))}catch(_){p(_)}}function b(A){try{m(c.throw(A))}catch(_){p(_)}}function m(A){A.done?f(A.value):d(A.value).then(w,b)}m((c=c.apply(l,s||[])).next())})},Zl=function(l,s){var o={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},c,d,f,p;return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(m){return function(A){return b([m,A])}}function b(m){if(c)throw new TypeError("Generator is already executing.");for(;p&&(p=0,m[0]&&(o=0)),o;)try{if(c=1,d&&(f=m[0]&2?d.return:m[0]?d.throw||((f=d.return)&&f.call(d),0):d.next)&&!(f=f.call(d,m[1])).done)return f;switch(d=0,f&&(m=[m[0]&2,f.value]),m[0]){case 0:case 1:f=m;break;case 4:return o.label++,{value:m[1],done:!1};case 5:o.label++,d=m[1],m=[0];continue;case 7:m=o.ops.pop(),o.trys.pop();continue;default:if(f=o.trys,!(f=f.length>0&&f[f.length-1])&&(m[0]===6||m[0]===2)){o=0;continue}if(m[0]===3&&(!f||m[1]>f[0]&&m[1]<f[3])){o.label=m[1];break}if(m[0]===6&&o.label<f[1]){o.label=f[1],f=m;break}if(f&&o.label<f[2]){o.label=f[2],o.ops.push(m);break}f[2]&&o.ops.pop(),o.trys.pop();continue}m=s.call(l,o)}catch(A){m=[6,A],d=0}finally{c=f=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Kl=(function(){function l(){}return l.retrieve=function(){if(navigator.mediaDevices)return l.getCamerasFromMediaDevices();var s=MediaStreamTrack;return MediaStreamTrack&&s.getSources?l.getCamerasFromMediaStreamTrack():l.rejectWithError()},l.rejectWithError=function(){var s=vn.unableToQuerySupportedDevices();return l.isHttpsOrLocalhost()||(s=vn.insecureContextCameraQueryError()),Promise.reject(s)},l.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var s=location.host.split(":")[0];return s==="127.0.0.1"||s==="localhost"},l.getCamerasFromMediaDevices=function(){return ql(this,void 0,void 0,function(){var s,o,c,d,f,p,w;return Zl(this,function(b){switch(b.label){case 0:return s=function(m){for(var A=m.getVideoTracks(),_=0,O=A;_<O.length;_++){var D=O[_];D.enabled=!1,D.stop(),m.removeTrack(D)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return o=b.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(c=b.sent(),d=[],f=0,p=c;f<p.length;f++)w=p[f],w.kind==="videoinput"&&d.push({id:w.deviceId,label:w.label});return s(o),[2,d]}})})},l.getCamerasFromMediaStreamTrack=function(){return new Promise(function(s,o){var c=function(f){for(var p=[],w=0,b=f;w<b.length;w++){var m=b[w];m.kind==="video"&&p.push({id:m.id,label:m.label})}s(p)},d=MediaStreamTrack;d.getSources(c)})},l})(),Ve;(function(l){l[l.UNKNOWN=0]="UNKNOWN",l[l.NOT_STARTED=1]="NOT_STARTED",l[l.SCANNING=2]="SCANNING",l[l.PAUSED=3]="PAUSED"})(Ve||(Ve={}));var Ql=(function(){function l(){this.state=Ve.NOT_STARTED,this.onGoingTransactionNewState=Ve.UNKNOWN}return l.prototype.directTransition=function(s){this.failIfTransitionOngoing(),this.validateTransition(s),this.state=s},l.prototype.startTransition=function(s){return this.failIfTransitionOngoing(),this.validateTransition(s),this.onGoingTransactionNewState=s,this},l.prototype.execute=function(){if(this.onGoingTransactionNewState===Ve.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var s=this.onGoingTransactionNewState;this.onGoingTransactionNewState=Ve.UNKNOWN,this.directTransition(s)},l.prototype.cancel=function(){if(this.onGoingTransactionNewState===Ve.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=Ve.UNKNOWN},l.prototype.getState=function(){return this.state},l.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==Ve.UNKNOWN)throw"Cannot transition to a new state, already under transition"},l.prototype.validateTransition=function(s){switch(this.state){case Ve.UNKNOWN:throw"Transition from unknown is not allowed";case Ve.NOT_STARTED:this.failIfNewStateIs(s,[Ve.PAUSED]);break;case Ve.SCANNING:break;case Ve.PAUSED:break}},l.prototype.failIfNewStateIs=function(s,o){for(var c=0,d=o;c<d.length;c++){var f=d[c];if(s===f)throw"Cannot transition from ".concat(this.state," to ").concat(s)}},l})(),Jl=(function(){function l(s){this.stateManager=s}return l.prototype.startTransition=function(s){return this.stateManager.startTransition(s)},l.prototype.directTransition=function(s){this.stateManager.directTransition(s)},l.prototype.getState=function(){return this.stateManager.getState()},l.prototype.canScanFile=function(){return this.stateManager.getState()===Ve.NOT_STARTED},l.prototype.isScanning=function(){return this.stateManager.getState()!==Ve.NOT_STARTED},l.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===Ve.SCANNING},l.prototype.isPaused=function(){return this.stateManager.getState()===Ve.PAUSED},l})(),$l=(function(){function l(){}return l.create=function(){return new Jl(new Ql)},l})(),e0=(function(){var l=function(s,o){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var f in d)Object.prototype.hasOwnProperty.call(d,f)&&(c[f]=d[f])},l(s,o)};return function(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");l(s,o);function c(){this.constructor=s}s.prototype=o===null?Object.create(o):(c.prototype=o.prototype,new c)}})(),wt=(function(l){e0(s,l);function s(){return l!==null&&l.apply(this,arguments)||this}return s.DEFAULT_WIDTH=300,s.DEFAULT_WIDTH_OFFSET=2,s.FILE_SCAN_MIN_HEIGHT=300,s.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,s.MIN_QR_BOX_SIZE=50,s.SHADED_LEFT=1,s.SHADED_RIGHT=2,s.SHADED_TOP=3,s.SHADED_BOTTOM=4,s.SHADED_REGION_ELEMENT_ID="qr-shaded-region",s.VERBOSE=!1,s.BORDER_SHADER_DEFAULT_COLOR="#ffffff",s.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",s})(Ol),t0=(function(){function l(s,o){this.logger=o,this.fps=wt.SCAN_DEFAULT_FPS,s?(s.fps&&(this.fps=s.fps),this.disableFlip=s.disableFlip===!0,this.qrbox=s.qrbox,this.aspectRatio=s.aspectRatio,this.videoConstraints=s.videoConstraints):this.disableFlip=wt.DEFAULT_DISABLE_FLIP}return l.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?Oa.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},l.prototype.isShadedBoxEnabled=function(){return!Ht(this.qrbox)},l.create=function(s,o){return new l(s,o)},l})(),Ma=(function(){function l(s,o){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(s))throw"HTML Element with id=".concat(s," not found");this.elementId=s,this.verbose=!1;var c;typeof o=="boolean"?this.verbose=o===!0:o&&(c=o,this.verbose=c.verbose===!0,c.experimentalFeatures),this.logger=new Ml(this.verbose),this.qrcode=new Vl(this.getSupportedFormats(o),this.getUseBarCodeDetectorIfSupported(c),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=$l.create()}return l.prototype.start=function(s,o,c,d){var f=this;if(!s)throw"cameraIdOrConfig is required";if(!c||typeof c!="function")throw"qrCodeSuccessCallback is required and should be a function.";var p;d?p=d:p=this.verbose?this.logger.log:function(){};var w=t0.create(o,this.logger);this.clearElement();var b=!1;w.videoConstraints&&(w.isMediaStreamConstraintsValid()?b=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var m=b,A=document.getElementById(this.elementId);A.clientWidth?A.clientWidth:wt.DEFAULT_WIDTH,A.style.position="relative",this.shouldScan=!0,this.element=A;var _=this,O=this.stateManagerProxy.startTransition(Ve.SCANNING);return new Promise(function(D,Z){var G=m?w.videoConstraints:_.createVideoConstraints(s);if(!G){O.cancel(),Z("videoConstraints should be defined");return}var Ee={};(!m||w.aspectRatio)&&(Ee.aspectRatio=w.aspectRatio);var ae={onRenderSurfaceReady:function(te,j){_.setupUi(te,j,w),_.isScanning=!0,_.foreverScan(w,c,p)}};Yl.failIfNotSupported().then(function(te){te.create(G).then(function(j){return j.render(f.element,Ee,ae).then(function(K){_.renderedCamera=K,O.execute(),D(null)}).catch(function(K){O.cancel(),Z(K)})}).catch(function(j){O.cancel(),Z(vn.errorGettingUserMedia(j))})}).catch(function(te){O.cancel(),Z(vn.cameraStreamingNotSupported())})})},l.prototype.pause=function(s){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(Ve.PAUSED),this.showPausedState(),(Ht(s)||s!==!0)&&(s=!1),s&&this.renderedCamera&&this.renderedCamera.pause()},l.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var s=this,o=function(){s.stateManagerProxy.directTransition(Ve.SCANNING),s.hidePausedState()};if(!this.renderedCamera.isPaused()){o();return}this.renderedCamera.resume(function(){o()})},l.prototype.getState=function(){return this.stateManagerProxy.getState()},l.prototype.stop=function(){var s=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var o=this.stateManagerProxy.startTransition(Ve.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var c=function(){if(s.element){var f=document.getElementById(wt.SHADED_REGION_ELEMENT_ID);f&&s.element.removeChild(f)}},d=this;return this.renderedCamera.close().then(function(){return d.renderedCamera=null,d.element&&(d.element.removeChild(d.canvasElement),d.canvasElement=null),c(),d.qrRegion&&(d.qrRegion=null),d.context&&(d.context=null),o.execute(),d.hidePausedState(),d.isScanning=!1,Promise.resolve()})},l.prototype.scanFile=function(s,o){return this.scanFileV2(s,o).then(function(c){return c.decodedText})},l.prototype.scanFileV2=function(s,o){var c=this;if(!s||!(s instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(Ht(o)&&(o=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(d,f){c.possiblyCloseLastScanImageFile(),c.clearElement(),c.lastScanImageFile=URL.createObjectURL(s);var p=new Image;p.onload=function(){var w=p.width,b=p.height,m=document.getElementById(c.elementId),A=m.clientWidth?m.clientWidth:wt.DEFAULT_WIDTH,_=Math.max(m.clientHeight?m.clientHeight:b,wt.FILE_SCAN_MIN_HEIGHT),O=c.computeCanvasDrawConfig(w,b,A,_);if(o){var D=c.createCanvasElement(A,_,"qr-canvas-visible");D.style.display="inline-block",m.appendChild(D);var Z=D.getContext("2d");if(!Z)throw"Unable to get 2d context from canvas";Z.canvas.width=A,Z.canvas.height=_,Z.drawImage(p,0,0,w,b,O.x,O.y,O.width,O.height)}var G=wt.FILE_SCAN_HIDDEN_CANVAS_PADDING,Ee=Math.max(p.width,O.width),ae=Math.max(p.height,O.height),te=Ee+2*G,j=ae+2*G,K=c.createCanvasElement(te,j);m.appendChild(K);var _e=K.getContext("2d");if(!_e)throw"Unable to get 2d context from canvas";_e.canvas.width=te,_e.canvas.height=j,_e.drawImage(p,0,0,w,b,G,G,Ee,ae);try{c.qrcode.decodeRobustlyAsync(K).then(function(X){d(no.createFromQrcodeResult(X))}).catch(f)}catch(X){f("QR code parse error, error = ".concat(X))}},p.onerror=f,p.onabort=f,p.onstalled=f,p.onsuspend=f,p.src=URL.createObjectURL(s)})},l.prototype.clear=function(){this.clearElement()},l.getCameras=function(){return Kl.retrieve()},l.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},l.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},l.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},l.prototype.applyVideoConstraints=function(s){if(s){if(!Oa.isMediaStreamConstraintsValid(s,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(s)},l.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},l.prototype.getSupportedFormats=function(s){var o=[J.QR_CODE,J.AZTEC,J.CODABAR,J.CODE_39,J.CODE_93,J.CODE_128,J.DATA_MATRIX,J.MAXICODE,J.ITF,J.EAN_13,J.EAN_8,J.PDF_417,J.RSS_14,J.RSS_EXPANDED,J.UPC_A,J.UPC_E,J.UPC_EAN_EXTENSION];if(!s||typeof s=="boolean"||!s.formatsToSupport)return o;if(!Array.isArray(s.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(s.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var c=[],d=0,f=s.formatsToSupport;d<f.length;d++){var p=f[d];Nl(p)?c.push(p):this.logger.warn("Invalid format: ".concat(p," passed in config, ignoring."))}if(c.length===0)throw"None of formatsToSupport match supported values.";return c},l.prototype.getUseBarCodeDetectorIfSupported=function(s){if(Ht(s))return!0;if(!Ht(s.useBarCodeDetectorIfSupported))return s.useBarCodeDetectorIfSupported!==!1;if(Ht(s.experimentalFeatures))return!0;var o=s.experimentalFeatures;return Ht(o.useBarCodeDetectorIfSupported)?!0:o.useBarCodeDetectorIfSupported!==!1},l.prototype.validateQrboxSize=function(s,o,c){var d=this,f=c.qrbox;this.validateQrboxConfig(f);var p=this.toQrdimensions(s,o,f),w=function(m){if(m<wt.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(wt.MIN_QR_BOX_SIZE,"px.")},b=function(m){return m>s&&(d.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),m=s),m};w(p.width),w(p.height),p.width=b(p.width)},l.prototype.validateQrboxConfig=function(s){if(typeof s!="number"&&typeof s!="function"&&(s.width===void 0||s.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},l.prototype.toQrdimensions=function(s,o,c){if(typeof c=="number")return{width:c,height:c};if(typeof c=="function")try{return c(s,o)}catch(d){throw new Error("qrbox config was passed as a function but it failed with unknown error"+d)}return c},l.prototype.setupUi=function(s,o,c){c.isShadedBoxEnabled()&&this.validateQrboxSize(s,o,c);var d=Ht(c.qrbox)?{width:s,height:o}:c.qrbox;this.validateQrboxConfig(d);var f=this.toQrdimensions(s,o,d);f.height>o&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var p=c.isShadedBoxEnabled()&&f.height<=o,w={x:0,y:0,width:s,height:o},b=p?this.getShadedRegionBounds(s,o,f):w,m=this.createCanvasElement(b.width,b.height),A={willReadFrequently:!0},_=m.getContext("2d",A);_.canvas.width=b.width,_.canvas.height=b.height,this.element.append(m),p&&this.possiblyInsertShadingElement(this.element,s,o,f),this.createScannerPausedUiElement(this.element),this.qrRegion=b,this.context=_,this.canvasElement=m},l.prototype.createScannerPausedUiElement=function(s){var o=document.createElement("div");o.innerText=vn.scannerPaused(),o.style.display="none",o.style.position="absolute",o.style.top="0px",o.style.zIndex="1",o.style.background="rgba(9, 9, 9, 0.46)",o.style.color="#FFECEC",o.style.textAlign="center",o.style.width="100%",s.appendChild(o),this.scannerPausedUiElement=o},l.prototype.scanContext=function(s,o){var c=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(d){return s(d.text,no.createFromQrcodeResult(d)),c.possiblyUpdateShaders(!0),!0}).catch(function(d){c.possiblyUpdateShaders(!1);var f=vn.codeParseError(d);return o(f,Dl.createFrom(f)),!1})},l.prototype.foreverScan=function(s,o,c){var d=this;if(this.shouldScan&&this.renderedCamera){var f=this.renderedCamera.getSurface(),p=f.videoWidth/f.clientWidth,w=f.videoHeight/f.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var b=this.qrRegion.width*p,m=this.qrRegion.height*w,A=this.qrRegion.x*p,_=this.qrRegion.y*w;this.context.drawImage(f,A,_,b,m,0,0,this.qrRegion.width,this.qrRegion.height);var O=function(){d.foreverScanTimeout=setTimeout(function(){d.foreverScan(s,o,c)},d.getTimeoutFps(s.fps))};this.scanContext(o,c).then(function(D){!D&&s.disableFlip!==!0?(d.context.translate(d.context.canvas.width,0),d.context.scale(-1,1),d.scanContext(o,c).finally(function(){O()})):O()}).catch(function(D){d.logger.logError("Error happend while scanning context",D),O()})}},l.prototype.createVideoConstraints=function(s){if(typeof s=="string")return{deviceId:{exact:s}};if(typeof s=="object"){var o="facingMode",c="deviceId",d={user:!0,environment:!0},f="exact",p=function(Z){if(Z in d)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(Z,"'")},w=Object.keys(s);if(w.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(w.length," keys");var b=Object.keys(s)[0];if(b!==o&&b!==c)throw"Only '".concat(o,"' and '").concat(c,"' ")+" are supported for 'cameraIdOrConfig'";if(b===o){var m=s.facingMode;if(typeof m=="string"){if(p(m))return{facingMode:m}}else if(typeof m=="object")if(f in m){if(p(m["".concat(f)]))return{facingMode:{exact:m["".concat(f)]}}}else throw"'facingMode' should be string or object with"+" ".concat(f," as key.");else{var A=typeof m;throw"Invalid type of 'facingMode' = ".concat(A)}}else{var _=s.deviceId;if(typeof _=="string")return{deviceId:_};if(typeof _=="object"){if(f in _)return{deviceId:{exact:_["".concat(f)]}};throw"'deviceId' should be string or object with"+" ".concat(f," as key.")}else{var O=typeof _;throw"Invalid type of 'deviceId' = ".concat(O)}}}var D=typeof s;throw"Invalid type of 'cameraIdOrConfig' = ".concat(D)},l.prototype.computeCanvasDrawConfig=function(s,o,c,d){if(s<=c&&o<=d){var f=(c-s)/2,p=(d-o)/2;return{x:f,y:p,width:s,height:o}}else{var w=s,b=o;return s>c&&(o=c/s*o,s=c),o>d&&(s=d/o*s,o=d),this.logger.log("Image downsampled from "+"".concat(w,"X").concat(b)+" to ".concat(s,"X").concat(o,".")),this.computeCanvasDrawConfig(s,o,c,d)}},l.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var s=document.getElementById(this.elementId);s&&(s.innerHTML="")},l.prototype.possiblyUpdateShaders=function(s){this.qrMatch!==s&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(o){o.style.backgroundColor=s?wt.BORDER_SHADER_MATCH_COLOR:wt.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=s)},l.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},l.prototype.createCanvasElement=function(s,o,c){var d=s,f=o,p=document.createElement("canvas");return p.style.width="".concat(d,"px"),p.style.height="".concat(f,"px"),p.style.display="none",p.id=Ht(c)?"qr-canvas":c,p},l.prototype.getShadedRegionBounds=function(s,o,c){if(c.width>s||c.height>o)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(s-c.width)/2,y:(o-c.height)/2,width:c.width,height:c.height}},l.prototype.possiblyInsertShadingElement=function(s,o,c,d){if(!(o-d.width<1||c-d.height<1)){var f=document.createElement("div");f.style.position="absolute";var p=(o-d.width)/2,w=(c-d.height)/2;if(f.style.borderLeft="".concat(p,"px solid rgba(0, 0, 0, 0.48)"),f.style.borderRight="".concat(p,"px solid rgba(0, 0, 0, 0.48)"),f.style.borderTop="".concat(w,"px solid rgba(0, 0, 0, 0.48)"),f.style.borderBottom="".concat(w,"px solid rgba(0, 0, 0, 0.48)"),f.style.boxSizing="border-box",f.style.top="0px",f.style.bottom="0px",f.style.left="0px",f.style.right="0px",f.id="".concat(wt.SHADED_REGION_ELEMENT_ID),o-d.width<11||c-d.height<11)this.hasBorderShaders=!1;else{var b=5,m=40;this.insertShaderBorders(f,m,b,-b,null,0,!0),this.insertShaderBorders(f,m,b,-b,null,0,!1),this.insertShaderBorders(f,m,b,null,-b,0,!0),this.insertShaderBorders(f,m,b,null,-b,0,!1),this.insertShaderBorders(f,b,m+b,-b,null,-b,!0),this.insertShaderBorders(f,b,m+b,null,-b,-b,!0),this.insertShaderBorders(f,b,m+b,-b,null,-b,!1),this.insertShaderBorders(f,b,m+b,null,-b,-b,!1),this.hasBorderShaders=!0}s.append(f)}},l.prototype.insertShaderBorders=function(s,o,c,d,f,p,w){var b=document.createElement("div");b.style.position="absolute",b.style.backgroundColor=wt.BORDER_SHADER_DEFAULT_COLOR,b.style.width="".concat(o,"px"),b.style.height="".concat(c,"px"),d!==null&&(b.style.top="".concat(d,"px")),f!==null&&(b.style.bottom="".concat(f,"px")),w?b.style.left="".concat(p,"px"):b.style.right="".concat(p,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(b),s.appendChild(b)},l.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},l.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},l.prototype.getTimeoutFps=function(s){return 1e3/s},l})(),uo;(function(l){l[l.STATUS_DEFAULT=0]="STATUS_DEFAULT",l[l.STATUS_SUCCESS=1]="STATUS_SUCCESS",l[l.STATUS_WARNING=2]="STATUS_WARNING",l[l.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(uo||(uo={}));let Ft=null;async function ka(l,s){try{await Rl.toCanvas(s,l,{width:300,margin:2,color:{dark:"#000000",light:"#ffffff"}})}catch(o){throw console.error("Error generating QR code:",o),o}}async function n0(l,s,o){try{Ft&&await Ba(),Ft=new Ma(l);const c={fps:20,aspectRatio:1,verbose:!0,experimentalFeatures:{useBarCodeDetectorIfSupported:!0}};return await Ft.start({facingMode:"environment"},c,d=>{console.log("QR Code scanned successfully:",d),s(d)},d=>{}),Ft}catch(c){throw console.error("Error initializing QR scanner:",c),o&&o(c),c}}async function Ba(){if(Ft)try{Ft.isScanning&&await Ft.stop(),await Ft.clear(),Ft=null}catch(l){console.error("Error stopping QR scanner:",l),Ft=null}}async function r0(){try{const l=await Ma.getCameras();return l&&l.length>0}catch(l){return console.error("Error checking camera availability:",l),!1}}class i0{constructor(s,o){this.container=s,this.publicId=o.publicId,this.render()}render(){this.container.innerHTML=`
      <div class="h-full w-full bg-gradient-to-br from-dark-950 via-dark-900 to-dark-800 overflow-y-auto custom-scrollbar">
        <div class="min-h-full flex items-center justify-center p-6">
            <div class="max-w-2xl w-full animate-fade-in my-auto">
              <!-- Header -->
              <div class="text-center mb-8">
                <div class="inline-flex p-4 bg-primary-500/10 rounded-full mb-4">
                  <svg class="w-16 h-16 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                  </svg>
                </div>
                <h1 class="text-4xl font-bold text-white mb-2">Welcome to Chamber</h1>
                <p class="text-gray-400 text-lg">Your privacy-focused encrypted messenger</p>
              </div>
              
              <!-- Identity Info Card -->
              <div class="glass rounded-2xl p-6 mb-6 border border-white/10">
                <div class="mb-6">
                  <label class="block text-sm text-gray-400 mb-2">Choose a Display Name</label>
                  <input 
                    type="text" 
                    id="display-name" 
                    class="w-full px-4 py-3 bg-dark-800 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" 
                    placeholder="Enter your name (optional)"
                  >
                  <p class="text-xs text-gray-500 mt-2">
                    This name is stored locally and shared only when you connect with others.
                  </p>
                </div>

                <h3 class="text-xl font-semibold text-white mb-3">Your Public ID</h3>
                <p class="text-sm text-gray-400 mb-4">
                  This is your unique identifier. Share it with others to start chatting.
                </p>
                
                <div class="flex items-center gap-3 bg-dark-800/50 p-4 rounded-xl border border-gray-700">
                  <code class="flex-1 font-mono text-sm text-primary-400 break-all">${this.publicId}</code>
                  <button class="p-2 hover:bg-dark-700 rounded-lg transition-colors copy-btn" title="Copy to clipboard">
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                  </button>
                </div>
                
                <div class="flex justify-center p-6 bg-dark-800/30 rounded-xl mt-4">
                  <canvas id="qr-canvas"></canvas>
                </div>
                
                <p class="text-xs text-gray-500 text-center mt-3">
                  Scan this QR code to share your ID
                </p>
              </div>
              
              <!-- Continue Button -->
              <div class="space-y-4">
                <button class="w-full px-6 py-4 bg-gradient-primary hover:shadow-glow text-white font-semibold rounded-xl transition-all duration-300 flex items-center justify-center gap-2 continue-btn">
                  Create New Account
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                  </svg>
                </button>
                
                <button class="w-full px-6 py-4 bg-dark-800 hover:bg-dark-700 text-gray-300 font-medium rounded-xl transition-colors flex items-center justify-center gap-2 recover-btn">
                  I have existing recovery codes
                </button>
              </div>
            </div>
        </div>
      </div>
    `,this.setupEventListeners(),this.generateQR()}async generateQR(){const s=this.container.querySelector("#qr-canvas");if(s)try{await ka(this.publicId,s)}catch(o){console.error("Failed to generate QR code:",o)}}setupEventListeners(){this.container.querySelector(".copy-btn").addEventListener("click",()=>this.copyToClipboard());const o=this.container.querySelector(".continue-btn");o.addEventListener("click",async()=>{const p=this.container.querySelector("#display-name").value.trim();if(p)try{await ki(p)}catch(w){console.error("Failed to update name:",w)}window.location.hash="#recovery-setup?publicId="+this.publicId}),this.container.querySelector(".recover-btn").addEventListener("click",()=>{window.location.hash="#account-recovery"}),this.container.querySelector("#display-name").addEventListener("keypress",f=>{f.key==="Enter"&&o.click()})}async copyToClipboard(){try{await navigator.clipboard.writeText(this.publicId);const s=this.container.querySelector(".copy-btn"),o=s.innerHTML;s.innerHTML=`
        <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
      `,setTimeout(()=>{s.innerHTML=o},2e3)}catch(s){console.error("Failed to copy:",s)}}cleanup(){}}const s0="modulepreload",o0=function(l){return"/chamber/"+l},ho={},Pa=function(s,o,c){let d=Promise.resolve();if(o&&o.length>0){let m=function(A){return Promise.all(A.map(_=>Promise.resolve(_).then(O=>({status:"fulfilled",value:O}),O=>({status:"rejected",reason:O}))))};var p=m;document.getElementsByTagName("link");const w=document.querySelector("meta[property=csp-nonce]"),b=w?.nonce||w?.getAttribute("nonce");d=m(o.map(A=>{if(A=o0(A),A in ho)return;ho[A]=!0;const _=A.endsWith(".css"),O=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${A}"]${O}`))return;const D=document.createElement("link");if(D.rel=_?"stylesheet":s0,_||(D.as="script"),D.crossOrigin="",D.href=A,b&&D.setAttribute("nonce",b),document.head.appendChild(D),_)return new Promise((Z,G)=>{D.addEventListener("load",Z),D.addEventListener("error",()=>G(new Error(`Unable to preload CSS for ${A}`)))})}))}function f(w){const b=new Event("vite:preloadError",{cancelable:!0});if(b.payload=w,window.dispatchEvent(b),!b.defaultPrevented)throw w}return d.then(w=>{for(const b of w||[])b.status==="rejected"&&f(b.reason);return s().catch(f)})};class a0{constructor(s,o){this.container=s,this.publicId=o.publicId,this.recoveryCodes=[],this.render(),this.initialize()}async initialize(){const s=sessionStorage.getItem("TEMP_RECOVERY_CODES");if(s)try{this.recoveryCodes=JSON.parse(s),this.displayCodes()}catch(o){console.error("Failed to parse recovery codes",o),this.handleMissingCodes()}else this.handleMissingCodes()}async handleMissingCodes(){alert("Recovery codes not found. For your security, we must restart the setup process.");const{clearAllData:s}=await Pa(async()=>{const{clearAllData:o}=await Promise.resolve().then(()=>Rc);return{clearAllData:o}},void 0);await s(),window.location.hash="#onboarding",window.location.reload()}render(){this.container.innerHTML=`
      <div class="min-h-screen bg-gradient-to-br from-dark-950 via-dark-900 to-dark-800 flex items-center justify-center p-4">
        <div class="max-w-2xl w-full animate-fade-in">
          <!-- Header -->
          <div class="text-center mb-8">
            <div class="inline-flex p-4 bg-primary-500/10 rounded-full mb-4">
              <svg class="w-12 h-12 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
              </svg>
            </div>
            <h1 class="text-3xl font-bold text-white mb-2">Save Your Recovery Codes</h1>
            <p class="text-gray-400">These codes are the only way to recover your account if you lose access</p>
          </div>
          
          <!-- Warning Card -->
          <div class="glass-strong rounded-2xl p-6 mb-6 border-l-4 border-yellow-500">
            <div class="flex items-start gap-3">
              <svg class="w-6 h-6 text-yellow-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
              </svg>
              <div>
                <h3 class="text-yellow-500 font-semibold mb-1">Important</h3>
                <ul class="text-sm text-gray-300 space-y-1">
                  <li>â€¢ Store these codes in a safe place</li>
                  <li>â€¢ You'll need them to recover your account</li>
                  <li>â€¢ We cannot recover your account without these codes</li>
                </ul>
              </div>
            </div>
          </div>
          
          <!-- Recovery Codes Grid -->
          <div class="glass rounded-2xl p-6 mb-6">
            <h3 class="text-lg font-semibold text-white mb-4">Your Recovery Codes</h3>
            <div id="codes-grid" class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-6">
              <!-- Codes will be inserted here -->
            </div>
            
            <!-- Actions -->
            <div class="flex flex-wrap gap-3">
              <button class="flex-1 min-w-[200px] px-4 py-3 bg-dark-700 hover:bg-dark-600 text-white rounded-xl transition-all duration-200 flex items-center justify-center gap-2 copy-codes-btn">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
                Copy All
              </button>
              
              <button class="flex-1 min-w-[200px] px-4 py-3 bg-dark-700 hover:bg-dark-600 text-white rounded-xl transition-all duration-200 flex items-center justify-center gap-2 download-codes-btn">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                </svg>
                Download
              </button>
            </div>
          </div>
          
          <!-- Confirmation -->
          <div class="glass rounded-2xl p-6 mb-6">
            <label class="flex items-start gap-3 cursor-pointer">
              <input type="checkbox" id="confirm-saved" class="mt-1 w-5 h-5 rounded border-gray-600 bg-dark-700 text-primary-500 focus:ring-primary-500 focus:ring-offset-0">
              <span class="text-gray-300">I have saved my recovery codes in a safe place and understand that I cannot recover my account without them</span>
            </label>
          </div>
          
          <!-- Continue Button -->
          <button class="w-full px-6 py-4 bg-gradient-primary hover:shadow-glow text-white font-semibold rounded-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed continue-btn" disabled>
            Continue to App
            <svg class="inline-block w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
            </svg>
          </button>
        </div>
      </div>
    `,this.setupEventListeners()}displayCodes(){const s=this.container.querySelector("#codes-grid");s.innerHTML=this.recoveryCodes.map((o,c)=>`
      <div class="bg-dark-800/50 backdrop-blur-sm border border-gray-700 rounded-lg p-3 hover:border-primary-500/50 transition-colors">
        <div class="text-xs text-gray-500 mb-1">${c+1}</div>
        <code class="text-sm font-mono text-primary-400">${o}</code>
      </div>
    `).join("")}setupEventListeners(){const s=this.container.querySelector("#confirm-saved"),o=this.container.querySelector(".continue-btn");s.addEventListener("change",()=>{o.disabled=!s.checked}),o.addEventListener("click",()=>{sessionStorage.removeItem("TEMP_RECOVERY_CODES"),window.location.hash="#contacts"}),this.container.querySelector(".copy-codes-btn").addEventListener("click",()=>this.copyCodes()),this.container.querySelector(".download-codes-btn").addEventListener("click",()=>this.downloadCodes())}async copyCodes(){const s=this.recoveryCodes.map((o,c)=>`${c+1}. ${o}`).join(`
`);try{await navigator.clipboard.writeText(s);const o=this.container.querySelector(".copy-codes-btn"),c=o.innerHTML;o.innerHTML=`
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        Copied!
      `,o.classList.add("bg-green-600"),setTimeout(()=>{o.innerHTML=c,o.classList.remove("bg-green-600")},2e3)}catch(o){console.error("Failed to copy:",o)}}downloadCodes(){const s=`Chamber Recovery Codes

Public ID: ${this.publicId}

Recovery Codes:
${this.recoveryCodes.map((f,p)=>`${p+1}. ${f}`).join(`
`)}

IMPORTANT: Keep these codes safe. You'll need them to recover your account.`,o=new Blob([s],{type:"text/plain"}),c=URL.createObjectURL(o),d=document.createElement("a");d.href=c,d.download=`chamber-recovery-codes-${Date.now()}.txt`,d.click(),URL.revokeObjectURL(c)}cleanup(){}}class c0{constructor(s,o){this.container=s,this.render()}render(){this.container.innerHTML=`
      <div class="h-full w-full bg-gradient-to-br from-dark-950 via-dark-900 to-dark-800 overflow-y-auto custom-scrollbar">
        <div class="min-h-full flex items-center justify-center p-4">
            <div class="max-w-md w-full animate-fade-in my-auto">
              <!-- Header -->
              <div class="text-center mb-8">
                <div class="inline-flex p-4 bg-primary-500/10 rounded-full mb-4">
                  <svg class="w-12 h-12 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                  </svg>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">Recover Account</h1>
                <p class="text-gray-400">Enter your recovery codes to restore access</p>
              </div>
              
              <!-- Recovery Form -->
              <div class="glass rounded-2xl p-6 mb-6">
                <div class="mb-6">
                  <label class="block text-sm font-medium text-gray-300 mb-2">
                    Enter Recovery Codes
                  </label>
                  <p class="text-xs text-gray-500 mb-4">
                    Enter all 12 recovery codes separated by spaces or commas
                  </p>
                  <textarea
                    id="recovery-codes-input"
                    rows="6"
                    class="w-full px-4 py-3 bg-dark-800 border border-gray-700 rounded-xl text-white placeholder-gray-500 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all resize-none font-mono text-sm"
                    placeholder="Enter your 12 recovery codes..."
                  ></textarea>
                </div>
                
                <div id="error-message" class="hidden mb-4 p-4 bg-red-500/10 border border-red-500/50 rounded-xl text-red-400 text-sm"></div>
                
                <button class="w-full px-6 py-4 bg-gradient-primary hover:shadow-glow text-white font-semibold rounded-xl transition-all duration-300 recover-btn">
                  Recover Account
                  <svg class="inline-block w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </button>
              </div>
              
              <!-- Alternative Options -->
              <div class="text-center">
                <button class="text-gray-400 hover:text-white transition-colors text-sm new-account-btn">
                  Create New Account Instead
                </button>
              </div>
            </div>
        </div>
      </div>
    `,this.setupEventListeners()}setupEventListeners(){this.container.querySelector(".recover-btn").addEventListener("click",()=>this.attemptRecovery()),this.container.querySelector(".new-account-btn").addEventListener("click",()=>{window.location.hash="#onboarding",window.location.reload()}),this.container.querySelector("#recovery-codes-input").addEventListener("keydown",d=>{d.key==="Enter"&&d.ctrlKey&&this.attemptRecovery()})}async attemptRecovery(){const s=this.container.querySelector("#recovery-codes-input"),o=this.container.querySelector("#error-message"),c=this.container.querySelector(".recover-btn"),d=s.value.trim();if(!d){this.showError("Please enter your recovery codes");return}const f=d.split(/[\s,\n]+/).filter(w=>w.length>0);if(f.length!==12){this.showError(`Please enter all 12 recovery codes (you entered ${f.length})`);return}if(f.filter(w=>!/^[a-f0-9]{16}$/i.test(w)).length>0){this.showError("Invalid code format. Each code should be 16 hexadecimal characters");return}c.disabled=!0,c.innerHTML=`
      <svg class="inline-block w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
      </svg>
      Recovering...
    `;try{const w=await Do(f),{generateRecoveryCodes:b,hashRecoveryCodes:m}=await Pa(async()=>{const{generateRecoveryCodes:O,hashRecoveryCodes:D}=await Promise.resolve().then(()=>Oc);return{generateRecoveryCodes:O,hashRecoveryCodes:D}},void 0),A=await b(w),_=await m(A);await Mi(w,null,_),o.classList.add("hidden"),c.innerHTML=`
        <svg class="inline-block w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        Account Recovered!
      `,c.classList.remove("bg-gradient-primary"),c.classList.add("bg-green-600"),setTimeout(()=>{window.location.hash="#contacts",window.location.reload()},1500)}catch(w){console.error("Recovery failed:",w),this.showError("Recovery failed. Please check your codes and try again."),c.disabled=!1,c.innerHTML=`
        Recover Account
        <svg class="inline-block w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      `}}showError(s){const o=this.container.querySelector("#error-message");o.textContent=s,o.classList.remove("hidden"),setTimeout(()=>{o.classList.add("hidden")},5e3)}cleanup(){}}class l0{constructor(s,o){this.container=s,this.contacts=[],this.render(),this.loadContacts()}render(){this.container.innerHTML=`
      <div class="h-full flex flex-col bg-dark-900">
        <!-- Header -->
        <div class="px-6 py-4 flex items-center justify-between border-b border-white/10 glass sticky top-0 z-10">
          <h2 class="text-2xl font-bold bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent">Messages</h2>
            <button class="p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded-xl transition-colors settings-btn" title="Settings">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
            </button>
        </div>
        
        <!-- List -->
        <div class="flex-1 overflow-y-auto custom-scrollbar p-4 space-y-2" id="contacts-list">
          <div class="flex flex-col items-center justify-center h-64 space-y-4">
            <div class="w-8 h-8 border-4 border-primary-500 border-t-transparent rounded-full animate-spin"></div>
            <p class="text-gray-400">Loading conversations...</p>
          </div>
        </div>
        
        <!-- FAB -->
        <button class="absolute bottom-6 right-6 w-14 h-14 bg-gradient-primary rounded-full shadow-glow hover:shadow-glow-lg flex items-center justify-center text-white transition-all hover:scale-105 active:scale-95 add-contact-btn z-20">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
        </button>
      </div>
    `,this.setupEventListeners()}async loadContacts(){try{this.contacts=await wo(),this.renderContacts()}catch(s){console.error("Failed to load contacts:",s),this.renderError()}}renderContacts(){const s=this.container.querySelector("#contacts-list");if(this.contacts.length===0){s.innerHTML=`
        <div class="flex flex-col items-center justify-center h-full text-center px-6 animate-fade-in">
          <div class="w-20 h-20 bg-dark-800 rounded-full flex items-center justify-center mb-6 ring-1 ring-white/10">
            <svg class="w-10 h-10 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-white mb-2">No conversations yet</h3>
          <p class="text-gray-400 max-w-xs mx-auto">Click the + button below to add a contact and start messaging securely.</p>
        </div>
      `;return}s.innerHTML=this.contacts.map(o=>`
      <div class="group flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 transition-colors cursor-pointer border border-transparent hover:border-white/5 animate-fade-in contact-item" data-id="${o.publicId}">
        <div class="w-12 h-12 rounded-full avatar-gradient flex items-center justify-center text-white font-semibold text-lg shadow-lg">
          ${this.getAvatarInitials(o.name)}
        </div>
        
        <div class="flex-1 min-w-0">
          <div class="flex items-center justify-between mb-1">
            <h4 class="font-semibold text-white truncate group-hover:text-primary-400 transition-colors">${this.escapeHtml(o.name)}</h4>
            ${o.lastMessageTime?`
              <span class="text-xs text-gray-500">${this.formatTime(o.lastMessageTime)}</span>
            `:""}
          </div>
          <p class="text-sm truncate ${o.lastMessage?"text-gray-400":"text-gray-500 italic"}">
            ${o.lastMessage||"No messages yet"}
          </p>
        </div>
        
        ${o.unreadCount>0?`
          <div class="w-5 h-5 bg-primary-500 rounded-full flex items-center justify-center text-[10px] font-bold text-white shadow-glow">
            ${o.unreadCount}
          </div>
        `:""}
      </div>
    `).join(""),s.querySelectorAll(".contact-item").forEach(o=>{o.addEventListener("click",()=>{const c=o.dataset.id;window.location.hash=`#chat?id=${c}`})})}renderError(){const s=this.container.querySelector("#contacts-list");s.innerHTML=`
      <div class="flex flex-col items-center justify-center h-full text-center p-6">
        <p class="text-red-400 mb-4">Failed to load contacts</p>
        <button class="px-4 py-2 bg-dark-800 hover:bg-dark-700 text-white rounded-lg transition-colors retry-btn">Retry</button>
      </div>
    `,s.querySelector(".retry-btn").addEventListener("click",()=>{this.loadContacts()})}setupEventListeners(){this.container.querySelector(".add-contact-btn").addEventListener("click",()=>{window.location.hash="#add-contact"}),this.container.querySelector(".settings-btn").addEventListener("click",()=>{window.location.hash="#settings"})}getAvatarInitials(s){const o=s.split(" ");return o.length>=2?o[0][0]+o[1][0]:s.substring(0,2).toUpperCase()}formatTime(s){const o=new Date(s),c=new Date,d=c-o;return d<6e4?"Just now":d<36e5?`${Math.floor(d/6e4)}m ago`:o.toDateString()===c.toDateString()?o.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):d<6048e5?o.toLocaleDateString("en-US",{weekday:"short"}):o.toLocaleDateString("en-US",{month:"short",day:"numeric"})}escapeHtml(s){const o=document.createElement("div");return o.textContent=s,o.innerHTML}cleanup(){}}class u0{constructor(s,o){this.container=s,this.contactId=o.id,this.contact=null,this.messages=[],this.sharedKey=null,this.myIdentity=null,this.mediaRecorder=null,this.audioChunks=[],this.isRecording=!1,this.render(),this.initialize()}async initialize(){try{if(this.contact=await Ei(this.contactId),this.myIdentity=await Nn(),!this.contact){this.showError("Contact not found");return}this.sharedKey=await Mo(this.myIdentity.publicId,this.contactId),this.updateHeader(),await this.loadMessages(),this.messageHandler=s=>{s.detail.senderId===this.contactId&&this.loadMessages()},window.addEventListener("message-received",this.messageHandler)}catch(s){console.error("Failed to initialize chat:",s),this.showError("Failed to load chat")}}render(){this.container.innerHTML=`
      <div class="h-full flex flex-col bg-dark-900 relative">
        <!-- Header -->
        <div class="px-4 py-3 flex items-center justify-between border-b border-white/10 glass sticky top-0 z-10">
          <div class="flex items-center gap-3">
            <button class="p-2 -ml-2 text-gray-400 hover:text-white hover:bg-white/10 rounded-xl transition-colors back-btn">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
              </svg>
            </button>
            <div>
              <h3 class="font-bold text-white contact-name">Loading...</h3>
              <p class="text-xs text-gray-400 contact-id font-mono truncate max-w-[150px]"></p>
            </div>
          </div>
          
          <div class="relative">
            <button class="p-2 -mr-2 text-gray-400 hover:text-white hover:bg-white/10 rounded-xl transition-colors menu-btn">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="1"></circle>
                <circle cx="12" cy="5" r="1"></circle>
                <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </button>
            
            <!-- Dropdown Menu -->
            <div class="absolute right-0 top-full mt-2 w-48 bg-dark-800 border border-white/10 rounded-xl shadow-xl z-50 hidden menu-dropdown animate-scale-in">
                <button class="w-full text-left px-4 py-3 text-sm text-gray-300 hover:bg-white/5 hover:text-white transition-colors edit-name-btn">
                    Edit Name
                </button>
                <button class="w-full text-left px-4 py-3 text-sm text-red-400 hover:bg-red-500/10 transition-colors clear-chat-btn">
                    Clear Chat
                </button>
            </div>
          </div>
        </div>
        
        <!-- Messages -->
        <div class="flex-1 overflow-y-auto custom-scrollbar p-4 space-y-4" id="messages-container">
          <div class="flex flex-col items-center justify-center h-full">
            <div class="w-8 h-8 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p class="text-gray-500 text-sm">Decrypting messages...</p>
          </div>
        </div>
        
        <!-- Input Area -->
        <div class="p-4 border-t border-white/10 bg-dark-800/50 backdrop-blur-md">
          <!-- Recording Indicator -->
          <div class="flex items-center justify-center text-red-400 text-sm mb-2 hidden recording-indicator animate-pulse">
            <div class="w-2 h-2 bg-red-500 rounded-full mr-2"></div>
            Recording... <span class="recording-timer ml-1 font-mono">0:00</span>
          </div>

          <div class="flex items-end gap-3 max-w-4xl mx-auto">
            <!-- File Attach -->
            <button class="p-3 text-gray-400 hover:text-primary-400 hover:bg-white/5 rounded-xl transition-colors attach-btn" title="Send File or Image">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
              </svg>
            </button>
            <input type="file" id="file-input" class="hidden">
            
            <!-- Audio Record -->
             <button class="p-3 text-gray-400 hover:text-red-400 hover:bg-white/5 rounded-xl transition-colors mic-btn" title="Record Audio">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
              </svg>
            </button>

            <div class="flex-1 bg-dark-900 border border-white/10 rounded-2xl overflow-hidden focus-within:ring-2 focus-within:ring-primary-500/50 focus-within:border-primary-500 transition-all">
              <textarea 
                class="w-full px-4 py-3 bg-transparent text-white placeholder-gray-500 focus:outline-none resize-none max-h-32 custom-scrollbar"
                placeholder="Type a message..."
                id="message-input"
                rows="1"
                style="min-height: 48px;"
              ></textarea>
            </div>
            
            <button class="p-3 bg-gradient-primary hover:shadow-glow text-white rounded-xl transition-all active:scale-95 send-btn">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    `,this.setupEventListeners()}updateHeader(){this.contact&&(this.container.querySelector(".contact-name").textContent=this.contact.name,this.container.querySelector(".contact-id").textContent=`ID: ${this.contactId.substring(0,8)}...`)}async loadMessages(){try{this.messages=await bo(this.contactId),await this.renderMessages(),this.scrollToBottom()}catch(s){console.error("Failed to load messages:",s)}}async renderMessages(){const s=this.container.querySelector("#messages-container");if(this.messages.length===0){s.innerHTML=`
        <div class="flex flex-col items-center justify-center h-full text-center space-y-4 opacity-50">
          <div class="w-16 h-16 bg-white/10 rounded-full flex items-center justify-center">
            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
          </div>
          <p class="text-gray-400">No messages yet. Say hello!</p>
        </div>
      `;return}const o=await Promise.all(this.messages.map(async c=>{const d=c.sent;if(c.type==="image"||c.type==="audio"||c.type==="file")return this.renderAttachmentMessage(c,d);let f=c.content;if(c.encrypted&&c.iv)try{f=await Bo(c.encrypted,c.iv,this.sharedKey)}catch{f="ðŸ”’ [Encrypted message]"}return`
        <div class="flex ${d?"justify-end":"justify-start"} animate-fade-in group">
          <div class="max-w-[75%] ${d?"order-1":"order-2"}">
            <div class="${d?"message-bubble-sent rounded-br-none":"message-bubble-received rounded-bl-none"} px-4 py-2 rounded-2xl shadow-sm relative text-sm md:text-base break-words">
             ${this.escapeHtml(f)}
             <div class="${d?"text-primary-100":"text-gray-400"} text-[10px] text-right mt-1 opacity-70">
               ${this.formatTime(c.timestamp)}
             </div>
            </div>
          </div>
        </div>
      `}));s.innerHTML=o.join("")}async renderAttachmentMessage(s,o){if(!s.imageId)return this.renderErrorBubble(o,"Attachment unavailable",s.timestamp);try{const c=await Ao(s.imageId);if(!c)return this.renderErrorBubble(o,"Attachment not found",s.timestamp);const d=new Uint8Array(c.iv),f=await Lo(c.blob,d,this.sharedKey);let p="";if(s.type==="image"){const w=new Blob([f],{type:"image/jpeg"});p=`<img src="${URL.createObjectURL(w)}" class="rounded-xl max-h-64 object-cover cursor-pointer hover:opacity-90 transition-opacity message-img">`}else if(s.type==="audio"){const w=new Blob([f],{type:"audio/webm"});p=`<audio controls src="${URL.createObjectURL(w)}" class="w-full min-w-[200px]"></audio>`}else{const w=new Blob([f]);p=`
                    <div class="flex items-center gap-3 p-2">
                        <div class="bg-black/20 p-2 rounded-lg">
                             <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                        </div>
                        <a href="${URL.createObjectURL(w)}" download="file.bin" class="underline hover:text-white">Download File</a>
                    </div>
                 `}return`
        <div class="flex ${o?"justify-end":"justify-start"} animate-fade-in mb-2">
          <div class="${o?"message-bubble-sent rounded-br-none":"message-bubble-received rounded-bl-none"} p-2 rounded-2xl shadow-sm relative overflow-hidden max-w-[75%] group">
            ${p}
            <div class="text-[10px] ${o?"text-primary-100":"text-gray-400"} text-right mt-1 px-1 opacity-70">
              ${this.formatTime(s.timestamp)}
            </div>
          </div>
        </div>
      `}catch(c){return console.error("Failed to decrypt attachment:",c),this.renderErrorBubble(o,"Decryption failed",s.timestamp)}}renderErrorBubble(s,o,c){return`
      <div class="flex ${s?"justify-end":"justify-start"} animate-fade-in">
        <div class="bg-red-500/20 text-red-200 border border-red-500/30 px-4 py-2 rounded-2xl text-sm italic">
          âš ï¸ ${o}
        </div>
      </div>
    `}setupEventListeners(){this.container.querySelector(".back-btn").addEventListener("click",()=>window.location.hash="#contacts"),this.container.querySelector(".send-btn").addEventListener("click",()=>this.sendMessage());const c=this.container.querySelector("#message-input");c.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px",this.value===""&&(this.style.height="48px")}),c.addEventListener("keypress",m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),this.sendMessage())});const d=this.container.querySelector(".menu-btn"),f=this.container.querySelector(".menu-dropdown");d.addEventListener("click",m=>{m.stopPropagation(),f.classList.toggle("hidden")}),document.addEventListener("click",()=>{f.classList.contains("hidden")||f.classList.add("hidden")}),this.container.querySelector(".edit-name-btn").addEventListener("click",()=>this.editName()),this.container.querySelector(".clear-chat-btn").addEventListener("click",()=>this.clearChat());const p=this.container.querySelector(".attach-btn"),w=this.container.querySelector("#file-input");p.addEventListener("click",()=>w.click()),w.addEventListener("change",m=>{m.target.files.length>0&&this.sendAttachment(m.target.files[0])});const b=this.container.querySelector(".mic-btn");b.addEventListener("mousedown",()=>this.startRecording()),b.addEventListener("mouseup",()=>this.stopRecording()),b.addEventListener("touchstart",m=>{m.preventDefault(),this.startRecording()}),b.addEventListener("touchend",m=>{m.preventDefault(),this.stopRecording()})}async editName(){const s=prompt("Enter new contact name:",this.contact.name);s&&s.trim()&&(await yo(this.contactId,s.trim()),this.contact=await Ei(this.contactId),this.updateHeader())}async clearChat(){confirm("Are you sure you want to clear this chat? This cannot be undone.")&&(await Eo(this.contactId),await this.loadMessages())}async startRecording(){try{const s=await navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(s),this.audioChunks=[],this.mediaRecorder.ondataavailable=o=>this.audioChunks.push(o.data),this.mediaRecorder.onstop=async()=>{const o=new Blob(this.audioChunks,{type:"audio/webm"});await this.sendAttachment(o,"audio"),s.getTracks().forEach(c=>c.stop())},this.mediaRecorder.start(),this.isRecording=!0,this.container.querySelector(".recording-indicator").classList.remove("hidden")}catch(s){console.error("Mic error:",s),alert("Could not access microphone")}}stopRecording(){this.isRecording&&this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(this.mediaRecorder.stop(),this.isRecording=!1,this.container.querySelector(".recording-indicator").classList.add("hidden"))}async sendAttachment(s,o=null){if(this.sharedKey)try{o||(s.type.startsWith("image/")?o="image":s.type.startsWith("audio/")?o="audio":o="file");const c=await s.arrayBuffer(),{encrypted:d,iv:f}=await Po(c,this.sharedKey),p=await Bi(d,f,o);await Xn(this.contactId,o==="image"?"ðŸ“· Image":o==="audio"?"ðŸŽ¤ Audio":"ðŸ“Ž File",o,!0,null,null,p),Oi(this.contactId,{type:o,blob:d,iv:f,timestamp:Date.now()}),await this.loadMessages()}catch(c){console.error("Send attachment failed:",c),alert("Failed to send file")}}async sendMessage(){const s=this.container.querySelector("#message-input"),o=s.value.trim();if(!(!o||!this.sharedKey))try{const{encrypted:c,iv:d}=await ko(o,this.sharedKey);await Xn(this.contactId,o,"text",!0,c,d),Oi(this.contactId,{type:"text",content:o,timestamp:Date.now(),encrypted:c,iv:d}),s.value="",s.style.height="48px",await this.loadMessages()}catch(c){console.error("Failed to send message:",c),alert("Failed to send message")}}scrollToBottom(){const s=this.container.querySelector("#messages-container");s.scrollTop=s.scrollHeight}formatTime(s){return new Date(s).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}escapeHtml(s){const o=document.createElement("div");return o.textContent=s,o.innerHTML}showError(s){const o=this.container.querySelector("#messages-container");o&&(o.innerHTML=`<p class="text-red-400 text-center p-4">${s}</p>`)}cleanup(){this.messageHandler&&window.removeEventListener("message-received",this.messageHandler),this.container.querySelectorAll("audio, img").forEach(s=>{s.src&&s.src.startsWith("blob:")&&URL.revokeObjectURL(s.src)})}}class d0{constructor(s,o){this.container=s,this.isScanning=!1,this.render()}render(){this.container.innerHTML=`
      <div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in modal-overlay">
        <div class="bg-dark-900 border border-white/10 rounded-2xl w-full max-w-lg shadow-2xl relative overflow-hidden flex flex-col max-h-[90vh] animate-scale-in">
          
          <!-- Header -->
          <div class="px-6 py-4 border-b border-white/10 flex items-center justify-between bg-dark-800/50">
            <h2 class="text-xl font-bold text-white">Add Contact</h2>
            <button class="p-2 -mr-2 text-gray-400 hover:text-white hover:bg-white/10 rounded-full transition-colors close-btn">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
          
          <div class="p-6 overflow-y-auto">
            <!-- Tabs -->
            <div class="flex p-1 bg-dark-800 rounded-xl mb-6">
              <button class="flex-1 py-2 text-sm font-medium rounded-lg transition-all tab-btn active bg-primary-600 text-white shadow-md" data-tab="manual">
                Manual Entry
              </button>
              <button class="flex-1 py-2 text-sm font-medium rounded-lg text-gray-400 hover:text-white transition-all tab-btn" data-tab="qr">
                Scan QR Code
              </button>
            </div>
            
            <!-- Manual Entry -->
            <div class="space-y-4" id="manual-tab">
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1" for="contact-id">Public ID</label>
                <input 
                  type="text" 
                  id="contact-id" 
                  class="w-full px-4 py-3 bg-dark-800 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all font-mono text-sm" 
                  placeholder="Enter 64-char public ID"
                >
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-1" for="contact-name">Name (optional)</label>
                <input 
                  type="text" 
                  id="contact-name" 
                  class="w-full px-4 py-3 bg-dark-800 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" 
                  placeholder="Enter a display name"
                >
              </div>
              
              <button class="w-full mt-6 py-3 bg-gradient-primary hover:shadow-glow text-white font-semibold rounded-xl transition-all active:scale-95 add-btn">
                Add Contact
              </button>
            </div>
            
            <!-- QR Scanner -->
            <div class="hidden flex flex-col items-center space-y-4" id="qr-tab">
              <div class="w-full overflow-hidden rounded-xl border-2 border-primary-500/30 bg-black relative aspect-square flex items-center justify-center">
                <div id="qr-reader" class="w-full h-full"></div>
                <div class="absolute inset-0 pointer-events-none border-2 border-primary-500 opacity-50 scanner-overlay hidden"></div>
              </div>
              
              <p class="text-gray-400 text-sm text-center">
                Point your camera at a contact's QR code to scan
              </p>
              
              <button class="px-4 py-2 text-red-400 hover:bg-red-500/10 rounded-lg transition-colors hidden cancel-scan-btn">
                Stop Scanning
              </button>
            </div>
            
            <!-- Error Message -->
            <div class="mt-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-200 text-sm hidden" id="error-message"></div>
          </div>
        </div>
      </div>
    `,this.setupEventListeners()}setupEventListeners(){this.container.querySelector(".close-btn").addEventListener("click",()=>this.close());const o=this.container.querySelector(".modal-overlay");o.addEventListener("click",p=>{p.target===o&&this.close()}),this.container.querySelectorAll(".tab-btn").forEach(p=>{p.addEventListener("click",()=>this.switchTab(p.dataset.tab))}),this.container.querySelector(".add-btn").addEventListener("click",()=>this.addContactManually()),this.container.querySelectorAll("input").forEach(p=>{p.addEventListener("keypress",w=>{w.key==="Enter"&&this.addContactManually()})})}async switchTab(s){this.container.querySelectorAll(".tab-btn").forEach(f=>{f.dataset.tab===s?(f.classList.add("bg-primary-600","text-white","shadow-md"),f.classList.remove("text-gray-400","hover:text-white")):(f.classList.remove("bg-primary-600","text-white","shadow-md"),f.classList.add("text-gray-400","hover:text-white"))});const c=this.container.querySelector("#manual-tab"),d=this.container.querySelector("#qr-tab");s==="manual"?(c.classList.remove("hidden"),d.classList.add("hidden"),await this.stopScanning()):(c.classList.add("hidden"),d.classList.remove("hidden"),await this.startScanning())}async startScanning(){if(!this.isScanning)try{if(!await r0()){this.showError("No camera available");return}this.isScanning=!0,await new Promise(f=>setTimeout(f,100));const o=document.getElementById("qr-reader");(!o||o.offsetWidth===0)&&await new Promise(f=>setTimeout(f,300)),await n0("qr-reader",f=>this.handleQRScan(f),f=>console.error("QR scan error:",f));const c=this.container.querySelector(".cancel-scan-btn");c&&(c.classList.remove("hidden"),c.onclick=()=>this.stopScanning());const d=this.container.querySelector(".scanner-overlay");d&&d.classList.remove("hidden")}catch(s){console.error("Failed to start scanner:",s),this.showError("Failed to access camera. Please check permissions."),this.isScanning=!1}}async stopScanning(){if(this.isScanning)try{await Ba(),this.isScanning=!1;const s=this.container.querySelector(".cancel-scan-btn");s&&s.classList.add("hidden");const o=this.container.querySelector(".scanner-overlay");o&&o.classList.add("hidden")}catch(s){console.error("Failed to stop scanner:",s)}}async handleQRScan(s){if(await this.stopScanning(),!/^[a-f0-9]{64}$/i.test(s)){this.showError("Invalid QR code format");return}try{await bi(s),this.close(),window.location.hash=`#chat?id=${s}`}catch(o){console.error("Failed to add contact:",o),this.showError(o.message||"Failed to add contact")}}async addContactManually(){const s=this.container.querySelector("#contact-id"),o=this.container.querySelector("#contact-name"),c=s.value.trim(),d=o.value.trim();if(!c){this.showError("Please enter a public ID");return}if(!/^[a-f0-9]{64}$/i.test(c)){this.showError("Invalid public ID format. Must be 64 hexadecimal characters.");return}try{await bi(c,d||null),this.close(),window.location.hash=`#chat?id=${c}`}catch(f){console.error("Failed to add contact:",f),this.showError(f.message||"Failed to add contact")}}showError(s){const o=this.container.querySelector("#error-message");o.textContent=s,o.classList.remove("hidden"),setTimeout(()=>{o.classList.add("hidden")},5e3)}close(){this.stopScanning(),window.location.hash="#contacts"}async cleanup(){await this.stopScanning()}}class h0{constructor(s,o){this.container=s,this.identity=null,this.render(),this.initialize()}async initialize(){this.identity=await Nn(),this.updateIdentityDisplay(),this.generateQR()}render(){this.container.innerHTML=`
      <div class="h-full flex flex-col bg-dark-900">
        <!-- Header -->
        <div class="px-6 py-4 flex items-center gap-4 border-b border-white/10 glass sticky top-0 z-10">
          <button class="p-2 -ml-2 text-gray-400 hover:text-white hover:bg-white/10 rounded-xl transition-colors back-btn">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
          </button>
          <h2 class="text-xl font-bold text-white">Settings</h2>
        </div>
        
        <!-- Content -->
        <div class="flex-1 overflow-y-auto custom-scrollbar p-6 space-y-6">
          
          <!-- Identity Card -->
          <div class="glass rounded-2xl p-6 border border-white/10">
            <h3 class="text-lg font-semibold text-white mb-4">Your Identity</h3>
            
            <div class="mb-6">
              <label class="block text-sm text-gray-400 mb-2">Display Name</label>
              <div class="flex gap-2">
                <input 
                  type="text" 
                  id="display-name-input" 
                  class="flex-1 px-4 py-3 bg-dark-800 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" 
                  placeholder="Set a display name"
                >
                <button class="px-4 py-2 bg-primary-600 hover:bg-primary-500 text-white font-medium rounded-xl transition-colors save-name-btn">
                  Save
                </button>
              </div>
              <p class="text-xs text-green-400 mt-2 hidden" id="save-success-msg">
                Name saved successfully!
              </p>
            </div>

            <div class="mb-6">
              <label class="block text-sm text-gray-400 mb-2">Public ID</label>
              <div class="flex items-center gap-2 bg-dark-800/50 p-3 rounded-xl border border-white/5">
                <code class="flex-1 font-mono text-sm text-primary-400 break-all" id="public-id">Loading...</code>
                <button class="p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors copy-btn" title="Copy to clipboard">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                </button>
              </div>
            </div>
            
            <div class="flex justify-center p-6 bg-white/5 rounded-xl mb-4">
              <canvas id="qr-canvas"></canvas>
            </div>
            
            <p class="text-xs text-gray-500 text-center">
              Share this QR code or ID with others to connect
            </p>
          </div>
          
          <!-- Data Management -->
          <div class="glass rounded-2xl p-6 border border-white/10">
            <h3 class="text-lg font-semibold text-white mb-4">Data Management</h3>
            
            <div class="flex gap-3 mb-4">
              <button class="flex-1 px-4 py-3 bg-dark-800 hover:bg-dark-700 text-white rounded-xl transition-colors flex items-center justify-center gap-2 border border-white/5 export-btn">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                </svg>
                Export
              </button>
              
              <button class="flex-1 px-4 py-3 bg-dark-800 hover:bg-dark-700 text-white rounded-xl transition-colors flex items-center justify-center gap-2 border border-white/5 import-btn">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                </svg>
                Import
              </button>
              <input type="file" id="import-input" accept=".json" class="hidden">
            </div>
            
            <p class="text-xs text-gray-500">
              Export your data for backup or import from a previous backup.
            </p>
          </div>
          
          <!-- About -->
          <div class="glass rounded-2xl p-6 border border-white/10">
            <h3 class="text-lg font-semibold text-white mb-4">About</h3>
            
            <div class="space-y-3 mb-6">
              <div class="flex justify-between text-sm">
                <span class="text-gray-400">Version</span>
                <span class="text-white">1.0.0</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-400">Encryption</span>
                <span class="text-white">AES-256-GCM</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-400">Storage</span>
                <span class="text-white">Local Only (IndexedDB)</span>
              </div>
            </div>
            
            <div class="bg-primary-500/10 border border-primary-500/20 rounded-xl p-4">
              <h4 class="text-primary-400 font-medium mb-2 flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                </svg>
                Privacy Guarantee
              </h4>
              <ul class="text-xs text-gray-300 space-y-1 ml-6 list-disc">
                <li>All messages are encrypted end-to-end</li>
                <li>No data is sent to any server</li>
                <li>Everything stays on your device</li>
                <li>No tracking, no analytics, no accounts</li>
              </ul>
            </div>
          </div>
          
          <!-- Danger Zone -->
          <div class="glass rounded-2xl p-6 border border-red-500/20">
            <h3 class="text-lg font-semibold text-red-400 mb-4">Danger Zone</h3>
            
            <p class="text-sm text-gray-400 mb-6">
              This will permanently delete all your data including messages, contacts, and your identity.
            </p>
            
            <button class="w-full px-4 py-3 bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/30 rounded-xl transition-colors font-medium clear-data-btn">
              Clear All Data
            </button>
          </div>
          
          <div class="h-6"></div> <!-- Spacer -->
          
        </div>
      </div>
    `,this.setupEventListeners()}updateIdentityDisplay(){if(this.identity){const s=this.container.querySelector("#public-id");s.textContent=this.identity.publicId;const o=this.container.querySelector("#display-name-input");this.identity.displayName&&(o.value=this.identity.displayName)}}async generateQR(){if(this.identity){const s=this.container.querySelector("#qr-canvas");try{await ka(this.identity.publicId,s)}catch(o){console.error("Failed to generate QR code:",o)}}}setupEventListeners(){this.container.querySelector(".back-btn").addEventListener("click",()=>{window.location.hash="#contacts"}),this.container.querySelector(".save-name-btn").addEventListener("click",()=>this.saveDisplayName()),this.container.querySelector(".copy-btn").addEventListener("click",()=>this.copyToClipboard()),this.container.querySelector(".export-btn").addEventListener("click",()=>this.exportDataToFile());const f=this.container.querySelector(".import-btn"),p=this.container.querySelector("#import-input");f.addEventListener("click",()=>{p.click()}),p.addEventListener("change",b=>{b.target.files.length>0&&this.importDataFromFile(b.target.files[0])}),this.container.querySelector(".clear-data-btn").addEventListener("click",()=>this.confirmClearData())}async saveDisplayName(){const o=this.container.querySelector("#display-name-input").value.trim(),c=this.container.querySelector("#save-success-msg");if(o)try{await ki(o),c.textContent="Name saved successfully!",c.classList.remove("hidden"),setTimeout(()=>c.classList.add("hidden"),3e3)}catch(d){console.error("Failed to save name:",d),alert("Failed to save name")}}async copyToClipboard(){if(this.identity)try{await navigator.clipboard.writeText(this.identity.publicId);const s=this.container.querySelector(".copy-btn"),o=s.innerHTML;s.innerHTML=`
        <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      `,setTimeout(()=>{s.innerHTML=o},2e3)}catch(s){console.error("Failed to copy:",s)}}async exportDataToFile(){try{const s=await vo(),o=JSON.stringify(s,null,2),c=new Blob([o],{type:"application/json"}),d=URL.createObjectURL(c),f=document.createElement("a");f.href=d,f.download=`chamber-backup-${Date.now()}.json`,f.click(),URL.revokeObjectURL(d)}catch(s){console.error("Failed to export data:",s),alert("Failed to export data")}}async importDataFromFile(s){try{const o=await s.text(),c=JSON.parse(o);confirm("This will replace all existing data. Continue?")&&(await Ro(c),alert("Data imported successfully. Reloading..."),window.location.reload())}catch(o){console.error("Failed to import data:",o),alert("Failed to import data. Please check the file format.")}}async confirmClearData(){if(confirm(`Are you sure you want to delete ALL data? This cannot be undone.

This will delete:
- Your identity and public ID
- All contacts
- All messages
- All images

Type "DELETE" to confirm.`)&&prompt("Type DELETE to confirm:")==="DELETE")try{await Pi(),alert("All data cleared. Reloading..."),window.location.reload()}catch(c){console.error("Failed to clear data:",c),alert("Failed to clear data")}}cleanup(){}}async function fo(){try{let l=await Nn();const s=window.location.hash;if(s!=="#account-recovery")if(l)!await mo()&&!s.includes("recovery-setup")?window.location.hash=`#recovery-setup?publicId=${l.publicId}`:(!s||s==="#onboarding")&&(window.location.hash="#contacts");else{const{publicId:o,codes:c}=await No(),d=await Oo(c);await Mi(o,null,d),sessionStorage.setItem("TEMP_RECOVERY_CODES",JSON.stringify(c)),l=await Nn(),window.location.hash=`#onboarding?publicId=${o}`}un.register("onboarding",i0),un.register("recovery-setup",a0),un.register("account-recovery",c0),un.register("contacts",l0),un.register("chat",u0),un.register("add-contact",d0),un.register("settings",h0),l&&rl((o,c)=>{console.log("New message received from",o),window.dispatchEvent(new CustomEvent("message-received",{detail:{senderId:o,data:c}}))})}catch(l){console.error("Failed to initialize app:",l),document.getElementById("app").innerHTML=`
      <div class="min-h-screen flex items-center justify-center p-4">
        <div class="text-center">
          <h2 class="text-2xl font-bold text-white mb-4">Failed to initialize app</h2>
          <p class="text-gray-400 mb-6">${l.message}</p>
          <button onclick="location.reload()" class="px-6 py-3 bg-gradient-primary text-white rounded-xl">Reload</button>
        </div>
      </div>
    `}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",fo):fo();
